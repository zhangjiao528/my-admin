/*! For license information please see bimmap.js.LICENSE.txt */
var t={9705:(t,e,r)=>{var n=r(1540);function i(t){var e=[1/0,1/0,-1/0,-1/0];return n.coordEach(t,(function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])})),e}i.default=i,e.Z=i},7269:function(t){t.exports=function(){function t(r,n,i,o,a){for(;o>i;){if(o-i>600){var s=o-i+1,u=n-i+1,l=Math.log(s),c=.5*Math.exp(2*l/3),f=.5*Math.sqrt(l*c*(s-c)/s)*(u-s/2<0?-1:1);t(r,n,Math.max(i,Math.floor(n-u*c/s+f)),Math.min(o,Math.floor(n+(s-u)*c/s+f)),a)}var p=r[n],h=i,y=o;for(e(r,i,n),a(r[o],p)>0&&e(r,i,o);h<y;){for(e(r,h,y),h++,y--;a(r[h],p)<0;)h++;for(;a(r[y],p)>0;)y--}0===a(r[i],p)?e(r,i,y):e(r,++y,o),y<=n&&(i=y+1),n<=y&&(o=y-1)}}function e(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function r(t,e){return t<e?-1:t>e?1:0}return function(e,n,i,o,a){t(e,n,i||0,o||e.length-1,a||r)}}()},67:(t,e,r)=>{t.exports=i,t.exports.default=i;var n=r(7269);function i(t,e){if(!(this instanceof i))return new i(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function o(t,e,r){if(!r)return e.indexOf(t);for(var n=0;n<e.length;n++)if(r(t,e[n]))return n;return-1}function a(t,e){s(t,0,t.children.length,e,t)}function s(t,e,r,n,i){i||(i=d(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o,a=e;a<r;a++)o=t.children[a],u(i,t.leaf?n(o):o);return i}function u(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function l(t,e){return t.minX-e.minX}function c(t,e){return t.minY-e.minY}function f(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function p(t){return t.maxX-t.minX+(t.maxY-t.minY)}function h(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function y(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function d(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function g(t,e,r,i,o){for(var a,s=[e,r];s.length;)(r=s.pop())-(e=s.pop())<=i||(a=e+Math.ceil((r-e)/i/2)*i,n(t,a,e,r,o),s.push(e,a,a,r))}i.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,r=[],n=this.toBBox;if(!y(t,e))return r;for(var i,o,a,s,u=[];e;){for(i=0,o=e.children.length;i<o;i++)a=e.children[i],y(t,s=e.leaf?n(a):a)&&(e.leaf?r.push(a):h(t,s)?this._all(a,r):u.push(a));e=u.pop()}return r},collides:function(t){var e=this.data,r=this.toBBox;if(!y(t,e))return!1;for(var n,i,o,a,s=[];e;){for(n=0,i=e.children.length;n<i;n++)if(o=e.children[n],y(t,a=e.leaf?r(o):o)){if(e.leaf||h(t,a))return!0;s.push(o)}e=s.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,r=t.length;e<r;e++)this.insert(t[e]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var i=this.data;this.data=n,n=i}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=d([]),this},remove:function(t,e){if(!t)return this;for(var r,n,i,a,s=this.data,u=this.toBBox(t),l=[],c=[];s||l.length;){if(s||(s=l.pop(),n=l[l.length-1],r=c.pop(),a=!0),s.leaf&&-1!==(i=o(t,s.children,e)))return s.children.splice(i,1),l.push(s),this._condense(l),this;a||s.leaf||!h(s,u)?n?(r++,s=n.children[r],a=!1):s=null:(l.push(s),c.push(r),r=0,n=s,s=s.children[0])}return this},toBBox:function(t){return t},compareMinX:l,compareMinY:c,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var r=[];t;)t.leaf?e.push.apply(e,t.children):r.push.apply(r,t.children),t=r.pop();return e},_build:function(t,e,r,n){var i,o=r-e+1,s=this._maxEntries;if(o<=s)return a(i=d(t.slice(e,r+1)),this.toBBox),i;n||(n=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,n-1))),(i=d([])).leaf=!1,i.height=n;var u,l,c,f,p=Math.ceil(o/s),h=p*Math.ceil(Math.sqrt(s));for(g(t,e,r,h,this.compareMinX),u=e;u<=r;u+=h)for(g(t,u,c=Math.min(u+h-1,r),p,this.compareMinY),l=u;l<=c;l+=p)f=Math.min(l+p-1,c),i.children.push(this._build(t,l,f,n-1));return a(i,this.toBBox),i},_chooseSubtree:function(t,e,r,n){for(var i,o,a,s,u,l,c,p,h,y;n.push(e),!e.leaf&&n.length-1!==r;){for(c=p=1/0,i=0,o=e.children.length;i<o;i++)u=f(a=e.children[i]),h=t,y=a,(l=(Math.max(y.maxX,h.maxX)-Math.min(y.minX,h.minX))*(Math.max(y.maxY,h.maxY)-Math.min(y.minY,h.minY))-u)<p?(p=l,c=u<c?u:c,s=a):l===p&&u<c&&(c=u,s=a);e=s||e.children[0]}return e},_insert:function(t,e,r){var n=this.toBBox,i=r?t:n(t),o=[],a=this._chooseSubtree(i,this.data,e,o);for(a.children.push(t),u(a,i);e>=0&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(i,o,e)},_split:function(t,e){var r=t[e],n=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,n);var o=this._chooseSplitIndex(r,i,n),s=d(r.children.splice(o,r.children.length-o));s.height=r.height,s.leaf=r.leaf,a(r,this.toBBox),a(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(r,s)},_splitRoot:function(t,e){this.data=d([t,e]),this.data.height=t.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,r){var n,i,o,a,u,l,c,p,h,y,d,g,m,v;for(l=c=1/0,n=e;n<=r-e;n++)h=i=s(t,0,n,this.toBBox),y=o=s(t,n,r,this.toBBox),void 0,void 0,void 0,void 0,d=Math.max(h.minX,y.minX),g=Math.max(h.minY,y.minY),m=Math.min(h.maxX,y.maxX),v=Math.min(h.maxY,y.maxY),a=Math.max(0,m-d)*Math.max(0,v-g),u=f(i)+f(o),a<l?(l=a,p=n,c=u<c?u:c):a===l&&u<c&&(c=u,p=n);return p},_chooseSplitAxis:function(t,e,r){var n=t.leaf?this.compareMinX:l,i=t.leaf?this.compareMinY:c;this._allDistMargin(t,e,r,n)<this._allDistMargin(t,e,r,i)&&t.children.sort(n)},_allDistMargin:function(t,e,r,n){t.children.sort(n);var i,o,a=this.toBBox,l=s(t,0,e,a),c=s(t,r-e,r,a),f=p(l)+p(c);for(i=e;i<r-e;i++)o=t.children[i],u(l,t.leaf?a(o):o),f+=p(l);for(i=r-e-1;i>=e;i--)o=t.children[i],u(c,t.leaf?a(o):o),f+=p(c);return f},_adjustParentBBoxes:function(t,e,r){for(var n=r;n>=0;n--)u(e[n],t)},_condense:function(t){for(var e,r=t.length-1;r>=0;r--)0===t[r].children.length?r>0?(e=t[r-1].children).splice(e.indexOf(t[r]),1):this.clear():a(t[r],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}},4102:(t,e)=>{function r(t,e,r){void 0===r&&(r={});var n={type:"Feature"};return(0===r.id||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=e||{},n.geometry=t,n}function n(t,e,n){if(void 0===n&&(n={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!h(t[0])||!h(t[1]))throw new Error("coordinates must contain numbers");return r({type:"Point",coordinates:t},e,n)}function i(t,e,n){void 0===n&&(n={});for(var i=0,o=t;i<o.length;i++){var a=o[i];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<a[a.length-1].length;s++)if(a[a.length-1][s]!==a[0][s])throw new Error("First and last Position are not equivalent.")}return r({type:"Polygon",coordinates:t},e,n)}function o(t,e,n){if(void 0===n&&(n={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return r({type:"LineString",coordinates:t},e,n)}function a(t,e){void 0===e&&(e={});var r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}function s(t,e,n){return void 0===n&&(n={}),r({type:"MultiLineString",coordinates:t},e,n)}function u(t,e,n){return void 0===n&&(n={}),r({type:"MultiPoint",coordinates:t},e,n)}function l(t,e,n){return void 0===n&&(n={}),r({type:"MultiPolygon",coordinates:t},e,n)}function c(t,r){void 0===r&&(r="kilometers");var n=e.factors[r];if(!n)throw new Error(r+" units is invalid");return t*n}function f(t,r){void 0===r&&(r="kilometers");var n=e.factors[r];if(!n)throw new Error(r+" units is invalid");return t/n}function p(t){return t%(2*Math.PI)*180/Math.PI}function h(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.earthRadius=6371008.8,e.factors={centimeters:100*e.earthRadius,centimetres:100*e.earthRadius,degrees:e.earthRadius/111325,feet:3.28084*e.earthRadius,inches:39.37*e.earthRadius,kilometers:e.earthRadius/1e3,kilometres:e.earthRadius/1e3,meters:e.earthRadius,metres:e.earthRadius,miles:e.earthRadius/1609.344,millimeters:1e3*e.earthRadius,millimetres:1e3*e.earthRadius,nauticalmiles:e.earthRadius/1852,radians:1,yards:1.0936*e.earthRadius},e.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/e.earthRadius,yards:1.0936133},e.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},e.feature=r,e.geometry=function(t,e,r){switch(void 0===r&&(r={}),t){case"Point":return n(e).geometry;case"LineString":return o(e).geometry;case"Polygon":return i(e).geometry;case"MultiPoint":return u(e).geometry;case"MultiLineString":return s(e).geometry;case"MultiPolygon":return l(e).geometry;default:throw new Error(t+" is invalid")}},e.point=n,e.points=function(t,e,r){return void 0===r&&(r={}),a(t.map((function(t){return n(t,e)})),r)},e.polygon=i,e.polygons=function(t,e,r){return void 0===r&&(r={}),a(t.map((function(t){return i(t,e)})),r)},e.lineString=o,e.lineStrings=function(t,e,r){return void 0===r&&(r={}),a(t.map((function(t){return o(t,e)})),r)},e.featureCollection=a,e.multiLineString=s,e.multiPoint=u,e.multiPolygon=l,e.geometryCollection=function(t,e,n){return void 0===n&&(n={}),r({type:"GeometryCollection",geometries:t},e,n)},e.round=function(t,e){if(void 0===e&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,e||0);return Math.round(t*r)/r},e.radiansToLength=c,e.lengthToRadians=f,e.lengthToDegrees=function(t,e){return p(f(t,e))},e.bearingToAzimuth=function(t){var e=t%360;return e<0&&(e+=360),e},e.radiansToDegrees=p,e.degreesToRadians=function(t){return t%360*Math.PI/180},e.convertLength=function(t,e,r){if(void 0===e&&(e="kilometers"),void 0===r&&(r="kilometers"),!(t>=0))throw new Error("length must be a positive number");return c(f(t,e),r)},e.convertArea=function(t,r,n){if(void 0===r&&(r="meters"),void 0===n&&(n="kilometers"),!(t>=0))throw new Error("area must be a positive number");var i=e.areaFactors[r];if(!i)throw new Error("invalid original units");var o=e.areaFactors[n];if(!o)throw new Error("invalid final units");return t/i*o},e.isNumber=h,e.isObject=function(t){return!!t&&t.constructor===Object},e.validateBBox=function(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach((function(t){if(!h(t))throw new Error("bbox must only contain numbers")}))},e.validateId=function(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof t))throw new Error("id must be a number or a string")}},1540:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0});var n=r(4102);function i(t,e,r){if(null!==t)for(var n,o,a,s,u,l,c,f,p=0,h=0,y=t.type,d="FeatureCollection"===y,g="Feature"===y,m=d?t.features.length:1,v=0;v<m;v++){u=(f=!!(c=d?t.features[v].geometry:g?t.geometry:t)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var _=0;_<u;_++){var b=0,w=0;if(null!==(s=f?c.geometries[_]:c)){l=s.coordinates;var S=s.type;switch(p=!r||"Polygon"!==S&&"MultiPolygon"!==S?0:1,S){case null:break;case"Point":if(!1===e(l,h,v,b,w))return!1;h++,b++;break;case"LineString":case"MultiPoint":for(n=0;n<l.length;n++){if(!1===e(l[n],h,v,b,w))return!1;h++,"MultiPoint"===S&&b++}"LineString"===S&&b++;break;case"Polygon":case"MultiLineString":for(n=0;n<l.length;n++){for(o=0;o<l[n].length-p;o++){if(!1===e(l[n][o],h,v,b,w))return!1;h++}"MultiLineString"===S&&b++,"Polygon"===S&&w++}"Polygon"===S&&b++;break;case"MultiPolygon":for(n=0;n<l.length;n++){for(w=0,o=0;o<l[n].length;o++){for(a=0;a<l[n][o].length-p;a++){if(!1===e(l[n][o][a],h,v,b,w))return!1;h++}w++}b++}break;case"GeometryCollection":for(n=0;n<s.geometries.length;n++)if(!1===i(s.geometries[n],e,r))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function o(t,e){var r;switch(t.type){case"FeatureCollection":for(r=0;r<t.features.length&&!1!==e(t.features[r].properties,r);r++);break;case"Feature":e(t.properties,0)}}function a(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var r=0;r<t.features.length&&!1!==e(t.features[r],r);r++);}function s(t,e){var r,n,i,o,a,s,u,l,c,f,p=0,h="FeatureCollection"===t.type,y="Feature"===t.type,d=h?t.features.length:1;for(r=0;r<d;r++){for(s=h?t.features[r].geometry:y?t.geometry:t,l=h?t.features[r].properties:y?t.properties:{},c=h?t.features[r].bbox:y?t.bbox:void 0,f=h?t.features[r].id:y?t.id:void 0,a=(u=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,i=0;i<a;i++)if(null!==(o=u?s.geometries[i]:s))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(o,p,l,c,f))return!1;break;case"GeometryCollection":for(n=0;n<o.geometries.length;n++)if(!1===e(o.geometries[n],p,l,c,f))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,p,l,c,f))return!1;p++}}function u(t,e){s(t,(function(t,r,i,o,a){var s,u=null===t?null:t.type;switch(u){case null:case"Point":case"LineString":case"Polygon":return!1!==e(n.feature(t,i,{bbox:o,id:a}),r,0)&&void 0}switch(u){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var l=0;l<t.coordinates.length;l++){var c={type:s,coordinates:t.coordinates[l]};if(!1===e(n.feature(c,i),r,l))return!1}}))}function l(t,e){u(t,(function(t,r,o){var a=0;if(t.geometry){var s=t.geometry.type;if("Point"!==s&&"MultiPoint"!==s){var u,l=0,c=0,f=0;return!1!==i(t,(function(i,s,p,h,y){if(void 0===u||r>l||h>c||y>f)return u=i,l=r,c=h,f=y,void(a=0);var d=n.lineString([u,i],t.properties);if(!1===e(d,r,o,y,a))return!1;a++,u=i}))&&void 0}}}))}function c(t,e){if(!t)throw new Error("geojson is required");u(t,(function(t,r,i){if(null!==t.geometry){var o=t.geometry.type,a=t.geometry.coordinates;switch(o){case"LineString":if(!1===e(t,r,i,0,0))return!1;break;case"Polygon":for(var s=0;s<a.length;s++)if(!1===e(n.lineString(a[s],t.properties),r,i,s))return!1}}}))}e.coordAll=function(t){var e=[];return i(t,(function(t){e.push(t)})),e},e.coordEach=i,e.coordReduce=function(t,e,r,n){var o=r;return i(t,(function(t,n,i,a,s){o=0===n&&void 0===r?t:e(o,t,n,i,a,s)}),n),o},e.featureEach=a,e.featureReduce=function(t,e,r){var n=r;return a(t,(function(t,i){n=0===i&&void 0===r?t:e(n,t,i)})),n},e.findPoint=function(t,e){if(e=e||{},!n.isObject(e))throw new Error("options is invalid");var r,i=e.featureIndex||0,o=e.multiFeatureIndex||0,a=e.geometryIndex||0,s=e.coordIndex||0,u=e.properties;switch(t.type){case"FeatureCollection":i<0&&(i=t.features.length+i),u=u||t.features[i].properties,r=t.features[i].geometry;break;case"Feature":u=u||t.properties,r=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":r=t;break;default:throw new Error("geojson is invalid")}if(null===r)return null;var l=r.coordinates;switch(r.type){case"Point":return n.point(l,u,e);case"MultiPoint":return o<0&&(o=l.length+o),n.point(l[o],u,e);case"LineString":return s<0&&(s=l.length+s),n.point(l[s],u,e);case"Polygon":return a<0&&(a=l.length+a),s<0&&(s=l[a].length+s),n.point(l[a][s],u,e);case"MultiLineString":return o<0&&(o=l.length+o),s<0&&(s=l[o].length+s),n.point(l[o][s],u,e);case"MultiPolygon":return o<0&&(o=l.length+o),a<0&&(a=l[o].length+a),s<0&&(s=l[o][a].length-s),n.point(l[o][a][s],u,e)}throw new Error("geojson is invalid")},e.findSegment=function(t,e){if(e=e||{},!n.isObject(e))throw new Error("options is invalid");var r,i=e.featureIndex||0,o=e.multiFeatureIndex||0,a=e.geometryIndex||0,s=e.segmentIndex||0,u=e.properties;switch(t.type){case"FeatureCollection":i<0&&(i=t.features.length+i),u=u||t.features[i].properties,r=t.features[i].geometry;break;case"Feature":u=u||t.properties,r=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":r=t;break;default:throw new Error("geojson is invalid")}if(null===r)return null;var l=r.coordinates;switch(r.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=l.length+s-1),n.lineString([l[s],l[s+1]],u,e);case"Polygon":return a<0&&(a=l.length+a),s<0&&(s=l[a].length+s-1),n.lineString([l[a][s],l[a][s+1]],u,e);case"MultiLineString":return o<0&&(o=l.length+o),s<0&&(s=l[o].length+s-1),n.lineString([l[o][s],l[o][s+1]],u,e);case"MultiPolygon":return o<0&&(o=l.length+o),a<0&&(a=l[o].length+a),s<0&&(s=l[o][a].length-s-1),n.lineString([l[o][a][s],l[o][a][s+1]],u,e)}throw new Error("geojson is invalid")},e.flattenEach=u,e.flattenReduce=function(t,e,r){var n=r;return u(t,(function(t,i,o){n=0===i&&0===o&&void 0===r?t:e(n,t,i,o)})),n},e.geomEach=s,e.geomReduce=function(t,e,r){var n=r;return s(t,(function(t,i,o,a,s){n=0===i&&void 0===r?t:e(n,t,i,o,a,s)})),n},e.lineEach=c,e.lineReduce=function(t,e,r){var n=r;return c(t,(function(t,i,o,a){n=0===i&&void 0===r?t:e(n,t,i,o,a)})),n},e.propEach=o,e.propReduce=function(t,e,r){var n=r;return o(t,(function(t,i){n=0===i&&void 0===r?t:e(n,t,i)})),n},e.segmentEach=l,e.segmentReduce=function(t,e,r){var n=r,i=!1;return l(t,(function(t,o,a,s,u){n=!1===i&&void 0===r?t:e(n,t,o,a,s,u),i=!0})),n}},9538:function(t){t.exports=function(){function t(r,n,i,o,a){for(;o>i;){if(o-i>600){var s=o-i+1,u=n-i+1,l=Math.log(s),c=.5*Math.exp(2*l/3),f=.5*Math.sqrt(l*c*(s-c)/s)*(u-s/2<0?-1:1);t(r,n,Math.max(i,Math.floor(n-u*c/s+f)),Math.min(o,Math.floor(n+(s-u)*c/s+f)),a)}var p=r[n],h=i,y=o;for(e(r,i,n),a(r[o],p)>0&&e(r,i,o);h<y;){for(e(r,h,y),h++,y--;a(r[h],p)<0;)h++;for(;a(r[y],p)>0;)y--}0===a(r[i],p)?e(r,i,y):e(r,++y,o),y<=n&&(i=y+1),n<=y&&(o=y-1)}}function e(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function r(t,e){return t<e?-1:t>e?1:0}return function(e,n,i,o,a){t(e,n,i||0,o||e.length-1,a||r)}}()},4860:(t,e,r)=>{t.exports=i,t.exports.default=i;var n=r(9538);function i(t,e){if(!(this instanceof i))return new i(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function o(t,e,r){if(!r)return e.indexOf(t);for(var n=0;n<e.length;n++)if(r(t,e[n]))return n;return-1}function a(t,e){s(t,0,t.children.length,e,t)}function s(t,e,r,n,i){i||(i=d(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o,a=e;a<r;a++)o=t.children[a],u(i,t.leaf?n(o):o);return i}function u(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function l(t,e){return t.minX-e.minX}function c(t,e){return t.minY-e.minY}function f(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function p(t){return t.maxX-t.minX+(t.maxY-t.minY)}function h(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function y(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function d(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function g(t,e,r,i,o){for(var a,s=[e,r];s.length;)(r=s.pop())-(e=s.pop())<=i||(a=e+Math.ceil((r-e)/i/2)*i,n(t,a,e,r,o),s.push(e,a,a,r))}i.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,r=[],n=this.toBBox;if(!y(t,e))return r;for(var i,o,a,s,u=[];e;){for(i=0,o=e.children.length;i<o;i++)a=e.children[i],y(t,s=e.leaf?n(a):a)&&(e.leaf?r.push(a):h(t,s)?this._all(a,r):u.push(a));e=u.pop()}return r},collides:function(t){var e=this.data,r=this.toBBox;if(!y(t,e))return!1;for(var n,i,o,a,s=[];e;){for(n=0,i=e.children.length;n<i;n++)if(o=e.children[n],y(t,a=e.leaf?r(o):o)){if(e.leaf||h(t,a))return!0;s.push(o)}e=s.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,r=t.length;e<r;e++)this.insert(t[e]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var i=this.data;this.data=n,n=i}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=d([]),this},remove:function(t,e){if(!t)return this;for(var r,n,i,a,s=this.data,u=this.toBBox(t),l=[],c=[];s||l.length;){if(s||(s=l.pop(),n=l[l.length-1],r=c.pop(),a=!0),s.leaf&&-1!==(i=o(t,s.children,e)))return s.children.splice(i,1),l.push(s),this._condense(l),this;a||s.leaf||!h(s,u)?n?(r++,s=n.children[r],a=!1):s=null:(l.push(s),c.push(r),r=0,n=s,s=s.children[0])}return this},toBBox:function(t){return t},compareMinX:l,compareMinY:c,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var r=[];t;)t.leaf?e.push.apply(e,t.children):r.push.apply(r,t.children),t=r.pop();return e},_build:function(t,e,r,n){var i,o=r-e+1,s=this._maxEntries;if(o<=s)return a(i=d(t.slice(e,r+1)),this.toBBox),i;n||(n=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,n-1))),(i=d([])).leaf=!1,i.height=n;var u,l,c,f,p=Math.ceil(o/s),h=p*Math.ceil(Math.sqrt(s));for(g(t,e,r,h,this.compareMinX),u=e;u<=r;u+=h)for(g(t,u,c=Math.min(u+h-1,r),p,this.compareMinY),l=u;l<=c;l+=p)f=Math.min(l+p-1,c),i.children.push(this._build(t,l,f,n-1));return a(i,this.toBBox),i},_chooseSubtree:function(t,e,r,n){for(var i,o,a,s,u,l,c,p,h,y;n.push(e),!e.leaf&&n.length-1!==r;){for(c=p=1/0,i=0,o=e.children.length;i<o;i++)u=f(a=e.children[i]),h=t,y=a,(l=(Math.max(y.maxX,h.maxX)-Math.min(y.minX,h.minX))*(Math.max(y.maxY,h.maxY)-Math.min(y.minY,h.minY))-u)<p?(p=l,c=u<c?u:c,s=a):l===p&&u<c&&(c=u,s=a);e=s||e.children[0]}return e},_insert:function(t,e,r){var n=this.toBBox,i=r?t:n(t),o=[],a=this._chooseSubtree(i,this.data,e,o);for(a.children.push(t),u(a,i);e>=0&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(i,o,e)},_split:function(t,e){var r=t[e],n=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,n);var o=this._chooseSplitIndex(r,i,n),s=d(r.children.splice(o,r.children.length-o));s.height=r.height,s.leaf=r.leaf,a(r,this.toBBox),a(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(r,s)},_splitRoot:function(t,e){this.data=d([t,e]),this.data.height=t.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,r){var n,i,o,a,u,l,c,p,h,y,d,g,m,v;for(l=c=1/0,n=e;n<=r-e;n++)h=i=s(t,0,n,this.toBBox),y=o=s(t,n,r,this.toBBox),void 0,void 0,void 0,void 0,d=Math.max(h.minX,y.minX),g=Math.max(h.minY,y.minY),m=Math.min(h.maxX,y.maxX),v=Math.min(h.maxY,y.maxY),a=Math.max(0,m-d)*Math.max(0,v-g),u=f(i)+f(o),a<l?(l=a,p=n,c=u<c?u:c):a===l&&u<c&&(c=u,p=n);return p},_chooseSplitAxis:function(t,e,r){var n=t.leaf?this.compareMinX:l,i=t.leaf?this.compareMinY:c;this._allDistMargin(t,e,r,n)<this._allDistMargin(t,e,r,i)&&t.children.sort(n)},_allDistMargin:function(t,e,r,n){t.children.sort(n);var i,o,a=this.toBBox,l=s(t,0,e,a),c=s(t,r-e,r,a),f=p(l)+p(c);for(i=e;i<r-e;i++)o=t.children[i],u(l,t.leaf?a(o):o),f+=p(l);for(i=r-e-1;i>=e;i--)o=t.children[i],u(c,t.leaf?a(o):o),f+=p(c);return f},_adjustParentBBoxes:function(t,e,r){for(var n=r;n>=0;n--)u(e[n],t)},_condense:function(t){for(var e,r=t.length-1;r>=0;r--)0===t[r].children.length?r>0?(e=t[r-1].children).splice(e.indexOf(t[r]),1):this.clear():a(t[r],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}},1924:(t,e,r)=>{var n=r(210),i=r(5559),o=i(n("String.prototype.indexOf"));t.exports=function(t,e){var r=n(t,!!e);return"function"==typeof r&&o(t,".prototype.")>-1?i(r):r}},5559:(t,e,r)=>{var n=r(8612),i=r(210),o=r(7771),a=i("%TypeError%"),s=i("%Function.prototype.apply%"),u=i("%Function.prototype.call%"),l=i("%Reflect.apply%",!0)||n.call(u,s),c=i("%Object.defineProperty%",!0),f=i("%Math.max%");if(c)try{c({},"a",{value:1})}catch(t){c=null}t.exports=function(t){if("function"!=typeof t)throw new a("a function is required");var e=l(n,u,arguments);return o(e,1+f(0,t.length-(arguments.length-1)),!0)};var p=function(){return l(n,s,arguments)};c?c(t.exports,"apply",{value:p}):t.exports.apply=p},2273:(t,e,r)=>{var n=r(2582),i=r(3842),o=r(6960),a=r(8639).orient2d;function s(t,e,r){e=Math.max(0,void 0===e?2:e),r=r||0;var i=function(t){for(var e=t[0],r=t[0],n=t[0],i=t[0],a=0;a<t.length;a++){var s=t[a];s[0]<e[0]&&(e=s),s[0]>n[0]&&(n=s),s[1]<r[1]&&(r=s),s[1]>i[1]&&(i=s)}var u=[e,r,n,i],l=u.slice();for(a=0;a<t.length;a++)o(t[a],u)||l.push(t[a]);return function(t){t.sort(_);for(var e=[],r=0;r<t.length;r++){for(;e.length>=2&&h(e[e.length-2],e[e.length-1],t[r])<=0;)e.pop();e.push(t[r])}for(var n=[],i=t.length-1;i>=0;i--){for(;n.length>=2&&h(n[n.length-2],n[n.length-1],t[i])<=0;)n.pop();n.push(t[i])}return n.pop(),e.pop(),e.concat(n)}(l)}(t),a=new n(16);a.toBBox=function(t){return{minX:t[0],minY:t[1],maxX:t[0],maxY:t[1]}},a.compareMinX=function(t,e){return t[0]-e[0]},a.compareMinY=function(t,e){return t[1]-e[1]},a.load(t);for(var s,l=[],c=0;c<i.length;c++){var f=i[c];a.remove(f),s=d(f,s),l.push(s)}var p=new n(16);for(c=0;c<l.length;c++)p.insert(y(l[c]));for(var m=e*e,v=r*r;l.length;){var b=l.shift(),w=b.p,S=b.next.p,O=g(w,S);if(!(O<v)){var x=O/m;(f=u(a,b.prev.p,w,S,b.next.next.p,x,p))&&Math.min(g(f,w),g(f,S))<=x&&(l.push(b),l.push(d(f,b)),a.remove(f),p.remove(b),p.insert(y(b)),p.insert(y(b.next)))}}b=s;var C=[];do{C.push(b.p),b=b.next}while(b!==s);return C.push(b.p),C}function u(t,e,r,n,o,a,s){for(var u=new i([],l),f=t.data;f;){for(var h=0;h<f.children.length;h++){var y=f.children[h],d=f.leaf?m(y,r,n):c(r,n,y);d>a||u.push({node:y,dist:d})}for(;u.length&&!u.peek().node.children;){var g=u.pop(),v=g.node,_=m(v,e,r),b=m(v,n,o);if(g.dist<_&&g.dist<b&&p(r,v,s)&&p(n,v,s))return v}(f=u.pop())&&(f=f.node)}return null}function l(t,e){return t.dist-e.dist}function c(t,e,r){if(f(t,r)||f(e,r))return 0;var n=v(t[0],t[1],e[0],e[1],r.minX,r.minY,r.maxX,r.minY);if(0===n)return 0;var i=v(t[0],t[1],e[0],e[1],r.minX,r.minY,r.minX,r.maxY);if(0===i)return 0;var o=v(t[0],t[1],e[0],e[1],r.maxX,r.minY,r.maxX,r.maxY);if(0===o)return 0;var a=v(t[0],t[1],e[0],e[1],r.minX,r.maxY,r.maxX,r.maxY);return 0===a?0:Math.min(n,i,o,a)}function f(t,e){return t[0]>=e.minX&&t[0]<=e.maxX&&t[1]>=e.minY&&t[1]<=e.maxY}function p(t,e,r){for(var n,i,o,a,s=Math.min(t[0],e[0]),u=Math.min(t[1],e[1]),l=Math.max(t[0],e[0]),c=Math.max(t[1],e[1]),f=r.search({minX:s,minY:u,maxX:l,maxY:c}),p=0;p<f.length;p++)if(n=f[p].p,i=f[p].next.p,o=t,n!==(a=e)&&i!==o&&h(n,i,o)>0!=h(n,i,a)>0&&h(o,a,n)>0!=h(o,a,i)>0)return!1;return!0}function h(t,e,r){return a(t[0],t[1],e[0],e[1],r[0],r[1])}function y(t){var e=t.p,r=t.next.p;return t.minX=Math.min(e[0],r[0]),t.minY=Math.min(e[1],r[1]),t.maxX=Math.max(e[0],r[0]),t.maxY=Math.max(e[1],r[1]),t}function d(t,e){var r={p:t,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return e?(r.next=e.next,r.prev=e,e.next.prev=r,e.next=r):(r.prev=r,r.next=r),r}function g(t,e){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}function m(t,e,r){var n=e[0],i=e[1],o=r[0]-n,a=r[1]-i;if(0!==o||0!==a){var s=((t[0]-n)*o+(t[1]-i)*a)/(o*o+a*a);s>1?(n=r[0],i=r[1]):s>0&&(n+=o*s,i+=a*s)}return(o=t[0]-n)*o+(a=t[1]-i)*a}function v(t,e,r,n,i,o,a,s){var u,l,c,f,p=r-t,h=n-e,y=a-i,d=s-o,g=t-i,m=e-o,v=p*p+h*h,_=p*y+h*d,b=y*y+d*d,w=p*g+h*m,S=y*g+d*m,O=v*b-_*_,x=O,C=O;0===O?(l=0,x=1,f=S,C=b):(f=v*S-_*w,(l=_*S-b*w)<0?(l=0,f=S,C=b):l>x&&(l=x,f=S+_,C=b)),f<0?(f=0,-w<0?l=0:-w>v?l=x:(l=-w,x=v)):f>C&&(f=C,-w+_<0?l=0:-w+_>v?l=x:(l=-w+_,x=v));var E=(1-(c=0===f?0:f/C))*i+c*a-((1-(u=0===l?0:l/x))*t+u*r),P=(1-c)*o+c*s-((1-u)*e+u*n);return E*E+P*P}function _(t,e){return t[0]===e[0]?t[1]-e[1]:t[0]-e[0]}i.default&&(i=i.default),t.exports=s,t.exports.default=s},892:(t,e,r)=>{r.d(e,{Z:()=>s});var n=r(8081),i=r.n(n),o=r(3645),a=r.n(o)()(i());a.push([t.id,".bimmap-csm-popus {\n  position: absolute;\n  top: 0;\n  left: 0;\n  pointer-events: none;\n}\n.bimmap-csm-popup {\n  width: 5px;\n  height: 5px;\n  pointer-events: all;\n  transform-origin: center center;\n}\n.bimmap-csm-popup_content {\n  position: absolute;\n  left: 0;\n  top: 0;\n  display: inline-block;\n  padding: 5px 5px;\n  white-space: nowrap;\n  background-color: #ffffff;\n  color: #666666;\n  max-width: 200px;\n  min-width: 60px;\n  max-height: 200px;\n  min-height: 60px;\n}\n",""]);const s=a},8633:(t,e,r)=>{r.d(e,{Z:()=>s});var n=r(8081),i=r.n(n),o=r(3645),a=r.n(o)()(i());a.push([t.id,".bimmap-div-none {\n  display: none;\n}\n.bimmap-div-icon_circle {\n  border-radius: 100%;\n  width: 6px;\n  height: 6px;\n}\n.bimmap-marker_text {\n  white-space: nowrap;\n  width: auto;\n  padding: 0px;\n  width: 0px;\n  height: 0px;\n}\n.bimmap-marker_text.leaflet-marker-icon > span {\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  width: auto;\n  display: inline-block;\n  padding: 6px 20px;\n  color: #666666;\n  transform: translate(-50%, -50%);\n  white-space: nowrap;\n  background-repeat: no-repeat;\n  background-size: cover;\n  transform-origin: left top;\n}\n.bimmap-marker_img {\n  width: 0px;\n  height: 0px;\n}\n.bimmap-marker_img.leaflet-marker-icon > img {\n  margin: 0px;\n  border: 0px;\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  width: auto;\n  display: inline-block;\n  padding: 0px;\n  transform: translate(-50%, -50%);\n  transform-origin: left top;\n}\n.bimmap-marker_badge.leaflet-marker-icon > span {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  border-radius: 9px;\n  overflow: hidden;\n  width: 38px;\n  height: 26px;\n  padding: 0px;\n}\n.bimmap-popup.leaflet-popup {\n  margin-bottom: 0px;\n}\n.bimmap-popup .leaflet-popup-content-wrapper {\n  border-radius: 0px;\n}\n.bimmap-popup .leaflet-popup-tip-container {\n  display: none;\n}\n.bimmap-popup .leaflet-popup-content {\n  margin: 0;\n  padding: 3px 5px;\n  text-align: center;\n}\n.bimmap-popup .bimmap-popup-content {\n  width: 100%;\n  min-height: 60px;\n  background-color: #ffffff;\n}\n.bimmap-popup.bimmap-popup_nbg {\n  background: none;\n}\n.bimmap-popup.bimmap-popup_nbg .leaflet-popup-content-wrapper {\n  background: none;\n  padding: 0px;\n  box-shadow: none;\n}\n",""]);const s=a},7823:(t,e,r)=>{r.d(e,{Z:()=>s});var n=r(8081),i=r.n(n),o=r(3645),a=r.n(o)()(i());a.push([t.id,".bimmap-smap-popus {\n  position: absolute;\n  top: 0;\n  left: 0;\n  pointer-events: none;\n}\n.bimmap-smap-popup {\n  width: 5px;\n  height: 5px;\n  pointer-events: all;\n  transform-origin: center center;\n}\n.bimmap-smap-popup_content {\n  position: absolute;\n  left: 0;\n  top: 0;\n  display: inline-block;\n  padding: 5px 5px;\n  white-space: nowrap;\n  background-color: #ffffff;\n  color: #666666;\n  max-width: 200px;\n  min-width: 60px;\n  max-height: 200px;\n  min-height: 60px;\n}\n/* 态势标绘样式 */\n.bimmap-smap-plotting {\n  position: fixed;\n  top: 0px;\n  left: 0px;\n  width: 320px;\n  height: 100%;\n  z-index: 9998;\n  display: none;\n}\n.bimmap-smap-plotting .easyui-tabs {\n  display: flex;\n  flex-direction: column;\n}\n.bimmap-smap-plotting .tabs-panels {\n  flex: 1;\n}\n.bimmap-smap-plotting .tabs-panels .panel-body-noheader {\n  height: 100%;\n  overflow: auto;\n}\n.bimmap-smap-plotting .panel,\n.bimmap-smap-plotting .easyui-panel,\n.bimmap-smap-plotting .tabs-panels,\n.bimmap-smap-plotting .panel-body {\n  height: 100%;\n  overflow: hidden;\n}\n.bimmap-smap-plotting_panel {\n  position: absolute;\n  top: 0px;\n  bottom: 0px;\n  left: 0px;\n  right: 0px;\n  padding: 0px;\n  width: 100%;\n  height: 100%;\n}\n.bimmap-smap-plotting .easyui-tabs {\n  width: 100%;\n  height: 100%;\n}\n.bimmap-smap-plotting #icon td > div {\n  cursor: pointer;\n  transition: all 0.2s linear;\n}\n.bimmap-smap-plotting #icon td > div:hover,\n.bimmap-smap-plotting #icon td > div.selected {\n  background-color: rgba(0, 0, 0, 0.2);\n}\n.bimmap-smap-plotting #icon td > div img,\n.bimmap-smap-plotting #icon td > div div {\n  pointer-events: none;\n}\n",""]);const s=a},3645:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var r="",n=void 0!==e[5];return e[4]&&(r+="@supports (".concat(e[4],") {")),e[2]&&(r+="@media ".concat(e[2]," {")),n&&(r+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),r+=t(e),n&&(r+="}"),e[2]&&(r+="}"),e[4]&&(r+="}"),r})).join("")},e.i=function(t,r,n,i,o){"string"==typeof t&&(t=[[null,t,void 0]]);var a={};if(n)for(var s=0;s<this.length;s++){var u=this[s][0];null!=u&&(a[u]=!0)}for(var l=0;l<t.length;l++){var c=[].concat(t[l]);n&&a[c[0]]||(void 0!==o&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=o),r&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=r):c[2]=r),i&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=i):c[4]="".concat(i)),e.push(c))}},e}},8081:t=>{t.exports=function(t){return t[1]}},251:(t,e,r)=>{var n=r(2215),i=r(2584),o=r(609),a=r(8420),s=r(2847),u=r(8923),l=Date.prototype.getTime;function c(t){return null==t}function f(t){return!(!t||"object"!=typeof t||"number"!=typeof t.length||"function"!=typeof t.copy||"function"!=typeof t.slice||t.length>0&&"number"!=typeof t[0])}t.exports=function t(e,r,p){var h=p||{};return!!(h.strict?o(e,r):e===r)||(!e||!r||"object"!=typeof e&&"object"!=typeof r?h.strict?o(e,r):e==r:function(e,r,o){var p,h;if(typeof e!=typeof r)return!1;if(c(e)||c(r))return!1;if(e.prototype!==r.prototype)return!1;if(i(e)!==i(r))return!1;var y=a(e),d=a(r);if(y!==d)return!1;if(y||d)return e.source===r.source&&s(e)===s(r);if(u(e)&&u(r))return l.call(e)===l.call(r);var g=f(e),m=f(r);if(g!==m)return!1;if(g||m){if(e.length!==r.length)return!1;for(p=0;p<e.length;p++)if(e[p]!==r[p])return!1;return!0}if(typeof e!=typeof r)return!1;try{var v=n(e),_=n(r)}catch(t){return!1}if(v.length!==_.length)return!1;for(v.sort(),_.sort(),p=v.length-1;p>=0;p--)if(v[p]!=_[p])return!1;for(p=v.length-1;p>=0;p--)if(!t(e[h=v[p]],r[h],o))return!1;return!0}(e,r,h))}},2296:(t,e,r)=>{var n=r(1044)(),i=r(210),o=n&&i("%Object.defineProperty%",!0);if(o)try{o({},"a",{value:1})}catch(t){o=!1}var a=i("%SyntaxError%"),s=i("%TypeError%"),u=r(7296);t.exports=function(t,e,r){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new s("`obj` must be an object or a function`");if("string"!=typeof e&&"symbol"!=typeof e)throw new s("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new s("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new s("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new s("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new s("`loose`, if provided, must be a boolean");var n=arguments.length>3?arguments[3]:null,i=arguments.length>4?arguments[4]:null,l=arguments.length>5?arguments[5]:null,c=arguments.length>6&&arguments[6],f=!!u&&u(t,e);if(o)o(t,e,{configurable:null===l&&f?f.configurable:!l,enumerable:null===n&&f?f.enumerable:!n,value:r,writable:null===i&&f?f.writable:!i});else{if(!c&&(n||i||l))throw new a("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");t[e]=r}}},4289:(t,e,r)=>{var n=r(2215),i="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),o=Object.prototype.toString,a=Array.prototype.concat,s=r(2296),u=r(1044)(),l=function(t,e,r,n){if(e in t)if(!0===n){if(t[e]===r)return}else if("function"!=typeof(i=n)||"[object Function]"!==o.call(i)||!n())return;var i;u?s(t,e,r,!0):s(t,e,r)},c=function(t,e){var r=arguments.length>2?arguments[2]:{},o=n(e);i&&(o=a.call(o,Object.getOwnPropertySymbols(e)));for(var s=0;s<o.length;s+=1)l(t,o[s],e[o[s]],r[o[s]])};c.supportsDescriptors=!!u,t.exports=c},8317:t=>{function e(t,e,r,n){this.dataset=[],this.epsilon=1,this.minPts=2,this.distance=this._euclideanDistance,this.clusters=[],this.noise=[],this._visited=[],this._assigned=[],this._datasetLength=0,this._init(t,e,r,n)}e.prototype.run=function(t,e,r,n){this._init(t,e,r,n);for(var i=0;i<this._datasetLength;i++)if(1!==this._visited[i]){this._visited[i]=1;var o=this._regionQuery(i);if(o.length<this.minPts)this.noise.push(i);else{var a=this.clusters.length;this.clusters.push([]),this._addToCluster(i,a),this._expandCluster(a,o)}}return this.clusters},e.prototype._init=function(t,e,r,n){if(t){if(!(t instanceof Array))throw Error("Dataset must be of type array, "+typeof t+" given");this.dataset=t,this.clusters=[],this.noise=[],this._datasetLength=t.length,this._visited=new Array(this._datasetLength),this._assigned=new Array(this._datasetLength)}e&&(this.epsilon=e),r&&(this.minPts=r),n&&(this.distance=n)},e.prototype._expandCluster=function(t,e){for(var r=0;r<e.length;r++){var n=e[r];if(1!==this._visited[n]){this._visited[n]=1;var i=this._regionQuery(n);i.length>=this.minPts&&(e=this._mergeArrays(e,i))}1!==this._assigned[n]&&this._addToCluster(n,t)}},e.prototype._addToCluster=function(t,e){this.clusters[e].push(t),this._assigned[t]=1},e.prototype._regionQuery=function(t){for(var e=[],r=0;r<this._datasetLength;r++)this.distance(this.dataset[t],this.dataset[r])<this.epsilon&&e.push(r);return e},e.prototype._mergeArrays=function(t,e){for(var r=e.length,n=0;n<r;n++){var i=e[n];t.indexOf(i)<0&&t.push(i)}return t},e.prototype._euclideanDistance=function(t,e){for(var r=0,n=Math.min(t.length,e.length);n--;)r+=(t[n]-e[n])*(t[n]-e[n]);return Math.sqrt(r)},t.exports&&(t.exports=e)},3781:t=>{function e(t,e,r){this.k=3,this.dataset=[],this.assignments=[],this.centroids=[],this.init(t,e,r)}e.prototype.init=function(t,e,r){this.assignments=[],this.centroids=[],void 0!==t&&(this.dataset=t),void 0!==e&&(this.k=e),void 0!==r&&(this.distance=r)},e.prototype.run=function(t,e){this.init(t,e);for(var r=this.dataset.length,n=0;n<this.k;n++)this.centroids[n]=this.randomCentroid();for(var i=!0;i;){i=this.assign();for(var o=0;o<this.k;o++){for(var a=new Array(c),s=0,u=0;u<c;u++)a[u]=0;for(var l=0;l<r;l++){var c=this.dataset[l].length;if(o===this.assignments[l]){for(u=0;u<c;u++)a[u]+=this.dataset[l][u];s++}}if(s>0){for(u=0;u<c;u++)a[u]/=s;this.centroids[o]=a}else this.centroids[o]=this.randomCentroid(),i=!0}}return this.getClusters()},e.prototype.randomCentroid=function(){var t,e,r=this.dataset.length-1;do{e=Math.round(Math.random()*r),t=this.dataset[e]}while(this.centroids.indexOf(t)>=0);return t},e.prototype.assign=function(){for(var t,e=!1,r=this.dataset.length,n=0;n<r;n++)(t=this.argmin(this.dataset[n],this.centroids,this.distance))!=this.assignments[n]&&(this.assignments[n]=t,e=!0);return e},e.prototype.getClusters=function(){for(var t,e=new Array(this.k),r=0;r<this.assignments.length;r++)void 0===e[t=this.assignments[r]]&&(e[t]=[]),e[t].push(r);return e},e.prototype.argmin=function(t,e,r){for(var n,i=Number.MAX_VALUE,o=0,a=e.length,s=0;s<a;s++)(n=r(t,e[s]))<i&&(i=n,o=s);return o},e.prototype.distance=function(t,e){for(var r=0,n=Math.min(t.length,e.length);n--;){var i=t[n]-e[n];r+=i*i}return Math.sqrt(r)},t.exports&&(t.exports=e)},3763:(t,e,r)=>{if(t.exports)var n=r(7985);function i(t,e,r,n){this.epsilon=1,this.minPts=1,this.distance=this._euclideanDistance,this._reachability=[],this._processed=[],this._coreDistance=0,this._orderedList=[],this._init(t,e,r,n)}i.prototype.run=function(t,e,r,i){this._init(t,e,r,i);for(var o=0,a=this.dataset.length;o<a;o++)if(1!==this._processed[o]){this._processed[o]=1,this.clusters.push([o]);var s=this.clusters.length-1;this._orderedList.push(o);var u=new n(null,null,"asc"),l=this._regionQuery(o);void 0!==this._distanceToCore(o)&&(this._updateQueue(o,l,u),this._expandCluster(s,u))}return this.clusters},i.prototype.getReachabilityPlot=function(){for(var t=[],e=0,r=this._orderedList.length;e<r;e++){var n=this._orderedList[e],i=this._reachability[n];t.push([n,i])}return t},i.prototype._init=function(t,e,r,n){if(t){if(!(t instanceof Array))throw Error("Dataset must be of type array, "+typeof t+" given");this.dataset=t,this.clusters=[],this._reachability=new Array(this.dataset.length),this._processed=new Array(this.dataset.length),this._coreDistance=0,this._orderedList=[]}e&&(this.epsilon=e),r&&(this.minPts=r),n&&(this.distance=n)},i.prototype._updateQueue=function(t,e,r){var n=this;this._coreDistance=this._distanceToCore(t),e.forEach((function(e){if(void 0===n._processed[e]){var i=n.distance(n.dataset[t],n.dataset[e]),o=Math.max(n._coreDistance,i);void 0===n._reachability[e]?(n._reachability[e]=o,r.insert(e,o)):o<n._reachability[e]&&(n._reachability[e]=o,r.remove(e),r.insert(e,o))}}))},i.prototype._expandCluster=function(t,e){for(var r=e.getElements(),n=0,i=r.length;n<i;n++){var o=r[n];if(void 0===this._processed[o]){var a=this._regionQuery(o);this._processed[o]=1,this.clusters[t].push(o),this._orderedList.push(o),void 0!==this._distanceToCore(o)&&(this._updateQueue(o,a,e),this._expandCluster(t,e))}}},i.prototype._distanceToCore=function(t){for(var e=this.epsilon,r=0;r<e;r++)if(this._regionQuery(t,r).length>=this.minPts)return r},i.prototype._regionQuery=function(t,e){e=e||this.epsilon;for(var r=[],n=0,i=this.dataset.length;n<i;n++)this.distance(this.dataset[t],this.dataset[n])<e&&r.push(n);return r},i.prototype._euclideanDistance=function(t,e){for(var r=0,n=Math.min(t.length,e.length);n--;)r+=(t[n]-e[n])*(t[n]-e[n]);return Math.sqrt(r)},t.exports&&(t.exports=i)},7985:t=>{function e(t,e,r){this._queue=[],this._priorities=[],this._sorting="desc",this._init(t,e,r)}e.prototype.insert=function(t,e){for(var r=this._queue.length,n=r;n--;){var i=this._priorities[n];"desc"===this._sorting?e>i&&(r=n):e<i&&(r=n)}this._insertAt(t,e,r)},e.prototype.remove=function(t){for(var e=this._queue.length;e--;)if(t===this._queue[e]){this._queue.splice(e,1),this._priorities.splice(e,1);break}},e.prototype.forEach=function(t){this._queue.forEach(t)},e.prototype.getElements=function(){return this._queue},e.prototype.getElementPriority=function(t){return this._priorities[t]},e.prototype.getPriorities=function(){return this._priorities},e.prototype.getElementsWithPriorities=function(){for(var t=[],e=0,r=this._queue.length;e<r;e++)t.push([this._queue[e],this._priorities[e]]);return t},e.prototype._init=function(t,e,r){if(t&&e){if(this._queue=[],this._priorities=[],t.length!==e.length)throw new Error("Arrays must have the same length");for(var n=0;n<t.length;n++)this.insert(t[n],e[n])}r&&(this._sorting=r)},e.prototype._insertAt=function(t,e,r){this._queue.length===r?(this._queue.push(t),this._priorities.push(e)):(this._queue.splice(r,0,t),this._priorities.splice(r,0,e))},t.exports&&(t.exports=e)},2606:(t,e,r)=>{t.exports&&(t.exports={DBSCAN:r(8317),KMEANS:r(3781),OPTICS:r(3763),PriorityQueue:r(7985)})},9187:t=>{function e(t,e,n){n=n||2;var o,a,s,u,f,p,y,d=e&&e.length,g=d?e[0]*n:t.length,m=r(t,0,g,n,!0),v=[];if(!m||m.next===m.prev)return v;if(d&&(m=function(t,e,n,i){var o,a,s,u=[];for(o=0,a=e.length;o<a;o++)(s=r(t,e[o]*i,o<a-1?e[o+1]*i:t.length,i,!1))===s.next&&(s.steiner=!0),u.push(h(s));for(u.sort(l),o=0;o<u.length;o++)n=c(u[o],n);return n}(t,e,m,n)),t.length>80*n){o=s=t[0],a=u=t[1];for(var _=n;_<g;_+=n)(f=t[_])<o&&(o=f),(p=t[_+1])<a&&(a=p),f>s&&(s=f),p>u&&(u=p);y=0!==(y=Math.max(s-o,u-a))?32767/y:0}return i(m,v,n,o,a,y,0),v}function r(t,e,r,n,i){var o,a;if(i===E(t,e,r,n)>0)for(o=e;o<r;o+=n)a=O(o,t[o],t[o+1],a);else for(o=r-n;o>=e;o-=n)a=O(o,t[o],t[o+1],a);return a&&m(a,a.next)&&(x(a),a=a.next),a}function n(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!m(n,n.next)&&0!==g(n.prev,n,n.next))n=n.next;else{if(x(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function i(t,e,r,l,c,f,h){if(t){!h&&f&&function(t,e,r,n){var i=t;do{0===i.z&&(i.z=p(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,r,n,i,o,a,s,u,l=1;do{for(r=t,t=null,o=null,a=0;r;){for(a++,n=r,s=0,e=0;e<l&&(s++,n=n.nextZ);e++);for(u=l;s>0||u>0&&n;)0!==s&&(0===u||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;r=n}o.nextZ=null,l*=2}while(a>1)}(i)}(t,l,c,f);for(var y,d,g=t;t.prev!==t.next;)if(y=t.prev,d=t.next,f?a(t,l,c,f):o(t))e.push(y.i/r|0),e.push(t.i/r|0),e.push(d.i/r|0),x(t),t=d.next,g=d.next;else if((t=d)===g){h?1===h?i(t=s(n(t),e,r),e,r,l,c,f,2):2===h&&u(t,e,r,l,c,f):i(n(t),e,r,l,c,f,1);break}}}function o(t){var e=t.prev,r=t,n=t.next;if(g(e,r,n)>=0)return!1;for(var i=e.x,o=r.x,a=n.x,s=e.y,u=r.y,l=n.y,c=i<o?i<a?i:a:o<a?o:a,f=s<u?s<l?s:l:u<l?u:l,p=i>o?i>a?i:a:o>a?o:a,h=s>u?s>l?s:l:u>l?u:l,d=n.next;d!==e;){if(d.x>=c&&d.x<=p&&d.y>=f&&d.y<=h&&y(i,s,o,u,a,l,d.x,d.y)&&g(d.prev,d,d.next)>=0)return!1;d=d.next}return!0}function a(t,e,r,n){var i=t.prev,o=t,a=t.next;if(g(i,o,a)>=0)return!1;for(var s=i.x,u=o.x,l=a.x,c=i.y,f=o.y,h=a.y,d=s<u?s<l?s:l:u<l?u:l,m=c<f?c<h?c:h:f<h?f:h,v=s>u?s>l?s:l:u>l?u:l,_=c>f?c>h?c:h:f>h?f:h,b=p(d,m,e,r,n),w=p(v,_,e,r,n),S=t.prevZ,O=t.nextZ;S&&S.z>=b&&O&&O.z<=w;){if(S.x>=d&&S.x<=v&&S.y>=m&&S.y<=_&&S!==i&&S!==a&&y(s,c,u,f,l,h,S.x,S.y)&&g(S.prev,S,S.next)>=0)return!1;if(S=S.prevZ,O.x>=d&&O.x<=v&&O.y>=m&&O.y<=_&&O!==i&&O!==a&&y(s,c,u,f,l,h,O.x,O.y)&&g(O.prev,O,O.next)>=0)return!1;O=O.nextZ}for(;S&&S.z>=b;){if(S.x>=d&&S.x<=v&&S.y>=m&&S.y<=_&&S!==i&&S!==a&&y(s,c,u,f,l,h,S.x,S.y)&&g(S.prev,S,S.next)>=0)return!1;S=S.prevZ}for(;O&&O.z<=w;){if(O.x>=d&&O.x<=v&&O.y>=m&&O.y<=_&&O!==i&&O!==a&&y(s,c,u,f,l,h,O.x,O.y)&&g(O.prev,O,O.next)>=0)return!1;O=O.nextZ}return!0}function s(t,e,r){var i=t;do{var o=i.prev,a=i.next.next;!m(o,a)&&v(o,i,i.next,a)&&w(o,a)&&w(a,o)&&(e.push(o.i/r|0),e.push(i.i/r|0),e.push(a.i/r|0),x(i),x(i.next),i=t=a),i=i.next}while(i!==t);return n(i)}function u(t,e,r,o,a,s){var u=t;do{for(var l=u.next.next;l!==u.prev;){if(u.i!==l.i&&d(u,l)){var c=S(u,l);return u=n(u,u.next),c=n(c,c.next),i(u,e,r,o,a,s,0),void i(c,e,r,o,a,s,0)}l=l.next}u=u.next}while(u!==t)}function l(t,e){return t.x-e.x}function c(t,e){var r=function(t,e){var r,n=e,i=t.x,o=t.y,a=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>a&&(a=s,r=n.x<n.next.x?n:n.next,s===i))return r}n=n.next}while(n!==e);if(!r)return null;var u,l=r,c=r.x,p=r.y,h=1/0;n=r;do{i>=n.x&&n.x>=c&&i!==n.x&&y(o<p?i:a,o,c,p,o<p?a:i,o,n.x,n.y)&&(u=Math.abs(o-n.y)/(i-n.x),w(n,t)&&(u<h||u===h&&(n.x>r.x||n.x===r.x&&f(r,n)))&&(r=n,h=u)),n=n.next}while(n!==l);return r}(t,e);if(!r)return e;var i=S(r,t);return n(i,i.next),n(r,r.next)}function f(t,e){return g(t.prev,t,e.prev)<0&&g(e.next,t,t.next)<0}function p(t,e,r,n,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function h(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function y(t,e,r,n,i,o,a,s){return(i-a)*(e-s)>=(t-a)*(o-s)&&(t-a)*(n-s)>=(r-a)*(e-s)&&(r-a)*(o-s)>=(i-a)*(n-s)}function d(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&v(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(w(t,e)&&w(e,t)&&function(t,e){var r=t,n=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)&&(g(t.prev,t,e.prev)||g(t,e.prev,e))||m(t,e)&&g(t.prev,t,t.next)>0&&g(e.prev,e,e.next)>0)}function g(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function m(t,e){return t.x===e.x&&t.y===e.y}function v(t,e,r,n){var i=b(g(t,e,r)),o=b(g(t,e,n)),a=b(g(r,n,t)),s=b(g(r,n,e));return i!==o&&a!==s||!(0!==i||!_(t,r,e))||!(0!==o||!_(t,n,e))||!(0!==a||!_(r,t,n))||!(0!==s||!_(r,e,n))}function _(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function b(t){return t>0?1:t<0?-1:0}function w(t,e){return g(t.prev,t,t.next)<0?g(t,e,t.next)>=0&&g(t,t.prev,e)>=0:g(t,e,t.prev)<0||g(t,t.next,e)<0}function S(t,e){var r=new C(t.i,t.x,t.y),n=new C(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function O(t,e,r,n){var i=new C(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function x(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function C(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function E(t,e,r,n){for(var i=0,o=e,a=r-n;o<r;o+=n)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}t.exports=e,t.exports.default=e,e.deviation=function(t,e,r,n){var i=e&&e.length,o=i?e[0]*r:t.length,a=Math.abs(E(t,0,o,r));if(i)for(var s=0,u=e.length;s<u;s++){var l=e[s]*r,c=s<u-1?e[s+1]*r:t.length;a-=Math.abs(E(t,l,c,r))}var f=0;for(s=0;s<n.length;s+=3){var p=n[s]*r,h=n[s+1]*r,y=n[s+2]*r;f+=Math.abs((t[p]-t[y])*(t[h+1]-t[p+1])-(t[p]-t[h])*(t[y+1]-t[p+1]))}return 0===a&&0===f?0:Math.abs((f-a)/a)},e.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)r.vertices.push(t[i][o][a]);i>0&&(n+=t[i-1].length,r.holes.push(n))}return r}},7648:t=>{var e=Object.prototype.toString,r=Math.max,n=function(t,e){for(var r=[],n=0;n<t.length;n+=1)r[n]=t[n];for(var i=0;i<e.length;i+=1)r[i+t.length]=e[i];return r};t.exports=function(t){var i=this;if("function"!=typeof i||"[object Function]"!==e.apply(i))throw new TypeError("Function.prototype.bind called on incompatible "+i);for(var o,a=function(t,e){for(var r=[],n=1,i=0;n<t.length;n+=1,i+=1)r[i]=t[n];return r}(arguments),s=r(0,i.length-a.length),u=[],l=0;l<s;l++)u[l]="$"+l;if(o=Function("binder","return function ("+function(t,e){for(var r="",n=0;n<t.length;n+=1)r+=t[n],n+1<t.length&&(r+=",");return r}(u)+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof o){var e=i.apply(this,n(a,arguments));return Object(e)===e?e:this}return i.apply(t,n(a,arguments))})),i.prototype){var c=function(){};c.prototype=i.prototype,o.prototype=new c,c.prototype=null}return o}},8612:(t,e,r)=>{var n=r(7648);t.exports=Function.prototype.bind||n},5972:t=>{var e=function(){return"string"==typeof function(){}.name},r=Object.getOwnPropertyDescriptor;if(r)try{r([],"length")}catch(t){r=null}e.functionsHaveConfigurableNames=function(){if(!e()||!r)return!1;var t=r((function(){}),"name");return!!t&&!!t.configurable};var n=Function.prototype.bind;e.boundFunctionsHaveNames=function(){return e()&&"function"==typeof n&&""!==function(){}.bind().name},t.exports=e},9657:(t,e,r)=>{var n=r(251),i=function(t){this.precision=t&&t.precision?t.precision:17,this.direction=!(!t||!t.direction)&&t.direction,this.pseudoNode=!(!t||!t.pseudoNode)&&t.pseudoNode,this.objectComparator=t&&t.objectComparator?t.objectComparator:s};function o(t){return t.coordinates.map((function(e){return{type:t.type.replace("Multi",""),coordinates:e}}))}function a(t,e){return t.hasOwnProperty("coordinates")?t.coordinates.length===e.coordinates.length:t.length===e.length}function s(t,e){return n(t,e,{strict:!0})}i.prototype.compare=function(t,e){if(t.type!==e.type||!a(t,e))return!1;switch(t.type){case"Point":return this.compareCoord(t.coordinates,e.coordinates);case"LineString":return this.compareLine(t.coordinates,e.coordinates,0,!1);case"Polygon":return this.comparePolygon(t,e);case"Feature":return this.compareFeature(t,e);default:if(0===t.type.indexOf("Multi")){var r=this,n=o(t),i=o(e);return n.every((function(t){return this.some((function(e){return r.compare(t,e)}))}),i)}}return!1},i.prototype.compareCoord=function(t,e){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r++)if(t[r].toFixed(this.precision)!==e[r].toFixed(this.precision))return!1;return!0},i.prototype.compareLine=function(t,e,r,n){if(!a(t,e))return!1;var i=this.pseudoNode?t:this.removePseudo(t),o=this.pseudoNode?e:this.removePseudo(e);if(!n||this.compareCoord(i[0],o[0])||(o=this.fixStartIndex(o,i))){var s=this.compareCoord(i[r],o[r]);return this.direction||s?this.comparePath(i,o):!!this.compareCoord(i[r],o[o.length-(1+r)])&&this.comparePath(i.slice().reverse(),o)}},i.prototype.fixStartIndex=function(t,e){for(var r,n=-1,i=0;i<t.length;i++)if(this.compareCoord(t[i],e[0])){n=i;break}return n>=0&&(r=[].concat(t.slice(n,t.length),t.slice(1,n+1))),r},i.prototype.comparePath=function(t,e){var r=this;return t.every((function(t,e){return r.compareCoord(t,this[e])}),e)},i.prototype.comparePolygon=function(t,e){if(this.compareLine(t.coordinates[0],e.coordinates[0],1,!0)){var r=t.coordinates.slice(1,t.coordinates.length),n=e.coordinates.slice(1,e.coordinates.length),i=this;return r.every((function(t){return this.some((function(e){return i.compareLine(t,e,1,!0)}))}),n)}return!1},i.prototype.compareFeature=function(t,e){return!(t.id!==e.id||!this.objectComparator(t.properties,e.properties)||!this.compareBBox(t,e))&&this.compare(t.geometry,e.geometry)},i.prototype.compareBBox=function(t,e){return!!(!t.bbox&&!e.bbox||t.bbox&&e.bbox&&this.compareCoord(t.bbox,e.bbox))},i.prototype.removePseudo=function(t){return t},t.exports=i},1787:(t,e,r)=>{var n=r(2582),i=r(4102),o=r(1540),a=r(9705).Z,s=o.featureEach,u=(o.coordEach,i.polygon,i.featureCollection);function l(t){var e=new n(t);return e.insert=function(t){if("Feature"!==t.type)throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:a(t),n.prototype.insert.call(this,t)},e.load=function(t){var e=[];return Array.isArray(t)?t.forEach((function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox?t.bbox:a(t),e.push(t)})):s(t,(function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox?t.bbox:a(t),e.push(t)})),n.prototype.load.call(this,e)},e.remove=function(t,e){if("Feature"!==t.type)throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:a(t),n.prototype.remove.call(this,t,e)},e.clear=function(){return n.prototype.clear.call(this)},e.search=function(t){var e=n.prototype.search.call(this,this.toBBox(t));return u(e)},e.collides=function(t){return n.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=n.prototype.all.call(this);return u(t)},e.toJSON=function(){return n.prototype.toJSON.call(this)},e.fromJSON=function(t){return n.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var e;if(t.bbox)e=t.bbox;else if(Array.isArray(t)&&4===t.length)e=t;else if(Array.isArray(t)&&6===t.length)e=[t[0],t[1],t[3],t[4]];else if("Feature"===t.type)e=a(t);else{if("FeatureCollection"!==t.type)throw new Error("invalid geojson");e=a(t)}return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}},e}t.exports=l,t.exports.default=l},210:(t,e,r)=>{var n,i=SyntaxError,o=Function,a=TypeError,s=function(t){try{return o('"use strict"; return ('+t+").constructor;")()}catch(t){}},u=Object.getOwnPropertyDescriptor;if(u)try{u({},"")}catch(t){u=null}var l=function(){throw new a},c=u?function(){try{return l}catch(t){try{return u(arguments,"callee").get}catch(t){return l}}}():l,f=r(1405)(),p=r(8185)(),h=Object.getPrototypeOf||(p?function(t){return t.__proto__}:null),y={},d="undefined"!=typeof Uint8Array&&h?h(Uint8Array):n,g={"%AggregateError%":"undefined"==typeof AggregateError?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?n:ArrayBuffer,"%ArrayIteratorPrototype%":f&&h?h([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":y,"%AsyncGenerator%":y,"%AsyncGeneratorFunction%":y,"%AsyncIteratorPrototype%":y,"%Atomics%":"undefined"==typeof Atomics?n:Atomics,"%BigInt%":"undefined"==typeof BigInt?n:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?n:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?n:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?n:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?n:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?n:FinalizationRegistry,"%Function%":o,"%GeneratorFunction%":y,"%Int8Array%":"undefined"==typeof Int8Array?n:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?n:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":f&&h?h(h([][Symbol.iterator]())):n,"%JSON%":"object"==typeof JSON?JSON:n,"%Map%":"undefined"==typeof Map?n:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&f&&h?h((new Map)[Symbol.iterator]()):n,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?n:Promise,"%Proxy%":"undefined"==typeof Proxy?n:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?n:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?n:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&f&&h?h((new Set)[Symbol.iterator]()):n,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":f&&h?h(""[Symbol.iterator]()):n,"%Symbol%":f?Symbol:n,"%SyntaxError%":i,"%ThrowTypeError%":c,"%TypedArray%":d,"%TypeError%":a,"%Uint8Array%":"undefined"==typeof Uint8Array?n:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?n:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?n:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?n:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?n:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?n:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?n:WeakSet};if(h)try{null.error}catch(t){var m=h(h(t));g["%Error.prototype%"]=m}var v=function t(e){var r;if("%AsyncFunction%"===e)r=s("async function () {}");else if("%GeneratorFunction%"===e)r=s("function* () {}");else if("%AsyncGeneratorFunction%"===e)r=s("async function* () {}");else if("%AsyncGenerator%"===e){var n=t("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if("%AsyncIteratorPrototype%"===e){var i=t("%AsyncGenerator%");i&&h&&(r=h(i.prototype))}return g[e]=r,r},_={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},b=r(8612),w=r(8824),S=b.call(Function.call,Array.prototype.concat),O=b.call(Function.apply,Array.prototype.splice),x=b.call(Function.call,String.prototype.replace),C=b.call(Function.call,String.prototype.slice),E=b.call(Function.call,RegExp.prototype.exec),P=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,k=/\\(\\)?/g,T=function(t,e){var r,n=t;if(w(_,n)&&(n="%"+(r=_[n])[0]+"%"),w(g,n)){var o=g[n];if(o===y&&(o=v(n)),void 0===o&&!e)throw new a("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:r,name:n,value:o}}throw new i("intrinsic "+t+" does not exist!")};t.exports=function(t,e){if("string"!=typeof t||0===t.length)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof e)throw new a('"allowMissing" argument must be a boolean');if(null===E(/^%?[^%]*%?$/,t))throw new i("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=function(t){var e=C(t,0,1),r=C(t,-1);if("%"===e&&"%"!==r)throw new i("invalid intrinsic syntax, expected closing `%`");if("%"===r&&"%"!==e)throw new i("invalid intrinsic syntax, expected opening `%`");var n=[];return x(t,P,(function(t,e,r,i){n[n.length]=r?x(i,k,"$1"):e||t})),n}(t),n=r.length>0?r[0]:"",o=T("%"+n+"%",e),s=o.name,l=o.value,c=!1,f=o.alias;f&&(n=f[0],O(r,S([0,1],f)));for(var p=1,h=!0;p<r.length;p+=1){var y=r[p],d=C(y,0,1),m=C(y,-1);if(('"'===d||"'"===d||"`"===d||'"'===m||"'"===m||"`"===m)&&d!==m)throw new i("property names with quotes must have matching quotes");if("constructor"!==y&&h||(c=!0),w(g,s="%"+(n+="."+y)+"%"))l=g[s];else if(null!=l){if(!(y in l)){if(!e)throw new a("base intrinsic for "+t+" exists, but the property is not available.");return}if(u&&p+1>=r.length){var v=u(l,y);l=(h=!!v)&&"get"in v&&!("originalValue"in v.get)?v.get:l[y]}else h=w(l,y),l=l[y];h&&!c&&(g[s]=l)}}return l}},7296:(t,e,r)=>{var n=r(210)("%Object.getOwnPropertyDescriptor%",!0);if(n)try{n([],"length")}catch(t){n=null}t.exports=n},1044:(t,e,r)=>{var n=r(210)("%Object.defineProperty%",!0),i=function(){if(n)try{return n({},"a",{value:1}),!0}catch(t){return!1}return!1};i.hasArrayLengthDefineBug=function(){if(!i())return null;try{return 1!==n([],"length",{value:1}).length}catch(t){return!0}},t.exports=i},8185:t=>{var e={foo:{}},r=Object;t.exports=function(){return{__proto__:e}.foo===e.foo&&!({__proto__:null}instanceof r)}},1405:(t,e,r)=>{var n="undefined"!=typeof Symbol&&Symbol,i=r(5419);t.exports=function(){return"function"==typeof n&&"function"==typeof Symbol&&"symbol"==typeof n("foo")&&"symbol"==typeof Symbol("bar")&&i()}},5419:t=>{t.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var t={},e=Symbol("test"),r=Object(e);if("string"==typeof e)return!1;if("[object Symbol]"!==Object.prototype.toString.call(e))return!1;if("[object Symbol]"!==Object.prototype.toString.call(r))return!1;for(e in t[e]=42,t)return!1;if("function"==typeof Object.keys&&0!==Object.keys(t).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(t).length)return!1;var n=Object.getOwnPropertySymbols(t);if(1!==n.length||n[0]!==e)return!1;if(!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var i=Object.getOwnPropertyDescriptor(t,e);if(42!==i.value||!0!==i.enumerable)return!1}return!0}},6410:(t,e,r)=>{var n=r(5419);t.exports=function(){return n()&&!!Symbol.toStringTag}},8824:(t,e,r)=>{var n=Function.prototype.call,i=Object.prototype.hasOwnProperty,o=r(8612);t.exports=o.call(n,i)},645:(t,e)=>{e.read=function(t,e,r,n,i){var o,a,s=8*i-n-1,u=(1<<s)-1,l=u>>1,c=-7,f=r?i-1:0,p=r?-1:1,h=t[e+f];for(f+=p,o=h&(1<<-c)-1,h>>=-c,c+=s;c>0;o=256*o+t[e+f],f+=p,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=n;c>0;a=256*a+t[e+f],f+=p,c-=8);if(0===o)o=1-l;else{if(o===u)return a?NaN:1/0*(h?-1:1);a+=Math.pow(2,n),o-=l}return(h?-1:1)*a*Math.pow(2,o-n)},e.write=function(t,e,r,n,i,o){var a,s,u,l=8*o-i-1,c=(1<<l)-1,f=c>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=n?0:o-1,y=n?1:-1,d=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),(e+=a+f>=1?p/u:p*Math.pow(2,1-f))*u>=2&&(a++,u/=2),a+f>=c?(s=0,a=c):a+f>=1?(s=(e*u-1)*Math.pow(2,i),a+=f):(s=e*Math.pow(2,f-1)*Math.pow(2,i),a=0));i>=8;t[r+h]=255&s,h+=y,s/=256,i-=8);for(a=a<<i|s,l+=i;l>0;t[r+h]=255&a,h+=y,a/=256,l-=8);t[r+h-y]|=128*d}},2584:(t,e,r)=>{var n=r(6410)(),i=r(1924)("Object.prototype.toString"),o=function(t){return!(n&&t&&"object"==typeof t&&Symbol.toStringTag in t)&&"[object Arguments]"===i(t)},a=function(t){return!!o(t)||null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Array]"!==i(t)&&"[object Function]"===i(t.callee)},s=function(){return o(arguments)}();o.isLegacyArguments=a,t.exports=s?o:a},8923:(t,e,r)=>{var n=Date.prototype.getDay,i=Object.prototype.toString,o=r(6410)();t.exports=function(t){return"object"==typeof t&&null!==t&&(o?function(t){try{return n.call(t),!0}catch(t){return!1}}(t):"[object Date]"===i.call(t))}},8420:(t,e,r)=>{var n,i,o,a,s=r(1924),u=r(6410)();if(u){n=s("Object.prototype.hasOwnProperty"),i=s("RegExp.prototype.exec"),o={};var l=function(){throw o};a={toString:l,valueOf:l},"symbol"==typeof Symbol.toPrimitive&&(a[Symbol.toPrimitive]=l)}var c=s("Object.prototype.toString"),f=Object.getOwnPropertyDescriptor;t.exports=u?function(t){if(!t||"object"!=typeof t)return!1;var e=f(t,"lastIndex");if(!e||!n(e,"value"))return!1;try{i(t,a)}catch(t){return t===o}}:function(t){return!(!t||"object"!=typeof t&&"function"!=typeof t)&&"[object RegExp]"===c(t)}},7418:t=>{var e=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable;t.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},r=0;r<10;r++)e["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach((function(t){n[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(t){return!1}}()?Object.assign:function(t,i){for(var o,a,s=function(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}(t),u=1;u<arguments.length;u++){for(var l in o=Object(arguments[u]))r.call(o,l)&&(s[l]=o[l]);if(e){a=e(o);for(var c=0;c<a.length;c++)n.call(o,a[c])&&(s[a[c]]=o[a[c]])}}return s}},4244:t=>{var e=function(t){return t!=t};t.exports=function(t,r){return 0===t&&0===r?1/t==1/r:t===r||!(!e(t)||!e(r))}},609:(t,e,r)=>{var n=r(4289),i=r(5559),o=r(4244),a=r(5624),s=r(2281),u=i(a(),Object);n(u,{getPolyfill:a,implementation:o,shim:s}),t.exports=u},5624:(t,e,r)=>{var n=r(4244);t.exports=function(){return"function"==typeof Object.is?Object.is:n}},2281:(t,e,r)=>{var n=r(5624),i=r(4289);t.exports=function(){var t=n();return i(Object,{is:t},{is:function(){return Object.is!==t}}),t}},8987:(t,e,r)=>{var n;if(!Object.keys){var i=Object.prototype.hasOwnProperty,o=Object.prototype.toString,a=r(1414),s=Object.prototype.propertyIsEnumerable,u=!s.call({toString:null},"toString"),l=s.call((function(){}),"prototype"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],f=function(t){var e=t.constructor;return e&&e.prototype===t},p={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},h=function(){if("undefined"==typeof window)return!1;for(var t in window)try{if(!p["$"+t]&&i.call(window,t)&&null!==window[t]&&"object"==typeof window[t])try{f(window[t])}catch(t){return!0}}catch(t){return!0}return!1}();n=function(t){var e=null!==t&&"object"==typeof t,r="[object Function]"===o.call(t),n=a(t),s=e&&"[object String]"===o.call(t),p=[];if(!e&&!r&&!n)throw new TypeError("Object.keys called on a non-object");var y=l&&r;if(s&&t.length>0&&!i.call(t,0))for(var d=0;d<t.length;++d)p.push(String(d));if(n&&t.length>0)for(var g=0;g<t.length;++g)p.push(String(g));else for(var m in t)y&&"prototype"===m||!i.call(t,m)||p.push(String(m));if(u)for(var v=function(t){if("undefined"==typeof window||!h)return f(t);try{return f(t)}catch(t){return!1}}(t),_=0;_<c.length;++_)v&&"constructor"===c[_]||!i.call(t,c[_])||p.push(c[_]);return p}}t.exports=n},2215:(t,e,r)=>{var n=Array.prototype.slice,i=r(1414),o=Object.keys,a=o?function(t){return o(t)}:r(8987),s=Object.keys;a.shim=function(){if(Object.keys){var t=function(){var t=Object.keys(arguments);return t&&t.length===arguments.length}(1,2);t||(Object.keys=function(t){return i(t)?s(n.call(t)):s(t)})}else Object.keys=a;return Object.keys||a},t.exports=a},1414:t=>{var e=Object.prototype.toString;t.exports=function(t){var r=e.call(t),n="[object Arguments]"===r;return n||(n="[object Array]"!==r&&null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Function]"===e.call(t.callee)),n}},3614:(t,e,r)=>{t.exports=i;var n=r(645);function i(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}i.Varint=0,i.Fixed64=1,i.Bytes=2,i.Fixed32=5;var o=4294967296,a=1/o,s="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function u(t){return t.type===i.Bytes?t.readVarint()+t.pos:t.pos+1}function l(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function c(t,e,r){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(n);for(var i=r.pos-1;i>=t;i--)r.buf[i+n]=r.buf[i]}function f(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function p(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function h(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function y(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function d(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function g(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function m(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function v(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function _(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function b(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function w(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function S(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}i.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),i=n>>3,o=this.pos;this.type=7&n,t(i,e,this),this.pos===o&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=b(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=S(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=b(this.buf,this.pos)+b(this.buf,this.pos+4)*o;return this.pos+=8,t},readSFixed64:function(){var t=b(this.buf,this.pos)+S(this.buf,this.pos+4)*o;return this.pos+=8,t},readFloat:function(){var t=n.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=n.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,n=this.buf;return e=127&(r=n[this.pos++]),r<128?e:(e|=(127&(r=n[this.pos++]))<<7,r<128?e:(e|=(127&(r=n[this.pos++]))<<14,r<128?e:(e|=(127&(r=n[this.pos++]))<<21,r<128?e:function(t,e,r){var n,i,o=r.buf;if(n=(112&(i=o[r.pos++]))>>4,i<128)return l(t,n,e);if(n|=(127&(i=o[r.pos++]))<<3,i<128)return l(t,n,e);if(n|=(127&(i=o[r.pos++]))<<10,i<128)return l(t,n,e);if(n|=(127&(i=o[r.pos++]))<<17,i<128)return l(t,n,e);if(n|=(127&(i=o[r.pos++]))<<24,i<128)return l(t,n,e);if(n|=(1&(i=o[r.pos++]))<<31,i<128)return l(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&s?function(t,e,r){return s.decode(t.subarray(e,r))}(this.buf,e,t):function(t,e,r){for(var n="",i=e;i<r;){var o,a,s,u=t[i],l=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c>r)break;1===c?u<128&&(l=u):2===c?128==(192&(o=t[i+1]))&&(l=(31&u)<<6|63&o)<=127&&(l=null):3===c?(o=t[i+1],a=t[i+2],128==(192&o)&&128==(192&a)&&((l=(15&u)<<12|(63&o)<<6|63&a)<=2047||l>=55296&&l<=57343)&&(l=null)):4===c&&(o=t[i+1],a=t[i+2],s=t[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&((l=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||l>=1114112)&&(l=null)),null===l?(l=65533,c=1):l>65535&&(l-=65536,n+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),n+=String.fromCharCode(l),i+=c}return n}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==i.Bytes)return t.push(this.readVarint(e));var r=u(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==i.Bytes)return t.push(this.readSVarint());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==i.Bytes)return t.push(this.readBoolean());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==i.Bytes)return t.push(this.readFloat());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==i.Bytes)return t.push(this.readDouble());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==i.Bytes)return t.push(this.readFixed32());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==i.Bytes)return t.push(this.readSFixed32());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==i.Bytes)return t.push(this.readFixed64());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==i.Bytes)return t.push(this.readSFixed64());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===i.Varint)for(;this.buf[this.pos++]>127;);else if(e===i.Bytes)this.pos=this.readVarint()+this.pos;else if(e===i.Fixed32)this.pos+=4;else{if(e!==i.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),w(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),w(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),w(this.buf,-1&t,this.pos),w(this.buf,Math.floor(t*a),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),w(this.buf,-1&t,this.pos),w(this.buf,Math.floor(t*a),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var r,n;if(t>=0?(r=t%4294967296|0,n=t/4294967296|0):(n=~(-t/4294967296),4294967295^(r=~(-t%4294967296))?r=r+1|0:(r=0,n=n+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,r){r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos]=127&t}(r,0,e),function(t,e){var r=(7&t)<<4;e.buf[e.pos++]|=r|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(n,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,r){for(var n,i,o=0;o<e.length;o++){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){n>56319||o+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):i=n;continue}if(n<56320){t[r++]=239,t[r++]=191,t[r++]=189,i=n;continue}n=i-55296<<10|n-56320|65536,i=null}else i&&(t[r++]=239,t[r++]=191,t[r++]=189,i=null);n<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:(n<65536?t[r++]=n>>12|224:(t[r++]=n>>18|240,t[r++]=n>>12&63|128),t[r++]=n>>6&63|128),t[r++]=63&n|128)}return r}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&c(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),n.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),n.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var n=this.pos-r;n>=128&&c(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,r){this.writeTag(t,i.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,f,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,p,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,d,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,h,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,y,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,g,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,m,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,v,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,_,e)},writeBytesField:function(t,e){this.writeTag(t,i.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,i.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,i.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,i.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,i.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,i.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,i.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,i.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,i.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,i.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}}},1895:t=>{t.exports=function(t,e,r,n){var i=t[0],o=t[1],a=!1;void 0===r&&(r=0),void 0===n&&(n=e.length);for(var s=(n-r)/2,u=0,l=s-1;u<s;l=u++){var c=e[r+2*u+0],f=e[r+2*u+1],p=e[r+2*l+0],h=e[r+2*l+1];f>o!=h>o&&i<(p-c)*(o-f)/(h-f)+c&&(a=!a)}return a}},6960:(t,e,r)=>{var n=r(1895),i=r(8139);t.exports=function(t,e,r,o){return e.length>0&&Array.isArray(e[0])?i(t,e,r,o):n(t,e,r,o)},t.exports.nested=i,t.exports.flat=n},8139:t=>{t.exports=function(t,e,r,n){var i=t[0],o=t[1],a=!1;void 0===r&&(r=0),void 0===n&&(n=e.length);for(var s=n-r,u=0,l=s-1;u<s;l=u++){var c=e[u+r][0],f=e[u+r][1],p=e[l+r][0],h=e[l+r][1];f>o!=h>o&&i<(p-c)*(o-f)/(h-f)+c&&(a=!a)}return a}},2676:function(t){t.exports=function(){function t(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var e=function(t,e){this.next=null,this.key=t,this.data=e,this.left=null,this.right=null};function r(t,e){return t>e?1:t<e?-1:0}function n(t,r,n){for(var i=new e(null,null),o=i,a=i;;){var s=n(t,r.key);if(s<0){if(null===r.left)break;if(n(t,r.left.key)<0){var u=r.left;if(r.left=u.right,u.right=r,null===(r=u).left)break}a.left=r,a=r,r=r.left}else{if(!(s>0))break;if(null===r.right)break;if(n(t,r.right.key)>0&&(u=r.right,r.right=u.left,u.left=r,null===(r=u).right))break;o.right=r,o=r,r=r.right}}return o.right=r.left,a.left=r.right,r.left=i.right,r.right=i.left,r}function i(t,r,i,o){var a=new e(t,r);if(null===i)return a.left=a.right=null,a;var s=o(t,(i=n(t,i,o)).key);return s<0?(a.left=i.left,a.right=i,i.left=null):s>=0&&(a.right=i.right,a.left=i,i.right=null),a}function o(t,e,r){var i=null,o=null;if(e){var a=r((e=n(t,e,r)).key,t);0===a?(i=e.left,o=e.right):a<0?(o=e.right,e.right=null,i=e):(i=e.left,e.left=null,o=e)}return{left:i,right:o}}function a(t,e,r,n,i){if(t){n(e+(r?"└── ":"├── ")+i(t)+"\n");var o=e+(r?"    ":"│   ");t.left&&a(t.left,o,!1,n,i),t.right&&a(t.right,o,!0,n,i)}}var s=function(){function s(t){void 0===t&&(t=r),this._root=null,this._size=0,this._comparator=t}return s.prototype.insert=function(t,e){return this._size++,this._root=i(t,e,this._root,this._comparator)},s.prototype.add=function(t,r){var i=new e(t,r);null===this._root&&(i.left=i.right=null,this._size++,this._root=i);var o=this._comparator,a=n(t,this._root,o),s=o(t,a.key);return 0===s?this._root=a:(s<0?(i.left=a.left,i.right=a,a.left=null):s>0&&(i.right=a.right,i.left=a,a.right=null),this._size++,this._root=i),this._root},s.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},s.prototype._remove=function(t,e,r){var i;return null===e?null:0===r(t,(e=n(t,e,r)).key)?(null===e.left?i=e.right:(i=n(t,e.left,r)).right=e.right,this._size--,i):e},s.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=n(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},s.prototype.findStatic=function(t){for(var e=this._root,r=this._comparator;e;){var n=r(t,e.key);if(0===n)return e;e=n<0?e.left:e.right}return null},s.prototype.find=function(t){return this._root&&(this._root=n(t,this._root,this._comparator),0!==this._comparator(t,this._root.key))?null:this._root},s.prototype.contains=function(t){for(var e=this._root,r=this._comparator;e;){var n=r(t,e.key);if(0===n)return!0;e=n<0?e.left:e.right}return!1},s.prototype.forEach=function(t,e){for(var r=this._root,n=[],i=!1;!i;)null!==r?(n.push(r),r=r.left):0!==n.length?(r=n.pop(),t.call(e,r),r=r.right):i=!0;return this},s.prototype.range=function(t,e,r,n){for(var i=[],o=this._comparator,a=this._root;0!==i.length||a;)if(a)i.push(a),a=a.left;else{if(o((a=i.pop()).key,e)>0)break;if(o(a.key,t)>=0&&r.call(n,a))return this;a=a.right}return this},s.prototype.keys=function(){var t=[];return this.forEach((function(e){var r=e.key;return t.push(r)})),t},s.prototype.values=function(){var t=[];return this.forEach((function(e){var r=e.data;return t.push(r)})),t},s.prototype.min=function(){return this._root?this.minNode(this._root).key:null},s.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},s.prototype.minNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.left;)t=t.left;return t},s.prototype.maxNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.right;)t=t.right;return t},s.prototype.at=function(t){for(var e=this._root,r=!1,n=0,i=[];!r;)if(e)i.push(e),e=e.left;else if(i.length>0){if(e=i.pop(),n===t)return e;n++,e=e.right}else r=!0;return null},s.prototype.next=function(t){var e=this._root,r=null;if(t.right){for(r=t.right;r.left;)r=r.left;return r}for(var n=this._comparator;e;){var i=n(t.key,e.key);if(0===i)break;i<0?(r=e,e=e.left):e=e.right}return r},s.prototype.prev=function(t){var e=this._root,r=null;if(null!==t.left){for(r=t.left;r.right;)r=r.right;return r}for(var n=this._comparator;e;){var i=n(t.key,e.key);if(0===i)break;i<0?e=e.left:(r=e,e=e.right)}return r},s.prototype.clear=function(){return this._root=null,this._size=0,this},s.prototype.toList=function(){return function(t){for(var r=t,n=[],i=!1,o=new e(null,null),a=o;!i;)r?(n.push(r),r=r.left):n.length>0?r=(r=a=a.next=n.pop()).right:i=!0;return a.next=null,o.next}(this._root)},s.prototype.load=function(t,r,n){void 0===r&&(r=[]),void 0===n&&(n=!1);var i=t.length,o=this._comparator;if(n&&c(t,r,0,i-1,o),null===this._root)this._root=u(t,r,0,i),this._size=i;else{var a=function(t,r,n){for(var i=new e(null,null),o=i,a=t,s=r;null!==a&&null!==s;)n(a.key,s.key)<0?(o.next=a,a=a.next):(o.next=s,s=s.next),o=o.next;return null!==a?o.next=a:null!==s&&(o.next=s),i.next}(this.toList(),function(t,r){for(var n=new e(null,null),i=n,o=0;o<t.length;o++)i=i.next=new e(t[o],r[o]);return i.next=null,n.next}(t,r),o);i=this._size+i,this._root=l({head:a},0,i)}return this},s.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(s.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),s.prototype.toString=function(t){void 0===t&&(t=function(t){return String(t.key)});var e=[];return a(this._root,"",!0,(function(t){return e.push(t)}),t),e.join("")},s.prototype.update=function(t,e,r){var a=this._comparator,s=o(t,this._root,a),u=s.left,l=s.right;a(t,e)<0?l=i(e,r,l,a):u=i(e,r,u,a),this._root=function(t,e,r){return null===e?t:(null===t||((e=n(t.key,e,r)).left=t),e)}(u,l,a)},s.prototype.split=function(t){return o(t,this._root,this._comparator)},s.prototype[Symbol.iterator]=function(){var e,r,n;return t(this,(function(t){switch(t.label){case 0:e=this._root,r=[],n=!1,t.label=1;case 1:return n?[3,6]:null===e?[3,2]:(r.push(e),e=e.left,[3,5]);case 2:return 0===r.length?[3,4]:[4,e=r.pop()];case 3:return t.sent(),e=e.right,[3,5];case 4:n=!0,t.label=5;case 5:return[3,1];case 6:return[2]}}))},s}();function u(t,r,n,i){var o=i-n;if(o>0){var a=n+Math.floor(o/2),s=t[a],l=r[a],c=new e(s,l);return c.left=u(t,r,n,a),c.right=u(t,r,a+1,i),c}return null}function l(t,e,r){var n=r-e;if(n>0){var i=e+Math.floor(n/2),o=l(t,e,i),a=t.head;return a.left=o,t.head=t.head.next,a.right=l(t,i+1,r),a}return null}function c(t,e,r,n,i){if(!(r>=n)){for(var o=t[r+n>>1],a=r-1,s=n+1;;){do{a++}while(i(t[a],o)<0);do{s--}while(i(t[s],o)>0);if(a>=s)break;var u=t[a];t[a]=t[s],t[s]=u,u=e[a],e[a]=e[s],e[s]=u}c(t,e,r,s,i),c(t,e,s+1,n,i)}}const f=(t,e)=>t.ll.x<=e.x&&e.x<=t.ur.x&&t.ll.y<=e.y&&e.y<=t.ur.y,p=(t,e)=>{if(e.ur.x<t.ll.x||t.ur.x<e.ll.x||e.ur.y<t.ll.y||t.ur.y<e.ll.y)return null;const r=t.ll.x<e.ll.x?e.ll.x:t.ll.x,n=t.ur.x<e.ur.x?t.ur.x:e.ur.x;return{ll:{x:r,y:t.ll.y<e.ll.y?e.ll.y:t.ll.y},ur:{x:n,y:t.ur.y<e.ur.y?t.ur.y:e.ur.y}}};let h=Number.EPSILON;void 0===h&&(h=Math.pow(2,-52));const y=h*h,d=(t,e)=>{if(-h<t&&t<h&&-h<e&&e<h)return 0;const r=t-e;return r*r<y*t*e?0:t<e?-1:1};class g{constructor(){this.tree=new s,this.round(0)}round(t){const e=this.tree.add(t),r=this.tree.prev(e);if(null!==r&&0===d(e.key,r.key))return this.tree.remove(t),r.key;const n=this.tree.next(e);return null!==n&&0===d(e.key,n.key)?(this.tree.remove(t),n.key):t}}const m=new class{constructor(){this.reset()}reset(){this.xRounder=new g,this.yRounder=new g}round(t,e){return{x:this.xRounder.round(t),y:this.yRounder.round(e)}}},v=11102230246251565e-32,_=134217729,b=(3+8*v)*v;function w(t,e,r,n,i){let o,a,s,u,l=e[0],c=n[0],f=0,p=0;c>l==c>-l?(o=l,l=e[++f]):(o=c,c=n[++p]);let h=0;if(f<t&&p<r)for(c>l==c>-l?(a=l+o,s=o-(a-l),l=e[++f]):(a=c+o,s=o-(a-c),c=n[++p]),o=a,0!==s&&(i[h++]=s);f<t&&p<r;)c>l==c>-l?(a=o+l,u=a-o,s=o-(a-u)+(l-u),l=e[++f]):(a=o+c,u=a-o,s=o-(a-u)+(c-u),c=n[++p]),o=a,0!==s&&(i[h++]=s);for(;f<t;)a=o+l,u=a-o,s=o-(a-u)+(l-u),l=e[++f],o=a,0!==s&&(i[h++]=s);for(;p<r;)a=o+c,u=a-o,s=o-(a-u)+(c-u),c=n[++p],o=a,0!==s&&(i[h++]=s);return 0===o&&0!==h||(i[h++]=o),h}function S(t){return new Float64Array(t)}const O=22204460492503146e-32,x=11093356479670487e-47,C=S(4),E=S(8),P=S(12),k=S(16),T=S(4);function j(t,e,r,n,i,o){const a=(e-o)*(r-i),s=(t-i)*(n-o),u=a-s,l=Math.abs(a+s);return Math.abs(u)>=33306690738754716e-32*l?u:-function(t,e,r,n,i,o,a){let s,u,l,c,f,p,h,y,d,g,m,v,S,j,R,L,I,M;const A=t-i,D=r-i,N=e-o,F=n-o;j=A*F,p=_*A,h=p-(p-A),y=A-h,p=_*F,d=p-(p-F),g=F-d,R=y*g-(j-h*d-y*d-h*g),L=N*D,p=_*N,h=p-(p-N),y=N-h,p=_*D,d=p-(p-D),g=D-d,I=y*g-(L-h*d-y*d-h*g),m=R-I,f=R-m,C[0]=R-(m+f)+(f-I),v=j+m,f=v-j,S=j-(v-f)+(m-f),m=S-L,f=S-m,C[1]=S-(m+f)+(f-L),M=v+m,f=M-v,C[2]=v-(M-f)+(m-f),C[3]=M;let z=function(t,e){let r=e[0];for(let n=1;n<t;n++)r+=e[n];return r}(4,C),G=O*a;if(z>=G||-z>=G)return z;if(f=t-A,s=t-(A+f)+(f-i),f=r-D,l=r-(D+f)+(f-i),f=e-N,u=e-(N+f)+(f-o),f=n-F,c=n-(F+f)+(f-o),0===s&&0===u&&0===l&&0===c)return z;if(G=x*a+b*Math.abs(z),z+=A*c+F*s-(N*l+D*u),z>=G||-z>=G)return z;j=s*F,p=_*s,h=p-(p-s),y=s-h,p=_*F,d=p-(p-F),g=F-d,R=y*g-(j-h*d-y*d-h*g),L=u*D,p=_*u,h=p-(p-u),y=u-h,p=_*D,d=p-(p-D),g=D-d,I=y*g-(L-h*d-y*d-h*g),m=R-I,f=R-m,T[0]=R-(m+f)+(f-I),v=j+m,f=v-j,S=j-(v-f)+(m-f),m=S-L,f=S-m,T[1]=S-(m+f)+(f-L),M=v+m,f=M-v,T[2]=v-(M-f)+(m-f),T[3]=M;const B=w(4,C,4,T,E);j=A*c,p=_*A,h=p-(p-A),y=A-h,p=_*c,d=p-(p-c),g=c-d,R=y*g-(j-h*d-y*d-h*g),L=N*l,p=_*N,h=p-(p-N),y=N-h,p=_*l,d=p-(p-l),g=l-d,I=y*g-(L-h*d-y*d-h*g),m=R-I,f=R-m,T[0]=R-(m+f)+(f-I),v=j+m,f=v-j,S=j-(v-f)+(m-f),m=S-L,f=S-m,T[1]=S-(m+f)+(f-L),M=v+m,f=M-v,T[2]=v-(M-f)+(m-f),T[3]=M;const V=w(B,E,4,T,P);j=s*c,p=_*s,h=p-(p-s),y=s-h,p=_*c,d=p-(p-c),g=c-d,R=y*g-(j-h*d-y*d-h*g),L=u*l,p=_*u,h=p-(p-u),y=u-h,p=_*l,d=p-(p-l),g=l-d,I=y*g-(L-h*d-y*d-h*g),m=R-I,f=R-m,T[0]=R-(m+f)+(f-I),v=j+m,f=v-j,S=j-(v-f)+(m-f),m=S-L,f=S-m,T[1]=S-(m+f)+(f-L),M=v+m,f=M-v,T[2]=v-(M-f)+(m-f),T[3]=M;const U=w(V,P,4,T,k);return k[U-1]}(t,e,r,n,i,o,l)}const R=(t,e)=>t.x*e.y-t.y*e.x,L=(t,e)=>t.x*e.x+t.y*e.y,I=(t,e,r)=>{const n=j(t.x,t.y,e.x,e.y,r.x,r.y);return n>0?-1:n<0?1:0},M=t=>Math.sqrt(L(t,t)),A=(t,e,r)=>{const n={x:e.x-t.x,y:e.y-t.y},i={x:r.x-t.x,y:r.y-t.y};return R(i,n)/M(i)/M(n)},D=(t,e,r)=>{const n={x:e.x-t.x,y:e.y-t.y},i={x:r.x-t.x,y:r.y-t.y};return L(i,n)/M(i)/M(n)},N=(t,e,r)=>0===e.y?null:{x:t.x+e.x/e.y*(r-t.y),y:r},F=(t,e,r)=>0===e.x?null:{x:r,y:t.y+e.y/e.x*(r-t.x)};class z{static compare(t,e){const r=z.comparePoints(t.point,e.point);return 0!==r?r:(t.point!==e.point&&t.link(e),t.isLeft!==e.isLeft?t.isLeft?1:-1:B.compare(t.segment,e.segment))}static comparePoints(t,e){return t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y>e.y?1:0}constructor(t,e){void 0===t.events?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=e}link(t){if(t.point===this.point)throw new Error("Tried to link already linked events");const e=t.point.events;for(let t=0,r=e.length;t<r;t++){const r=e[t];this.point.events.push(r),r.point=this.point}this.checkForConsuming()}checkForConsuming(){const t=this.point.events.length;for(let e=0;e<t;e++){const r=this.point.events[e];if(void 0===r.segment.consumedBy)for(let n=e+1;n<t;n++){const t=this.point.events[n];void 0===t.consumedBy&&r.otherSE.point.events===t.otherSE.point.events&&r.segment.consume(t.segment)}}}getAvailableLinkedEvents(){const t=[];for(let e=0,r=this.point.events.length;e<r;e++){const r=this.point.events[e];r!==this&&!r.segment.ringOut&&r.segment.isInResult()&&t.push(r)}return t}getLeftmostComparator(t){const e=new Map,r=r=>{const n=r.otherSE;e.set(r,{sine:A(this.point,t.point,n.point),cosine:D(this.point,t.point,n.point)})};return(t,n)=>{e.has(t)||r(t),e.has(n)||r(n);const{sine:i,cosine:o}=e.get(t),{sine:a,cosine:s}=e.get(n);return i>=0&&a>=0?o<s?1:o>s?-1:0:i<0&&a<0?o<s?-1:o>s?1:0:a<i?-1:a>i?1:0}}}let G=0;class B{static compare(t,e){const r=t.leftSE.point.x,n=e.leftSE.point.x,i=t.rightSE.point.x,o=e.rightSE.point.x;if(o<r)return 1;if(i<n)return-1;const a=t.leftSE.point.y,s=e.leftSE.point.y,u=t.rightSE.point.y,l=e.rightSE.point.y;if(r<n){if(s<a&&s<u)return 1;if(s>a&&s>u)return-1;const r=t.comparePoint(e.leftSE.point);if(r<0)return 1;if(r>0)return-1;const n=e.comparePoint(t.rightSE.point);return 0!==n?n:-1}if(r>n){if(a<s&&a<l)return-1;if(a>s&&a>l)return 1;const r=e.comparePoint(t.leftSE.point);if(0!==r)return r;const n=t.comparePoint(e.rightSE.point);return n<0?1:n>0?-1:1}if(a<s)return-1;if(a>s)return 1;if(i<o){const r=e.comparePoint(t.rightSE.point);if(0!==r)return r}if(i>o){const r=t.comparePoint(e.rightSE.point);if(r<0)return 1;if(r>0)return-1}if(i!==o){const t=u-a,e=i-r,c=l-s,f=o-n;if(t>e&&c<f)return 1;if(t<e&&c>f)return-1}return i>o?1:i<o||u<l?-1:u>l?1:t.id<e.id?-1:t.id>e.id?1:0}constructor(t,e,r,n){this.id=++G,this.leftSE=t,t.segment=this,t.otherSE=e,this.rightSE=e,e.segment=this,e.otherSE=t,this.rings=r,this.windings=n}static fromRing(t,e,r){let n,i,o;const a=z.comparePoints(t,e);if(a<0)n=t,i=e,o=1;else{if(!(a>0))throw new Error(`Tried to create degenerate segment at [${t.x}, ${t.y}]`);n=e,i=t,o=-1}const s=new z(n,!0),u=new z(i,!1);return new B(s,u,[r],[o])}replaceRightSE(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<e?t:e},ur:{x:this.rightSE.point.x,y:t>e?t:e}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}comparePoint(t){if(this.isAnEndpoint(t))return 0;const e=this.leftSE.point,r=this.rightSE.point,n=this.vector();if(e.x===r.x)return t.x===e.x?0:t.x<e.x?1:-1;const i=(t.y-e.y)/n.y,o=e.x+i*n.x;if(t.x===o)return 0;const a=(t.x-e.x)/n.x,s=e.y+a*n.y;return t.y===s?0:t.y<s?-1:1}getIntersection(t){const e=this.bbox(),r=t.bbox(),n=p(e,r);if(null===n)return null;const i=this.leftSE.point,o=this.rightSE.point,a=t.leftSE.point,s=t.rightSE.point,u=f(e,a)&&0===this.comparePoint(a),l=f(r,i)&&0===t.comparePoint(i),c=f(e,s)&&0===this.comparePoint(s),h=f(r,o)&&0===t.comparePoint(o);if(l&&u)return h&&!c?o:!h&&c?s:null;if(l)return c&&i.x===s.x&&i.y===s.y?null:i;if(u)return h&&o.x===a.x&&o.y===a.y?null:a;if(h&&c)return null;if(h)return o;if(c)return s;const y=((t,e,r,n)=>{if(0===e.x)return F(r,n,t.x);if(0===n.x)return F(t,e,r.x);if(0===e.y)return N(r,n,t.y);if(0===n.y)return N(t,e,r.y);const i=R(e,n);if(0==i)return null;const o={x:r.x-t.x,y:r.y-t.y},a=R(o,e)/i,s=R(o,n)/i;return{x:(t.x+s*e.x+(r.x+a*n.x))/2,y:(t.y+s*e.y+(r.y+a*n.y))/2}})(i,this.vector(),a,t.vector());return null===y?null:f(n,y)?m.round(y.x,y.y):null}split(t){const e=[],r=void 0!==t.events,n=new z(t,!0),i=new z(t,!1),o=this.rightSE;this.replaceRightSE(i),e.push(i),e.push(n);const a=new B(n,o,this.rings.slice(),this.windings.slice());return z.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),z.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(n.checkForConsuming(),i.checkForConsuming()),e}swapEvents(){const t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,e=this.windings.length;t<e;t++)this.windings[t]*=-1}consume(t){let e=this,r=t;for(;e.consumedBy;)e=e.consumedBy;for(;r.consumedBy;)r=r.consumedBy;const n=B.compare(e,r);if(0!==n){if(n>0){const t=e;e=r,r=t}if(e.prev===r){const t=e;e=r,r=t}for(let t=0,n=r.rings.length;t<n;t++){const n=r.rings[t],i=r.windings[t],o=e.rings.indexOf(n);-1===o?(e.rings.push(n),e.windings.push(i)):e.windings[o]+=i}r.rings=null,r.windings=null,r.consumedBy=e,r.leftSE.consumedBy=e.leftSE,r.rightSE.consumedBy=e.rightSE}}prevInResult(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}beforeState(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){const t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}afterState(){if(void 0!==this._afterState)return this._afterState;const t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};const e=this._afterState.rings,r=this._afterState.windings,n=this._afterState.multiPolys;for(let t=0,n=this.rings.length;t<n;t++){const n=this.rings[t],i=this.windings[t],o=e.indexOf(n);-1===o?(e.push(n),r.push(i)):r[o]+=i}const i=[],o=[];for(let t=0,n=e.length;t<n;t++){if(0===r[t])continue;const n=e[t],a=n.poly;if(-1===o.indexOf(a))if(n.isExterior)i.push(a);else{-1===o.indexOf(a)&&o.push(a);const t=i.indexOf(n.poly);-1!==t&&i.splice(t,1)}}for(let t=0,e=i.length;t<e;t++){const e=i[t].multiPoly;-1===n.indexOf(e)&&n.push(e)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;const t=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch(J.type){case"union":{const r=0===t.length,n=0===e.length;this._isInResult=r!==n;break}case"intersection":{let r,n;t.length<e.length?(r=t.length,n=e.length):(r=e.length,n=t.length),this._isInResult=n===J.numMultiPolys&&r<n;break}case"xor":{const r=Math.abs(t.length-e.length);this._isInResult=r%2==1;break}case"difference":{const r=t=>1===t.length&&t[0].isSubject;this._isInResult=r(t)!==r(e);break}default:throw new Error(`Unrecognized operation type found ${J.type}`)}return this._isInResult}}class V{constructor(t,e,r){if(!Array.isArray(t)||0===t.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=r,this.segments=[],"number"!=typeof t[0][0]||"number"!=typeof t[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const n=m.round(t[0][0],t[0][1]);this.bbox={ll:{x:n.x,y:n.y},ur:{x:n.x,y:n.y}};let i=n;for(let e=1,r=t.length;e<r;e++){if("number"!=typeof t[e][0]||"number"!=typeof t[e][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let r=m.round(t[e][0],t[e][1]);r.x===i.x&&r.y===i.y||(this.segments.push(B.fromRing(i,r,this)),r.x<this.bbox.ll.x&&(this.bbox.ll.x=r.x),r.y<this.bbox.ll.y&&(this.bbox.ll.y=r.y),r.x>this.bbox.ur.x&&(this.bbox.ur.x=r.x),r.y>this.bbox.ur.y&&(this.bbox.ur.y=r.y),i=r)}n.x===i.x&&n.y===i.y||this.segments.push(B.fromRing(i,n,this))}getSweepEvents(){const t=[];for(let e=0,r=this.segments.length;e<r;e++){const r=this.segments[e];t.push(r.leftSE),t.push(r.rightSE)}return t}}class U{constructor(t,e){if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new V(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let e=1,r=t.length;e<r;e++){const r=new V(t[e],this,!1);r.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=r.bbox.ll.x),r.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=r.bbox.ll.y),r.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=r.bbox.ur.x),r.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=r.bbox.ur.y),this.interiorRings.push(r)}this.multiPoly=e}getSweepEvents(){const t=this.exteriorRing.getSweepEvents();for(let e=0,r=this.interiorRings.length;e<r;e++){const r=this.interiorRings[e].getSweepEvents();for(let e=0,n=r.length;e<n;e++)t.push(r[e])}return t}}class q{constructor(t,e){if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof t[0][0][0]&&(t=[t])}catch(t){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let e=0,r=t.length;e<r;e++){const r=new U(t[e],this);r.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=r.bbox.ll.x),r.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=r.bbox.ll.y),r.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=r.bbox.ur.x),r.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=r.bbox.ur.y),this.polys.push(r)}this.isSubject=e}getSweepEvents(){const t=[];for(let e=0,r=this.polys.length;e<r;e++){const r=this.polys[e].getSweepEvents();for(let e=0,n=r.length;e<n;e++)t.push(r[e])}return t}}class W{static factory(t){const e=[];for(let r=0,n=t.length;r<n;r++){const n=t[r];if(!n.isInResult()||n.ringOut)continue;let i=null,o=n.leftSE,a=n.rightSE;const s=[o],u=o.point,l=[];for(;i=o,o=a,s.push(o),o.point!==u;)for(;;){const t=o.getAvailableLinkedEvents();if(0===t.length){const t=s[0].point,e=s[s.length-1].point;throw new Error(`Unable to complete output ring starting at [${t.x}, ${t.y}]. Last matching segment found ends at [${e.x}, ${e.y}].`)}if(1===t.length){a=t[0].otherSE;break}let r=null;for(let t=0,e=l.length;t<e;t++)if(l[t].point===o.point){r=t;break}if(null!==r){const t=l.splice(r)[0],n=s.splice(t.index);n.unshift(n[0].otherSE),e.push(new W(n.reverse()));continue}l.push({index:s.length,point:o.point});const n=o.getLeftmostComparator(i);a=t.sort(n)[0].otherSE;break}e.push(new W(s))}return e}constructor(t){this.events=t;for(let e=0,r=t.length;e<r;e++)t[e].segment.ringOut=this;this.poly=null}getGeom(){let t=this.events[0].point;const e=[t];for(let r=1,n=this.events.length-1;r<n;r++){const n=this.events[r].point,i=this.events[r+1].point;0!==I(n,t,i)&&(e.push(n),t=n)}if(1===e.length)return null;const r=e[0],n=e[1];0===I(r,t,n)&&e.shift(),e.push(e[0]);const i=this.isExteriorRing()?1:-1,o=this.isExteriorRing()?0:e.length-1,a=this.isExteriorRing()?e.length:-1,s=[];for(let t=o;t!=a;t+=i)s.push([e[t].x,e[t].y]);return s}isExteriorRing(){if(void 0===this._isExteriorRing){const t=this.enclosingRing();this._isExteriorRing=!t||!t.isExteriorRing()}return this._isExteriorRing}enclosingRing(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let t=this.events[0];for(let e=1,r=this.events.length;e<r;e++){const r=this.events[e];z.compare(t,r)>0&&(t=r)}let e=t.segment.prevInResult(),r=e?e.prevInResult():null;for(;;){if(!e)return null;if(!r)return e.ringOut;if(r.ringOut!==e.ringOut)return r.ringOut.enclosingRing()!==e.ringOut?e.ringOut:e.ringOut.enclosingRing();e=r.prevInResult(),r=e?e.prevInResult():null}}}class X{constructor(t){this.exteriorRing=t,t.poly=this,this.interiorRings=[]}addInterior(t){this.interiorRings.push(t),t.poly=this}getGeom(){const t=[this.exteriorRing.getGeom()];if(null===t[0])return null;for(let e=0,r=this.interiorRings.length;e<r;e++){const r=this.interiorRings[e].getGeom();null!==r&&t.push(r)}return t}}class Z{constructor(t){this.rings=t,this.polys=this._composePolys(t)}getGeom(){const t=[];for(let e=0,r=this.polys.length;e<r;e++){const r=this.polys[e].getGeom();null!==r&&t.push(r)}return t}_composePolys(t){const e=[];for(let r=0,n=t.length;r<n;r++){const n=t[r];if(!n.poly)if(n.isExteriorRing())e.push(new X(n));else{const t=n.enclosingRing();t.poly||e.push(new X(t)),t.poly.addInterior(n)}}return e}}class H{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B.compare;this.queue=t,this.tree=new s(e),this.segments=[]}process(t){const e=t.segment,r=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(e),r;const n=t.isLeft?this.tree.add(e):this.tree.find(e);if(!n)throw new Error(`Unable to find segment #${e.id} [${e.leftSE.point.x}, ${e.leftSE.point.y}] -> [${e.rightSE.point.x}, ${e.rightSE.point.y}] in SweepLine tree.`);let i,o,a=n,s=n;for(;void 0===i;)a=this.tree.prev(a),null===a?i=null:void 0===a.key.consumedBy&&(i=a.key);for(;void 0===o;)s=this.tree.next(s),null===s?o=null:void 0===s.key.consumedBy&&(o=s.key);if(t.isLeft){let n=null;if(i){const t=i.getIntersection(e);if(null!==t&&(e.isAnEndpoint(t)||(n=t),!i.isAnEndpoint(t))){const e=this._splitSafely(i,t);for(let t=0,n=e.length;t<n;t++)r.push(e[t])}}let a=null;if(o){const t=o.getIntersection(e);if(null!==t&&(e.isAnEndpoint(t)||(a=t),!o.isAnEndpoint(t))){const e=this._splitSafely(o,t);for(let t=0,n=e.length;t<n;t++)r.push(e[t])}}if(null!==n||null!==a){let t=null;t=null===n?a:null===a||z.comparePoints(n,a)<=0?n:a,this.queue.remove(e.rightSE),r.push(e.rightSE);const i=e.split(t);for(let t=0,e=i.length;t<e;t++)r.push(i[t])}r.length>0?(this.tree.remove(e),r.push(t)):(this.segments.push(e),e.prev=i)}else{if(i&&o){const t=i.getIntersection(o);if(null!==t){if(!i.isAnEndpoint(t)){const e=this._splitSafely(i,t);for(let t=0,n=e.length;t<n;t++)r.push(e[t])}if(!o.isAnEndpoint(t)){const e=this._splitSafely(o,t);for(let t=0,n=e.length;t<n;t++)r.push(e[t])}}}this.tree.remove(e)}return r}_splitSafely(t,e){this.tree.remove(t);const r=t.rightSE;this.queue.remove(r);const n=t.split(e);return n.push(r),void 0===t.consumedBy&&this.tree.add(t),n}}const Y="undefined"!=typeof process&&{BIMGIS_SDK_VERSION:"1.1.2"}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,K="undefined"!=typeof process&&{BIMGIS_SDK_VERSION:"1.1.2"}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;const J=new class{run(t,e,r){J.type=t,m.reset();const n=[new q(e,!0)];for(let t=0,e=r.length;t<e;t++)n.push(new q(r[t],!1));if(J.numMultiPolys=n.length,"difference"===J.type){const t=n[0];let e=1;for(;e<n.length;)null!==p(n[e].bbox,t.bbox)?e++:n.splice(e,1)}if("intersection"===J.type)for(let t=0,e=n.length;t<e;t++){const e=n[t];for(let r=t+1,i=n.length;r<i;r++)if(null===p(e.bbox,n[r].bbox))return[]}const i=new s(z.compare);for(let t=0,e=n.length;t<e;t++){const e=n[t].getSweepEvents();for(let t=0,r=e.length;t<r;t++)if(i.insert(e[t]),i.size>Y)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const o=new H(i);let a=i.size,u=i.pop();for(;u;){const t=u.key;if(i.size===a){const e=t.segment;throw new Error(`Unable to pop() ${t.isLeft?"left":"right"} SweepEvent [${t.point.x}, ${t.point.y}] from segment #${e.id} [${e.leftSE.point.x}, ${e.leftSE.point.y}] -> [${e.rightSE.point.x}, ${e.rightSE.point.y}] from queue.`)}if(i.size>Y)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(o.segments.length>K)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const e=o.process(t);for(let t=0,r=e.length;t<r;t++){const r=e[t];void 0===r.consumedBy&&i.insert(r)}a=i.size,u=i.pop()}m.reset();const l=W.factory(o.segments);return new Z(l).getGeom()}};return{union:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return J.run("union",t,r)},intersection:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return J.run("intersection",t,r)},xor:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return J.run("xor",t,r)},difference:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return J.run("difference",t,r)}}}()},2582:function(t){t.exports=function(){function t(t,n,i,o,a){!function t(r,n,i,o,a){for(;o>i;){if(o-i>600){var s=o-i+1,u=n-i+1,l=Math.log(s),c=.5*Math.exp(2*l/3),f=.5*Math.sqrt(l*c*(s-c)/s)*(u-s/2<0?-1:1);t(r,n,Math.max(i,Math.floor(n-u*c/s+f)),Math.min(o,Math.floor(n+(s-u)*c/s+f)),a)}var p=r[n],h=i,y=o;for(e(r,i,n),a(r[o],p)>0&&e(r,i,o);h<y;){for(e(r,h,y),h++,y--;a(r[h],p)<0;)h++;for(;a(r[y],p)>0;)y--}0===a(r[i],p)?e(r,i,y):e(r,++y,o),y<=n&&(i=y+1),n<=y&&(o=y-1)}}(t,n,i||0,o||t.length-1,a||r)}function e(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function r(t,e){return t<e?-1:t>e?1:0}var n=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function i(t,e,r){if(!r)return e.indexOf(t);for(var n=0;n<e.length;n++)if(r(t,e[n]))return n;return-1}function o(t,e){a(t,0,t.children.length,e,t)}function a(t,e,r,n,i){i||(i=y(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o=e;o<r;o++){var a=t.children[o];s(i,t.leaf?n(a):a)}return i}function s(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function u(t,e){return t.minX-e.minX}function l(t,e){return t.minY-e.minY}function c(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function f(t){return t.maxX-t.minX+(t.maxY-t.minY)}function p(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function h(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function y(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function d(e,r,n,i,o){for(var a=[r,n];a.length;)if(!((n=a.pop())-(r=a.pop())<=i)){var s=r+Math.ceil((n-r)/i/2)*i;t(e,s,r,n,o),a.push(r,s,s,n)}}return n.prototype.all=function(){return this._all(this.data,[])},n.prototype.search=function(t){var e=this.data,r=[];if(!h(t,e))return r;for(var n=this.toBBox,i=[];e;){for(var o=0;o<e.children.length;o++){var a=e.children[o],s=e.leaf?n(a):a;h(t,s)&&(e.leaf?r.push(a):p(t,s)?this._all(a,r):i.push(a))}e=i.pop()}return r},n.prototype.collides=function(t){var e=this.data;if(!h(t,e))return!1;for(var r=[];e;){for(var n=0;n<e.children.length;n++){var i=e.children[n],o=e.leaf?this.toBBox(i):i;if(h(t,o)){if(e.leaf||p(t,o))return!0;r.push(i)}}e=r.pop()}return!1},n.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0;e<t.length;e++)this.insert(t[e]);return this}var r=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var n=this.data;this.data=r,r=n}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},n.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},n.prototype.clear=function(){return this.data=y([]),this},n.prototype.remove=function(t,e){if(!t)return this;for(var r,n,o,a=this.data,s=this.toBBox(t),u=[],l=[];a||u.length;){if(a||(a=u.pop(),n=u[u.length-1],r=l.pop(),o=!0),a.leaf){var c=i(t,a.children,e);if(-1!==c)return a.children.splice(c,1),u.push(a),this._condense(u),this}o||a.leaf||!p(a,s)?n?(r++,a=n.children[r],o=!1):a=null:(u.push(a),l.push(r),r=0,n=a,a=a.children[0])}return this},n.prototype.toBBox=function(t){return t},n.prototype.compareMinX=function(t,e){return t.minX-e.minX},n.prototype.compareMinY=function(t,e){return t.minY-e.minY},n.prototype.toJSON=function(){return this.data},n.prototype.fromJSON=function(t){return this.data=t,this},n.prototype._all=function(t,e){for(var r=[];t;)t.leaf?e.push.apply(e,t.children):r.push.apply(r,t.children),t=r.pop();return e},n.prototype._build=function(t,e,r,n){var i,a=r-e+1,s=this._maxEntries;if(a<=s)return o(i=y(t.slice(e,r+1)),this.toBBox),i;n||(n=Math.ceil(Math.log(a)/Math.log(s)),s=Math.ceil(a/Math.pow(s,n-1))),(i=y([])).leaf=!1,i.height=n;var u=Math.ceil(a/s),l=u*Math.ceil(Math.sqrt(s));d(t,e,r,l,this.compareMinX);for(var c=e;c<=r;c+=l){var f=Math.min(c+l-1,r);d(t,c,f,u,this.compareMinY);for(var p=c;p<=f;p+=u){var h=Math.min(p+u-1,f);i.children.push(this._build(t,p,h,n-1))}}return o(i,this.toBBox),i},n.prototype._chooseSubtree=function(t,e,r,n){for(;n.push(e),!e.leaf&&n.length-1!==r;){for(var i=1/0,o=1/0,a=void 0,s=0;s<e.children.length;s++){var u=e.children[s],l=c(u),f=(p=t,h=u,(Math.max(h.maxX,p.maxX)-Math.min(h.minX,p.minX))*(Math.max(h.maxY,p.maxY)-Math.min(h.minY,p.minY))-l);f<o?(o=f,i=l<i?l:i,a=u):f===o&&l<i&&(i=l,a=u)}e=a||e.children[0]}var p,h;return e},n.prototype._insert=function(t,e,r){var n=r?t:this.toBBox(t),i=[],o=this._chooseSubtree(n,this.data,e,i);for(o.children.push(t),s(o,n);e>=0&&i[e].children.length>this._maxEntries;)this._split(i,e),e--;this._adjustParentBBoxes(n,i,e)},n.prototype._split=function(t,e){var r=t[e],n=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,n);var a=this._chooseSplitIndex(r,i,n),s=y(r.children.splice(a,r.children.length-a));s.height=r.height,s.leaf=r.leaf,o(r,this.toBBox),o(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(r,s)},n.prototype._splitRoot=function(t,e){this.data=y([t,e]),this.data.height=t.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},n.prototype._chooseSplitIndex=function(t,e,r){for(var n,i,o,s,u,l,f,p=1/0,h=1/0,y=e;y<=r-e;y++){var d=a(t,0,y,this.toBBox),g=a(t,y,r,this.toBBox),m=(i=d,o=g,void 0,void 0,void 0,void 0,s=Math.max(i.minX,o.minX),u=Math.max(i.minY,o.minY),l=Math.min(i.maxX,o.maxX),f=Math.min(i.maxY,o.maxY),Math.max(0,l-s)*Math.max(0,f-u)),v=c(d)+c(g);m<p?(p=m,n=y,h=v<h?v:h):m===p&&v<h&&(h=v,n=y)}return n||r-e},n.prototype._chooseSplitAxis=function(t,e,r){var n=t.leaf?this.compareMinX:u,i=t.leaf?this.compareMinY:l;this._allDistMargin(t,e,r,n)<this._allDistMargin(t,e,r,i)&&t.children.sort(n)},n.prototype._allDistMargin=function(t,e,r,n){t.children.sort(n);for(var i=this.toBBox,o=a(t,0,e,i),u=a(t,r-e,r,i),l=f(o)+f(u),c=e;c<r-e;c++){var p=t.children[c];s(o,t.leaf?i(p):p),l+=f(o)}for(var h=r-e-1;h>=e;h--){var y=t.children[h];s(u,t.leaf?i(y):y),l+=f(u)}return l},n.prototype._adjustParentBBoxes=function(t,e,r){for(var n=r;n>=0;n--)s(e[n],t)},n.prototype._condense=function(t){for(var e=t.length-1,r=void 0;e>=0;e--)0===t[e].children.length?e>0?(r=t[e-1].children).splice(r.indexOf(t[e]),1):this.clear():o(t[e],this.toBBox)},n}()},3697:(t,e,r)=>{var n=r(8052),i=Object,o=TypeError;t.exports=n((function(){if(null!=this&&this!==i(this))throw new o("RegExp.prototype.flags getter called on non-object");var t="";return this.hasIndices&&(t+="d"),this.global&&(t+="g"),this.ignoreCase&&(t+="i"),this.multiline&&(t+="m"),this.dotAll&&(t+="s"),this.unicode&&(t+="u"),this.unicodeSets&&(t+="v"),this.sticky&&(t+="y"),t}),"get flags",!0)},2847:(t,e,r)=>{var n=r(4289),i=r(5559),o=r(3697),a=r(1721),s=r(2753),u=i(a());n(u,{getPolyfill:a,implementation:o,shim:s}),t.exports=u},1721:(t,e,r)=>{var n=r(3697),i=r(4289).supportsDescriptors,o=Object.getOwnPropertyDescriptor;t.exports=function(){if(i&&"gim"===/a/gim.flags){var t=o(RegExp.prototype,"flags");if(t&&"function"==typeof t.get&&"boolean"==typeof RegExp.prototype.dotAll&&"boolean"==typeof RegExp.prototype.hasIndices){var e="",r={};if(Object.defineProperty(r,"hasIndices",{get:function(){e+="d"}}),Object.defineProperty(r,"sticky",{get:function(){e+="y"}}),"dy"===e)return t.get}}return n}},2753:(t,e,r)=>{var n=r(4289).supportsDescriptors,i=r(1721),o=Object.getOwnPropertyDescriptor,a=Object.defineProperty,s=TypeError,u=Object.getPrototypeOf,l=/a/;t.exports=function(){if(!n||!u)throw new s("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var t=i(),e=u(l),r=o(e,"flags");return r&&r.get===t||a(e,"flags",{configurable:!0,enumerable:!1,get:t}),t}},8639:function(t,e){!function(t){const e=134217729;function r(t,e,r,n,i){let o,a,s,u,l=e[0],c=n[0],f=0,p=0;c>l==c>-l?(o=l,l=e[++f]):(o=c,c=n[++p]);let h=0;if(f<t&&p<r)for(c>l==c>-l?(s=o-((a=l+o)-l),l=e[++f]):(s=o-((a=c+o)-c),c=n[++p]),o=a,0!==s&&(i[h++]=s);f<t&&p<r;)c>l==c>-l?(s=o-((a=o+l)-(u=a-o))+(l-u),l=e[++f]):(s=o-((a=o+c)-(u=a-o))+(c-u),c=n[++p]),o=a,0!==s&&(i[h++]=s);for(;f<t;)s=o-((a=o+l)-(u=a-o))+(l-u),l=e[++f],o=a,0!==s&&(i[h++]=s);for(;p<r;)s=o-((a=o+c)-(u=a-o))+(c-u),c=n[++p],o=a,0!==s&&(i[h++]=s);return 0===o&&0!==h||(i[h++]=o),h}function n(t){return new Float64Array(t)}const i=n(4),o=n(8),a=n(12),s=n(16),u=n(4);t.orient2d=function(t,n,l,c,f,p){const h=(n-p)*(l-f),y=(t-f)*(c-p),d=h-y;if(0===h||0===y||h>0!=y>0)return d;const g=Math.abs(h+y);return Math.abs(d)>=33306690738754716e-32*g?d:-function(t,n,l,c,f,p,h){let y,d,g,m,v,_,b,w,S,O,x,C,E,P,k,T,j,R;const L=t-f,I=l-f,M=n-p,A=c-p;v=(k=(w=L-(b=(_=e*L)-(_-L)))*(O=A-(S=(_=e*A)-(_-A)))-((P=L*A)-b*S-w*S-b*O))-(x=k-(j=(w=M-(b=(_=e*M)-(_-M)))*(O=I-(S=(_=e*I)-(_-I)))-((T=M*I)-b*S-w*S-b*O))),i[0]=k-(x+v)+(v-j),v=(E=P-((C=P+x)-(v=C-P))+(x-v))-(x=E-T),i[1]=E-(x+v)+(v-T),v=(R=C+x)-C,i[2]=C-(R-v)+(x-v),i[3]=R;let D=function(t,e){let r=e[0];for(let t=1;t<4;t++)r+=e[t];return r}(0,i),N=22204460492503146e-32*h;if(D>=N||-D>=N)return D;if(y=t-(L+(v=t-L))+(v-f),g=l-(I+(v=l-I))+(v-f),d=n-(M+(v=n-M))+(v-p),m=c-(A+(v=c-A))+(v-p),0===y&&0===d&&0===g&&0===m)return D;if(N=11093356479670487e-47*h+33306690738754706e-32*Math.abs(D),(D+=L*m+A*y-(M*g+I*d))>=N||-D>=N)return D;v=(k=(w=y-(b=(_=e*y)-(_-y)))*(O=A-(S=(_=e*A)-(_-A)))-((P=y*A)-b*S-w*S-b*O))-(x=k-(j=(w=d-(b=(_=e*d)-(_-d)))*(O=I-(S=(_=e*I)-(_-I)))-((T=d*I)-b*S-w*S-b*O))),u[0]=k-(x+v)+(v-j),v=(E=P-((C=P+x)-(v=C-P))+(x-v))-(x=E-T),u[1]=E-(x+v)+(v-T),v=(R=C+x)-C,u[2]=C-(R-v)+(x-v),u[3]=R;const F=r(4,i,4,u,o);v=(k=(w=L-(b=(_=e*L)-(_-L)))*(O=m-(S=(_=e*m)-(_-m)))-((P=L*m)-b*S-w*S-b*O))-(x=k-(j=(w=M-(b=(_=e*M)-(_-M)))*(O=g-(S=(_=e*g)-(_-g)))-((T=M*g)-b*S-w*S-b*O))),u[0]=k-(x+v)+(v-j),v=(E=P-((C=P+x)-(v=C-P))+(x-v))-(x=E-T),u[1]=E-(x+v)+(v-T),v=(R=C+x)-C,u[2]=C-(R-v)+(x-v),u[3]=R;const z=r(F,o,4,u,a);v=(k=(w=y-(b=(_=e*y)-(_-y)))*(O=m-(S=(_=e*m)-(_-m)))-((P=y*m)-b*S-w*S-b*O))-(x=k-(j=(w=d-(b=(_=e*d)-(_-d)))*(O=g-(S=(_=e*g)-(_-g)))-((T=d*g)-b*S-w*S-b*O))),u[0]=k-(x+v)+(v-j),v=(E=P-((C=P+x)-(v=C-P))+(x-v))-(x=E-T),u[1]=E-(x+v)+(v-T),v=(R=C+x)-C,u[2]=C-(R-v)+(x-v),u[3]=R;const G=r(z,a,4,u,s);return s[G-1]}(t,n,l,c,f,p,g)},t.orient2dfast=function(t,e,r,n,i,o){return(e-o)*(r-i)-(t-i)*(n-o)},Object.defineProperty(t,"__esModule",{value:!0})}(e)},7771:(t,e,r)=>{var n=r(210),i=r(2296),o=r(1044)(),a=r(7296),s=n("%TypeError%"),u=n("%Math.floor%");t.exports=function(t,e){if("function"!=typeof t)throw new s("`fn` is not a function");if("number"!=typeof e||e<0||e>4294967295||u(e)!==e)throw new s("`length` must be a positive 32-bit integer");var r=arguments.length>2&&!!arguments[2],n=!0,l=!0;if("length"in t&&a){var c=a(t,"length");c&&!c.configurable&&(n=!1),c&&!c.writable&&(l=!1)}return(n||l||!r)&&(o?i(t,"length",e,!0,!0):i(t,"length",e)),t}},8052:(t,e,r)=>{var n=r(2296),i=r(1044)(),o=r(5972).functionsHaveConfigurableNames(),a=TypeError;t.exports=function(t,e){if("function"!=typeof t)throw new a("`fn` is not a function");return arguments.length>2&&!!arguments[2]&&!o||(i?n(t,"name",e,!0,!0):n(t,"name",e)),t}},5697:t=>{t.exports={eudist:function(t,e,r){for(var n=t.length,i=0,o=0;o<n;o++){var a=(t[o]||0)-(e[o]||0);i+=a*a}return r?Math.sqrt(i):i},mandist:function(t,e,r){for(var n=t.length,i=0,o=0;o<n;o++)i+=Math.abs((t[o]||0)-(e[o]||0));return r?Math.sqrt(i):i},dist:function(t,e,r){var n=Math.abs(t-e);return r?n:n*n}}},7035:(t,e,r)=>{var n=r(5697),i=n.eudist,o=n.dist;t.exports={kmrand:function(t,e){for(var r={},n=[],i=e<<2,o=t.length,a=t[0].length>0;n.length<e&&i-- >0;){var s=t[Math.floor(Math.random()*o)],u=a?s.join("_"):""+s;r[u]||(r[u]=!0,n.push(s))}if(n.length<e)throw new Error("Error initializating clusters");return n},kmpp:function(t,e){var r=t[0].length?i:o,n=[],a=t.length,s=t[0].length>0,u=t[Math.floor(Math.random()*a)];for(s&&u.join("_"),n.push(u);n.length<e;){for(var l=[],c=n.length,f=0,p=[],h=0;h<a;h++){for(var y=1/0,d=0;d<c;d++){var g=r(t[h],n[d]);g<=y&&(y=g)}l[h]=y}for(var m=0;m<a;m++)f+=l[m];for(var v=0;v<a;v++)p[v]={i:v,v:t[v],pr:l[v]/f,cs:0};p.sort((function(t,e){return t.pr-e.pr})),p[0].cs=p[0].pr;for(var _=1;_<a;_++)p[_].cs=p[_-1].cs+p[_].pr;for(var b=Math.random(),w=0;w<a-1&&p[w++].cs<b;);n.push(p[w-1].v)}return n}}},1160:(t,e,r)=>{var n=r(5697),i=r(7035),o=n.eudist,a=(n.mandist,n.dist,i.kmrand),s=i.kmpp;function u(t,e,r){r=r||[];for(var n=0;n<t;n++)r[n]=e;return r}t.exports=function(t,e,r,n){var i=[],l=[],c=[],f=[],p=!1,h=n||1e4,y=t.length,d=t[0].length,g=d>0,m=[];if(r)i="kmrand"==r?a(t,e):"kmpp"==r?s(t,e):r;else for(var v={};i.length<e;){var _=Math.floor(Math.random()*y);v[_]||(v[_]=!0,i.push(t[_]))}do{u(e,0,m);for(var b=0;b<y;b++){for(var w=1/0,S=0,O=0;O<e;O++)(f=g?o(t[b],i[O]):Math.abs(t[b]-i[O]))<=w&&(w=f,S=O);c[b]=S,m[S]++}for(var x=[],C=(l=[],0);C<e;C++)x[C]=g?u(d,0,x[C]):0,l[C]=i[C];if(g){for(var E=0;E<e;E++)i[E]=[];for(var P=0;P<y;P++)for(var k=x[c[P]],T=t[P],j=0;j<d;j++)k[j]+=T[j];p=!0;for(var R=0;R<e;R++){for(var L=i[R],I=x[R],M=l[R],A=m[R],D=0;D<d;D++)L[D]=I[D]/A||0;if(p)for(var N=0;N<d;N++)if(M[N]!=L[N]){p=!1;break}}}else{for(var F=0;F<y;F++)x[c[F]]+=t[F];for(var z=0;z<e;z++)i[z]=x[z]/m[z]||0;p=!0;for(var G=0;G<e;G++)if(l[G]!=i[G]){p=!1;break}}p=p||--h<=0}while(!p);return{it:1e4-h,k:e,idxs:c,centroids:i}}},3379:t=>{var e=[];function r(t){for(var r=-1,n=0;n<e.length;n++)if(e[n].identifier===t){r=n;break}return r}function n(t,n){for(var o={},a=[],s=0;s<t.length;s++){var u=t[s],l=n.base?u[0]+n.base:u[0],c=o[l]||0,f="".concat(l," ").concat(c);o[l]=c+1;var p=r(f),h={css:u[1],media:u[2],sourceMap:u[3],supports:u[4],layer:u[5]};if(-1!==p)e[p].references++,e[p].updater(h);else{var y=i(h,n);n.byIndex=s,e.splice(s,0,{identifier:f,updater:y,references:1})}a.push(f)}return a}function i(t,e){var r=e.domAPI(e);return r.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;r.update(t=e)}else r.remove()}}t.exports=function(t,i){var o=n(t=t||[],i=i||{});return function(t){t=t||[];for(var a=0;a<o.length;a++){var s=r(o[a]);e[s].references--}for(var u=n(t,i),l=0;l<o.length;l++){var c=r(o[l]);0===e[c].references&&(e[c].updater(),e.splice(c,1))}o=u}}},569:t=>{var e={};t.exports=function(t,r){var n=function(t){if(void 0===e[t]){var r=document.querySelector(t);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(t){r=null}e[t]=r}return e[t]}(t);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(r)}},9216:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},3565:(t,e,r)=>{t.exports=function(t){var e=r.nc;e&&t.setAttribute("nonce",e)}},7795:t=>{t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(r){!function(t,e,r){var n="";r.supports&&(n+="@supports (".concat(r.supports,") {")),r.media&&(n+="@media ".concat(r.media," {"));var i=void 0!==r.layer;i&&(n+="@layer".concat(r.layer.length>0?" ".concat(r.layer):""," {")),n+=r.css,i&&(n+="}"),r.media&&(n+="}"),r.supports&&(n+="}");var o=r.sourceMap;o&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),e.styleTagTransform(n,t,e.options)}(e,t,r)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},4589:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},3842:(t,e,r)=>{r.r(e),r.d(e,{default:()=>n});class n{constructor(t=[],e=i){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:r}=this,n=e[t];for(;t>0;){const i=t-1>>1,o=e[i];if(r(n,o)>=0)break;e[t]=o,t=i}e[t]=n}_down(t){const{data:e,compare:r}=this,n=this.length>>1,i=e[t];for(;t<n;){let n=1+(t<<1),o=e[n];const a=n+1;if(a<this.length&&r(e[a],o)<0&&(n=a,o=e[a]),r(o,i)>=0)break;e[t]=o,t=n}e[t]=i}}function i(t,e){return t<e?-1:t>e?1:0}},675:function(t,e){!function(t){function e(){}function r(t){this.message=t||""}function n(t){this.message=t||""}function i(t){this.message=t||""}function o(){}function a(t){return null===t?Mt:t.color}function s(t){return null===t?null:t.parent}function u(t,e){null!==t&&(t.color=e)}function l(t){return null===t?null:t.left}function c(t){return null===t?null:t.right}function f(){this.root_=null,this.size_=0}function p(){}function h(){this.array_=[],arguments[0]instanceof bt&&this.addAll(arguments[0])}function y(){}function d(t){this.message=t||""}function g(){this.array_=[]}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(t){if(null==this)throw new TypeError(this+" is not an object");var e=Object(this),r=Math.max(Math.min(e.length,9007199254740991),0)||0,n=1 in arguments&&parseInt(Number(arguments[1]),10)||0;n=n<0?Math.max(r+n,0):Math.min(n,r);var i=2 in arguments&&void 0!==arguments[2]?parseInt(Number(arguments[2]),10)||0:r;for(i=i<0?Math.max(r+arguments[2],0):Math.min(i,r);n<i;)e[n]=t,++n;return e},writable:!0}),Number.isFinite=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)},Number.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},Number.parseFloat=Number.parseFloat||parseFloat,Number.isNaN=Number.isNaN||function(t){return t!=t},Math.trunc=Math.trunc||function(t){return t<0?Math.ceil(t):Math.floor(t)};var m=function(){};m.prototype.interfaces_=function(){return[]},m.prototype.getClass=function(){return m},m.prototype.equalsWithTolerance=function(t,e,r){return Math.abs(t-e)<=r};var v=function(t){function e(e){t.call(this,e),this.name="IllegalArgumentException",this.message=e,this.stack=(new t).stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),_=function(){},b={MAX_VALUE:{configurable:!0}};_.isNaN=function(t){return Number.isNaN(t)},_.doubleToLongBits=function(t){return t},_.longBitsToDouble=function(t){return t},_.isInfinite=function(t){return!Number.isFinite(t)},b.MAX_VALUE.get=function(){return Number.MAX_VALUE},Object.defineProperties(_,b);var w=function(){},S=function(){},O=function(){},x=function t(){if(this.x=null,this.y=null,this.z=null,0===arguments.length)this.x=0,this.y=0,this.z=t.NULL_ORDINATE;else if(1===arguments.length){var e=arguments[0];this.x=e.x,this.y=e.y,this.z=e.z}else 2===arguments.length?(this.x=arguments[0],this.y=arguments[1],this.z=t.NULL_ORDINATE):3===arguments.length&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},C={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};x.prototype.setOrdinate=function(t,e){switch(t){case x.X:this.x=e;break;case x.Y:this.y=e;break;case x.Z:this.z=e;break;default:throw new v("Invalid ordinate index: "+t)}},x.prototype.equals2D=function(){if(1===arguments.length){var t=arguments[0];return this.x===t.x&&this.y===t.y}if(2===arguments.length){var e=arguments[0],r=arguments[1];return!!m.equalsWithTolerance(this.x,e.x,r)&&!!m.equalsWithTolerance(this.y,e.y,r)}},x.prototype.getOrdinate=function(t){switch(t){case x.X:return this.x;case x.Y:return this.y;case x.Z:return this.z}throw new v("Invalid ordinate index: "+t)},x.prototype.equals3D=function(t){return this.x===t.x&&this.y===t.y&&(this.z===t.z||_.isNaN(this.z))&&_.isNaN(t.z)},x.prototype.equals=function(t){return t instanceof x&&this.equals2D(t)},x.prototype.equalInZ=function(t,e){return m.equalsWithTolerance(this.z,t.z,e)},x.prototype.compareTo=function(t){var e=t;return this.x<e.x?-1:this.x>e.x?1:this.y<e.y?-1:this.y>e.y?1:0},x.prototype.clone=function(){},x.prototype.copy=function(){return new x(this)},x.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},x.prototype.distance3D=function(t){var e=this.x-t.x,r=this.y-t.y,n=this.z-t.z;return Math.sqrt(e*e+r*r+n*n)},x.prototype.distance=function(t){var e=this.x-t.x,r=this.y-t.y;return Math.sqrt(e*e+r*r)},x.prototype.hashCode=function(){var t=17;return 37*(t=37*t+x.hashCode(this.x))+x.hashCode(this.y)},x.prototype.setCoordinate=function(t){this.x=t.x,this.y=t.y,this.z=t.z},x.prototype.interfaces_=function(){return[w,S,e]},x.prototype.getClass=function(){return x},x.hashCode=function(){if(1===arguments.length){var t=_.doubleToLongBits(arguments[0]);return Math.trunc((t^t)>>>32)}},C.DimensionalComparator.get=function(){return E},C.serialVersionUID.get=function(){return 0x5cbf2c235c7e5800},C.NULL_ORDINATE.get=function(){return _.NaN},C.X.get=function(){return 0},C.Y.get=function(){return 1},C.Z.get=function(){return 2},Object.defineProperties(x,C);var E=function(t){if(this._dimensionsToTest=2,0===arguments.length);else if(1===arguments.length){var e=arguments[0];if(2!==e&&3!==e)throw new v("only 2 or 3 dimensions may be specified");this._dimensionsToTest=e}};E.prototype.compare=function(t,e){var r=t,n=e,i=E.compare(r.x,n.x);if(0!==i)return i;var o=E.compare(r.y,n.y);return 0!==o?o:this._dimensionsToTest<=2?0:E.compare(r.z,n.z)},E.prototype.interfaces_=function(){return[O]},E.prototype.getClass=function(){return E},E.compare=function(t,e){return t<e?-1:t>e?1:_.isNaN(t)?_.isNaN(e)?0:-1:_.isNaN(e)?1:0};var P=function(){};P.prototype.create=function(){},P.prototype.interfaces_=function(){return[]},P.prototype.getClass=function(){return P};var k=function(){},T={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};k.prototype.interfaces_=function(){return[]},k.prototype.getClass=function(){return k},k.toLocationSymbol=function(t){switch(t){case k.EXTERIOR:return"e";case k.BOUNDARY:return"b";case k.INTERIOR:return"i";case k.NONE:return"-"}throw new v("Unknown location value: "+t)},T.INTERIOR.get=function(){return 0},T.BOUNDARY.get=function(){return 1},T.EXTERIOR.get=function(){return 2},T.NONE.get=function(){return-1},Object.defineProperties(k,T);var j=function(t,e){return t.interfaces_&&t.interfaces_().indexOf(e)>-1},R=function(){},L={LOG_10:{configurable:!0}};R.prototype.interfaces_=function(){return[]},R.prototype.getClass=function(){return R},R.log10=function(t){var e=Math.log(t);return _.isInfinite(e)||_.isNaN(e)?e:e/R.LOG_10},R.min=function(t,e,r,n){var i=t;return e<i&&(i=e),r<i&&(i=r),n<i&&(i=n),i},R.clamp=function(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1],r=arguments[2];return t<e?e:t>r?r:t}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var n=arguments[0],i=arguments[1],o=arguments[2];return n<i?i:n>o?o:n}},R.wrap=function(t,e){return t<0?e- -t%e:t%e},R.max=function(){if(3===arguments.length){var t=arguments[1],e=arguments[2],r=arguments[0];return t>r&&(r=t),e>r&&(r=e),r}if(4===arguments.length){var n=arguments[1],i=arguments[2],o=arguments[3],a=arguments[0];return n>a&&(a=n),i>a&&(a=i),o>a&&(a=o),a}},R.average=function(t,e){return(t+e)/2},L.LOG_10.get=function(){return Math.log(10)},Object.defineProperties(R,L);var I=function(t){this.str=t};I.prototype.append=function(t){this.str+=t},I.prototype.setCharAt=function(t,e){this.str=this.str.substr(0,t)+e+this.str.substr(t+1)},I.prototype.toString=function(t){return this.str};var M=function(t){this.value=t};M.prototype.intValue=function(){return this.value},M.prototype.compareTo=function(t){return this.value<t?-1:this.value>t?1:0},M.isNaN=function(t){return Number.isNaN(t)};var A=function(){};A.isWhitespace=function(t){return t<=32&&t>=0||127===t},A.toUpperCase=function(t){return t.toUpperCase()};var D=function t(){if(this._hi=0,this._lo=0,0===arguments.length)this.init(0);else if(1===arguments.length)if("number"==typeof arguments[0]){var e=arguments[0];this.init(e)}else if(arguments[0]instanceof t){var r=arguments[0];this.init(r)}else"string"==typeof arguments[0]&&t.call(this,t.parse(arguments[0]));else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.init(n,i)}},N={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};D.prototype.le=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<=t._lo},D.prototype.extractSignificantDigits=function(t,e){var r=this.abs(),n=D.magnitude(r._hi),i=D.TEN.pow(n);(r=r.divide(i)).gt(D.TEN)?(r=r.divide(D.TEN),n+=1):r.lt(D.ONE)&&(r=r.multiply(D.TEN),n-=1);for(var o=n+1,a=new I,s=D.MAX_PRINT_DIGITS-1,u=0;u<=s;u++){t&&u===o&&a.append(".");var l=Math.trunc(r._hi);if(l<0)break;var c=!1,f=0;l>9?(c=!0,f="9"):f="0"+l,a.append(f),r=r.subtract(D.valueOf(l)).multiply(D.TEN),c&&r.selfAdd(D.TEN);var p=!0,h=D.magnitude(r._hi);if(h<0&&Math.abs(h)>=s-u&&(p=!1),!p)break}return e[0]=n,a.toString()},D.prototype.sqr=function(){return this.multiply(this)},D.prototype.doubleValue=function(){return this._hi+this._lo},D.prototype.subtract=function(){if(arguments[0]instanceof D){var t=arguments[0];return this.add(t.negate())}if("number"==typeof arguments[0]){var e=arguments[0];return this.add(-e)}},D.prototype.equals=function(){if(1===arguments.length){var t=arguments[0];return this._hi===t._hi&&this._lo===t._lo}},D.prototype.isZero=function(){return 0===this._hi&&0===this._lo},D.prototype.selfSubtract=function(){if(arguments[0]instanceof D){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t._hi,-t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e,0)}},D.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null},D.prototype.min=function(t){return this.le(t)?this:t},D.prototype.selfDivide=function(){if(1===arguments.length){if(arguments[0]instanceof D){var t=arguments[0];return this.selfDivide(t._hi,t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.selfDivide(e,0)}}else if(2===arguments.length){var r,n,i,o,a=arguments[0],s=arguments[1],u=null,l=null,c=null,f=null;return i=this._hi/a,f=(u=(c=D.SPLIT*i)-(u=c-i))*(l=(f=D.SPLIT*a)-(l=f-a))-(o=i*a)+u*(n=a-l)+(r=i-u)*l+r*n,f=i+(c=(this._hi-o-f+this._lo-i*s)/a),this._hi=f,this._lo=i-f+c,this}},D.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"},D.prototype.divide=function(){if(arguments[0]instanceof D){var t,e,r,n,i=arguments[0],o=null,a=null,s=null,u=null;return t=(r=this._hi/i._hi)-(o=(s=D.SPLIT*r)-(o=s-r)),u=o*(a=(u=D.SPLIT*i._hi)-(a=u-i._hi))-(n=r*i._hi)+o*(e=i._hi-a)+t*a+t*e,s=(this._hi-n-u+this._lo-r*i._lo)/i._hi,new D(u=r+s,r-u+s)}if("number"==typeof arguments[0]){var l=arguments[0];return _.isNaN(l)?D.createNaN():D.copy(this).selfDivide(l,0)}},D.prototype.ge=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>=t._lo},D.prototype.pow=function(t){if(0===t)return D.valueOf(1);var e=new D(this),r=D.valueOf(1),n=Math.abs(t);if(n>1)for(;n>0;)n%2==1&&r.selfMultiply(e),(n/=2)>0&&(e=e.sqr());else r=e;return t<0?r.reciprocal():r},D.prototype.ceil=function(){if(this.isNaN())return D.NaN;var t=Math.ceil(this._hi),e=0;return t===this._hi&&(e=Math.ceil(this._lo)),new D(t,e)},D.prototype.compareTo=function(t){var e=t;return this._hi<e._hi?-1:this._hi>e._hi?1:this._lo<e._lo?-1:this._lo>e._lo?1:0},D.prototype.rint=function(){return this.isNaN()?this:this.add(.5).floor()},D.prototype.setValue=function(){if(arguments[0]instanceof D){var t=arguments[0];return this.init(t),this}if("number"==typeof arguments[0]){var e=arguments[0];return this.init(e),this}},D.prototype.max=function(t){return this.ge(t)?this:t},D.prototype.sqrt=function(){if(this.isZero())return D.valueOf(0);if(this.isNegative())return D.NaN;var t=1/Math.sqrt(this._hi),e=this._hi*t,r=D.valueOf(e),n=this.subtract(r.sqr())._hi*(.5*t);return r.add(n)},D.prototype.selfAdd=function(){if(1===arguments.length){if(arguments[0]instanceof D){var t=arguments[0];return this.selfAdd(t._hi,t._lo)}if("number"==typeof arguments[0]){var e,r,n,i,o,a=arguments[0],s=null;return s=(n=this._hi+a)-(i=n-this._hi),r=(o=(s=a-i+(this._hi-s))+this._lo)+(n-(e=n+o)),this._hi=e+r,this._lo=r+(e-this._hi),this}}else if(2===arguments.length){var u,l,c,f,p=arguments[0],h=arguments[1],y=null,d=null,g=null;c=this._hi+p,l=this._lo+h,d=c-(g=c-this._hi),y=l-(f=l-this._lo);var m=(u=c+(g=(d=p-g+(this._hi-d))+l))+(g=(y=h-f+(this._lo-y))+(g+(c-u))),v=g+(u-m);return this._hi=m,this._lo=v,this}},D.prototype.selfMultiply=function(){if(1===arguments.length){if(arguments[0]instanceof D){var t=arguments[0];return this.selfMultiply(t._hi,t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.selfMultiply(e,0)}}else if(2===arguments.length){var r,n,i=arguments[0],o=arguments[1],a=null,s=null,u=null,l=null;a=(u=D.SPLIT*this._hi)-this._hi,l=D.SPLIT*i,a=u-a,r=this._hi-a,s=l-i;var c=(u=this._hi*i)+(l=a*(s=l-s)-u+a*(n=i-s)+r*s+r*n+(this._hi*o+this._lo*i)),f=l+(a=u-c);return this._hi=c,this._lo=f,this}},D.prototype.selfSqr=function(){return this.selfMultiply(this)},D.prototype.floor=function(){if(this.isNaN())return D.NaN;var t=Math.floor(this._hi),e=0;return t===this._hi&&(e=Math.floor(this._lo)),new D(t,e)},D.prototype.negate=function(){return this.isNaN()?this:new D(-this._hi,-this._lo)},D.prototype.clone=function(){},D.prototype.multiply=function(){if(arguments[0]instanceof D){var t=arguments[0];return t.isNaN()?D.createNaN():D.copy(this).selfMultiply(t)}if("number"==typeof arguments[0]){var e=arguments[0];return _.isNaN(e)?D.createNaN():D.copy(this).selfMultiply(e,0)}},D.prototype.isNaN=function(){return _.isNaN(this._hi)},D.prototype.intValue=function(){return Math.trunc(this._hi)},D.prototype.toString=function(){var t=D.magnitude(this._hi);return t>=-3&&t<=20?this.toStandardNotation():this.toSciNotation()},D.prototype.toStandardNotation=function(){var t=this.getSpecialNumberString();if(null!==t)return t;var e=new Array(1).fill(null),r=this.extractSignificantDigits(!0,e),n=e[0]+1,i=r;if("."===r.charAt(0))i="0"+r;else if(n<0)i="0."+D.stringOfChar("0",-n)+r;else if(-1===r.indexOf(".")){var o=n-r.length;i=r+D.stringOfChar("0",o)+".0"}return this.isNegative()?"-"+i:i},D.prototype.reciprocal=function(){var t,e,r,n,i=null,o=null,a=null,s=null;t=(r=1/this._hi)-(i=(a=D.SPLIT*r)-(i=a-r)),o=(s=D.SPLIT*this._hi)-this._hi;var u=r+(a=(1-(n=r*this._hi)-(s=i*(o=s-o)-n+i*(e=this._hi-o)+t*o+t*e)-r*this._lo)/this._hi);return new D(u,r-u+a)},D.prototype.toSciNotation=function(){if(this.isZero())return D.SCI_NOT_ZERO;var t=this.getSpecialNumberString();if(null!==t)return t;var e=new Array(1).fill(null),r=this.extractSignificantDigits(!1,e),n=D.SCI_NOT_EXPONENT_CHAR+e[0];if("0"===r.charAt(0))throw new Error("Found leading zero: "+r);var i="";r.length>1&&(i=r.substring(1));var o=r.charAt(0)+"."+i;return this.isNegative()?"-"+o+n:o+n},D.prototype.abs=function(){return this.isNaN()?D.NaN:this.isNegative()?this.negate():new D(this)},D.prototype.isPositive=function(){return(this._hi>0||0===this._hi)&&this._lo>0},D.prototype.lt=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<t._lo},D.prototype.add=function(){if(arguments[0]instanceof D){var t=arguments[0];return D.copy(this).selfAdd(t)}if("number"==typeof arguments[0]){var e=arguments[0];return D.copy(this).selfAdd(e)}},D.prototype.init=function(){if(1===arguments.length){if("number"==typeof arguments[0]){var t=arguments[0];this._hi=t,this._lo=0}else if(arguments[0]instanceof D){var e=arguments[0];this._hi=e._hi,this._lo=e._lo}}else if(2===arguments.length){var r=arguments[0],n=arguments[1];this._hi=r,this._lo=n}},D.prototype.gt=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>t._lo},D.prototype.isNegative=function(){return(this._hi<0||0===this._hi)&&this._lo<0},D.prototype.trunc=function(){return this.isNaN()?D.NaN:this.isPositive()?this.floor():this.ceil()},D.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0},D.prototype.interfaces_=function(){return[e,w,S]},D.prototype.getClass=function(){return D},D.sqr=function(t){return D.valueOf(t).selfMultiply(t)},D.valueOf=function(){return"string"==typeof arguments[0]?D.parse(arguments[0]):"number"==typeof arguments[0]?new D(arguments[0]):void 0},D.sqrt=function(t){return D.valueOf(t).sqrt()},D.parse=function(t){for(var e=0,r=t.length;A.isWhitespace(t.charAt(e));)e++;var n=!1;if(e<r){var i=t.charAt(e);"-"!==i&&"+"!==i||(e++,"-"===i&&(n=!0))}for(var o=new D,a=0,s=0,u=0;!(e>=r);){var l=t.charAt(e);if(e++,A.isDigit(l)){var c=l-"0";o.selfMultiply(D.TEN),o.selfAdd(c),a++}else{if("."!==l){if("e"===l||"E"===l){var f=t.substring(e);try{u=M.parseInt(f)}catch(e){throw e instanceof Error?new Error("Invalid exponent "+f+" in string "+t):e}break}throw new Error("Unexpected character '"+l+"' at position "+e+" in string "+t)}s=a}}var p=o,h=a-s-u;if(0===h)p=o;else if(h>0){var y=D.TEN.pow(h);p=o.divide(y)}else if(h<0){var d=D.TEN.pow(-h);p=o.multiply(d)}return n?p.negate():p},D.createNaN=function(){return new D(_.NaN,_.NaN)},D.copy=function(t){return new D(t)},D.magnitude=function(t){var e=Math.abs(t),r=Math.log(e)/Math.log(10),n=Math.trunc(Math.floor(r));return 10*Math.pow(10,n)<=e&&(n+=1),n},D.stringOfChar=function(t,e){for(var r=new I,n=0;n<e;n++)r.append(t);return r.toString()},N.PI.get=function(){return new D(3.141592653589793,12246467991473532e-32)},N.TWO_PI.get=function(){return new D(6.283185307179586,24492935982947064e-32)},N.PI_2.get=function(){return new D(1.5707963267948966,6123233995736766e-32)},N.E.get=function(){return new D(2.718281828459045,14456468917292502e-32)},N.NaN.get=function(){return new D(_.NaN,_.NaN)},N.EPS.get=function(){return 123259516440783e-46},N.SPLIT.get=function(){return 134217729},N.MAX_PRINT_DIGITS.get=function(){return 32},N.TEN.get=function(){return D.valueOf(10)},N.ONE.get=function(){return D.valueOf(1)},N.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"},N.SCI_NOT_ZERO.get=function(){return"0.0E0"},Object.defineProperties(D,N);var F=function(){},z={DP_SAFE_EPSILON:{configurable:!0}};F.prototype.interfaces_=function(){return[]},F.prototype.getClass=function(){return F},F.orientationIndex=function(t,e,r){var n=F.orientationIndexFilter(t,e,r);if(n<=1)return n;var i=D.valueOf(e.x).selfAdd(-t.x),o=D.valueOf(e.y).selfAdd(-t.y),a=D.valueOf(r.x).selfAdd(-e.x),s=D.valueOf(r.y).selfAdd(-e.y);return i.selfMultiply(s).selfSubtract(o.selfMultiply(a)).signum()},F.signOfDet2x2=function(t,e,r,n){return t.multiply(n).selfSubtract(e.multiply(r)).signum()},F.intersection=function(t,e,r,n){var i=D.valueOf(n.y).selfSubtract(r.y).selfMultiply(D.valueOf(e.x).selfSubtract(t.x)),o=D.valueOf(n.x).selfSubtract(r.x).selfMultiply(D.valueOf(e.y).selfSubtract(t.y)),a=i.subtract(o),s=D.valueOf(n.x).selfSubtract(r.x).selfMultiply(D.valueOf(t.y).selfSubtract(r.y)),u=D.valueOf(n.y).selfSubtract(r.y).selfMultiply(D.valueOf(t.x).selfSubtract(r.x)),l=s.subtract(u).selfDivide(a).doubleValue(),c=D.valueOf(t.x).selfAdd(D.valueOf(e.x).selfSubtract(t.x).selfMultiply(l)).doubleValue(),f=D.valueOf(e.x).selfSubtract(t.x).selfMultiply(D.valueOf(t.y).selfSubtract(r.y)),p=D.valueOf(e.y).selfSubtract(t.y).selfMultiply(D.valueOf(t.x).selfSubtract(r.x)),h=f.subtract(p).selfDivide(a).doubleValue(),y=D.valueOf(r.y).selfAdd(D.valueOf(n.y).selfSubtract(r.y).selfMultiply(h)).doubleValue();return new x(c,y)},F.orientationIndexFilter=function(t,e,r){var n=null,i=(t.x-r.x)*(e.y-r.y),o=(t.y-r.y)*(e.x-r.x),a=i-o;if(i>0){if(o<=0)return F.signum(a);n=i+o}else{if(!(i<0))return F.signum(a);if(o>=0)return F.signum(a);n=-i-o}var s=F.DP_SAFE_EPSILON*n;return a>=s||-a>=s?F.signum(a):2},F.signum=function(t){return t>0?1:t<0?-1:0},z.DP_SAFE_EPSILON.get=function(){return 1e-15},Object.defineProperties(F,z);var G=function(){},B={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};B.X.get=function(){return 0},B.Y.get=function(){return 1},B.Z.get=function(){return 2},B.M.get=function(){return 3},G.prototype.setOrdinate=function(t,e,r){},G.prototype.size=function(){},G.prototype.getOrdinate=function(t,e){},G.prototype.getCoordinate=function(){},G.prototype.getCoordinateCopy=function(t){},G.prototype.getDimension=function(){},G.prototype.getX=function(t){},G.prototype.clone=function(){},G.prototype.expandEnvelope=function(t){},G.prototype.copy=function(){},G.prototype.getY=function(t){},G.prototype.toCoordinateArray=function(){},G.prototype.interfaces_=function(){return[S]},G.prototype.getClass=function(){return G},Object.defineProperties(G,B);var V=function(){},U=function(t){function e(){t.call(this,"Projective point not representable on the Cartesian plane.")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(V),q=function(){};q.arraycopy=function(t,e,r,n,i){for(var o=0,a=e;a<e+i;a++)r[n+o]=t[a],o++},q.getProperty=function(t){return{"line.separator":"\n"}[t]};var W=function t(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.x=0,this.y=0,this.w=1;else if(1===arguments.length){var e=arguments[0];this.x=e.x,this.y=e.y,this.w=1}else if(2===arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var r=arguments[0],n=arguments[1];this.x=r,this.y=n,this.w=1}else if(arguments[0]instanceof t&&arguments[1]instanceof t){var i=arguments[0],o=arguments[1];this.x=i.y*o.w-o.y*i.w,this.y=o.x*i.w-i.x*o.w,this.w=i.x*o.y-o.x*i.y}else if(arguments[0]instanceof x&&arguments[1]instanceof x){var a=arguments[0],s=arguments[1];this.x=a.y-s.y,this.y=s.x-a.x,this.w=a.x*s.y-s.x*a.y}}else if(3===arguments.length){var u=arguments[0],l=arguments[1],c=arguments[2];this.x=u,this.y=l,this.w=c}else if(4===arguments.length){var f=arguments[0],p=arguments[1],h=arguments[2],y=arguments[3],d=f.y-p.y,g=p.x-f.x,m=f.x*p.y-p.x*f.y,v=h.y-y.y,_=y.x-h.x,b=h.x*y.y-y.x*h.y;this.x=g*b-_*m,this.y=v*m-d*b,this.w=d*_-v*g}};W.prototype.getY=function(){var t=this.y/this.w;if(_.isNaN(t)||_.isInfinite(t))throw new U;return t},W.prototype.getX=function(){var t=this.x/this.w;if(_.isNaN(t)||_.isInfinite(t))throw new U;return t},W.prototype.getCoordinate=function(){var t=new x;return t.x=this.getX(),t.y=this.getY(),t},W.prototype.interfaces_=function(){return[]},W.prototype.getClass=function(){return W},W.intersection=function(t,e,r,n){var i=t.y-e.y,o=e.x-t.x,a=t.x*e.y-e.x*t.y,s=r.y-n.y,u=n.x-r.x,l=r.x*n.y-n.x*r.y,c=i*u-s*o,f=(o*l-u*a)/c,p=(s*a-i*l)/c;if(_.isNaN(f)||_.isInfinite(f)||_.isNaN(p)||_.isInfinite(p))throw new U;return new x(f,p)};var X=function t(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,0===arguments.length)this.init();else if(1===arguments.length){if(arguments[0]instanceof x){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof t){var r=arguments[0];this.init(r)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.init(n.x,i.x,n.y,i.y)}else if(4===arguments.length){var o=arguments[0],a=arguments[1],s=arguments[2],u=arguments[3];this.init(o,a,s,u)}},Z={serialVersionUID:{configurable:!0}};X.prototype.getArea=function(){return this.getWidth()*this.getHeight()},X.prototype.equals=function(t){if(!(t instanceof X))return!1;var e=t;return this.isNull()?e.isNull():this._maxx===e.getMaxX()&&this._maxy===e.getMaxY()&&this._minx===e.getMinX()&&this._miny===e.getMinY()},X.prototype.intersection=function(t){if(this.isNull()||t.isNull()||!this.intersects(t))return new X;var e=this._minx>t._minx?this._minx:t._minx,r=this._miny>t._miny?this._miny:t._miny,n=this._maxx<t._maxx?this._maxx:t._maxx,i=this._maxy<t._maxy?this._maxy:t._maxy;return new X(e,n,r,i)},X.prototype.isNull=function(){return this._maxx<this._minx},X.prototype.getMaxX=function(){return this._maxx},X.prototype.covers=function(){if(1===arguments.length){if(arguments[0]instanceof x){var t=arguments[0];return this.covers(t.x,t.y)}if(arguments[0]instanceof X){var e=arguments[0];return!this.isNull()&&!e.isNull()&&e.getMinX()>=this._minx&&e.getMaxX()<=this._maxx&&e.getMinY()>=this._miny&&e.getMaxY()<=this._maxy}}else if(2===arguments.length){var r=arguments[0],n=arguments[1];return!this.isNull()&&r>=this._minx&&r<=this._maxx&&n>=this._miny&&n<=this._maxy}},X.prototype.intersects=function(){if(1===arguments.length){if(arguments[0]instanceof X){var t=arguments[0];return!this.isNull()&&!t.isNull()&&!(t._minx>this._maxx||t._maxx<this._minx||t._miny>this._maxy||t._maxy<this._miny)}if(arguments[0]instanceof x){var e=arguments[0];return this.intersects(e.x,e.y)}}else if(2===arguments.length){var r=arguments[0],n=arguments[1];return!this.isNull()&&!(r>this._maxx||r<this._minx||n>this._maxy||n<this._miny)}},X.prototype.getMinY=function(){return this._miny},X.prototype.getMinX=function(){return this._minx},X.prototype.expandToInclude=function(){if(1===arguments.length){if(arguments[0]instanceof x){var t=arguments[0];this.expandToInclude(t.x,t.y)}else if(arguments[0]instanceof X){var e=arguments[0];if(e.isNull())return null;this.isNull()?(this._minx=e.getMinX(),this._maxx=e.getMaxX(),this._miny=e.getMinY(),this._maxy=e.getMaxY()):(e._minx<this._minx&&(this._minx=e._minx),e._maxx>this._maxx&&(this._maxx=e._maxx),e._miny<this._miny&&(this._miny=e._miny),e._maxy>this._maxy&&(this._maxy=e._maxy))}}else if(2===arguments.length){var r=arguments[0],n=arguments[1];this.isNull()?(this._minx=r,this._maxx=r,this._miny=n,this._maxy=n):(r<this._minx&&(this._minx=r),r>this._maxx&&(this._maxx=r),n<this._miny&&(this._miny=n),n>this._maxy&&(this._maxy=n))}},X.prototype.minExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t<e?t:e},X.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx},X.prototype.compareTo=function(t){var e=t;return this.isNull()?e.isNull()?0:-1:e.isNull()?1:this._minx<e._minx?-1:this._minx>e._minx?1:this._miny<e._miny?-1:this._miny>e._miny?1:this._maxx<e._maxx?-1:this._maxx>e._maxx?1:this._maxy<e._maxy?-1:this._maxy>e._maxy?1:0},X.prototype.translate=function(t,e){if(this.isNull())return null;this.init(this.getMinX()+t,this.getMaxX()+t,this.getMinY()+e,this.getMaxY()+e)},X.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"},X.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1},X.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny},X.prototype.maxExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t>e?t:e},X.prototype.expandBy=function(){if(1===arguments.length){var t=arguments[0];this.expandBy(t,t)}else if(2===arguments.length){var e=arguments[0],r=arguments[1];if(this.isNull())return null;this._minx-=e,this._maxx+=e,this._miny-=r,this._maxy+=r,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}},X.prototype.contains=function(){if(1===arguments.length){if(arguments[0]instanceof X){var t=arguments[0];return this.covers(t)}if(arguments[0]instanceof x){var e=arguments[0];return this.covers(e)}}else if(2===arguments.length){var r=arguments[0],n=arguments[1];return this.covers(r,n)}},X.prototype.centre=function(){return this.isNull()?null:new x((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)},X.prototype.init=function(){if(0===arguments.length)this.setToNull();else if(1===arguments.length){if(arguments[0]instanceof x){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof X){var e=arguments[0];this._minx=e._minx,this._maxx=e._maxx,this._miny=e._miny,this._maxy=e._maxy}}else if(2===arguments.length){var r=arguments[0],n=arguments[1];this.init(r.x,n.x,r.y,n.y)}else if(4===arguments.length){var i=arguments[0],o=arguments[1],a=arguments[2],s=arguments[3];i<o?(this._minx=i,this._maxx=o):(this._minx=o,this._maxx=i),a<s?(this._miny=a,this._maxy=s):(this._miny=s,this._maxy=a)}},X.prototype.getMaxY=function(){return this._maxy},X.prototype.distance=function(t){if(this.intersects(t))return 0;var e=0;this._maxx<t._minx?e=t._minx-this._maxx:this._minx>t._maxx&&(e=this._minx-t._maxx);var r=0;return this._maxy<t._miny?r=t._miny-this._maxy:this._miny>t._maxy&&(r=this._miny-t._maxy),0===e?r:0===r?e:Math.sqrt(e*e+r*r)},X.prototype.hashCode=function(){var t=17;return 37*(t=37*(t=37*(t=37*t+x.hashCode(this._minx))+x.hashCode(this._maxx))+x.hashCode(this._miny))+x.hashCode(this._maxy)},X.prototype.interfaces_=function(){return[w,e]},X.prototype.getClass=function(){return X},X.intersects=function(){if(3===arguments.length){var t=arguments[0],e=arguments[1],r=arguments[2];return r.x>=(t.x<e.x?t.x:e.x)&&r.x<=(t.x>e.x?t.x:e.x)&&r.y>=(t.y<e.y?t.y:e.y)&&r.y<=(t.y>e.y?t.y:e.y)}if(4===arguments.length){var n=arguments[0],i=arguments[1],o=arguments[2],a=arguments[3],s=Math.min(o.x,a.x),u=Math.max(o.x,a.x),l=Math.min(n.x,i.x),c=Math.max(n.x,i.x);return!(l>u||c<s||(s=Math.min(o.y,a.y),u=Math.max(o.y,a.y),l=Math.min(n.y,i.y),c=Math.max(n.y,i.y),l>u||c<s))}},Z.serialVersionUID.get=function(){return 0x51845cd552189800},Object.defineProperties(X,Z);var H={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},Y=function(t){this.geometryFactory=t||new me};Y.prototype.read=function(t){var e,r,n;t=t.replace(/[\n\r]/g," ");var i=H.typeStr.exec(t);if(-1!==t.search("EMPTY")&&((i=H.emptyTypeStr.exec(t))[2]=void 0),i&&(r=i[1].toLowerCase(),n=i[2],J[r]&&(e=J[r].apply(this,[n]))),void 0===e)throw new Error("Could not parse WKT "+t);return e},Y.prototype.write=function(t){return this.extractGeometry(t)},Y.prototype.extractGeometry=function(t){var e=t.getGeometryType().toLowerCase();if(!K[e])return null;var r=e.toUpperCase();return t.isEmpty()?r+" EMPTY":r+"("+K[e].apply(this,[t])+")"};var K={coordinate:function(t){return t.x+" "+t.y},point:function(t){return K.coordinate.call(this,t._coordinates._coordinates[0])},multipoint:function(t){for(var e=[],r=0,n=t._geometries.length;r<n;++r)e.push("("+K.point.apply(this,[t._geometries[r]])+")");return e.join(",")},linestring:function(t){for(var e=[],r=0,n=t._points._coordinates.length;r<n;++r)e.push(K.coordinate.apply(this,[t._points._coordinates[r]]));return e.join(",")},linearring:function(t){for(var e=[],r=0,n=t._points._coordinates.length;r<n;++r)e.push(K.coordinate.apply(this,[t._points._coordinates[r]]));return e.join(",")},multilinestring:function(t){for(var e=[],r=0,n=t._geometries.length;r<n;++r)e.push("("+K.linestring.apply(this,[t._geometries[r]])+")");return e.join(",")},polygon:function(t){var e=[];e.push("("+K.linestring.apply(this,[t._shell])+")");for(var r=0,n=t._holes.length;r<n;++r)e.push("("+K.linestring.apply(this,[t._holes[r]])+")");return e.join(",")},multipolygon:function(t){for(var e=[],r=0,n=t._geometries.length;r<n;++r)e.push("("+K.polygon.apply(this,[t._geometries[r]])+")");return e.join(",")},geometrycollection:function(t){for(var e=[],r=0,n=t._geometries.length;r<n;++r)e.push(this.extractGeometry(t._geometries[r]));return e.join(",")}},J={point:function(t){if(void 0===t)return this.geometryFactory.createPoint();var e=t.trim().split(H.spaces);return this.geometryFactory.createPoint(new x(Number.parseFloat(e[0]),Number.parseFloat(e[1])))},multipoint:function(t){if(void 0===t)return this.geometryFactory.createMultiPoint();for(var e,r=t.trim().split(","),n=[],i=0,o=r.length;i<o;++i)e=r[i].replace(H.trimParens,"$1"),n.push(J.point.apply(this,[e]));return this.geometryFactory.createMultiPoint(n)},linestring:function(t){if(void 0===t)return this.geometryFactory.createLineString();for(var e,r=t.trim().split(","),n=[],i=0,o=r.length;i<o;++i)e=r[i].trim().split(H.spaces),n.push(new x(Number.parseFloat(e[0]),Number.parseFloat(e[1])));return this.geometryFactory.createLineString(n)},linearring:function(t){if(void 0===t)return this.geometryFactory.createLinearRing();for(var e,r=t.trim().split(","),n=[],i=0,o=r.length;i<o;++i)e=r[i].trim().split(H.spaces),n.push(new x(Number.parseFloat(e[0]),Number.parseFloat(e[1])));return this.geometryFactory.createLinearRing(n)},multilinestring:function(t){if(void 0===t)return this.geometryFactory.createMultiLineString();for(var e,r=t.trim().split(H.parenComma),n=[],i=0,o=r.length;i<o;++i)e=r[i].replace(H.trimParens,"$1"),n.push(J.linestring.apply(this,[e]));return this.geometryFactory.createMultiLineString(n)},polygon:function(t){if(void 0===t)return this.geometryFactory.createPolygon();for(var e,r,n,i,o=t.trim().split(H.parenComma),a=[],s=0,u=o.length;s<u;++s)e=o[s].replace(H.trimParens,"$1"),r=J.linestring.apply(this,[e]),n=this.geometryFactory.createLinearRing(r._points),0===s?i=n:a.push(n);return this.geometryFactory.createPolygon(i,a)},multipolygon:function(t){if(void 0===t)return this.geometryFactory.createMultiPolygon();for(var e,r=t.trim().split(H.doubleParenComma),n=[],i=0,o=r.length;i<o;++i)e=r[i].replace(H.trimParens,"$1"),n.push(J.polygon.apply(this,[e]));return this.geometryFactory.createMultiPolygon(n)},geometrycollection:function(t){if(void 0===t)return this.geometryFactory.createGeometryCollection();for(var e=(t=t.replace(/,\s*([A-Za-z])/g,"|$1")).trim().split("|"),r=[],n=0,i=e.length;n<i;++n)r.push(this.read(e[n]));return this.geometryFactory.createGeometryCollection(r)}},$=function(t){this.parser=new Y(t)};$.prototype.write=function(t){return this.parser.write(t)},$.toLineString=function(t,e){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+t.x+" "+t.y+", "+e.x+" "+e.y+" )"};var Q=function(t){function e(e){t.call(this,e),this.name="RuntimeException",this.message=e,this.stack=(new t).stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),tt=function(t){function e(){if(t.call(this),0===arguments.length)t.call(this);else if(1===arguments.length){var e=arguments[0];t.call(this,e)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Q),et=function(){};et.prototype.interfaces_=function(){return[]},et.prototype.getClass=function(){return et},et.shouldNeverReachHere=function(){if(0===arguments.length)et.shouldNeverReachHere(null);else if(1===arguments.length){var t=arguments[0];throw new tt("Should never reach here"+(null!==t?": "+t:""))}},et.isTrue=function(){var t;if(1===arguments.length)et.isTrue(arguments[0],null);else if(2===arguments.length&&(t=arguments[1],!arguments[0]))throw null===t?new tt:new tt(t)},et.equals=function(){var t,e,r;if(2===arguments.length)et.equals(t=arguments[0],e=arguments[1],null);else if(3===arguments.length&&(t=arguments[0],r=arguments[2],!(e=arguments[1]).equals(t)))throw new tt("Expected "+t+" but encountered "+e+(null!==r?": "+r:""))};var rt=function(){this._result=null,this._inputLines=Array(2).fill().map((function(){return Array(2)})),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new x,this._intPt[1]=new x,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},nt={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};rt.prototype.getIndexAlongSegment=function(t,e){return this.computeIntLineIndex(),this._intLineIndex[t][e]},rt.prototype.getTopologySummary=function(){var t=new I;return this.isEndPoint()&&t.append(" endpoint"),this._isProper&&t.append(" proper"),this.isCollinear()&&t.append(" collinear"),t.toString()},rt.prototype.computeIntersection=function(t,e,r,n){this._inputLines[0][0]=t,this._inputLines[0][1]=e,this._inputLines[1][0]=r,this._inputLines[1][1]=n,this._result=this.computeIntersect(t,e,r,n)},rt.prototype.getIntersectionNum=function(){return this._result},rt.prototype.computeIntLineIndex=function(){if(0===arguments.length)null===this._intLineIndex&&(this._intLineIndex=Array(2).fill().map((function(){return Array(2)})),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){var t=arguments[0];this.getEdgeDistance(t,0)>this.getEdgeDistance(t,1)?(this._intLineIndex[t][0]=0,this._intLineIndex[t][1]=1):(this._intLineIndex[t][0]=1,this._intLineIndex[t][1]=0)}},rt.prototype.isProper=function(){return this.hasIntersection()&&this._isProper},rt.prototype.setPrecisionModel=function(t){this._precisionModel=t},rt.prototype.isInteriorIntersection=function(){if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var t=arguments[0],e=0;e<this._result;e++)if(!this._intPt[e].equals2D(this._inputLines[t][0])&&!this._intPt[e].equals2D(this._inputLines[t][1]))return!0;return!1}},rt.prototype.getIntersection=function(t){return this._intPt[t]},rt.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper},rt.prototype.hasIntersection=function(){return this._result!==rt.NO_INTERSECTION},rt.prototype.getEdgeDistance=function(t,e){return rt.computeEdgeDistance(this._intPt[e],this._inputLines[t][0],this._inputLines[t][1])},rt.prototype.isCollinear=function(){return this._result===rt.COLLINEAR_INTERSECTION},rt.prototype.toString=function(){return $.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+$.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()},rt.prototype.getEndpoint=function(t,e){return this._inputLines[t][e]},rt.prototype.isIntersection=function(t){for(var e=0;e<this._result;e++)if(this._intPt[e].equals2D(t))return!0;return!1},rt.prototype.getIntersectionAlongSegment=function(t,e){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[t][e]]},rt.prototype.interfaces_=function(){return[]},rt.prototype.getClass=function(){return rt},rt.computeEdgeDistance=function(t,e,r){var n=Math.abs(r.x-e.x),i=Math.abs(r.y-e.y),o=-1;if(t.equals(e))o=0;else if(t.equals(r))o=n>i?n:i;else{var a=Math.abs(t.x-e.x),s=Math.abs(t.y-e.y);0!==(o=n>i?a:s)||t.equals(e)||(o=Math.max(a,s))}return et.isTrue(!(0===o&&!t.equals(e)),"Bad distance calculation"),o},rt.nonRobustComputeEdgeDistance=function(t,e,r){var n=t.x-e.x,i=t.y-e.y,o=Math.sqrt(n*n+i*i);return et.isTrue(!(0===o&&!t.equals(e)),"Invalid distance calculation"),o},nt.DONT_INTERSECT.get=function(){return 0},nt.DO_INTERSECT.get=function(){return 1},nt.COLLINEAR.get=function(){return 2},nt.NO_INTERSECTION.get=function(){return 0},nt.POINT_INTERSECTION.get=function(){return 1},nt.COLLINEAR_INTERSECTION.get=function(){return 2},Object.defineProperties(rt,nt);var it=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isInSegmentEnvelopes=function(t){var e=new X(this._inputLines[0][0],this._inputLines[0][1]),r=new X(this._inputLines[1][0],this._inputLines[1][1]);return e.contains(t)&&r.contains(t)},e.prototype.computeIntersection=function(){if(3!==arguments.length)return t.prototype.computeIntersection.apply(this,arguments);var e=arguments[0],r=arguments[1],n=arguments[2];if(this._isProper=!1,X.intersects(r,n,e)&&0===st.orientationIndex(r,n,e)&&0===st.orientationIndex(n,r,e))return this._isProper=!0,(e.equals(r)||e.equals(n))&&(this._isProper=!1),this._result=t.POINT_INTERSECTION,null;this._result=t.NO_INTERSECTION},e.prototype.normalizeToMinimum=function(t,e,r,n,i){i.x=this.smallestInAbsValue(t.x,e.x,r.x,n.x),i.y=this.smallestInAbsValue(t.y,e.y,r.y,n.y),t.x-=i.x,t.y-=i.y,e.x-=i.x,e.y-=i.y,r.x-=i.x,r.y-=i.y,n.x-=i.x,n.y-=i.y},e.prototype.safeHCoordinateIntersection=function(t,r,n,i){var o=null;try{o=W.intersection(t,r,n,i)}catch(a){if(!(a instanceof U))throw a;o=e.nearestEndpoint(t,r,n,i)}return o},e.prototype.intersection=function(t,r,n,i){var o=this.intersectionWithNormalization(t,r,n,i);return this.isInSegmentEnvelopes(o)||(o=new x(e.nearestEndpoint(t,r,n,i))),null!==this._precisionModel&&this._precisionModel.makePrecise(o),o},e.prototype.smallestInAbsValue=function(t,e,r,n){var i=t,o=Math.abs(i);return Math.abs(e)<o&&(i=e,o=Math.abs(e)),Math.abs(r)<o&&(i=r,o=Math.abs(r)),Math.abs(n)<o&&(i=n),i},e.prototype.checkDD=function(t,e,r,n,i){var o=F.intersection(t,e,r,n),a=this.isInSegmentEnvelopes(o);q.out.println("DD in env = "+a+"  --------------------- "+o),i.distance(o)>1e-4&&q.out.println("Distance = "+i.distance(o))},e.prototype.intersectionWithNormalization=function(t,e,r,n){var i=new x(t),o=new x(e),a=new x(r),s=new x(n),u=new x;this.normalizeToEnvCentre(i,o,a,s,u);var l=this.safeHCoordinateIntersection(i,o,a,s);return l.x+=u.x,l.y+=u.y,l},e.prototype.computeCollinearIntersection=function(e,r,n,i){var o=X.intersects(e,r,n),a=X.intersects(e,r,i),s=X.intersects(n,i,e),u=X.intersects(n,i,r);return o&&a?(this._intPt[0]=n,this._intPt[1]=i,t.COLLINEAR_INTERSECTION):s&&u?(this._intPt[0]=e,this._intPt[1]=r,t.COLLINEAR_INTERSECTION):o&&s?(this._intPt[0]=n,this._intPt[1]=e,!n.equals(e)||a||u?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):o&&u?(this._intPt[0]=n,this._intPt[1]=r,!n.equals(r)||a||s?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):a&&s?(this._intPt[0]=i,this._intPt[1]=e,!i.equals(e)||o||u?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):a&&u?(this._intPt[0]=i,this._intPt[1]=r,!i.equals(r)||o||s?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):t.NO_INTERSECTION},e.prototype.normalizeToEnvCentre=function(t,e,r,n,i){var o=t.x<e.x?t.x:e.x,a=t.y<e.y?t.y:e.y,s=t.x>e.x?t.x:e.x,u=t.y>e.y?t.y:e.y,l=r.x<n.x?r.x:n.x,c=r.y<n.y?r.y:n.y,f=r.x>n.x?r.x:n.x,p=r.y>n.y?r.y:n.y,h=((o>l?o:l)+(s<f?s:f))/2,y=((a>c?a:c)+(u<p?u:p))/2;i.x=h,i.y=y,t.x-=i.x,t.y-=i.y,e.x-=i.x,e.y-=i.y,r.x-=i.x,r.y-=i.y,n.x-=i.x,n.y-=i.y},e.prototype.computeIntersect=function(e,r,n,i){if(this._isProper=!1,!X.intersects(e,r,n,i))return t.NO_INTERSECTION;var o=st.orientationIndex(e,r,n),a=st.orientationIndex(e,r,i);if(o>0&&a>0||o<0&&a<0)return t.NO_INTERSECTION;var s=st.orientationIndex(n,i,e),u=st.orientationIndex(n,i,r);return s>0&&u>0||s<0&&u<0?t.NO_INTERSECTION:0===o&&0===a&&0===s&&0===u?this.computeCollinearIntersection(e,r,n,i):(0===o||0===a||0===s||0===u?(this._isProper=!1,e.equals2D(n)||e.equals2D(i)?this._intPt[0]=e:r.equals2D(n)||r.equals2D(i)?this._intPt[0]=r:0===o?this._intPt[0]=new x(n):0===a?this._intPt[0]=new x(i):0===s?this._intPt[0]=new x(e):0===u&&(this._intPt[0]=new x(r))):(this._isProper=!0,this._intPt[0]=this.intersection(e,r,n,i)),t.POINT_INTERSECTION)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.nearestEndpoint=function(t,e,r,n){var i=t,o=st.distancePointLine(t,r,n),a=st.distancePointLine(e,r,n);return a<o&&(o=a,i=e),(a=st.distancePointLine(r,t,e))<o&&(o=a,i=r),(a=st.distancePointLine(n,t,e))<o&&(o=a,i=n),i},e}(rt),ot=function(){};ot.prototype.interfaces_=function(){return[]},ot.prototype.getClass=function(){return ot},ot.orientationIndex=function(t,e,r){var n=e.x-t.x,i=e.y-t.y,o=r.x-e.x,a=r.y-e.y;return ot.signOfDet2x2(n,i,o,a)},ot.signOfDet2x2=function(t,e,r,n){var i=null,o=null,a=null;if(i=1,0===t||0===n)return 0===e||0===r?0:e>0?r>0?-i:i:r>0?i:-i;if(0===e||0===r)return n>0?t>0?i:-i:t>0?-i:i;if(e>0?n>0?e<=n||(i=-i,o=t,t=r,r=o,o=e,e=n,n=o):e<=-n?(i=-i,r=-r,n=-n):(o=t,t=-r,r=o,o=e,e=-n,n=o):n>0?-e<=n?(i=-i,t=-t,e=-e):(o=-t,t=r,r=o,o=-e,e=n,n=o):e>=n?(t=-t,e=-e,r=-r,n=-n):(i=-i,o=-t,t=-r,r=o,o=-e,e=-n,n=o),t>0){if(!(r>0))return i;if(!(t<=r))return i}else{if(r>0)return-i;if(!(t>=r))return-i;i=-i,t=-t,r=-r}for(;;){if((n-=(a=Math.floor(r/t))*e)<0)return-i;if(n>e)return i;if(t>(r-=a*t)+r){if(e<n+n)return i}else{if(e>n+n)return-i;r=t-r,n=e-n,i=-i}if(0===n)return 0===r?0:-i;if(0===r)return i;if((e-=(a=Math.floor(t/r))*n)<0)return i;if(e>n)return-i;if(r>(t-=a*r)+t){if(n<e+e)return-i}else{if(n>e+e)return i;t=r-t,e=n-e,i=-i}if(0===e)return 0===t?0:i;if(0===t)return-i}};var at=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var t=arguments[0];this._p=t};at.prototype.countSegment=function(t,e){if(t.x<this._p.x&&e.x<this._p.x)return null;if(this._p.x===e.x&&this._p.y===e.y)return this._isPointOnSegment=!0,null;if(t.y===this._p.y&&e.y===this._p.y){var r=t.x,n=e.x;return r>n&&(r=e.x,n=t.x),this._p.x>=r&&this._p.x<=n&&(this._isPointOnSegment=!0),null}if(t.y>this._p.y&&e.y<=this._p.y||e.y>this._p.y&&t.y<=this._p.y){var i=t.x-this._p.x,o=t.y-this._p.y,a=e.x-this._p.x,s=e.y-this._p.y,u=ot.signOfDet2x2(i,o,a,s);if(0===u)return this._isPointOnSegment=!0,null;s<o&&(u=-u),u>0&&this._crossingCount++}},at.prototype.isPointInPolygon=function(){return this.getLocation()!==k.EXTERIOR},at.prototype.getLocation=function(){return this._isPointOnSegment?k.BOUNDARY:this._crossingCount%2==1?k.INTERIOR:k.EXTERIOR},at.prototype.isOnSegment=function(){return this._isPointOnSegment},at.prototype.interfaces_=function(){return[]},at.prototype.getClass=function(){return at},at.locatePointInRing=function(){if(arguments[0]instanceof x&&j(arguments[1],G)){for(var t=arguments[1],e=new at(arguments[0]),r=new x,n=new x,i=1;i<t.size();i++)if(t.getCoordinate(i,r),t.getCoordinate(i-1,n),e.countSegment(r,n),e.isOnSegment())return e.getLocation();return e.getLocation()}if(arguments[0]instanceof x&&arguments[1]instanceof Array){for(var o=arguments[1],a=new at(arguments[0]),s=1;s<o.length;s++){var u=o[s],l=o[s-1];if(a.countSegment(u,l),a.isOnSegment())return a.getLocation()}return a.getLocation()}};var st=function(){},ut={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};st.prototype.interfaces_=function(){return[]},st.prototype.getClass=function(){return st},st.orientationIndex=function(t,e,r){return F.orientationIndex(t,e,r)},st.signedArea=function(){if(arguments[0]instanceof Array){var t=arguments[0];if(t.length<3)return 0;for(var e=0,r=t[0].x,n=1;n<t.length-1;n++){var i=t[n].x-r,o=t[n+1].y;e+=i*(t[n-1].y-o)}return e/2}if(j(arguments[0],G)){var a=arguments[0],s=a.size();if(s<3)return 0;var u=new x,l=new x,c=new x;a.getCoordinate(0,l),a.getCoordinate(1,c);var f=l.x;c.x-=f;for(var p=0,h=1;h<s-1;h++)u.y=l.y,l.x=c.x,l.y=c.y,a.getCoordinate(h+1,c),c.x-=f,p+=l.x*(u.y-c.y);return p/2}},st.distanceLineLine=function(t,e,r,n){if(t.equals(e))return st.distancePointLine(t,r,n);if(r.equals(n))return st.distancePointLine(n,t,e);var i=!1;if(X.intersects(t,e,r,n)){var o=(e.x-t.x)*(n.y-r.y)-(e.y-t.y)*(n.x-r.x);if(0===o)i=!0;else{var a=(t.y-r.y)*(n.x-r.x)-(t.x-r.x)*(n.y-r.y),s=((t.y-r.y)*(e.x-t.x)-(t.x-r.x)*(e.y-t.y))/o,u=a/o;(u<0||u>1||s<0||s>1)&&(i=!0)}}else i=!0;return i?R.min(st.distancePointLine(t,r,n),st.distancePointLine(e,r,n),st.distancePointLine(r,t,e),st.distancePointLine(n,t,e)):0},st.isPointInRing=function(t,e){return st.locatePointInRing(t,e)!==k.EXTERIOR},st.computeLength=function(t){var e=t.size();if(e<=1)return 0;var r=0,n=new x;t.getCoordinate(0,n);for(var i=n.x,o=n.y,a=1;a<e;a++){t.getCoordinate(a,n);var s=n.x,u=n.y,l=s-i,c=u-o;r+=Math.sqrt(l*l+c*c),i=s,o=u}return r},st.isCCW=function(t){var e=t.length-1;if(e<3)throw new v("Ring has fewer than 4 points, so orientation cannot be determined");for(var r=t[0],n=0,i=1;i<=e;i++){var o=t[i];o.y>r.y&&(r=o,n=i)}var a=n;do{(a-=1)<0&&(a=e)}while(t[a].equals2D(r)&&a!==n);var s=n;do{s=(s+1)%e}while(t[s].equals2D(r)&&s!==n);var u=t[a],l=t[s];if(u.equals2D(r)||l.equals2D(r)||u.equals2D(l))return!1;var c=st.computeOrientation(u,r,l);return 0===c?u.x>l.x:c>0},st.locatePointInRing=function(t,e){return at.locatePointInRing(t,e)},st.distancePointLinePerpendicular=function(t,e,r){var n=(r.x-e.x)*(r.x-e.x)+(r.y-e.y)*(r.y-e.y),i=((e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y))/n;return Math.abs(i)*Math.sqrt(n)},st.computeOrientation=function(t,e,r){return st.orientationIndex(t,e,r)},st.distancePointLine=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(0===e.length)throw new v("Line array must contain at least one vertex");for(var r=t.distance(e[0]),n=0;n<e.length-1;n++){var i=st.distancePointLine(t,e[n],e[n+1]);i<r&&(r=i)}return r}if(3===arguments.length){var o=arguments[0],a=arguments[1],s=arguments[2];if(a.x===s.x&&a.y===s.y)return o.distance(a);var u=(s.x-a.x)*(s.x-a.x)+(s.y-a.y)*(s.y-a.y),l=((o.x-a.x)*(s.x-a.x)+(o.y-a.y)*(s.y-a.y))/u;if(l<=0)return o.distance(a);if(l>=1)return o.distance(s);var c=((a.y-o.y)*(s.x-a.x)-(a.x-o.x)*(s.y-a.y))/u;return Math.abs(c)*Math.sqrt(u)}},st.isOnLine=function(t,e){for(var r=new it,n=1;n<e.length;n++){var i=e[n-1],o=e[n];if(r.computeIntersection(t,i,o),r.hasIntersection())return!0}return!1},ut.CLOCKWISE.get=function(){return-1},ut.RIGHT.get=function(){return st.CLOCKWISE},ut.COUNTERCLOCKWISE.get=function(){return 1},ut.LEFT.get=function(){return st.COUNTERCLOCKWISE},ut.COLLINEAR.get=function(){return 0},ut.STRAIGHT.get=function(){return st.COLLINEAR},Object.defineProperties(st,ut);var lt=function(){};lt.prototype.filter=function(t){},lt.prototype.interfaces_=function(){return[]},lt.prototype.getClass=function(){return lt};var ct=function(){var t=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=t,this._SRID=t.getSRID()},ft={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};ct.prototype.isGeometryCollection=function(){return this.getSortIndex()===ct.SORTINDEX_GEOMETRYCOLLECTION},ct.prototype.getFactory=function(){return this._factory},ct.prototype.getGeometryN=function(t){return this},ct.prototype.getArea=function(){return 0},ct.prototype.isRectangle=function(){return!1},ct.prototype.equals=function(){if(arguments[0]instanceof ct){var t=arguments[0];return null!==t&&this.equalsTopo(t)}if(arguments[0]instanceof Object){var e=arguments[0];if(!(e instanceof ct))return!1;var r=e;return this.equalsExact(r)}},ct.prototype.equalsExact=function(t){return this===t||this.equalsExact(t,0)},ct.prototype.geometryChanged=function(){this.apply(ct.geometryChangedFilter)},ct.prototype.geometryChangedAction=function(){this._envelope=null},ct.prototype.equalsNorm=function(t){return null!==t&&this.norm().equalsExact(t.norm())},ct.prototype.getLength=function(){return 0},ct.prototype.getNumGeometries=function(){return 1},ct.prototype.compareTo=function(){if(1===arguments.length){var t=arguments[0],e=t;return this.getSortIndex()!==e.getSortIndex()?this.getSortIndex()-e.getSortIndex():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(t)}if(2===arguments.length){var r=arguments[0],n=arguments[1];return this.getSortIndex()!==r.getSortIndex()?this.getSortIndex()-r.getSortIndex():this.isEmpty()&&r.isEmpty()?0:this.isEmpty()?-1:r.isEmpty()?1:this.compareToSameClass(r,n)}},ct.prototype.getUserData=function(){return this._userData},ct.prototype.getSRID=function(){return this._SRID},ct.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())},ct.prototype.checkNotGeometryCollection=function(t){if(t.getSortIndex()===ct.SORTINDEX_GEOMETRYCOLLECTION)throw new v("This method does not support GeometryCollection arguments")},ct.prototype.equal=function(t,e,r){return 0===r?t.equals(e):t.distance(e)<=r},ct.prototype.norm=function(){var t=this.copy();return t.normalize(),t},ct.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()},ct.prototype.getEnvelopeInternal=function(){return null===this._envelope&&(this._envelope=this.computeEnvelopeInternal()),new X(this._envelope)},ct.prototype.setSRID=function(t){this._SRID=t},ct.prototype.setUserData=function(t){this._userData=t},ct.prototype.compare=function(t,e){for(var r=t.iterator(),n=e.iterator();r.hasNext()&&n.hasNext();){var i=r.next(),o=n.next(),a=i.compareTo(o);if(0!==a)return a}return r.hasNext()?1:n.hasNext()?-1:0},ct.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()},ct.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===ct.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===ct.SORTINDEX_MULTIPOINT||this.getSortIndex()===ct.SORTINDEX_MULTILINESTRING||this.getSortIndex()===ct.SORTINDEX_MULTIPOLYGON},ct.prototype.interfaces_=function(){return[S,w,e]},ct.prototype.getClass=function(){return ct},ct.hasNonEmptyElements=function(t){for(var e=0;e<t.length;e++)if(!t[e].isEmpty())return!0;return!1},ct.hasNullElements=function(t){for(var e=0;e<t.length;e++)if(null===t[e])return!0;return!1},ft.serialVersionUID.get=function(){return 0x799ea46522854c00},ft.SORTINDEX_POINT.get=function(){return 0},ft.SORTINDEX_MULTIPOINT.get=function(){return 1},ft.SORTINDEX_LINESTRING.get=function(){return 2},ft.SORTINDEX_LINEARRING.get=function(){return 3},ft.SORTINDEX_MULTILINESTRING.get=function(){return 4},ft.SORTINDEX_POLYGON.get=function(){return 5},ft.SORTINDEX_MULTIPOLYGON.get=function(){return 6},ft.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7},ft.geometryChangedFilter.get=function(){return pt},Object.defineProperties(ct,ft);var pt=function(){};pt.interfaces_=function(){return[lt]},pt.filter=function(t){t.geometryChangedAction()};var ht=function(){};ht.prototype.filter=function(t){},ht.prototype.interfaces_=function(){return[]},ht.prototype.getClass=function(){return ht};var yt=function(){},dt={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};yt.prototype.isInBoundary=function(t){},yt.prototype.interfaces_=function(){return[]},yt.prototype.getClass=function(){return yt},dt.Mod2BoundaryNodeRule.get=function(){return gt},dt.EndPointBoundaryNodeRule.get=function(){return mt},dt.MultiValentEndPointBoundaryNodeRule.get=function(){return vt},dt.MonoValentEndPointBoundaryNodeRule.get=function(){return _t},dt.MOD2_BOUNDARY_RULE.get=function(){return new gt},dt.ENDPOINT_BOUNDARY_RULE.get=function(){return new mt},dt.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new vt},dt.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new _t},dt.OGC_SFS_BOUNDARY_RULE.get=function(){return yt.MOD2_BOUNDARY_RULE},Object.defineProperties(yt,dt);var gt=function(){};gt.prototype.isInBoundary=function(t){return t%2==1},gt.prototype.interfaces_=function(){return[yt]},gt.prototype.getClass=function(){return gt};var mt=function(){};mt.prototype.isInBoundary=function(t){return t>0},mt.prototype.interfaces_=function(){return[yt]},mt.prototype.getClass=function(){return mt};var vt=function(){};vt.prototype.isInBoundary=function(t){return t>1},vt.prototype.interfaces_=function(){return[yt]},vt.prototype.getClass=function(){return vt};var _t=function(){};_t.prototype.isInBoundary=function(t){return 1===t},_t.prototype.interfaces_=function(){return[yt]},_t.prototype.getClass=function(){return _t};var bt=function(){};bt.prototype.add=function(){},bt.prototype.addAll=function(){},bt.prototype.isEmpty=function(){},bt.prototype.iterator=function(){},bt.prototype.size=function(){},bt.prototype.toArray=function(){},bt.prototype.remove=function(){},(r.prototype=new Error).name="IndexOutOfBoundsException";var wt=function(){};wt.prototype.hasNext=function(){},wt.prototype.next=function(){},wt.prototype.remove=function(){};var St=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(){},e.prototype.set=function(){},e.prototype.isEmpty=function(){},e}(bt);(n.prototype=new Error).name="NoSuchElementException";var Ot=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof bt&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.ensureCapacity=function(){},e.prototype.interfaces_=function(){return[t,bt]},e.prototype.add=function(t){return 1===arguments.length?this.array_.push(t):this.array_.splice(arguments[0],arguments[1]),!0},e.prototype.clear=function(){this.array_=[]},e.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},e.prototype.set=function(t,e){var r=this.array_[t];return this.array_[t]=e,r},e.prototype.iterator=function(){return new xt(this)},e.prototype.get=function(t){if(t<0||t>=this.size())throw new r;return this.array_[t]},e.prototype.isEmpty=function(){return 0===this.array_.length},e.prototype.size=function(){return this.array_.length},e.prototype.toArray=function(){for(var t=[],e=0,r=this.array_.length;e<r;e++)t.push(this.array_[e]);return t},e.prototype.remove=function(t){for(var e=!1,r=0,n=this.array_.length;r<n;r++)if(this.array_[r]===t){this.array_.splice(r,1),e=!0;break}return e},e}(St),xt=function(t){function e(e){t.call(this),this.arrayList_=e,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new n;return this.arrayList_.get(this.position_++)},e.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},e.prototype.set=function(t){return this.arrayList_.set(this.position_-1,t)},e.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},e}(wt),Ct=function(t){function e(){if(t.call(this),0===arguments.length);else if(1===arguments.length){var e=arguments[0];this.ensureCapacity(e.length),this.add(e,!0)}else if(2===arguments.length){var r=arguments[0],n=arguments[1];this.ensureCapacity(r.length),this.add(r,n)}}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={coordArrayType:{configurable:!0}};return r.coordArrayType.get=function(){return new Array(0).fill(null)},e.prototype.getCoordinate=function(t){return this.get(t)},e.prototype.addAll=function(){if(2===arguments.length){for(var e=arguments[1],r=!1,n=arguments[0].iterator();n.hasNext();)this.add(n.next(),e),r=!0;return r}return t.prototype.addAll.apply(this,arguments)},e.prototype.clone=function(){for(var e=t.prototype.clone.call(this),r=0;r<this.size();r++)e.add(r,this.get(r).copy());return e},e.prototype.toCoordinateArray=function(){return this.toArray(e.coordArrayType)},e.prototype.add=function(){if(1===arguments.length){var e=arguments[0];t.prototype.add.call(this,e)}else if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var r=arguments[0],n=arguments[1];return this.add(r,n,!0),!0}if(arguments[0]instanceof x&&"boolean"==typeof arguments[1]){var i=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(i))return null;t.prototype.add.call(this,i)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1]){var o=arguments[0],a=arguments[1];return this.add(o,a),!0}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var s=arguments[0],u=arguments[1];if(arguments[2])for(var l=0;l<s.length;l++)this.add(s[l],u);else for(var c=s.length-1;c>=0;c--)this.add(s[c],u);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof x){var f=arguments[0],p=arguments[1];if(!arguments[2]){var h=this.size();if(h>0){if(f>0&&this.get(f-1).equals2D(p))return null;if(f<h&&this.get(f).equals2D(p))return null}}t.prototype.add.call(this,f,p)}}else if(4===arguments.length){var y=arguments[0],d=arguments[1],g=arguments[2],m=arguments[3],v=1;g>m&&(v=-1);for(var _=g;_!==m;_+=v)this.add(y[_],d);return!0}},e.prototype.closeRing=function(){this.size()>0&&this.add(new x(this.get(0)),!1)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},Object.defineProperties(e,r),e}(Ot),Et=function(){},Pt={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};Pt.ForwardComparator.get=function(){return kt},Pt.BidirectionalComparator.get=function(){return Tt},Pt.coordArrayType.get=function(){return new Array(0).fill(null)},Et.prototype.interfaces_=function(){return[]},Et.prototype.getClass=function(){return Et},Et.isRing=function(t){return!(t.length<4||!t[0].equals2D(t[t.length-1]))},Et.ptNotInList=function(t,e){for(var r=0;r<t.length;r++){var n=t[r];if(Et.indexOf(n,e)<0)return n}return null},Et.scroll=function(t,e){var r=Et.indexOf(e,t);if(r<0)return null;var n=new Array(t.length).fill(null);q.arraycopy(t,r,n,0,t.length-r),q.arraycopy(t,0,n,t.length-r,r),q.arraycopy(n,0,t,0,t.length)},Et.equals=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(t===e)return!0;if(null===t||null===e)return!1;if(t.length!==e.length)return!1;for(var r=0;r<t.length;r++)if(!t[r].equals(e[r]))return!1;return!0}if(3===arguments.length){var n=arguments[0],i=arguments[1],o=arguments[2];if(n===i)return!0;if(null===n||null===i)return!1;if(n.length!==i.length)return!1;for(var a=0;a<n.length;a++)if(0!==o.compare(n[a],i[a]))return!1;return!0}},Et.intersection=function(t,e){for(var r=new Ct,n=0;n<t.length;n++)e.intersects(t[n])&&r.add(t[n],!0);return r.toCoordinateArray()},Et.hasRepeatedPoints=function(t){for(var e=1;e<t.length;e++)if(t[e-1].equals(t[e]))return!0;return!1},Et.removeRepeatedPoints=function(t){return Et.hasRepeatedPoints(t)?new Ct(t,!1).toCoordinateArray():t},Et.reverse=function(t){for(var e=t.length-1,r=Math.trunc(e/2),n=0;n<=r;n++){var i=t[n];t[n]=t[e-n],t[e-n]=i}},Et.removeNull=function(t){for(var e=0,r=0;r<t.length;r++)null!==t[r]&&e++;var n=new Array(e).fill(null);if(0===e)return n;for(var i=0,o=0;o<t.length;o++)null!==t[o]&&(n[i++]=t[o]);return n},Et.copyDeep=function(){if(1===arguments.length){for(var t=arguments[0],e=new Array(t.length).fill(null),r=0;r<t.length;r++)e[r]=new x(t[r]);return e}if(5===arguments.length)for(var n=arguments[0],i=arguments[1],o=arguments[2],a=arguments[3],s=arguments[4],u=0;u<s;u++)o[a+u]=new x(n[i+u])},Et.isEqualReversed=function(t,e){for(var r=0;r<t.length;r++){var n=t[r],i=e[t.length-r-1];if(0!==n.compareTo(i))return!1}return!0},Et.envelope=function(t){for(var e=new X,r=0;r<t.length;r++)e.expandToInclude(t[r]);return e},Et.toCoordinateArray=function(t){return t.toArray(Et.coordArrayType)},Et.atLeastNCoordinatesOrNothing=function(t,e){return e.length>=t?e:[]},Et.indexOf=function(t,e){for(var r=0;r<e.length;r++)if(t.equals(e[r]))return r;return-1},Et.increasingDirection=function(t){for(var e=0;e<Math.trunc(t.length/2);e++){var r=t.length-1-e,n=t[e].compareTo(t[r]);if(0!==n)return n}return 1},Et.compare=function(t,e){for(var r=0;r<t.length&&r<e.length;){var n=t[r].compareTo(e[r]);if(0!==n)return n;r++}return r<e.length?-1:r<t.length?1:0},Et.minCoordinate=function(t){for(var e=null,r=0;r<t.length;r++)(null===e||e.compareTo(t[r])>0)&&(e=t[r]);return e},Et.extract=function(t,e,r){e=R.clamp(e,0,t.length);var n=(r=R.clamp(r,-1,t.length))-e+1;r<0&&(n=0),e>=t.length&&(n=0),r<e&&(n=0);var i=new Array(n).fill(null);if(0===n)return i;for(var o=0,a=e;a<=r;a++)i[o++]=t[a];return i},Object.defineProperties(Et,Pt);var kt=function(){};kt.prototype.compare=function(t,e){return Et.compare(t,e)},kt.prototype.interfaces_=function(){return[O]},kt.prototype.getClass=function(){return kt};var Tt=function(){};Tt.prototype.compare=function(t,e){var r=t,n=e;if(r.length<n.length)return-1;if(r.length>n.length)return 1;if(0===r.length)return 0;var i=Et.compare(r,n);return Et.isEqualReversed(r,n)?0:i},Tt.prototype.OLDcompare=function(t,e){var r=t,n=e;if(r.length<n.length)return-1;if(r.length>n.length)return 1;if(0===r.length)return 0;for(var i=Et.increasingDirection(r),o=Et.increasingDirection(n),a=i>0?0:r.length-1,s=o>0?0:r.length-1,u=0;u<r.length;u++){var l=r[a].compareTo(n[s]);if(0!==l)return l;a+=i,s+=o}return 0},Tt.prototype.interfaces_=function(){return[O]},Tt.prototype.getClass=function(){return Tt};var jt=function(){};jt.prototype.get=function(){},jt.prototype.put=function(){},jt.prototype.size=function(){},jt.prototype.values=function(){},jt.prototype.entrySet=function(){};var Rt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(jt);(i.prototype=new Error).name="OperationNotSupported",(o.prototype=new bt).contains=function(){};var Lt=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof bt&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.contains=function(t){for(var e=0,r=this.array_.length;e<r;e++)if(this.array_[e]===t)return!0;return!1},e.prototype.add=function(t){return!this.contains(t)&&(this.array_.push(t),!0)},e.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},e.prototype.remove=function(t){throw new Error},e.prototype.size=function(){return this.array_.length},e.prototype.isEmpty=function(){return 0===this.array_.length},e.prototype.toArray=function(){for(var t=[],e=0,r=this.array_.length;e<r;e++)t.push(this.array_[e]);return t},e.prototype.iterator=function(){return new It(this)},e}(o),It=function(t){function e(e){t.call(this),this.hashSet_=e,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new n;return this.hashSet_.array_[this.position_++]},e.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},e.prototype.remove=function(){throw new i},e}(wt),Mt=0;(f.prototype=new Rt).get=function(t){for(var e=this.root_;null!==e;){var r=t.compareTo(e.key);if(r<0)e=e.left;else{if(!(r>0))return e.value;e=e.right}}return null},f.prototype.put=function(t,e){if(null===this.root_)return this.root_={key:t,value:e,left:null,right:null,parent:null,color:Mt,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var r,n,i=this.root_;do{if(r=i,(n=t.compareTo(i.key))<0)i=i.left;else{if(!(n>0)){var o=i.value;return i.value=e,o}i=i.right}}while(null!==i);var a={key:t,left:null,right:null,value:e,parent:r,color:Mt,getValue:function(){return this.value},getKey:function(){return this.key}};return n<0?r.left=a:r.right=a,this.fixAfterInsertion(a),this.size_++,null},f.prototype.fixAfterInsertion=function(t){for(t.color=1;null!=t&&t!==this.root_&&1===t.parent.color;)if(s(t)===l(s(s(t)))){var e=c(s(s(t)));1===a(e)?(u(s(t),Mt),u(e,Mt),u(s(s(t)),1),t=s(s(t))):(t===c(s(t))&&(t=s(t),this.rotateLeft(t)),u(s(t),Mt),u(s(s(t)),1),this.rotateRight(s(s(t))))}else{var r=l(s(s(t)));1===a(r)?(u(s(t),Mt),u(r,Mt),u(s(s(t)),1),t=s(s(t))):(t===l(s(t))&&(t=s(t),this.rotateRight(t)),u(s(t),Mt),u(s(s(t)),1),this.rotateLeft(s(s(t))))}this.root_.color=Mt},f.prototype.values=function(){var t=new Ot,e=this.getFirstEntry();if(null!==e)for(t.add(e.value);null!==(e=f.successor(e));)t.add(e.value);return t},f.prototype.entrySet=function(){var t=new Lt,e=this.getFirstEntry();if(null!==e)for(t.add(e);null!==(e=f.successor(e));)t.add(e);return t},f.prototype.rotateLeft=function(t){if(null!=t){var e=t.right;t.right=e.left,null!=e.left&&(e.left.parent=t),e.parent=t.parent,null===t.parent?this.root_=e:t.parent.left===t?t.parent.left=e:t.parent.right=e,e.left=t,t.parent=e}},f.prototype.rotateRight=function(t){if(null!=t){var e=t.left;t.left=e.right,null!=e.right&&(e.right.parent=t),e.parent=t.parent,null===t.parent?this.root_=e:t.parent.right===t?t.parent.right=e:t.parent.left=e,e.right=t,t.parent=e}},f.prototype.getFirstEntry=function(){var t=this.root_;if(null!=t)for(;null!=t.left;)t=t.left;return t},f.successor=function(t){if(null===t)return null;if(null!==t.right){for(var e=t.right;null!==e.left;)e=e.left;return e}for(var r=t.parent,n=t;null!==r&&n===r.right;)n=r,r=r.parent;return r},f.prototype.size=function(){return this.size_};var At=function(){};At.prototype.interfaces_=function(){return[]},At.prototype.getClass=function(){return At},p.prototype=new o,(h.prototype=new p).contains=function(t){for(var e=0,r=this.array_.length;e<r;e++)if(0===this.array_[e].compareTo(t))return!0;return!1},h.prototype.add=function(t){if(this.contains(t))return!1;for(var e=0,r=this.array_.length;e<r;e++)if(1===this.array_[e].compareTo(t))return this.array_.splice(e,0,t),!0;return this.array_.push(t),!0},h.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},h.prototype.remove=function(t){throw new i},h.prototype.size=function(){return this.array_.length},h.prototype.isEmpty=function(){return 0===this.array_.length},h.prototype.toArray=function(){for(var t=[],e=0,r=this.array_.length;e<r;e++)t.push(this.array_[e]);return t},h.prototype.iterator=function(){return new Dt(this)};var Dt=function(t){this.treeSet_=t,this.position_=0};Dt.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new n;return this.treeSet_.array_[this.position_++]},Dt.prototype.hasNext=function(){return this.position_<this.treeSet_.size()},Dt.prototype.remove=function(){throw new i};var Nt=function(){};Nt.sort=function(){var t,e,r,n,i=arguments[0];if(1===arguments.length)n=function(t,e){return t.compareTo(e)},i.sort(n);else if(2===arguments.length)r=arguments[1],n=function(t,e){return r.compare(t,e)},i.sort(n);else if(3===arguments.length){(e=i.slice(arguments[1],arguments[2])).sort();var o=i.slice(0,arguments[1]).concat(e,i.slice(arguments[2],i.length));for(i.splice(0,i.length),t=0;t<o.length;t++)i.push(o[t])}else if(4===arguments.length)for(e=i.slice(arguments[1],arguments[2]),r=arguments[3],n=function(t,e){return r.compare(t,e)},e.sort(n),o=i.slice(0,arguments[1]).concat(e,i.slice(arguments[2],i.length)),i.splice(0,i.length),t=0;t<o.length;t++)i.push(o[t])},Nt.asList=function(t){for(var e=new Ot,r=0,n=t.length;r<n;r++)e.add(t[r]);return e};var Ft=function(){},zt={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};zt.P.get=function(){return 0},zt.L.get=function(){return 1},zt.A.get=function(){return 2},zt.FALSE.get=function(){return-1},zt.TRUE.get=function(){return-2},zt.DONTCARE.get=function(){return-3},zt.SYM_FALSE.get=function(){return"F"},zt.SYM_TRUE.get=function(){return"T"},zt.SYM_DONTCARE.get=function(){return"*"},zt.SYM_P.get=function(){return"0"},zt.SYM_L.get=function(){return"1"},zt.SYM_A.get=function(){return"2"},Ft.prototype.interfaces_=function(){return[]},Ft.prototype.getClass=function(){return Ft},Ft.toDimensionSymbol=function(t){switch(t){case Ft.FALSE:return Ft.SYM_FALSE;case Ft.TRUE:return Ft.SYM_TRUE;case Ft.DONTCARE:return Ft.SYM_DONTCARE;case Ft.P:return Ft.SYM_P;case Ft.L:return Ft.SYM_L;case Ft.A:return Ft.SYM_A}throw new v("Unknown dimension value: "+t)},Ft.toDimensionValue=function(t){switch(A.toUpperCase(t)){case Ft.SYM_FALSE:return Ft.FALSE;case Ft.SYM_TRUE:return Ft.TRUE;case Ft.SYM_DONTCARE:return Ft.DONTCARE;case Ft.SYM_P:return Ft.P;case Ft.SYM_L:return Ft.L;case Ft.SYM_A:return Ft.A}throw new v("Unknown dimension symbol: "+t)},Object.defineProperties(Ft,zt);var Gt=function(){};Gt.prototype.filter=function(t){},Gt.prototype.interfaces_=function(){return[]},Gt.prototype.getClass=function(){return Gt};var Bt=function(){};Bt.prototype.filter=function(t,e){},Bt.prototype.isDone=function(){},Bt.prototype.isGeometryChanged=function(){},Bt.prototype.interfaces_=function(){return[]},Bt.prototype.getClass=function(){return Bt};var Vt=function(t){function e(e,r){if(t.call(this,r),this._geometries=e||[],t.hasNullElements(this._geometries))throw new v("geometries must not contain null elements")}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){for(var t=new X,e=0;e<this._geometries.length;e++)t.expandToInclude(this._geometries[e].getEnvelopeInternal());return t},e.prototype.getGeometryN=function(t){return this._geometries[t]},e.prototype.getSortIndex=function(){return t.SORTINDEX_GEOMETRYCOLLECTION},e.prototype.getCoordinates=function(){for(var t=new Array(this.getNumPoints()).fill(null),e=-1,r=0;r<this._geometries.length;r++)for(var n=this._geometries[r].getCoordinates(),i=0;i<n.length;i++)t[++e]=n[i];return t},e.prototype.getArea=function(){for(var t=0,e=0;e<this._geometries.length;e++)t+=this._geometries[e].getArea();return t},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],r=arguments[1];if(!this.isEquivalentClass(e))return!1;var n=e;if(this._geometries.length!==n._geometries.length)return!1;for(var i=0;i<this._geometries.length;i++)if(!this._geometries[i].equalsExact(n._geometries[i],r))return!1;return!0}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var t=0;t<this._geometries.length;t++)this._geometries[t].normalize();Nt.sort(this._geometries)},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},e.prototype.getBoundaryDimension=function(){for(var t=Ft.FALSE,e=0;e<this._geometries.length;e++)t=Math.max(t,this._geometries[e].getBoundaryDimension());return t},e.prototype.getDimension=function(){for(var t=Ft.FALSE,e=0;e<this._geometries.length;e++)t=Math.max(t,this._geometries[e].getDimension());return t},e.prototype.getLength=function(){for(var t=0,e=0;e<this._geometries.length;e++)t+=this._geometries[e].getLength();return t},e.prototype.getNumPoints=function(){for(var t=0,e=0;e<this._geometries.length;e++)t+=this._geometries[e].getNumPoints();return t},e.prototype.getNumGeometries=function(){return this._geometries.length},e.prototype.reverse=function(){for(var t=this._geometries.length,e=new Array(t).fill(null),r=0;r<this._geometries.length;r++)e[r]=this._geometries[r].reverse();return this.getFactory().createGeometryCollection(e)},e.prototype.compareToSameClass=function(){if(1===arguments.length){var t=arguments[0],e=new h(Nt.asList(this._geometries)),r=new h(Nt.asList(t._geometries));return this.compare(e,r)}if(2===arguments.length){for(var n=arguments[1],i=arguments[0],o=this.getNumGeometries(),a=i.getNumGeometries(),s=0;s<o&&s<a;){var u=this.getGeometryN(s),l=i.getGeometryN(s),c=u.compareToSameClass(l,n);if(0!==c)return c;s++}return s<o?1:s<a?-1:0}},e.prototype.apply=function(){if(j(arguments[0],ht))for(var t=arguments[0],e=0;e<this._geometries.length;e++)this._geometries[e].apply(t);else if(j(arguments[0],Bt)){var r=arguments[0];if(0===this._geometries.length)return null;for(var n=0;n<this._geometries.length&&(this._geometries[n].apply(r),!r.isDone());n++);r.isGeometryChanged()&&this.geometryChanged()}else if(j(arguments[0],Gt)){var i=arguments[0];i.filter(this);for(var o=0;o<this._geometries.length;o++)this._geometries[o].apply(i)}else if(j(arguments[0],lt)){var a=arguments[0];a.filter(this);for(var s=0;s<this._geometries.length;s++)this._geometries[s].apply(a)}},e.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),et.shouldNeverReachHere(),null},e.prototype.clone=function(){var e=t.prototype.clone.call(this);e._geometries=new Array(this._geometries.length).fill(null);for(var r=0;r<this._geometries.length;r++)e._geometries[r]=this._geometries[r].clone();return e},e.prototype.getGeometryType=function(){return"GeometryCollection"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),r=0;r<t.length;r++)t[r]=this._geometries[r].copy();return new e(t,this._factory)},e.prototype.isEmpty=function(){for(var t=0;t<this._geometries.length;t++)if(!this._geometries[t].isEmpty())return!1;return!0},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},r.serialVersionUID.get=function(){return-0x4f07bcb1f857d800},Object.defineProperties(e,r),e}(ct),Ut=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return ct.SORTINDEX_MULTILINESTRING},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],r=arguments[1];return!!this.isEquivalentClass(e)&&t.prototype.equalsExact.call(this,e,r)}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?Ft.FALSE:0},e.prototype.isClosed=function(){if(this.isEmpty())return!1;for(var t=0;t<this._geometries.length;t++)if(!this._geometries[t].isClosed())return!1;return!0},e.prototype.getDimension=function(){return 1},e.prototype.reverse=function(){for(var t=this._geometries.length,e=new Array(t).fill(null),r=0;r<this._geometries.length;r++)e[t-1-r]=this._geometries[r].reverse();return this.getFactory().createMultiLineString(e)},e.prototype.getBoundary=function(){return new qt(this).getBoundary()},e.prototype.getGeometryType=function(){return"MultiLineString"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),r=0;r<t.length;r++)t[r]=this._geometries[r].copy();return new e(t,this._factory)},e.prototype.interfaces_=function(){return[At]},e.prototype.getClass=function(){return e},r.serialVersionUID.get=function(){return 0x7155d2ab4afa8000},Object.defineProperties(e,r),e}(Vt),qt=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,1===arguments.length){var t=arguments[0],e=yt.MOD2_BOUNDARY_RULE;this._geom=t,this._geomFact=t.getFactory(),this._bnRule=e}else if(2===arguments.length){var r=arguments[0],n=arguments[1];this._geom=r,this._geomFact=r.getFactory(),this._bnRule=n}};qt.prototype.boundaryMultiLineString=function(t){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var e=this.computeBoundaryCoordinates(t);return 1===e.length?this._geomFact.createPoint(e[0]):this._geomFact.createMultiPointFromCoords(e)},qt.prototype.getBoundary=function(){return this._geom instanceof Yt?this.boundaryLineString(this._geom):this._geom instanceof Ut?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()},qt.prototype.boundaryLineString=function(t){return this._geom.isEmpty()?this.getEmptyMultiPoint():t.isClosed()?this._bnRule.isInBoundary(2)?t.getStartPoint():this._geomFact.createMultiPoint():this._geomFact.createMultiPoint([t.getStartPoint(),t.getEndPoint()])},qt.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()},qt.prototype.computeBoundaryCoordinates=function(t){var e=new Ot;this._endpointMap=new f;for(var r=0;r<t.getNumGeometries();r++){var n=t.getGeometryN(r);0!==n.getNumPoints()&&(this.addEndpoint(n.getCoordinateN(0)),this.addEndpoint(n.getCoordinateN(n.getNumPoints()-1)))}for(var i=this._endpointMap.entrySet().iterator();i.hasNext();){var o=i.next(),a=o.getValue().count;this._bnRule.isInBoundary(a)&&e.add(o.getKey())}return Et.toCoordinateArray(e)},qt.prototype.addEndpoint=function(t){var e=this._endpointMap.get(t);null===e&&(e=new Wt,this._endpointMap.put(t,e)),e.count++},qt.prototype.interfaces_=function(){return[]},qt.prototype.getClass=function(){return qt},qt.getBoundary=function(){return 1===arguments.length?new qt(arguments[0]).getBoundary():2===arguments.length?new qt(arguments[0],arguments[1]).getBoundary():void 0};var Wt=function(){this.count=null};Wt.prototype.interfaces_=function(){return[]},Wt.prototype.getClass=function(){return Wt};var Xt=function(){},Zt={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};Xt.prototype.interfaces_=function(){return[]},Xt.prototype.getClass=function(){return Xt},Xt.chars=function(t,e){for(var r=new Array(e).fill(null),n=0;n<e;n++)r[n]=t;return String(r)},Xt.getStackTrace=function(){if(1===arguments.length){var t=arguments[0],e=new function(){},r=new function(){}(e);return t.printStackTrace(r),e.toString()}if(2===arguments.length){for(var n=arguments[1],i="",o=new function(){}(new function(){}(Xt.getStackTrace(arguments[0]))),a=0;a<n;a++)try{i+=o.readLine()+Xt.NEWLINE}catch(t){if(!(t instanceof y))throw t;et.shouldNeverReachHere()}return i}},Xt.split=function(t,e){for(var r=e.length,n=new Ot,i=""+t,o=i.indexOf(e);o>=0;){var a=i.substring(0,o);n.add(a),o=(i=i.substring(o+r)).indexOf(e)}i.length>0&&n.add(i);for(var s=new Array(n.size()).fill(null),u=0;u<s.length;u++)s[u]=n.get(u);return s},Xt.toString=function(){if(1===arguments.length){var t=arguments[0];return Xt.SIMPLE_ORDINATE_FORMAT.format(t)}},Xt.spaces=function(t){return Xt.chars(" ",t)},Zt.NEWLINE.get=function(){return q.getProperty("line.separator")},Zt.SIMPLE_ORDINATE_FORMAT.get=function(){return new function(){}("0.#")},Object.defineProperties(Xt,Zt);var Ht=function(){};Ht.prototype.interfaces_=function(){return[]},Ht.prototype.getClass=function(){return Ht},Ht.copyCoord=function(t,e,r,n){for(var i=Math.min(t.getDimension(),r.getDimension()),o=0;o<i;o++)r.setOrdinate(n,o,t.getOrdinate(e,o))},Ht.isRing=function(t){var e=t.size();return 0===e||!(e<=3)&&t.getOrdinate(0,G.X)===t.getOrdinate(e-1,G.X)&&t.getOrdinate(0,G.Y)===t.getOrdinate(e-1,G.Y)},Ht.isEqual=function(t,e){var r=t.size();if(r!==e.size())return!1;for(var n=Math.min(t.getDimension(),e.getDimension()),i=0;i<r;i++)for(var o=0;o<n;o++){var a=t.getOrdinate(i,o),s=e.getOrdinate(i,o);if(!(t.getOrdinate(i,o)===e.getOrdinate(i,o)||_.isNaN(a)&&_.isNaN(s)))return!1}return!0},Ht.extend=function(t,e,r){var n=t.create(r,e.getDimension()),i=e.size();if(Ht.copy(e,0,n,0,i),i>0)for(var o=i;o<r;o++)Ht.copy(e,i-1,n,o,1);return n},Ht.reverse=function(t){for(var e=t.size()-1,r=Math.trunc(e/2),n=0;n<=r;n++)Ht.swap(t,n,e-n)},Ht.swap=function(t,e,r){if(e===r)return null;for(var n=0;n<t.getDimension();n++){var i=t.getOrdinate(e,n);t.setOrdinate(e,n,t.getOrdinate(r,n)),t.setOrdinate(r,n,i)}},Ht.copy=function(t,e,r,n,i){for(var o=0;o<i;o++)Ht.copyCoord(t,e+o,r,n+o)},Ht.toString=function(){if(1===arguments.length){var t=arguments[0],e=t.size();if(0===e)return"()";var r=t.getDimension(),n=new I;n.append("(");for(var i=0;i<e;i++){i>0&&n.append(" ");for(var o=0;o<r;o++)o>0&&n.append(","),n.append(Xt.toString(t.getOrdinate(i,o)))}return n.append(")"),n.toString()}},Ht.ensureValidRing=function(t,e){var r=e.size();return 0===r?e:r<=3?Ht.createClosedRing(t,e,4):e.getOrdinate(0,G.X)===e.getOrdinate(r-1,G.X)&&e.getOrdinate(0,G.Y)===e.getOrdinate(r-1,G.Y)?e:Ht.createClosedRing(t,e,r+1)},Ht.createClosedRing=function(t,e,r){var n=t.create(r,e.getDimension()),i=e.size();Ht.copy(e,0,n,0,i);for(var o=i;o<r;o++)Ht.copy(e,0,n,o,1);return n};var Yt=function(t){function e(e,r){t.call(this,r),this._points=null,this.init(e)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new X:this._points.expandEnvelope(new X)},e.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},e.prototype.getSortIndex=function(){return t.SORTINDEX_LINESTRING},e.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],r=arguments[1];if(!this.isEquivalentClass(e))return!1;var n=e;if(this._points.size()!==n._points.size())return!1;for(var i=0;i<this._points.size();i++)if(!this.equal(this._points.getCoordinate(i),n._points.getCoordinate(i),r))return!1;return!0}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var t=0;t<Math.trunc(this._points.size()/2);t++){var e=this._points.size()-1-t;if(!this._points.getCoordinate(t).equals(this._points.getCoordinate(e)))return this._points.getCoordinate(t).compareTo(this._points.getCoordinate(e))>0&&Ht.reverse(this._points),null}},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?Ft.FALSE:0},e.prototype.isClosed=function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},e.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},e.prototype.getDimension=function(){return 1},e.prototype.getLength=function(){return st.computeLength(this._points)},e.prototype.getNumPoints=function(){return this._points.size()},e.prototype.reverse=function(){var t=this._points.copy();return Ht.reverse(t),this.getFactory().createLineString(t)},e.prototype.compareToSameClass=function(){if(1===arguments.length){for(var t=arguments[0],e=0,r=0;e<this._points.size()&&r<t._points.size();){var n=this._points.getCoordinate(e).compareTo(t._points.getCoordinate(r));if(0!==n)return n;e++,r++}return e<this._points.size()?1:r<t._points.size()?-1:0}if(2===arguments.length){var i=arguments[0];return arguments[1].compare(this._points,i._points)}},e.prototype.apply=function(){if(j(arguments[0],ht))for(var t=arguments[0],e=0;e<this._points.size();e++)t.filter(this._points.getCoordinate(e));else if(j(arguments[0],Bt)){var r=arguments[0];if(0===this._points.size())return null;for(var n=0;n<this._points.size()&&(r.filter(this._points,n),!r.isDone());n++);r.isGeometryChanged()&&this.geometryChanged()}else(j(arguments[0],Gt)||j(arguments[0],lt))&&arguments[0].filter(this)},e.prototype.getBoundary=function(){return new qt(this).getBoundary()},e.prototype.isEquivalentClass=function(t){return t instanceof e},e.prototype.clone=function(){var e=t.prototype.clone.call(this);return e._points=this._points.clone(),e},e.prototype.getCoordinateN=function(t){return this._points.getCoordinate(t)},e.prototype.getGeometryType=function(){return"LineString"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._points},e.prototype.isEmpty=function(){return 0===this._points.size()},e.prototype.init=function(t){if(null===t&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),1===t.size())throw new v("Invalid number of points in LineString (found "+t.size()+" - must be 0 or >= 2)");this._points=t},e.prototype.isCoordinate=function(t){for(var e=0;e<this._points.size();e++)if(this._points.getCoordinate(e).equals(t))return!0;return!1},e.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},e.prototype.getPointN=function(t){return this.getFactory().createPoint(this._points.getCoordinate(t))},e.prototype.interfaces_=function(){return[At]},e.prototype.getClass=function(){return e},r.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(e,r),e}(ct),Kt=function(){};Kt.prototype.interfaces_=function(){return[]},Kt.prototype.getClass=function(){return Kt};var Jt=function(t){function e(e,r){t.call(this,r),this._coordinates=e||null,this.init(this._coordinates)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new X;var t=new X;return t.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),t},e.prototype.getSortIndex=function(){return t.SORTINDEX_POINT},e.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],r=arguments[1];return!!this.isEquivalentClass(e)&&(!(!this.isEmpty()||!e.isEmpty())||this.isEmpty()===e.isEmpty()&&this.equal(e.getCoordinate(),this.getCoordinate(),r))}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){},e.prototype.getCoordinate=function(){return 0!==this._coordinates.size()?this._coordinates.getCoordinate(0):null},e.prototype.getBoundaryDimension=function(){return Ft.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getNumPoints=function(){return this.isEmpty()?0:1},e.prototype.reverse=function(){return this.copy()},e.prototype.getX=function(){if(null===this.getCoordinate())throw new Error("getX called on empty Point");return this.getCoordinate().x},e.prototype.compareToSameClass=function(){if(1===arguments.length){var t=arguments[0];return this.getCoordinate().compareTo(t.getCoordinate())}if(2===arguments.length){var e=arguments[0];return arguments[1].compare(this._coordinates,e._coordinates)}},e.prototype.apply=function(){if(j(arguments[0],ht)){var t=arguments[0];if(this.isEmpty())return null;t.filter(this.getCoordinate())}else if(j(arguments[0],Bt)){var e=arguments[0];if(this.isEmpty())return null;e.filter(this._coordinates,0),e.isGeometryChanged()&&this.geometryChanged()}else(j(arguments[0],Gt)||j(arguments[0],lt))&&arguments[0].filter(this)},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.clone=function(){var e=t.prototype.clone.call(this);return e._coordinates=this._coordinates.clone(),e},e.prototype.getGeometryType=function(){return"Point"},e.prototype.copy=function(){return new e(this._coordinates.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._coordinates},e.prototype.getY=function(){if(null===this.getCoordinate())throw new Error("getY called on empty Point");return this.getCoordinate().y},e.prototype.isEmpty=function(){return 0===this._coordinates.size()},e.prototype.init=function(t){null===t&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),et.isTrue(t.size()<=1),this._coordinates=t},e.prototype.isSimple=function(){return!0},e.prototype.interfaces_=function(){return[Kt]},e.prototype.getClass=function(){return e},r.serialVersionUID.get=function(){return 0x44077bad161cbc00},Object.defineProperties(e,r),e}(ct),$t=function(){};$t.prototype.interfaces_=function(){return[]},$t.prototype.getClass=function(){return $t};var Qt=function(t){function e(e,r,n){if(t.call(this,n),this._shell=null,this._holes=null,null===e&&(e=this.getFactory().createLinearRing()),null===r&&(r=[]),t.hasNullElements(r))throw new v("holes must not contain null elements");if(e.isEmpty()&&t.hasNonEmptyElements(r))throw new v("shell is empty but holes are not");this._shell=e,this._holes=r}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},e.prototype.getSortIndex=function(){return t.SORTINDEX_POLYGON},e.prototype.getCoordinates=function(){if(this.isEmpty())return[];for(var t=new Array(this.getNumPoints()).fill(null),e=-1,r=this._shell.getCoordinates(),n=0;n<r.length;n++)t[++e]=r[n];for(var i=0;i<this._holes.length;i++)for(var o=this._holes[i].getCoordinates(),a=0;a<o.length;a++)t[++e]=o[a];return t},e.prototype.getArea=function(){var t=0;t+=Math.abs(st.signedArea(this._shell.getCoordinateSequence()));for(var e=0;e<this._holes.length;e++)t-=Math.abs(st.signedArea(this._holes[e].getCoordinateSequence()));return t},e.prototype.isRectangle=function(){if(0!==this.getNumInteriorRing())return!1;if(null===this._shell)return!1;if(5!==this._shell.getNumPoints())return!1;for(var t=this._shell.getCoordinateSequence(),e=this.getEnvelopeInternal(),r=0;r<5;r++){var n=t.getX(r);if(n!==e.getMinX()&&n!==e.getMaxX())return!1;var i=t.getY(r);if(i!==e.getMinY()&&i!==e.getMaxY())return!1}for(var o=t.getX(0),a=t.getY(0),s=1;s<=4;s++){var u=t.getX(s),l=t.getY(s);if(u!==o==(l!==a))return!1;o=u,a=l}return!0},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],r=arguments[1];if(!this.isEquivalentClass(e))return!1;var n=e,i=this._shell,o=n._shell;if(!i.equalsExact(o,r))return!1;if(this._holes.length!==n._holes.length)return!1;for(var a=0;a<this._holes.length;a++)if(!this._holes[a].equalsExact(n._holes[a],r))return!1;return!0}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){if(0===arguments.length){this.normalize(this._shell,!0);for(var t=0;t<this._holes.length;t++)this.normalize(this._holes[t],!1);Nt.sort(this._holes)}else if(2===arguments.length){var e=arguments[0],r=arguments[1];if(e.isEmpty())return null;var n=new Array(e.getCoordinates().length-1).fill(null);q.arraycopy(e.getCoordinates(),0,n,0,n.length);var i=Et.minCoordinate(e.getCoordinates());Et.scroll(n,i),q.arraycopy(n,0,e.getCoordinates(),0,n.length),e.getCoordinates()[n.length]=n[0],st.isCCW(e.getCoordinates())===r&&Et.reverse(e.getCoordinates())}},e.prototype.getCoordinate=function(){return this._shell.getCoordinate()},e.prototype.getNumInteriorRing=function(){return this._holes.length},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.getLength=function(){var t=0;t+=this._shell.getLength();for(var e=0;e<this._holes.length;e++)t+=this._holes[e].getLength();return t},e.prototype.getNumPoints=function(){for(var t=this._shell.getNumPoints(),e=0;e<this._holes.length;e++)t+=this._holes[e].getNumPoints();return t},e.prototype.reverse=function(){var t=this.copy();t._shell=this._shell.copy().reverse(),t._holes=new Array(this._holes.length).fill(null);for(var e=0;e<this._holes.length;e++)t._holes[e]=this._holes[e].copy().reverse();return t},e.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},e.prototype.compareToSameClass=function(){if(1===arguments.length){var t=arguments[0],e=this._shell,r=t._shell;return e.compareToSameClass(r)}if(2===arguments.length){var n=arguments[1],i=arguments[0],o=this._shell,a=i._shell,s=o.compareToSameClass(a,n);if(0!==s)return s;for(var u=this.getNumInteriorRing(),l=i.getNumInteriorRing(),c=0;c<u&&c<l;){var f=this.getInteriorRingN(c),p=i.getInteriorRingN(c),h=f.compareToSameClass(p,n);if(0!==h)return h;c++}return c<u?1:c<l?-1:0}},e.prototype.apply=function(t){if(j(t,ht)){this._shell.apply(t);for(var e=0;e<this._holes.length;e++)this._holes[e].apply(t)}else if(j(t,Bt)){if(this._shell.apply(t),!t.isDone())for(var r=0;r<this._holes.length&&(this._holes[r].apply(t),!t.isDone());r++);t.isGeometryChanged()&&this.geometryChanged()}else if(j(t,Gt))t.filter(this);else if(j(t,lt)){t.filter(this),this._shell.apply(t);for(var n=0;n<this._holes.length;n++)this._holes[n].apply(t)}},e.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var t=new Array(this._holes.length+1).fill(null);t[0]=this._shell;for(var e=0;e<this._holes.length;e++)t[e+1]=this._holes[e];return t.length<=1?this.getFactory().createLinearRing(t[0].getCoordinateSequence()):this.getFactory().createMultiLineString(t)},e.prototype.clone=function(){var e=t.prototype.clone.call(this);e._shell=this._shell.clone(),e._holes=new Array(this._holes.length).fill(null);for(var r=0;r<this._holes.length;r++)e._holes[r]=this._holes[r].clone();return e},e.prototype.getGeometryType=function(){return"Polygon"},e.prototype.copy=function(){for(var t=this._shell.copy(),r=new Array(this._holes.length).fill(null),n=0;n<r.length;n++)r[n]=this._holes[n].copy();return new e(t,r,this._factory)},e.prototype.getExteriorRing=function(){return this._shell},e.prototype.isEmpty=function(){return this._shell.isEmpty()},e.prototype.getInteriorRingN=function(t){return this._holes[t]},e.prototype.interfaces_=function(){return[$t]},e.prototype.getClass=function(){return e},r.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(e,r),e}(ct),te=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return ct.SORTINDEX_MULTIPOINT},e.prototype.isValid=function(){return!0},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],r=arguments[1];return!!this.isEquivalentClass(e)&&t.prototype.equalsExact.call(this,e,r)}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getCoordinate=function(){if(1===arguments.length){var e=arguments[0];return this._geometries[e].getCoordinate()}return t.prototype.getCoordinate.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return Ft.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.getGeometryType=function(){return"MultiPoint"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),r=0;r<t.length;r++)t[r]=this._geometries[r].copy();return new e(t,this._factory)},e.prototype.interfaces_=function(){return[Kt]},e.prototype.getClass=function(){return e},r.serialVersionUID.get=function(){return-0x6fb1ed4162e0fc00},Object.defineProperties(e,r),e}(Vt),ee=function(t){function e(e,r){e instanceof x&&r instanceof me&&(e=r.getCoordinateSequenceFactory().create(e)),t.call(this,e,r),this.validateConstruction()}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return ct.SORTINDEX_LINEARRING},e.prototype.getBoundaryDimension=function(){return Ft.FALSE},e.prototype.isClosed=function(){return!!this.isEmpty()||t.prototype.isClosed.call(this)},e.prototype.reverse=function(){var t=this._points.copy();return Ht.reverse(t),this.getFactory().createLinearRing(t)},e.prototype.validateConstruction=function(){if(!this.isEmpty()&&!t.prototype.isClosed.call(this))throw new v("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<e.MINIMUM_VALID_SIZE)throw new v("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},e.prototype.getGeometryType=function(){return"LinearRing"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},r.MINIMUM_VALID_SIZE.get=function(){return 4},r.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(e,r),e}(Yt),re=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return ct.SORTINDEX_MULTIPOLYGON},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],r=arguments[1];return!!this.isEquivalentClass(e)&&t.prototype.equalsExact.call(this,e,r)}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.reverse=function(){for(var t=this._geometries.length,e=new Array(t).fill(null),r=0;r<this._geometries.length;r++)e[r]=this._geometries[r].reverse();return this.getFactory().createMultiPolygon(e)},e.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var t=new Ot,e=0;e<this._geometries.length;e++)for(var r=this._geometries[e].getBoundary(),n=0;n<r.getNumGeometries();n++)t.add(r.getGeometryN(n));var i=new Array(t.size()).fill(null);return this.getFactory().createMultiLineString(t.toArray(i))},e.prototype.getGeometryType=function(){return"MultiPolygon"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),r=0;r<t.length;r++)t[r]=this._geometries[r].copy();return new e(t,this._factory)},e.prototype.interfaces_=function(){return[$t]},e.prototype.getClass=function(){return e},r.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(e,r),e}(Vt),ne=function(t){this._factory=t||null,this._isUserDataCopied=!1},ie={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};ne.prototype.setCopyUserData=function(t){this._isUserDataCopied=t},ne.prototype.edit=function(t,e){if(null===t)return null;var r=this.editInternal(t,e);return this._isUserDataCopied&&r.setUserData(t.getUserData()),r},ne.prototype.editInternal=function(t,e){return null===this._factory&&(this._factory=t.getFactory()),t instanceof Vt?this.editGeometryCollection(t,e):t instanceof Qt?this.editPolygon(t,e):t instanceof Jt||t instanceof Yt?e.edit(t,this._factory):(et.shouldNeverReachHere("Unsupported Geometry class: "+t.getClass().getName()),null)},ne.prototype.editGeometryCollection=function(t,e){for(var r=e.edit(t,this._factory),n=new Ot,i=0;i<r.getNumGeometries();i++){var o=this.edit(r.getGeometryN(i),e);null===o||o.isEmpty()||n.add(o)}return r.getClass()===te?this._factory.createMultiPoint(n.toArray([])):r.getClass()===Ut?this._factory.createMultiLineString(n.toArray([])):r.getClass()===re?this._factory.createMultiPolygon(n.toArray([])):this._factory.createGeometryCollection(n.toArray([]))},ne.prototype.editPolygon=function(t,e){var r=e.edit(t,this._factory);if(null===r&&(r=this._factory.createPolygon(null)),r.isEmpty())return r;var n=this.edit(r.getExteriorRing(),e);if(null===n||n.isEmpty())return this._factory.createPolygon();for(var i=new Ot,o=0;o<r.getNumInteriorRing();o++){var a=this.edit(r.getInteriorRingN(o),e);null===a||a.isEmpty()||i.add(a)}return this._factory.createPolygon(n,i.toArray([]))},ne.prototype.interfaces_=function(){return[]},ne.prototype.getClass=function(){return ne},ne.GeometryEditorOperation=function(){},ie.NoOpGeometryOperation.get=function(){return oe},ie.CoordinateOperation.get=function(){return ae},ie.CoordinateSequenceOperation.get=function(){return se},Object.defineProperties(ne,ie);var oe=function(){};oe.prototype.edit=function(t,e){return t},oe.prototype.interfaces_=function(){return[ne.GeometryEditorOperation]},oe.prototype.getClass=function(){return oe};var ae=function(){};ae.prototype.edit=function(t,e){var r=this.editCoordinates(t.getCoordinates(),t);return null===r?t:t instanceof ee?e.createLinearRing(r):t instanceof Yt?e.createLineString(r):t instanceof Jt?r.length>0?e.createPoint(r[0]):e.createPoint():t},ae.prototype.interfaces_=function(){return[ne.GeometryEditorOperation]},ae.prototype.getClass=function(){return ae};var se=function(){};se.prototype.edit=function(t,e){return t instanceof ee?e.createLinearRing(this.edit(t.getCoordinateSequence(),t)):t instanceof Yt?e.createLineString(this.edit(t.getCoordinateSequence(),t)):t instanceof Jt?e.createPoint(this.edit(t.getCoordinateSequence(),t)):t},se.prototype.interfaces_=function(){return[ne.GeometryEditorOperation]},se.prototype.getClass=function(){return se};var ue=function(){if(this._dimension=3,this._coordinates=null,1===arguments.length){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var t=arguments[0];this._coordinates=new Array(t).fill(null);for(var e=0;e<t;e++)this._coordinates[e]=new x}else if(j(arguments[0],G)){var r=arguments[0];if(null===r)return this._coordinates=new Array(0).fill(null),null;this._dimension=r.getDimension(),this._coordinates=new Array(r.size()).fill(null);for(var n=0;n<this._coordinates.length;n++)this._coordinates[n]=r.getCoordinateCopy(n)}}else if(2===arguments.length)if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var i=arguments[0],o=arguments[1];this._coordinates=i,this._dimension=o,null===i&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var a=arguments[0],s=arguments[1];this._coordinates=new Array(a).fill(null),this._dimension=s;for(var u=0;u<a;u++)this._coordinates[u]=new x}},le={serialVersionUID:{configurable:!0}};ue.prototype.setOrdinate=function(t,e,r){switch(e){case G.X:this._coordinates[t].x=r;break;case G.Y:this._coordinates[t].y=r;break;case G.Z:this._coordinates[t].z=r;break;default:throw new v("invalid ordinateIndex")}},ue.prototype.size=function(){return this._coordinates.length},ue.prototype.getOrdinate=function(t,e){switch(e){case G.X:return this._coordinates[t].x;case G.Y:return this._coordinates[t].y;case G.Z:return this._coordinates[t].z}return _.NaN},ue.prototype.getCoordinate=function(){if(1===arguments.length){var t=arguments[0];return this._coordinates[t]}if(2===arguments.length){var e=arguments[0],r=arguments[1];r.x=this._coordinates[e].x,r.y=this._coordinates[e].y,r.z=this._coordinates[e].z}},ue.prototype.getCoordinateCopy=function(t){return new x(this._coordinates[t])},ue.prototype.getDimension=function(){return this._dimension},ue.prototype.getX=function(t){return this._coordinates[t].x},ue.prototype.clone=function(){for(var t=new Array(this.size()).fill(null),e=0;e<this._coordinates.length;e++)t[e]=this._coordinates[e].clone();return new ue(t,this._dimension)},ue.prototype.expandEnvelope=function(t){for(var e=0;e<this._coordinates.length;e++)t.expandToInclude(this._coordinates[e]);return t},ue.prototype.copy=function(){for(var t=new Array(this.size()).fill(null),e=0;e<this._coordinates.length;e++)t[e]=this._coordinates[e].copy();return new ue(t,this._dimension)},ue.prototype.toString=function(){if(this._coordinates.length>0){var t=new I(17*this._coordinates.length);t.append("("),t.append(this._coordinates[0]);for(var e=1;e<this._coordinates.length;e++)t.append(", "),t.append(this._coordinates[e]);return t.append(")"),t.toString()}return"()"},ue.prototype.getY=function(t){return this._coordinates[t].y},ue.prototype.toCoordinateArray=function(){return this._coordinates},ue.prototype.interfaces_=function(){return[G,e]},ue.prototype.getClass=function(){return ue},le.serialVersionUID.get=function(){return-0xcb44a778db18e00},Object.defineProperties(ue,le);var ce=function(){},fe={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};ce.prototype.readResolve=function(){return ce.instance()},ce.prototype.create=function(){if(1===arguments.length){if(arguments[0]instanceof Array)return new ue(arguments[0]);if(j(arguments[0],G))return new ue(arguments[0])}else if(2===arguments.length){var t=arguments[0],e=arguments[1];return e>3&&(e=3),e<2?new ue(t):new ue(t,e)}},ce.prototype.interfaces_=function(){return[P,e]},ce.prototype.getClass=function(){return ce},ce.instance=function(){return ce.instanceObject},fe.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00},fe.instanceObject.get=function(){return new ce},Object.defineProperties(ce,fe);var pe=function(t){function e(){t.call(this),this.map_=new Map}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return this.map_.get(t)||null},e.prototype.put=function(t,e){return this.map_.set(t,e),e},e.prototype.values=function(){for(var t=new Ot,e=this.map_.values(),r=e.next();!r.done;)t.add(r.value),r=e.next();return t},e.prototype.entrySet=function(){var t=new Lt;return this.map_.entries().forEach((function(e){return t.add(e)})),t},e.prototype.size=function(){return this.map_.size()},e}(jt),he=function t(){if(this._modelType=null,this._scale=null,0===arguments.length)this._modelType=t.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof de){var e=arguments[0];this._modelType=e,e===t.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){var r=arguments[0];this._modelType=t.FIXED,this.setScale(r)}else if(arguments[0]instanceof t){var n=arguments[0];this._modelType=n._modelType,this._scale=n._scale}},ye={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};he.prototype.equals=function(t){if(!(t instanceof he))return!1;var e=t;return this._modelType===e._modelType&&this._scale===e._scale},he.prototype.compareTo=function(t){var e=t,r=this.getMaximumSignificantDigits(),n=e.getMaximumSignificantDigits();return new M(r).compareTo(new M(n))},he.prototype.getScale=function(){return this._scale},he.prototype.isFloating=function(){return this._modelType===he.FLOATING||this._modelType===he.FLOATING_SINGLE},he.prototype.getType=function(){return this._modelType},he.prototype.toString=function(){var t="UNKNOWN";return this._modelType===he.FLOATING?t="Floating":this._modelType===he.FLOATING_SINGLE?t="Floating-Single":this._modelType===he.FIXED&&(t="Fixed (Scale="+this.getScale()+")"),t},he.prototype.makePrecise=function(){if("number"==typeof arguments[0]){var t=arguments[0];return _.isNaN(t)||this._modelType===he.FLOATING_SINGLE?t:this._modelType===he.FIXED?Math.round(t*this._scale)/this._scale:t}if(arguments[0]instanceof x){var e=arguments[0];if(this._modelType===he.FLOATING)return null;e.x=this.makePrecise(e.x),e.y=this.makePrecise(e.y)}},he.prototype.getMaximumSignificantDigits=function(){var t=16;return this._modelType===he.FLOATING?t=16:this._modelType===he.FLOATING_SINGLE?t=6:this._modelType===he.FIXED&&(t=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),t},he.prototype.setScale=function(t){this._scale=Math.abs(t)},he.prototype.interfaces_=function(){return[e,w]},he.prototype.getClass=function(){return he},he.mostPrecise=function(t,e){return t.compareTo(e)>=0?t:e},ye.serialVersionUID.get=function(){return 0x6bee6404e9a25c00},ye.maximumPreciseValue.get=function(){return 9007199254740992},Object.defineProperties(he,ye);var de=function t(e){this._name=e||null,t.nameToTypeMap.put(e,this)},ge={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};de.prototype.readResolve=function(){return de.nameToTypeMap.get(this._name)},de.prototype.toString=function(){return this._name},de.prototype.interfaces_=function(){return[e]},de.prototype.getClass=function(){return de},ge.serialVersionUID.get=function(){return-552860263173159e4},ge.nameToTypeMap.get=function(){return new pe},Object.defineProperties(de,ge),he.Type=de,he.FIXED=new de("FIXED"),he.FLOATING=new de("FLOATING"),he.FLOATING_SINGLE=new de("FLOATING SINGLE");var me=function t(){this._precisionModel=new he,this._SRID=0,this._coordinateSequenceFactory=t.getDefaultCoordinateSequenceFactory(),0===arguments.length||(1===arguments.length?j(arguments[0],P)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof he&&(this._precisionModel=arguments[0]):2===arguments.length?(this._precisionModel=arguments[0],this._SRID=arguments[1]):3===arguments.length&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},ve={serialVersionUID:{configurable:!0}};me.prototype.toGeometry=function(t){return t.isNull()?this.createPoint(null):t.getMinX()===t.getMaxX()&&t.getMinY()===t.getMaxY()?this.createPoint(new x(t.getMinX(),t.getMinY())):t.getMinX()===t.getMaxX()||t.getMinY()===t.getMaxY()?this.createLineString([new x(t.getMinX(),t.getMinY()),new x(t.getMaxX(),t.getMaxY())]):this.createPolygon(this.createLinearRing([new x(t.getMinX(),t.getMinY()),new x(t.getMinX(),t.getMaxY()),new x(t.getMaxX(),t.getMaxY()),new x(t.getMaxX(),t.getMinY()),new x(t.getMinX(),t.getMinY())]),null)},me.prototype.createLineString=function(t){return t?t instanceof Array?new Yt(this.getCoordinateSequenceFactory().create(t),this):j(t,G)?new Yt(t,this):void 0:new Yt(this.getCoordinateSequenceFactory().create([]),this)},me.prototype.createMultiLineString=function(){return 0===arguments.length?new Ut(null,this):1===arguments.length?new Ut(arguments[0],this):void 0},me.prototype.buildGeometry=function(t){for(var e=null,r=!1,n=!1,i=t.iterator();i.hasNext();){var o=i.next(),a=o.getClass();null===e&&(e=a),a!==e&&(r=!0),o.isGeometryCollectionOrDerived()&&(n=!0)}if(null===e)return this.createGeometryCollection();if(r||n)return this.createGeometryCollection(me.toGeometryArray(t));var s=t.iterator().next();if(t.size()>1){if(s instanceof Qt)return this.createMultiPolygon(me.toPolygonArray(t));if(s instanceof Yt)return this.createMultiLineString(me.toLineStringArray(t));if(s instanceof Jt)return this.createMultiPoint(me.toPointArray(t));et.shouldNeverReachHere("Unhandled class: "+s.getClass().getName())}return s},me.prototype.createMultiPointFromCoords=function(t){return this.createMultiPoint(null!==t?this.getCoordinateSequenceFactory().create(t):null)},me.prototype.createPoint=function(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof x){var t=arguments[0];return this.createPoint(null!==t?this.getCoordinateSequenceFactory().create([t]):null)}if(j(arguments[0],G))return new Jt(arguments[0],this)}},me.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory},me.prototype.createPolygon=function(){if(0===arguments.length)return new Qt(null,null,this);if(1===arguments.length){if(j(arguments[0],G)){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}if(arguments[0]instanceof Array){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}if(arguments[0]instanceof ee){var r=arguments[0];return this.createPolygon(r,null)}}else if(2===arguments.length)return new Qt(arguments[0],arguments[1],this)},me.prototype.getSRID=function(){return this._SRID},me.prototype.createGeometryCollection=function(){return 0===arguments.length?new Vt(null,this):1===arguments.length?new Vt(arguments[0],this):void 0},me.prototype.createGeometry=function(t){return new ne(this).edit(t,{edit:function(){if(2===arguments.length){var t=arguments[0];return this._coordinateSequenceFactory.create(t)}}})},me.prototype.getPrecisionModel=function(){return this._precisionModel},me.prototype.createLinearRing=function(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];return this.createLinearRing(null!==t?this.getCoordinateSequenceFactory().create(t):null)}if(j(arguments[0],G))return new ee(arguments[0],this)}},me.prototype.createMultiPolygon=function(){return 0===arguments.length?new re(null,this):1===arguments.length?new re(arguments[0],this):void 0},me.prototype.createMultiPoint=function(){if(0===arguments.length)return new te(null,this);if(1===arguments.length){if(arguments[0]instanceof Array)return new te(arguments[0],this);if(arguments[0]instanceof Array){var t=arguments[0];return this.createMultiPoint(null!==t?this.getCoordinateSequenceFactory().create(t):null)}if(j(arguments[0],G)){var e=arguments[0];if(null===e)return this.createMultiPoint(new Array(0).fill(null));for(var r=new Array(e.size()).fill(null),n=0;n<e.size();n++){var i=this.getCoordinateSequenceFactory().create(1,e.getDimension());Ht.copy(e,n,i,0,1),r[n]=this.createPoint(i)}return this.createMultiPoint(r)}}},me.prototype.interfaces_=function(){return[e]},me.prototype.getClass=function(){return me},me.toMultiPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},me.toGeometryArray=function(t){if(null===t)return null;var e=new Array(t.size()).fill(null);return t.toArray(e)},me.getDefaultCoordinateSequenceFactory=function(){return ce.instance()},me.toMultiLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},me.toLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},me.toMultiPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},me.toLinearRingArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},me.toPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},me.toPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},me.createPointFromInternalCoord=function(t,e){return e.getPrecisionModel().makePrecise(t),e.getFactory().createPoint(t)},ve.serialVersionUID.get=function(){return-0x5ea75f2051eeb400},Object.defineProperties(me,ve);var _e=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],be=function(t){this.geometryFactory=t||new me};be.prototype.read=function(t){var e,r=(e="string"==typeof t?JSON.parse(t):t).type;if(!we[r])throw new Error("Unknown GeoJSON type: "+e.type);return-1!==_e.indexOf(r)?we[r].apply(this,[e.coordinates]):"GeometryCollection"===r?we[r].apply(this,[e.geometries]):we[r].apply(this,[e])},be.prototype.write=function(t){var e=t.getGeometryType();if(!Se[e])throw new Error("Geometry is not supported");return Se[e].apply(this,[t])};var we={Feature:function(t){var e={};for(var r in t)e[r]=t[r];if(t.geometry){var n=t.geometry.type;if(!we[n])throw new Error("Unknown GeoJSON type: "+t.type);e.geometry=this.read(t.geometry)}return t.bbox&&(e.bbox=we.bbox.apply(this,[t.bbox])),e},FeatureCollection:function(t){var e={};if(t.features){e.features=[];for(var r=0;r<t.features.length;++r)e.features.push(this.read(t.features[r]))}return t.bbox&&(e.bbox=this.parse.bbox.apply(this,[t.bbox])),e},coordinates:function(t){for(var e=[],r=0;r<t.length;++r){var n=t[r];e.push(new x(n[0],n[1]))}return e},bbox:function(t){return this.geometryFactory.createLinearRing([new x(t[0],t[1]),new x(t[2],t[1]),new x(t[2],t[3]),new x(t[0],t[3]),new x(t[0],t[1])])},Point:function(t){var e=new x(t[0],t[1]);return this.geometryFactory.createPoint(e)},MultiPoint:function(t){for(var e=[],r=0;r<t.length;++r)e.push(we.Point.apply(this,[t[r]]));return this.geometryFactory.createMultiPoint(e)},LineString:function(t){var e=we.coordinates.apply(this,[t]);return this.geometryFactory.createLineString(e)},MultiLineString:function(t){for(var e=[],r=0;r<t.length;++r)e.push(we.LineString.apply(this,[t[r]]));return this.geometryFactory.createMultiLineString(e)},Polygon:function(t){for(var e=we.coordinates.apply(this,[t[0]]),r=this.geometryFactory.createLinearRing(e),n=[],i=1;i<t.length;++i){var o=t[i],a=we.coordinates.apply(this,[o]),s=this.geometryFactory.createLinearRing(a);n.push(s)}return this.geometryFactory.createPolygon(r,n)},MultiPolygon:function(t){for(var e=[],r=0;r<t.length;++r){var n=t[r];e.push(we.Polygon.apply(this,[n]))}return this.geometryFactory.createMultiPolygon(e)},GeometryCollection:function(t){for(var e=[],r=0;r<t.length;++r){var n=t[r];e.push(this.read(n))}return this.geometryFactory.createGeometryCollection(e)}},Se={coordinate:function(t){return[t.x,t.y]},Point:function(t){return{type:"Point",coordinates:Se.coordinate.apply(this,[t.getCoordinate()])}},MultiPoint:function(t){for(var e=[],r=0;r<t._geometries.length;++r){var n=t._geometries[r],i=Se.Point.apply(this,[n]);e.push(i.coordinates)}return{type:"MultiPoint",coordinates:e}},LineString:function(t){for(var e=[],r=t.getCoordinates(),n=0;n<r.length;++n){var i=r[n];e.push(Se.coordinate.apply(this,[i]))}return{type:"LineString",coordinates:e}},MultiLineString:function(t){for(var e=[],r=0;r<t._geometries.length;++r){var n=t._geometries[r],i=Se.LineString.apply(this,[n]);e.push(i.coordinates)}return{type:"MultiLineString",coordinates:e}},Polygon:function(t){var e=[],r=Se.LineString.apply(this,[t._shell]);e.push(r.coordinates);for(var n=0;n<t._holes.length;++n){var i=t._holes[n],o=Se.LineString.apply(this,[i]);e.push(o.coordinates)}return{type:"Polygon",coordinates:e}},MultiPolygon:function(t){for(var e=[],r=0;r<t._geometries.length;++r){var n=t._geometries[r],i=Se.Polygon.apply(this,[n]);e.push(i.coordinates)}return{type:"MultiPolygon",coordinates:e}},GeometryCollection:function(t){for(var e=[],r=0;r<t._geometries.length;++r){var n=t._geometries[r],i=n.getGeometryType();e.push(Se[i].apply(this,[n]))}return{type:"GeometryCollection",geometries:e}}},Oe=function(t){this.geometryFactory=t||new me,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new be(this.geometryFactory)};Oe.prototype.read=function(t){var e=this.parser.read(t);return this.precisionModel.getType()===he.FIXED&&this.reducePrecision(e),e},Oe.prototype.reducePrecision=function(t){var e,r;if(t.coordinate)this.precisionModel.makePrecise(t.coordinate);else if(t.points)for(e=0,r=t.points.length;e<r;e++)this.precisionModel.makePrecise(t.points[e]);else if(t.geometries)for(e=0,r=t.geometries.length;e<r;e++)this.reducePrecision(t.geometries[e])};var xe=function(){this.parser=new be(this.geometryFactory)};xe.prototype.write=function(t){return this.parser.write(t)};var Ce=function(){},Ee={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};Ce.prototype.interfaces_=function(){return[]},Ce.prototype.getClass=function(){return Ce},Ce.opposite=function(t){return t===Ce.LEFT?Ce.RIGHT:t===Ce.RIGHT?Ce.LEFT:t},Ee.ON.get=function(){return 0},Ee.LEFT.get=function(){return 1},Ee.RIGHT.get=function(){return 2},Object.defineProperties(Ce,Ee),(d.prototype=new Error).name="EmptyStackException",(g.prototype=new St).add=function(t){return this.array_.push(t),!0},g.prototype.get=function(t){if(t<0||t>=this.size())throw new Error;return this.array_[t]},g.prototype.push=function(t){return this.array_.push(t),t},g.prototype.pop=function(t){if(0===this.array_.length)throw new d;return this.array_.pop()},g.prototype.peek=function(){if(0===this.array_.length)throw new d;return this.array_[this.array_.length-1]},g.prototype.empty=function(){return 0===this.array_.length},g.prototype.isEmpty=function(){return this.empty()},g.prototype.search=function(t){return this.array_.indexOf(t)},g.prototype.size=function(){return this.array_.length},g.prototype.toArray=function(){for(var t=[],e=0,r=this.array_.length;e<r;e++)t.push(this.array_[e]);return t};var Pe=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};Pe.prototype.getCoordinate=function(){return this._minCoord},Pe.prototype.getRightmostSide=function(t,e){var r=this.getRightmostSideOfSegment(t,e);return r<0&&(r=this.getRightmostSideOfSegment(t,e-1)),r<0&&(this._minCoord=null,this.checkForRightmostCoordinate(t)),r},Pe.prototype.findRightmostEdgeAtVertex=function(){var t=this._minDe.getEdge().getCoordinates();et.isTrue(this._minIndex>0&&this._minIndex<t.length,"rightmost point expected to be interior vertex of edge");var e=t[this._minIndex-1],r=t[this._minIndex+1],n=st.computeOrientation(this._minCoord,r,e),i=!1;(e.y<this._minCoord.y&&r.y<this._minCoord.y&&n===st.COUNTERCLOCKWISE||e.y>this._minCoord.y&&r.y>this._minCoord.y&&n===st.CLOCKWISE)&&(i=!0),i&&(this._minIndex=this._minIndex-1)},Pe.prototype.getRightmostSideOfSegment=function(t,e){var r=t.getEdge().getCoordinates();if(e<0||e+1>=r.length)return-1;if(r[e].y===r[e+1].y)return-1;var n=Ce.LEFT;return r[e].y<r[e+1].y&&(n=Ce.RIGHT),n},Pe.prototype.getEdge=function(){return this._orientedDe},Pe.prototype.checkForRightmostCoordinate=function(t){for(var e=t.getEdge().getCoordinates(),r=0;r<e.length-1;r++)(null===this._minCoord||e[r].x>this._minCoord.x)&&(this._minDe=t,this._minIndex=r,this._minCoord=e[r])},Pe.prototype.findRightmostEdgeAtNode=function(){var t=this._minDe.getNode().getEdges();this._minDe=t.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)},Pe.prototype.findEdge=function(t){for(var e=t.iterator();e.hasNext();){var r=e.next();r.isForward()&&this.checkForRightmostCoordinate(r)}et.isTrue(0!==this._minIndex||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),0===this._minIndex?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===Ce.LEFT&&(this._orientedDe=this._minDe.getSym())},Pe.prototype.interfaces_=function(){return[]},Pe.prototype.getClass=function(){return Pe};var ke=function(t){function e(r,n){t.call(this,e.msgWithCoord(r,n)),this.pt=n?new x(n):null,this.name="TopologyException"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCoordinate=function(){return this.pt},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.msgWithCoord=function(t,e){return e?t:t+" [ "+e+" ]"},e}(Q),Te=function(){this.array_=[]};Te.prototype.addLast=function(t){this.array_.push(t)},Te.prototype.removeFirst=function(){return this.array_.shift()},Te.prototype.isEmpty=function(){return 0===this.array_.length};var je=function(){this._finder=null,this._dirEdgeList=new Ot,this._nodes=new Ot,this._rightMostCoord=null,this._env=null,this._finder=new Pe};je.prototype.clearVisitedEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();)t.next().setVisited(!1)},je.prototype.getRightmostCoordinate=function(){return this._rightMostCoord},je.prototype.computeNodeDepth=function(t){for(var e=null,r=t.getEdges().iterator();r.hasNext();){var n=r.next();if(n.isVisited()||n.getSym().isVisited()){e=n;break}}if(null===e)throw new ke("unable to find edge to compute depths at "+t.getCoordinate());t.getEdges().computeDepths(e);for(var i=t.getEdges().iterator();i.hasNext();){var o=i.next();o.setVisited(!0),this.copySymDepths(o)}},je.prototype.computeDepth=function(t){this.clearVisitedEdges();var e=this._finder.getEdge();e.setEdgeDepths(Ce.RIGHT,t),this.copySymDepths(e),this.computeDepths(e)},je.prototype.create=function(t){this.addReachable(t),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()},je.prototype.findResultEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();){var e=t.next();e.getDepth(Ce.RIGHT)>=1&&e.getDepth(Ce.LEFT)<=0&&!e.isInteriorAreaEdge()&&e.setInResult(!0)}},je.prototype.computeDepths=function(t){var e=new Lt,r=new Te,n=t.getNode();for(r.addLast(n),e.add(n),t.setVisited(!0);!r.isEmpty();){var i=r.removeFirst();e.add(i),this.computeNodeDepth(i);for(var o=i.getEdges().iterator();o.hasNext();){var a=o.next().getSym();if(!a.isVisited()){var s=a.getNode();e.contains(s)||(r.addLast(s),e.add(s))}}}},je.prototype.compareTo=function(t){var e=t;return this._rightMostCoord.x<e._rightMostCoord.x?-1:this._rightMostCoord.x>e._rightMostCoord.x?1:0},je.prototype.getEnvelope=function(){if(null===this._env){for(var t=new X,e=this._dirEdgeList.iterator();e.hasNext();)for(var r=e.next().getEdge().getCoordinates(),n=0;n<r.length-1;n++)t.expandToInclude(r[n]);this._env=t}return this._env},je.prototype.addReachable=function(t){var e=new g;for(e.add(t);!e.empty();){var r=e.pop();this.add(r,e)}},je.prototype.copySymDepths=function(t){var e=t.getSym();e.setDepth(Ce.LEFT,t.getDepth(Ce.RIGHT)),e.setDepth(Ce.RIGHT,t.getDepth(Ce.LEFT))},je.prototype.add=function(t,e){t.setVisited(!0),this._nodes.add(t);for(var r=t.getEdges().iterator();r.hasNext();){var n=r.next();this._dirEdgeList.add(n);var i=n.getSym().getNode();i.isVisited()||e.push(i)}},je.prototype.getNodes=function(){return this._nodes},je.prototype.getDirectedEdges=function(){return this._dirEdgeList},je.prototype.interfaces_=function(){return[w]},je.prototype.getClass=function(){return je};var Re=function t(){if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array){var e=arguments[0];this.init(e.length)}else if(Number.isInteger(arguments[0])){var r=arguments[0];this.init(1),this.location[Ce.ON]=r}else if(arguments[0]instanceof t){var n=arguments[0];if(this.init(n.location.length),null!==n)for(var i=0;i<this.location.length;i++)this.location[i]=n.location[i]}}else if(3===arguments.length){var o=arguments[0],a=arguments[1],s=arguments[2];this.init(3),this.location[Ce.ON]=o,this.location[Ce.LEFT]=a,this.location[Ce.RIGHT]=s}};Re.prototype.setAllLocations=function(t){for(var e=0;e<this.location.length;e++)this.location[e]=t},Re.prototype.isNull=function(){for(var t=0;t<this.location.length;t++)if(this.location[t]!==k.NONE)return!1;return!0},Re.prototype.setAllLocationsIfNull=function(t){for(var e=0;e<this.location.length;e++)this.location[e]===k.NONE&&(this.location[e]=t)},Re.prototype.isLine=function(){return 1===this.location.length},Re.prototype.merge=function(t){if(t.location.length>this.location.length){var e=new Array(3).fill(null);e[Ce.ON]=this.location[Ce.ON],e[Ce.LEFT]=k.NONE,e[Ce.RIGHT]=k.NONE,this.location=e}for(var r=0;r<this.location.length;r++)this.location[r]===k.NONE&&r<t.location.length&&(this.location[r]=t.location[r])},Re.prototype.getLocations=function(){return this.location},Re.prototype.flip=function(){if(this.location.length<=1)return null;var t=this.location[Ce.LEFT];this.location[Ce.LEFT]=this.location[Ce.RIGHT],this.location[Ce.RIGHT]=t},Re.prototype.toString=function(){var t=new I;return this.location.length>1&&t.append(k.toLocationSymbol(this.location[Ce.LEFT])),t.append(k.toLocationSymbol(this.location[Ce.ON])),this.location.length>1&&t.append(k.toLocationSymbol(this.location[Ce.RIGHT])),t.toString()},Re.prototype.setLocations=function(t,e,r){this.location[Ce.ON]=t,this.location[Ce.LEFT]=e,this.location[Ce.RIGHT]=r},Re.prototype.get=function(t){return t<this.location.length?this.location[t]:k.NONE},Re.prototype.isArea=function(){return this.location.length>1},Re.prototype.isAnyNull=function(){for(var t=0;t<this.location.length;t++)if(this.location[t]===k.NONE)return!0;return!1},Re.prototype.setLocation=function(){if(1===arguments.length){var t=arguments[0];this.setLocation(Ce.ON,t)}else if(2===arguments.length){var e=arguments[0],r=arguments[1];this.location[e]=r}},Re.prototype.init=function(t){this.location=new Array(t).fill(null),this.setAllLocations(k.NONE)},Re.prototype.isEqualOnSide=function(t,e){return this.location[e]===t.location[e]},Re.prototype.allPositionsEqual=function(t){for(var e=0;e<this.location.length;e++)if(this.location[e]!==t)return!1;return!0},Re.prototype.interfaces_=function(){return[]},Re.prototype.getClass=function(){return Re};var Le=function t(){if(this.elt=new Array(2).fill(null),1===arguments.length){if(Number.isInteger(arguments[0])){var e=arguments[0];this.elt[0]=new Re(e),this.elt[1]=new Re(e)}else if(arguments[0]instanceof t){var r=arguments[0];this.elt[0]=new Re(r.elt[0]),this.elt[1]=new Re(r.elt[1])}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.elt[0]=new Re(k.NONE),this.elt[1]=new Re(k.NONE),this.elt[n].setLocation(i)}else if(3===arguments.length){var o=arguments[0],a=arguments[1],s=arguments[2];this.elt[0]=new Re(o,a,s),this.elt[1]=new Re(o,a,s)}else if(4===arguments.length){var u=arguments[0],l=arguments[1],c=arguments[2],f=arguments[3];this.elt[0]=new Re(k.NONE,k.NONE,k.NONE),this.elt[1]=new Re(k.NONE,k.NONE,k.NONE),this.elt[u].setLocations(l,c,f)}};Le.prototype.getGeometryCount=function(){var t=0;return this.elt[0].isNull()||t++,this.elt[1].isNull()||t++,t},Le.prototype.setAllLocations=function(t,e){this.elt[t].setAllLocations(e)},Le.prototype.isNull=function(t){return this.elt[t].isNull()},Le.prototype.setAllLocationsIfNull=function(){if(1===arguments.length){var t=arguments[0];this.setAllLocationsIfNull(0,t),this.setAllLocationsIfNull(1,t)}else if(2===arguments.length){var e=arguments[0],r=arguments[1];this.elt[e].setAllLocationsIfNull(r)}},Le.prototype.isLine=function(t){return this.elt[t].isLine()},Le.prototype.merge=function(t){for(var e=0;e<2;e++)null===this.elt[e]&&null!==t.elt[e]?this.elt[e]=new Re(t.elt[e]):this.elt[e].merge(t.elt[e])},Le.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()},Le.prototype.getLocation=function(){if(1===arguments.length){var t=arguments[0];return this.elt[t].get(Ce.ON)}if(2===arguments.length){var e=arguments[0],r=arguments[1];return this.elt[e].get(r)}},Le.prototype.toString=function(){var t=new I;return null!==this.elt[0]&&(t.append("A:"),t.append(this.elt[0].toString())),null!==this.elt[1]&&(t.append(" B:"),t.append(this.elt[1].toString())),t.toString()},Le.prototype.isArea=function(){if(0===arguments.length)return this.elt[0].isArea()||this.elt[1].isArea();if(1===arguments.length){var t=arguments[0];return this.elt[t].isArea()}},Le.prototype.isAnyNull=function(t){return this.elt[t].isAnyNull()},Le.prototype.setLocation=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];this.elt[t].setLocation(Ce.ON,e)}else if(3===arguments.length){var r=arguments[0],n=arguments[1],i=arguments[2];this.elt[r].setLocation(n,i)}},Le.prototype.isEqualOnSide=function(t,e){return this.elt[0].isEqualOnSide(t.elt[0],e)&&this.elt[1].isEqualOnSide(t.elt[1],e)},Le.prototype.allPositionsEqual=function(t,e){return this.elt[t].allPositionsEqual(e)},Le.prototype.toLine=function(t){this.elt[t].isArea()&&(this.elt[t]=new Re(this.elt[t].location[0]))},Le.prototype.interfaces_=function(){return[]},Le.prototype.getClass=function(){return Le},Le.toLineLabel=function(t){for(var e=new Le(k.NONE),r=0;r<2;r++)e.setLocation(r,t.getLocation(r));return e};var Ie=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new Ot,this._pts=new Ot,this._label=new Le(k.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new Ot,this._geometryFactory=null;var t=arguments[0],e=arguments[1];this._geometryFactory=e,this.computePoints(t),this.computeRing()};Ie.prototype.computeRing=function(){if(null!==this._ring)return null;for(var t=new Array(this._pts.size()).fill(null),e=0;e<this._pts.size();e++)t[e]=this._pts.get(e);this._ring=this._geometryFactory.createLinearRing(t),this._isHole=st.isCCW(this._ring.getCoordinates())},Ie.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},Ie.prototype.computePoints=function(t){this._startDe=t;var e=t,r=!0;do{if(null===e)throw new ke("Found null DirectedEdge");if(e.getEdgeRing()===this)throw new ke("Directed Edge visited twice during ring-building at "+e.getCoordinate());this._edges.add(e);var n=e.getLabel();et.isTrue(n.isArea()),this.mergeLabel(n),this.addPoints(e.getEdge(),e.isForward(),r),r=!1,this.setEdgeRing(e,this),e=this.getNext(e)}while(e!==this._startDe)},Ie.prototype.getLinearRing=function(){return this._ring},Ie.prototype.getCoordinate=function(t){return this._pts.get(t)},Ie.prototype.computeMaxNodeDegree=function(){this._maxNodeDegree=0;var t=this._startDe;do{var e=t.getNode().getEdges().getOutgoingDegree(this);e>this._maxNodeDegree&&(this._maxNodeDegree=e),t=this.getNext(t)}while(t!==this._startDe);this._maxNodeDegree*=2},Ie.prototype.addPoints=function(t,e,r){var n=t.getCoordinates();if(e){var i=1;r&&(i=0);for(var o=i;o<n.length;o++)this._pts.add(n[o])}else{var a=n.length-2;r&&(a=n.length-1);for(var s=a;s>=0;s--)this._pts.add(n[s])}},Ie.prototype.isHole=function(){return this._isHole},Ie.prototype.setInResult=function(){var t=this._startDe;do{t.getEdge().setInResult(!0),t=t.getNext()}while(t!==this._startDe)},Ie.prototype.containsPoint=function(t){var e=this.getLinearRing();if(!e.getEnvelopeInternal().contains(t))return!1;if(!st.isPointInRing(t,e.getCoordinates()))return!1;for(var r=this._holes.iterator();r.hasNext();)if(r.next().containsPoint(t))return!1;return!0},Ie.prototype.addHole=function(t){this._holes.add(t)},Ie.prototype.isShell=function(){return null===this._shell},Ie.prototype.getLabel=function(){return this._label},Ie.prototype.getEdges=function(){return this._edges},Ie.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree},Ie.prototype.getShell=function(){return this._shell},Ie.prototype.mergeLabel=function(){if(1===arguments.length){var t=arguments[0];this.mergeLabel(t,0),this.mergeLabel(t,1)}else if(2===arguments.length){var e=arguments[1],r=arguments[0].getLocation(e,Ce.RIGHT);if(r===k.NONE)return null;if(this._label.getLocation(e)===k.NONE)return this._label.setLocation(e,r),null}},Ie.prototype.setShell=function(t){this._shell=t,null!==t&&t.addHole(this)},Ie.prototype.toPolygon=function(t){for(var e=new Array(this._holes.size()).fill(null),r=0;r<this._holes.size();r++)e[r]=this._holes.get(r).getLinearRing();return t.createPolygon(this.getLinearRing(),e)},Ie.prototype.interfaces_=function(){return[]},Ie.prototype.getClass=function(){return Ie};var Me=function(t){function e(){var e=arguments[0],r=arguments[1];t.call(this,e,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setEdgeRing=function(t,e){t.setMinEdgeRing(e)},e.prototype.getNext=function(t){return t.getNextMin()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Ie),Ae=function(t){function e(){var e=arguments[0],r=arguments[1];t.call(this,e,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildMinimalRings=function(){var t=new Ot,e=this._startDe;do{if(null===e.getMinEdgeRing()){var r=new Me(e,this._geometryFactory);t.add(r)}e=e.getNext()}while(e!==this._startDe);return t},e.prototype.setEdgeRing=function(t,e){t.setEdgeRing(e)},e.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var t=this._startDe;do{t.getNode().getEdges().linkMinimalDirectedEdges(this),t=t.getNext()}while(t!==this._startDe)},e.prototype.getNext=function(t){return t.getNext()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Ie),De=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this._label=t}};De.prototype.setVisited=function(t){this._isVisited=t},De.prototype.setInResult=function(t){this._isInResult=t},De.prototype.isCovered=function(){return this._isCovered},De.prototype.isCoveredSet=function(){return this._isCoveredSet},De.prototype.setLabel=function(t){this._label=t},De.prototype.getLabel=function(){return this._label},De.prototype.setCovered=function(t){this._isCovered=t,this._isCoveredSet=!0},De.prototype.updateIM=function(t){et.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(t)},De.prototype.isInResult=function(){return this._isInResult},De.prototype.isVisited=function(){return this._isVisited},De.prototype.interfaces_=function(){return[]},De.prototype.getClass=function(){return De};var Ne=function(t){function e(){t.call(this),this._coord=null,this._edges=null;var e=arguments[0],r=arguments[1];this._coord=e,this._edges=r,this._label=new Le(0,k.NONE)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isIncidentEdgeInResult=function(){for(var t=this.getEdges().getEdges().iterator();t.hasNext();)if(t.next().getEdge().isInResult())return!0;return!1},e.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},e.prototype.getCoordinate=function(){return this._coord},e.prototype.print=function(t){t.println("node "+this._coord+" lbl: "+this._label)},e.prototype.computeIM=function(t){},e.prototype.computeMergedLocation=function(t,e){var r=k.NONE;if(r=this._label.getLocation(e),!t.isNull(e)){var n=t.getLocation(e);r!==k.BOUNDARY&&(r=n)}return r},e.prototype.setLabel=function(){if(2!==arguments.length)return t.prototype.setLabel.apply(this,arguments);var e=arguments[0],r=arguments[1];null===this._label?this._label=new Le(e,r):this._label.setLocation(e,r)},e.prototype.getEdges=function(){return this._edges},e.prototype.mergeLabel=function(){if(arguments[0]instanceof e){var t=arguments[0];this.mergeLabel(t._label)}else if(arguments[0]instanceof Le)for(var r=arguments[0],n=0;n<2;n++){var i=this.computeMergedLocation(r,n);this._label.getLocation(n)===k.NONE&&this._label.setLocation(n,i)}},e.prototype.add=function(t){this._edges.insert(t),t.setNode(this)},e.prototype.setLabelBoundary=function(t){if(null===this._label)return null;var e=k.NONE;null!==this._label&&(e=this._label.getLocation(t));var r=null;if(e===k.BOUNDARY)r=k.INTERIOR;else r=k.BOUNDARY;this._label.setLocation(t,r)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(De),Fe=function(){this.nodeMap=new f,this.nodeFact=null;var t=arguments[0];this.nodeFact=t};Fe.prototype.find=function(t){return this.nodeMap.get(t)},Fe.prototype.addNode=function(){if(arguments[0]instanceof x){var t=arguments[0],e=this.nodeMap.get(t);return null===e&&(e=this.nodeFact.createNode(t),this.nodeMap.put(t,e)),e}if(arguments[0]instanceof Ne){var r=arguments[0],n=this.nodeMap.get(r.getCoordinate());return null===n?(this.nodeMap.put(r.getCoordinate(),r),r):(n.mergeLabel(r),n)}},Fe.prototype.print=function(t){for(var e=this.iterator();e.hasNext();)e.next().print(t)},Fe.prototype.iterator=function(){return this.nodeMap.values().iterator()},Fe.prototype.values=function(){return this.nodeMap.values()},Fe.prototype.getBoundaryNodes=function(t){for(var e=new Ot,r=this.iterator();r.hasNext();){var n=r.next();n.getLabel().getLocation(t)===k.BOUNDARY&&e.add(n)}return e},Fe.prototype.add=function(t){var e=t.getCoordinate();this.addNode(e).add(t)},Fe.prototype.interfaces_=function(){return[]},Fe.prototype.getClass=function(){return Fe};var ze=function(){},Ge={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};ze.prototype.interfaces_=function(){return[]},ze.prototype.getClass=function(){return ze},ze.isNorthern=function(t){return t===ze.NE||t===ze.NW},ze.isOpposite=function(t,e){return t!==e&&2==(t-e+4)%4},ze.commonHalfPlane=function(t,e){if(t===e)return t;if(2==(t-e+4)%4)return-1;var r=t<e?t:e;return 0===r&&3===(t>e?t:e)?3:r},ze.isInHalfPlane=function(t,e){return e===ze.SE?t===ze.SE||t===ze.SW:t===e||t===e+1},ze.quadrant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1];if(0===t&&0===e)throw new v("Cannot compute the quadrant for point ( "+t+", "+e+" )");return t>=0?e>=0?ze.NE:ze.SE:e>=0?ze.NW:ze.SW}if(arguments[0]instanceof x&&arguments[1]instanceof x){var r=arguments[0],n=arguments[1];if(n.x===r.x&&n.y===r.y)throw new v("Cannot compute the quadrant for two identical points "+r);return n.x>=r.x?n.y>=r.y?ze.NE:ze.SE:n.y>=r.y?ze.NW:ze.SW}},Ge.NE.get=function(){return 0},Ge.NW.get=function(){return 1},Ge.SW.get=function(){return 2},Ge.SE.get=function(){return 3},Object.defineProperties(ze,Ge);var Be=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,1===arguments.length){var t=arguments[0];this._edge=t}else if(3===arguments.length){var e=arguments[0],r=arguments[1],n=arguments[2];this._edge=e,this.init(r,n),this._label=null}else if(4===arguments.length){var i=arguments[0],o=arguments[1],a=arguments[2],s=arguments[3];this._edge=i,this.init(o,a),this._label=s}};Be.prototype.compareDirection=function(t){return this._dx===t._dx&&this._dy===t._dy?0:this._quadrant>t._quadrant?1:this._quadrant<t._quadrant?-1:st.computeOrientation(t._p0,t._p1,this._p1)},Be.prototype.getDy=function(){return this._dy},Be.prototype.getCoordinate=function(){return this._p0},Be.prototype.setNode=function(t){this._node=t},Be.prototype.print=function(t){var e=Math.atan2(this._dy,this._dx),r=this.getClass().getName(),n=r.lastIndexOf("."),i=r.substring(n+1);t.print("  "+i+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label)},Be.prototype.compareTo=function(t){var e=t;return this.compareDirection(e)},Be.prototype.getDirectedCoordinate=function(){return this._p1},Be.prototype.getDx=function(){return this._dx},Be.prototype.getLabel=function(){return this._label},Be.prototype.getEdge=function(){return this._edge},Be.prototype.getQuadrant=function(){return this._quadrant},Be.prototype.getNode=function(){return this._node},Be.prototype.toString=function(){var t=Math.atan2(this._dy,this._dx),e=this.getClass().getName(),r=e.lastIndexOf(".");return"  "+e.substring(r+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label},Be.prototype.computeLabel=function(t){},Be.prototype.init=function(t,e){this._p0=t,this._p1=e,this._dx=e.x-t.x,this._dy=e.y-t.y,this._quadrant=ze.quadrant(this._dx,this._dy),et.isTrue(!(0===this._dx&&0===this._dy),"EdgeEnd with identical endpoints found")},Be.prototype.interfaces_=function(){return[w]},Be.prototype.getClass=function(){return Be};var Ve=function(t){function e(){var e=arguments[0],r=arguments[1];if(t.call(this,e),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=r,r)this.init(e.getCoordinate(0),e.getCoordinate(1));else{var n=e.getNumPoints()-1;this.init(e.getCoordinate(n),e.getCoordinate(n-1))}this.computeDirectedLabel()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getNextMin=function(){return this._nextMin},e.prototype.getDepth=function(t){return this._depth[t]},e.prototype.setVisited=function(t){this._isVisited=t},e.prototype.computeDirectedLabel=function(){this._label=new Le(this._edge.getLabel()),this._isForward||this._label.flip()},e.prototype.getNext=function(){return this._next},e.prototype.setDepth=function(t,e){if(-999!==this._depth[t]&&this._depth[t]!==e)throw new ke("assigned depths do not match",this.getCoordinate());this._depth[t]=e},e.prototype.isInteriorAreaEdge=function(){for(var t=!0,e=0;e<2;e++)this._label.isArea(e)&&this._label.getLocation(e,Ce.LEFT)===k.INTERIOR&&this._label.getLocation(e,Ce.RIGHT)===k.INTERIOR||(t=!1);return t},e.prototype.setNextMin=function(t){this._nextMin=t},e.prototype.print=function(e){t.prototype.print.call(this,e),e.print(" "+this._depth[Ce.LEFT]+"/"+this._depth[Ce.RIGHT]),e.print(" ("+this.getDepthDelta()+")"),this._isInResult&&e.print(" inResult")},e.prototype.setMinEdgeRing=function(t){this._minEdgeRing=t},e.prototype.isLineEdge=function(){var t=this._label.isLine(0)||this._label.isLine(1),e=!this._label.isArea(0)||this._label.allPositionsEqual(0,k.EXTERIOR),r=!this._label.isArea(1)||this._label.allPositionsEqual(1,k.EXTERIOR);return t&&e&&r},e.prototype.setEdgeRing=function(t){this._edgeRing=t},e.prototype.getMinEdgeRing=function(){return this._minEdgeRing},e.prototype.getDepthDelta=function(){var t=this._edge.getDepthDelta();return this._isForward||(t=-t),t},e.prototype.setInResult=function(t){this._isInResult=t},e.prototype.getSym=function(){return this._sym},e.prototype.isForward=function(){return this._isForward},e.prototype.getEdge=function(){return this._edge},e.prototype.printEdge=function(t){this.print(t),t.print(" "),this._isForward?this._edge.print(t):this._edge.printReverse(t)},e.prototype.setSym=function(t){this._sym=t},e.prototype.setVisitedEdge=function(t){this.setVisited(t),this._sym.setVisited(t)},e.prototype.setEdgeDepths=function(t,e){var r=this.getEdge().getDepthDelta();this._isForward||(r=-r);var n=1;t===Ce.LEFT&&(n=-1);var i=Ce.opposite(t),o=e+r*n;this.setDepth(t,e),this.setDepth(i,o)},e.prototype.getEdgeRing=function(){return this._edgeRing},e.prototype.isInResult=function(){return this._isInResult},e.prototype.setNext=function(t){this._next=t},e.prototype.isVisited=function(){return this._isVisited},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.depthFactor=function(t,e){return t===k.EXTERIOR&&e===k.INTERIOR?1:t===k.INTERIOR&&e===k.EXTERIOR?-1:0},e}(Be),Ue=function(){};Ue.prototype.createNode=function(t){return new Ne(t,null)},Ue.prototype.interfaces_=function(){return[]},Ue.prototype.getClass=function(){return Ue};var qe=function(){if(this._edges=new Ot,this._nodes=null,this._edgeEndList=new Ot,0===arguments.length)this._nodes=new Fe(new Ue);else if(1===arguments.length){var t=arguments[0];this._nodes=new Fe(t)}};qe.prototype.printEdges=function(t){t.println("Edges:");for(var e=0;e<this._edges.size();e++){t.println("edge "+e+":");var r=this._edges.get(e);r.print(t),r.eiList.print(t)}},qe.prototype.find=function(t){return this._nodes.find(t)},qe.prototype.addNode=function(){if(arguments[0]instanceof Ne){var t=arguments[0];return this._nodes.addNode(t)}if(arguments[0]instanceof x){var e=arguments[0];return this._nodes.addNode(e)}},qe.prototype.getNodeIterator=function(){return this._nodes.iterator()},qe.prototype.linkResultDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();)t.next().getEdges().linkResultDirectedEdges()},qe.prototype.debugPrintln=function(t){q.out.println(t)},qe.prototype.isBoundaryNode=function(t,e){var r=this._nodes.find(e);if(null===r)return!1;var n=r.getLabel();return null!==n&&n.getLocation(t)===k.BOUNDARY},qe.prototype.linkAllDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();)t.next().getEdges().linkAllDirectedEdges()},qe.prototype.matchInSameDirection=function(t,e,r,n){return!!t.equals(r)&&st.computeOrientation(t,e,n)===st.COLLINEAR&&ze.quadrant(t,e)===ze.quadrant(r,n)},qe.prototype.getEdgeEnds=function(){return this._edgeEndList},qe.prototype.debugPrint=function(t){q.out.print(t)},qe.prototype.getEdgeIterator=function(){return this._edges.iterator()},qe.prototype.findEdgeInSameDirection=function(t,e){for(var r=0;r<this._edges.size();r++){var n=this._edges.get(r),i=n.getCoordinates();if(this.matchInSameDirection(t,e,i[0],i[1]))return n;if(this.matchInSameDirection(t,e,i[i.length-1],i[i.length-2]))return n}return null},qe.prototype.insertEdge=function(t){this._edges.add(t)},qe.prototype.findEdgeEnd=function(t){for(var e=this.getEdgeEnds().iterator();e.hasNext();){var r=e.next();if(r.getEdge()===t)return r}return null},qe.prototype.addEdges=function(t){for(var e=t.iterator();e.hasNext();){var r=e.next();this._edges.add(r);var n=new Ve(r,!0),i=new Ve(r,!1);n.setSym(i),i.setSym(n),this.add(n),this.add(i)}},qe.prototype.add=function(t){this._nodes.add(t),this._edgeEndList.add(t)},qe.prototype.getNodes=function(){return this._nodes.values()},qe.prototype.findEdge=function(t,e){for(var r=0;r<this._edges.size();r++){var n=this._edges.get(r),i=n.getCoordinates();if(t.equals(i[0])&&e.equals(i[1]))return n}return null},qe.prototype.interfaces_=function(){return[]},qe.prototype.getClass=function(){return qe},qe.linkResultDirectedEdges=function(t){for(var e=t.iterator();e.hasNext();)e.next().getEdges().linkResultDirectedEdges()};var We=function(){this._geometryFactory=null,this._shellList=new Ot;var t=arguments[0];this._geometryFactory=t};We.prototype.sortShellsAndHoles=function(t,e,r){for(var n=t.iterator();n.hasNext();){var i=n.next();i.isHole()?r.add(i):e.add(i)}},We.prototype.computePolygons=function(t){for(var e=new Ot,r=t.iterator();r.hasNext();){var n=r.next().toPolygon(this._geometryFactory);e.add(n)}return e},We.prototype.placeFreeHoles=function(t,e){for(var r=e.iterator();r.hasNext();){var n=r.next();if(null===n.getShell()){var i=this.findEdgeRingContaining(n,t);if(null===i)throw new ke("unable to assign hole to a shell",n.getCoordinate(0));n.setShell(i)}}},We.prototype.buildMinimalEdgeRings=function(t,e,r){for(var n=new Ot,i=t.iterator();i.hasNext();){var o=i.next();if(o.getMaxNodeDegree()>2){o.linkDirectedEdgesForMinimalEdgeRings();var a=o.buildMinimalRings(),s=this.findShell(a);null!==s?(this.placePolygonHoles(s,a),e.add(s)):r.addAll(a)}else n.add(o)}return n},We.prototype.containsPoint=function(t){for(var e=this._shellList.iterator();e.hasNext();)if(e.next().containsPoint(t))return!0;return!1},We.prototype.buildMaximalEdgeRings=function(t){for(var e=new Ot,r=t.iterator();r.hasNext();){var n=r.next();if(n.isInResult()&&n.getLabel().isArea()&&null===n.getEdgeRing()){var i=new Ae(n,this._geometryFactory);e.add(i),i.setInResult()}}return e},We.prototype.placePolygonHoles=function(t,e){for(var r=e.iterator();r.hasNext();){var n=r.next();n.isHole()&&n.setShell(t)}},We.prototype.getPolygons=function(){return this.computePolygons(this._shellList)},We.prototype.findEdgeRingContaining=function(t,e){for(var r=t.getLinearRing(),n=r.getEnvelopeInternal(),i=r.getCoordinateN(0),o=null,a=null,s=e.iterator();s.hasNext();){var u=s.next(),l=u.getLinearRing(),c=l.getEnvelopeInternal();null!==o&&(a=o.getLinearRing().getEnvelopeInternal());var f=!1;c.contains(n)&&st.isPointInRing(i,l.getCoordinates())&&(f=!0),f&&(null===o||a.contains(c))&&(o=u)}return o},We.prototype.findShell=function(t){for(var e=0,r=null,n=t.iterator();n.hasNext();){var i=n.next();i.isHole()||(r=i,e++)}return et.isTrue(e<=1,"found two shells in MinimalEdgeRing list"),r},We.prototype.add=function(){if(1===arguments.length){var t=arguments[0];this.add(t.getEdgeEnds(),t.getNodes())}else if(2===arguments.length){var e=arguments[0];qe.linkResultDirectedEdges(arguments[1]);var r=this.buildMaximalEdgeRings(e),n=new Ot,i=this.buildMinimalEdgeRings(r,this._shellList,n);this.sortShellsAndHoles(i,this._shellList,n),this.placeFreeHoles(this._shellList,n)}},We.prototype.interfaces_=function(){return[]},We.prototype.getClass=function(){return We};var Xe=function(){};Xe.prototype.getBounds=function(){},Xe.prototype.interfaces_=function(){return[]},Xe.prototype.getClass=function(){return Xe};var Ze=function(){this._bounds=null,this._item=null;var t=arguments[0],e=arguments[1];this._bounds=t,this._item=e};Ze.prototype.getItem=function(){return this._item},Ze.prototype.getBounds=function(){return this._bounds},Ze.prototype.interfaces_=function(){return[Xe,e]},Ze.prototype.getClass=function(){return Ze};var He=function(){this._size=null,this._items=null,this._size=0,this._items=new Ot,this._items.add(null)};He.prototype.poll=function(){if(this.isEmpty())return null;var t=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),t},He.prototype.size=function(){return this._size},He.prototype.reorder=function(t){for(var e=null,r=this._items.get(t);2*t<=this._size&&((e=2*t)!==this._size&&this._items.get(e+1).compareTo(this._items.get(e))<0&&e++,this._items.get(e).compareTo(r)<0);t=e)this._items.set(t,this._items.get(e));this._items.set(t,r)},He.prototype.clear=function(){this._size=0,this._items.clear()},He.prototype.isEmpty=function(){return 0===this._size},He.prototype.add=function(t){this._items.add(null),this._size+=1;var e=this._size;for(this._items.set(0,t);t.compareTo(this._items.get(Math.trunc(e/2)))<0;e/=2)this._items.set(e,this._items.get(Math.trunc(e/2)));this._items.set(e,t)},He.prototype.interfaces_=function(){return[]},He.prototype.getClass=function(){return He};var Ye=function(){};Ye.prototype.visitItem=function(t){},Ye.prototype.interfaces_=function(){return[]},Ye.prototype.getClass=function(){return Ye};var Ke=function(){};Ke.prototype.insert=function(t,e){},Ke.prototype.remove=function(t,e){},Ke.prototype.query=function(){},Ke.prototype.interfaces_=function(){return[]},Ke.prototype.getClass=function(){return Ke};var Je=function(){if(this._childBoundables=new Ot,this._bounds=null,this._level=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this._level=t}},$e={serialVersionUID:{configurable:!0}};Je.prototype.getLevel=function(){return this._level},Je.prototype.size=function(){return this._childBoundables.size()},Je.prototype.getChildBoundables=function(){return this._childBoundables},Je.prototype.addChildBoundable=function(t){et.isTrue(null===this._bounds),this._childBoundables.add(t)},Je.prototype.isEmpty=function(){return this._childBoundables.isEmpty()},Je.prototype.getBounds=function(){return null===this._bounds&&(this._bounds=this.computeBounds()),this._bounds},Je.prototype.interfaces_=function(){return[Xe,e]},Je.prototype.getClass=function(){return Je},$e.serialVersionUID.get=function(){return 0x5a1e55ec41369800},Object.defineProperties(Je,$e);var Qe=function(){};Qe.reverseOrder=function(){return{compare:function(t,e){return e.compareTo(t)}}},Qe.min=function(t){return Qe.sort(t),t.get(0)},Qe.sort=function(t,e){var r=t.toArray();e?Nt.sort(r,e):Nt.sort(r);for(var n=t.iterator(),i=0,o=r.length;i<o;i++)n.next(),n.set(r[i])},Qe.singletonList=function(t){var e=new Ot;return e.add(t),e};var tr=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var t=arguments[0],e=arguments[1],r=arguments[2];this._boundable1=t,this._boundable2=e,this._itemDistance=r,this._distance=this.distance()};tr.prototype.expandToQueue=function(t,e){var r=tr.isComposite(this._boundable1),n=tr.isComposite(this._boundable2);if(r&&n)return tr.area(this._boundable1)>tr.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,t,e),null):(this.expand(this._boundable2,this._boundable1,t,e),null);if(r)return this.expand(this._boundable1,this._boundable2,t,e),null;if(n)return this.expand(this._boundable2,this._boundable1,t,e),null;throw new v("neither boundable is composite")},tr.prototype.isLeaves=function(){return!(tr.isComposite(this._boundable1)||tr.isComposite(this._boundable2))},tr.prototype.compareTo=function(t){var e=t;return this._distance<e._distance?-1:this._distance>e._distance?1:0},tr.prototype.expand=function(t,e,r,n){for(var i=t.getChildBoundables().iterator();i.hasNext();){var o=i.next(),a=new tr(o,e,this._itemDistance);a.getDistance()<n&&r.add(a)}},tr.prototype.getBoundable=function(t){return 0===t?this._boundable1:this._boundable2},tr.prototype.getDistance=function(){return this._distance},tr.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())},tr.prototype.interfaces_=function(){return[w]},tr.prototype.getClass=function(){return tr},tr.area=function(t){return t.getBounds().getArea()},tr.isComposite=function(t){return t instanceof Je};var er=function t(){if(this._root=null,this._built=!1,this._itemBoundables=new Ot,this._nodeCapacity=null,0===arguments.length){var e=t.DEFAULT_NODE_CAPACITY;this._nodeCapacity=e}else if(1===arguments.length){var r=arguments[0];et.isTrue(r>1,"Node capacity must be greater than 1"),this._nodeCapacity=r}},rr={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};er.prototype.getNodeCapacity=function(){return this._nodeCapacity},er.prototype.lastNode=function(t){return t.get(t.size()-1)},er.prototype.size=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this._root));if(1===arguments.length){for(var t=0,e=arguments[0].getChildBoundables().iterator();e.hasNext();){var r=e.next();r instanceof Je?t+=this.size(r):r instanceof Ze&&(t+=1)}return t}},er.prototype.removeItem=function(t,e){for(var r=null,n=t.getChildBoundables().iterator();n.hasNext();){var i=n.next();i instanceof Ze&&i.getItem()===e&&(r=i)}return null!==r&&(t.getChildBoundables().remove(r),!0)},er.prototype.itemsTree=function(){if(0===arguments.length){this.build();var t=this.itemsTree(this._root);return null===t?new Ot:t}if(1===arguments.length){for(var e=arguments[0],r=new Ot,n=e.getChildBoundables().iterator();n.hasNext();){var i=n.next();if(i instanceof Je){var o=this.itemsTree(i);null!==o&&r.add(o)}else i instanceof Ze?r.add(i.getItem()):et.shouldNeverReachHere()}return r.size()<=0?null:r}},er.prototype.insert=function(t,e){et.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Ze(t,e))},er.prototype.boundablesAtLevel=function(){if(1===arguments.length){var t=arguments[0],e=new Ot;return this.boundablesAtLevel(t,this._root,e),e}if(3===arguments.length){var r=arguments[0],n=arguments[1],i=arguments[2];if(et.isTrue(r>-2),n.getLevel()===r)return i.add(n),null;for(var o=n.getChildBoundables().iterator();o.hasNext();){var a=o.next();a instanceof Je?this.boundablesAtLevel(r,a,i):(et.isTrue(a instanceof Ze),-1===r&&i.add(a))}return null}},er.prototype.query=function(){if(1===arguments.length){var t=arguments[0];this.build();var e=new Ot;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.query(t,this._root,e),e}if(2===arguments.length){var r=arguments[0],n=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),r)&&this.query(r,this._root,n)}else if(3===arguments.length)if(j(arguments[2],Ye)&&arguments[0]instanceof Object&&arguments[1]instanceof Je)for(var i=arguments[0],o=arguments[2],a=arguments[1].getChildBoundables(),s=0;s<a.size();s++){var u=a.get(s);this.getIntersectsOp().intersects(u.getBounds(),i)&&(u instanceof Je?this.query(i,u,o):u instanceof Ze?o.visitItem(u.getItem()):et.shouldNeverReachHere())}else if(j(arguments[2],St)&&arguments[0]instanceof Object&&arguments[1]instanceof Je)for(var l=arguments[0],c=arguments[2],f=arguments[1].getChildBoundables(),p=0;p<f.size();p++){var h=f.get(p);this.getIntersectsOp().intersects(h.getBounds(),l)&&(h instanceof Je?this.query(l,h,c):h instanceof Ze?c.add(h.getItem()):et.shouldNeverReachHere())}},er.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0},er.prototype.getRoot=function(){return this.build(),this._root},er.prototype.remove=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.remove(t,this._root,e)}if(3===arguments.length){var r=arguments[0],n=arguments[1],i=arguments[2],o=this.removeItem(n,i);if(o)return!0;for(var a=null,s=n.getChildBoundables().iterator();s.hasNext();){var u=s.next();if(this.getIntersectsOp().intersects(u.getBounds(),r)&&u instanceof Je&&(o=this.remove(r,u,i))){a=u;break}}return null!==a&&a.getChildBoundables().isEmpty()&&n.getChildBoundables().remove(a),o}},er.prototype.createHigherLevels=function(t,e){et.isTrue(!t.isEmpty());var r=this.createParentBoundables(t,e+1);return 1===r.size()?r.get(0):this.createHigherLevels(r,e+1)},er.prototype.depth=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(1===arguments.length){for(var t=0,e=arguments[0].getChildBoundables().iterator();e.hasNext();){var r=e.next();if(r instanceof Je){var n=this.depth(r);n>t&&(t=n)}}return t+1}},er.prototype.createParentBoundables=function(t,e){et.isTrue(!t.isEmpty());var r=new Ot;r.add(this.createNode(e));var n=new Ot(t);Qe.sort(n,this.getComparator());for(var i=n.iterator();i.hasNext();){var o=i.next();this.lastNode(r).getChildBoundables().size()===this.getNodeCapacity()&&r.add(this.createNode(e)),this.lastNode(r).addChildBoundable(o)}return r},er.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()},er.prototype.interfaces_=function(){return[e]},er.prototype.getClass=function(){return er},er.compareDoubles=function(t,e){return t>e?1:t<e?-1:0},rr.IntersectsOp.get=function(){return nr},rr.serialVersionUID.get=function(){return-0x35ef64c82d4c5400},rr.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(er,rr);var nr=function(){},ir=function(){};ir.prototype.distance=function(t,e){},ir.prototype.interfaces_=function(){return[]},ir.prototype.getClass=function(){return ir};var or=function(t){function r(e){e=e||r.DEFAULT_NODE_CAPACITY,t.call(this,e)}t&&(r.__proto__=t),(r.prototype=Object.create(t&&t.prototype)).constructor=r;var n={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return r.prototype.createParentBoundablesFromVerticalSlices=function(t,e){et.isTrue(t.length>0);for(var r=new Ot,n=0;n<t.length;n++)r.addAll(this.createParentBoundablesFromVerticalSlice(t[n],e));return r},r.prototype.createNode=function(t){return new ar(t)},r.prototype.size=function(){return 0===arguments.length?t.prototype.size.call(this):t.prototype.size.apply(this,arguments)},r.prototype.insert=function(){if(2!==arguments.length)return t.prototype.insert.apply(this,arguments);var e=arguments[0],r=arguments[1];if(e.isNull())return null;t.prototype.insert.call(this,e,r)},r.prototype.getIntersectsOp=function(){return r.intersectsOp},r.prototype.verticalSlices=function(t,e){for(var r=Math.trunc(Math.ceil(t.size()/e)),n=new Array(e).fill(null),i=t.iterator(),o=0;o<e;o++){n[o]=new Ot;for(var a=0;i.hasNext()&&a<r;){var s=i.next();n[o].add(s),a++}}return n},r.prototype.query=function(){if(1===arguments.length){var e=arguments[0];return t.prototype.query.call(this,e)}if(2===arguments.length){var r=arguments[0],n=arguments[1];t.prototype.query.call(this,r,n)}else if(3===arguments.length)if(j(arguments[2],Ye)&&arguments[0]instanceof Object&&arguments[1]instanceof Je){var i=arguments[0],o=arguments[1],a=arguments[2];t.prototype.query.call(this,i,o,a)}else if(j(arguments[2],St)&&arguments[0]instanceof Object&&arguments[1]instanceof Je){var s=arguments[0],u=arguments[1],l=arguments[2];t.prototype.query.call(this,s,u,l)}},r.prototype.getComparator=function(){return r.yComparator},r.prototype.createParentBoundablesFromVerticalSlice=function(e,r){return t.prototype.createParentBoundables.call(this,e,r)},r.prototype.remove=function(){if(2===arguments.length){var e=arguments[0],r=arguments[1];return t.prototype.remove.call(this,e,r)}return t.prototype.remove.apply(this,arguments)},r.prototype.depth=function(){return 0===arguments.length?t.prototype.depth.call(this):t.prototype.depth.apply(this,arguments)},r.prototype.createParentBoundables=function(t,e){et.isTrue(!t.isEmpty());var n=Math.trunc(Math.ceil(t.size()/this.getNodeCapacity())),i=new Ot(t);Qe.sort(i,r.xComparator);var o=this.verticalSlices(i,Math.trunc(Math.ceil(Math.sqrt(n))));return this.createParentBoundablesFromVerticalSlices(o,e)},r.prototype.nearestNeighbour=function(){if(1===arguments.length){if(j(arguments[0],ir)){var t=arguments[0],e=new tr(this.getRoot(),this.getRoot(),t);return this.nearestNeighbour(e)}if(arguments[0]instanceof tr){var n=arguments[0];return this.nearestNeighbour(n,_.POSITIVE_INFINITY)}}else if(2===arguments.length){if(arguments[0]instanceof r&&j(arguments[1],ir)){var i=arguments[0],o=arguments[1],a=new tr(this.getRoot(),i.getRoot(),o);return this.nearestNeighbour(a)}if(arguments[0]instanceof tr&&"number"==typeof arguments[1]){var s=arguments[0],u=arguments[1],l=null,c=new He;for(c.add(s);!c.isEmpty()&&u>0;){var f=c.poll(),p=f.getDistance();if(p>=u)break;f.isLeaves()?(u=p,l=f):f.expandToQueue(c,u)}return[l.getBoundable(0).getItem(),l.getBoundable(1).getItem()]}}else if(3===arguments.length){var h=arguments[2],y=new Ze(arguments[0],arguments[1]),d=new tr(this.getRoot(),y,h);return this.nearestNeighbour(d)[0]}},r.prototype.interfaces_=function(){return[Ke,e]},r.prototype.getClass=function(){return r},r.centreX=function(t){return r.avg(t.getMinX(),t.getMaxX())},r.avg=function(t,e){return(t+e)/2},r.centreY=function(t){return r.avg(t.getMinY(),t.getMaxY())},n.STRtreeNode.get=function(){return ar},n.serialVersionUID.get=function(){return 0x39920f7d5f261e0},n.xComparator.get=function(){return{interfaces_:function(){return[O]},compare:function(e,n){return t.compareDoubles(r.centreX(e.getBounds()),r.centreX(n.getBounds()))}}},n.yComparator.get=function(){return{interfaces_:function(){return[O]},compare:function(e,n){return t.compareDoubles(r.centreY(e.getBounds()),r.centreY(n.getBounds()))}}},n.intersectsOp.get=function(){return{interfaces_:function(){return[t.IntersectsOp]},intersects:function(t,e){return t.intersects(e)}}},n.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(r,n),r}(er),ar=function(t){function e(){var e=arguments[0];t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.computeBounds=function(){for(var t=null,e=this.getChildBoundables().iterator();e.hasNext();){var r=e.next();null===t?t=new X(r.getBounds()):t.expandToInclude(r.getBounds())}return t},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Je),sr=function(){};sr.prototype.interfaces_=function(){return[]},sr.prototype.getClass=function(){return sr},sr.relativeSign=function(t,e){return t<e?-1:t>e?1:0},sr.compare=function(t,e,r){if(e.equals2D(r))return 0;var n=sr.relativeSign(e.x,r.x),i=sr.relativeSign(e.y,r.y);switch(t){case 0:return sr.compareValue(n,i);case 1:return sr.compareValue(i,n);case 2:return sr.compareValue(i,-n);case 3:return sr.compareValue(-n,i);case 4:return sr.compareValue(-n,-i);case 5:return sr.compareValue(-i,-n);case 6:return sr.compareValue(-i,n);case 7:return sr.compareValue(n,-i)}return et.shouldNeverReachHere("invalid octant value"),0},sr.compareValue=function(t,e){return t<0?-1:t>0?1:e<0?-1:e>0?1:0};var ur=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var t=arguments[0],e=arguments[1],r=arguments[2],n=arguments[3];this._segString=t,this.coord=new x(e),this.segmentIndex=r,this._segmentOctant=n,this._isInterior=!e.equals2D(t.getCoordinate(r))};ur.prototype.getCoordinate=function(){return this.coord},ur.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex)},ur.prototype.compareTo=function(t){var e=t;return this.segmentIndex<e.segmentIndex?-1:this.segmentIndex>e.segmentIndex?1:this.coord.equals2D(e.coord)?0:sr.compare(this._segmentOctant,this.coord,e.coord)},ur.prototype.isEndPoint=function(t){return 0===this.segmentIndex&&!this._isInterior||this.segmentIndex===t},ur.prototype.isInterior=function(){return this._isInterior},ur.prototype.interfaces_=function(){return[w]},ur.prototype.getClass=function(){return ur};var lr=function(){this._nodeMap=new f,this._edge=null;var t=arguments[0];this._edge=t};lr.prototype.getSplitCoordinates=function(){var t=new Ct;this.addEndpoints();for(var e=this.iterator(),r=e.next();e.hasNext();){var n=e.next();this.addEdgeCoordinates(r,n,t),r=n}return t.toCoordinateArray()},lr.prototype.addCollapsedNodes=function(){var t=new Ot;this.findCollapsesFromInsertedNodes(t),this.findCollapsesFromExistingVertices(t);for(var e=t.iterator();e.hasNext();){var r=e.next().intValue();this.add(this._edge.getCoordinate(r),r)}},lr.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();)e.next().print(t)},lr.prototype.findCollapsesFromExistingVertices=function(t){for(var e=0;e<this._edge.size()-2;e++){var r=this._edge.getCoordinate(e),n=this._edge.getCoordinate(e+2);r.equals2D(n)&&t.add(new M(e+1))}},lr.prototype.addEdgeCoordinates=function(t,e,r){var n=this._edge.getCoordinate(e.segmentIndex),i=e.isInterior()||!e.coord.equals2D(n);r.add(new x(t.coord),!1);for(var o=t.segmentIndex+1;o<=e.segmentIndex;o++)r.add(this._edge.getCoordinate(o));i&&r.add(new x(e.coord))},lr.prototype.iterator=function(){return this._nodeMap.values().iterator()},lr.prototype.addSplitEdges=function(t){this.addEndpoints(),this.addCollapsedNodes();for(var e=this.iterator(),r=e.next();e.hasNext();){var n=e.next(),i=this.createSplitEdge(r,n);t.add(i),r=n}},lr.prototype.findCollapseIndex=function(t,e,r){if(!t.coord.equals2D(e.coord))return!1;var n=e.segmentIndex-t.segmentIndex;return e.isInterior()||n--,1===n&&(r[0]=t.segmentIndex+1,!0)},lr.prototype.findCollapsesFromInsertedNodes=function(t){for(var e=new Array(1).fill(null),r=this.iterator(),n=r.next();r.hasNext();){var i=r.next();this.findCollapseIndex(n,i,e)&&t.add(new M(e[0])),n=i}},lr.prototype.getEdge=function(){return this._edge},lr.prototype.addEndpoints=function(){var t=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(t),t)},lr.prototype.createSplitEdge=function(t,e){var r=e.segmentIndex-t.segmentIndex+2,n=this._edge.getCoordinate(e.segmentIndex),i=e.isInterior()||!e.coord.equals2D(n);i||r--;var o=new Array(r).fill(null),a=0;o[a++]=new x(t.coord);for(var s=t.segmentIndex+1;s<=e.segmentIndex;s++)o[a++]=this._edge.getCoordinate(s);return i&&(o[a]=new x(e.coord)),new hr(o,this._edge.getData())},lr.prototype.add=function(t,e){var r=new ur(this._edge,t,e,this._edge.getSegmentOctant(e)),n=this._nodeMap.get(r);return null!==n?(et.isTrue(n.coord.equals2D(t),"Found equal nodes with different coordinates"),n):(this._nodeMap.put(r,r),r)},lr.prototype.checkSplitEdgesCorrectness=function(t){var e=this._edge.getCoordinates(),r=t.get(0).getCoordinate(0);if(!r.equals2D(e[0]))throw new Q("bad split edge start point at "+r);var n=t.get(t.size()-1).getCoordinates(),i=n[n.length-1];if(!i.equals2D(e[e.length-1]))throw new Q("bad split edge end point at "+i)},lr.prototype.interfaces_=function(){return[]},lr.prototype.getClass=function(){return lr};var cr=function(){};cr.prototype.interfaces_=function(){return[]},cr.prototype.getClass=function(){return cr},cr.octant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1];if(0===t&&0===e)throw new v("Cannot compute the octant for point ( "+t+", "+e+" )");var r=Math.abs(t),n=Math.abs(e);return t>=0?e>=0?r>=n?0:1:r>=n?7:6:e>=0?r>=n?3:2:r>=n?4:5}if(arguments[0]instanceof x&&arguments[1]instanceof x){var i=arguments[0],o=arguments[1],a=o.x-i.x,s=o.y-i.y;if(0===a&&0===s)throw new v("Cannot compute the octant for two identical points "+i);return cr.octant(a,s)}};var fr=function(){};fr.prototype.getCoordinates=function(){},fr.prototype.size=function(){},fr.prototype.getCoordinate=function(t){},fr.prototype.isClosed=function(){},fr.prototype.setData=function(t){},fr.prototype.getData=function(){},fr.prototype.interfaces_=function(){return[]},fr.prototype.getClass=function(){return fr};var pr=function(){};pr.prototype.addIntersection=function(t,e){},pr.prototype.interfaces_=function(){return[fr]},pr.prototype.getClass=function(){return pr};var hr=function(){this._nodeList=new lr(this),this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e};hr.prototype.getCoordinates=function(){return this._pts},hr.prototype.size=function(){return this._pts.length},hr.prototype.getCoordinate=function(t){return this._pts[t]},hr.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},hr.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(t),this.getCoordinate(t+1))},hr.prototype.setData=function(t){this._data=t},hr.prototype.safeOctant=function(t,e){return t.equals2D(e)?0:cr.octant(t,e)},hr.prototype.getData=function(){return this._data},hr.prototype.addIntersection=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];this.addIntersectionNode(t,e)}else if(4===arguments.length){var r=arguments[1],n=arguments[3],i=new x(arguments[0].getIntersection(n));this.addIntersection(i,r)}},hr.prototype.toString=function(){return $.toLineString(new ue(this._pts))},hr.prototype.getNodeList=function(){return this._nodeList},hr.prototype.addIntersectionNode=function(t,e){var r=e,n=r+1;if(n<this._pts.length){var i=this._pts[n];t.equals2D(i)&&(r=n)}return this._nodeList.add(t,r)},hr.prototype.addIntersections=function(t,e,r){for(var n=0;n<t.getIntersectionNum();n++)this.addIntersection(t,e,r,n)},hr.prototype.interfaces_=function(){return[pr]},hr.prototype.getClass=function(){return hr},hr.getNodedSubstrings=function(){if(1===arguments.length){var t=arguments[0],e=new Ot;return hr.getNodedSubstrings(t,e),e}if(2===arguments.length)for(var r=arguments[1],n=arguments[0].iterator();n.hasNext();)n.next().getNodeList().addSplitEdges(r)};var yr=function(){if(this.p0=null,this.p1=null,0===arguments.length)this.p0=new x,this.p1=new x;else if(1===arguments.length){var t=arguments[0];this.p0=new x(t.p0),this.p1=new x(t.p1)}else if(2===arguments.length)this.p0=arguments[0],this.p1=arguments[1];else if(4===arguments.length){var e=arguments[0],r=arguments[1],n=arguments[2],i=arguments[3];this.p0=new x(e,r),this.p1=new x(n,i)}},dr={serialVersionUID:{configurable:!0}};yr.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)},yr.prototype.orientationIndex=function(){if(arguments[0]instanceof yr){var t=arguments[0],e=st.orientationIndex(this.p0,this.p1,t.p0),r=st.orientationIndex(this.p0,this.p1,t.p1);return e>=0&&r>=0||e<=0&&r<=0?Math.max(e,r):0}if(arguments[0]instanceof x){var n=arguments[0];return st.orientationIndex(this.p0,this.p1,n)}},yr.prototype.toGeometry=function(t){return t.createLineString([this.p0,this.p1])},yr.prototype.isVertical=function(){return this.p0.x===this.p1.x},yr.prototype.equals=function(t){if(!(t instanceof yr))return!1;var e=t;return this.p0.equals(e.p0)&&this.p1.equals(e.p1)},yr.prototype.intersection=function(t){var e=new it;return e.computeIntersection(this.p0,this.p1,t.p0,t.p1),e.hasIntersection()?e.getIntersection(0):null},yr.prototype.project=function(){if(arguments[0]instanceof x){var t=arguments[0];if(t.equals(this.p0)||t.equals(this.p1))return new x(t);var e=this.projectionFactor(t),r=new x;return r.x=this.p0.x+e*(this.p1.x-this.p0.x),r.y=this.p0.y+e*(this.p1.y-this.p0.y),r}if(arguments[0]instanceof yr){var n=arguments[0],i=this.projectionFactor(n.p0),o=this.projectionFactor(n.p1);if(i>=1&&o>=1)return null;if(i<=0&&o<=0)return null;var a=this.project(n.p0);i<0&&(a=this.p0),i>1&&(a=this.p1);var s=this.project(n.p1);return o<0&&(s=this.p0),o>1&&(s=this.p1),new yr(a,s)}},yr.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()},yr.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)},yr.prototype.getCoordinate=function(t){return 0===t?this.p0:this.p1},yr.prototype.distancePerpendicular=function(t){return st.distancePointLinePerpendicular(t,this.p0,this.p1)},yr.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)},yr.prototype.midPoint=function(){return yr.midPoint(this.p0,this.p1)},yr.prototype.projectionFactor=function(t){if(t.equals(this.p0))return 0;if(t.equals(this.p1))return 1;var e=this.p1.x-this.p0.x,r=this.p1.y-this.p0.y,n=e*e+r*r;return n<=0?_.NaN:((t.x-this.p0.x)*e+(t.y-this.p0.y)*r)/n},yr.prototype.closestPoints=function(t){var e=this.intersection(t);if(null!==e)return[e,e];var r=new Array(2).fill(null),n=_.MAX_VALUE,i=null,o=this.closestPoint(t.p0);n=o.distance(t.p0),r[0]=o,r[1]=t.p0;var a=this.closestPoint(t.p1);(i=a.distance(t.p1))<n&&(n=i,r[0]=a,r[1]=t.p1);var s=t.closestPoint(this.p0);(i=s.distance(this.p0))<n&&(n=i,r[0]=this.p0,r[1]=s);var u=t.closestPoint(this.p1);return(i=u.distance(this.p1))<n&&(n=i,r[0]=this.p1,r[1]=u),r},yr.prototype.closestPoint=function(t){var e=this.projectionFactor(t);return e>0&&e<1?this.project(t):this.p0.distance(t)<this.p1.distance(t)?this.p0:this.p1},yr.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)},yr.prototype.getLength=function(){return this.p0.distance(this.p1)},yr.prototype.compareTo=function(t){var e=t,r=this.p0.compareTo(e.p0);return 0!==r?r:this.p1.compareTo(e.p1)},yr.prototype.reverse=function(){var t=this.p0;this.p0=this.p1,this.p1=t},yr.prototype.equalsTopo=function(t){return this.p0.equals(t.p0)&&(this.p1.equals(t.p1)||this.p0.equals(t.p1))&&this.p1.equals(t.p0)},yr.prototype.lineIntersection=function(t){try{return W.intersection(this.p0,this.p1,t.p0,t.p1)}catch(t){if(!(t instanceof U))throw t}return null},yr.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)},yr.prototype.pointAlongOffset=function(t,e){var r=this.p0.x+t*(this.p1.x-this.p0.x),n=this.p0.y+t*(this.p1.y-this.p0.y),i=this.p1.x-this.p0.x,o=this.p1.y-this.p0.y,a=Math.sqrt(i*i+o*o),s=0,u=0;if(0!==e){if(a<=0)throw new Error("Cannot compute offset from zero-length line segment");s=e*i/a,u=e*o/a}return new x(r-u,n+s)},yr.prototype.setCoordinates=function(){if(1===arguments.length){var t=arguments[0];this.setCoordinates(t.p0,t.p1)}else if(2===arguments.length){var e=arguments[0],r=arguments[1];this.p0.x=e.x,this.p0.y=e.y,this.p1.x=r.x,this.p1.y=r.y}},yr.prototype.segmentFraction=function(t){var e=this.projectionFactor(t);return e<0?e=0:(e>1||_.isNaN(e))&&(e=1),e},yr.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"},yr.prototype.isHorizontal=function(){return this.p0.y===this.p1.y},yr.prototype.distance=function(){if(arguments[0]instanceof yr){var t=arguments[0];return st.distanceLineLine(this.p0,this.p1,t.p0,t.p1)}if(arguments[0]instanceof x){var e=arguments[0];return st.distancePointLine(e,this.p0,this.p1)}},yr.prototype.pointAlong=function(t){var e=new x;return e.x=this.p0.x+t*(this.p1.x-this.p0.x),e.y=this.p0.y+t*(this.p1.y-this.p0.y),e},yr.prototype.hashCode=function(){var t=_.doubleToLongBits(this.p0.x);t^=31*_.doubleToLongBits(this.p0.y);var e=Math.trunc(t)^Math.trunc(t>>32),r=_.doubleToLongBits(this.p1.x);return r^=31*_.doubleToLongBits(this.p1.y),e^Math.trunc(r)^Math.trunc(r>>32)},yr.prototype.interfaces_=function(){return[w,e]},yr.prototype.getClass=function(){return yr},yr.midPoint=function(t,e){return new x((t.x+e.x)/2,(t.y+e.y)/2)},dr.serialVersionUID.get=function(){return 0x2d2172135f411c00},Object.defineProperties(yr,dr);var gr=function(){this.tempEnv1=new X,this.tempEnv2=new X,this._overlapSeg1=new yr,this._overlapSeg2=new yr};gr.prototype.overlap=function(){if(2===arguments.length);else if(4===arguments.length){var t=arguments[1],e=arguments[2],r=arguments[3];arguments[0].getLineSegment(t,this._overlapSeg1),e.getLineSegment(r,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}},gr.prototype.interfaces_=function(){return[]},gr.prototype.getClass=function(){return gr};var mr=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var t=arguments[0],e=arguments[1],r=arguments[2],n=arguments[3];this._pts=t,this._start=e,this._end=r,this._context=n};mr.prototype.getLineSegment=function(t,e){e.p0=this._pts[t],e.p1=this._pts[t+1]},mr.prototype.computeSelect=function(t,e,r,n){var i=this._pts[e],o=this._pts[r];if(n.tempEnv1.init(i,o),r-e==1)return n.select(this,e),null;if(!t.intersects(n.tempEnv1))return null;var a=Math.trunc((e+r)/2);e<a&&this.computeSelect(t,e,a,n),a<r&&this.computeSelect(t,a,r,n)},mr.prototype.getCoordinates=function(){for(var t=new Array(this._end-this._start+1).fill(null),e=0,r=this._start;r<=this._end;r++)t[e++]=this._pts[r];return t},mr.prototype.computeOverlaps=function(t,e){this.computeOverlapsInternal(this._start,this._end,t,t._start,t._end,e)},mr.prototype.setId=function(t){this._id=t},mr.prototype.select=function(t,e){this.computeSelect(t,this._start,this._end,e)},mr.prototype.getEnvelope=function(){if(null===this._env){var t=this._pts[this._start],e=this._pts[this._end];this._env=new X(t,e)}return this._env},mr.prototype.getEndIndex=function(){return this._end},mr.prototype.getStartIndex=function(){return this._start},mr.prototype.getContext=function(){return this._context},mr.prototype.getId=function(){return this._id},mr.prototype.computeOverlapsInternal=function(t,e,r,n,i,o){var a=this._pts[t],s=this._pts[e],u=r._pts[n],l=r._pts[i];if(e-t==1&&i-n==1)return o.overlap(this,t,r,n),null;if(o.tempEnv1.init(a,s),o.tempEnv2.init(u,l),!o.tempEnv1.intersects(o.tempEnv2))return null;var c=Math.trunc((t+e)/2),f=Math.trunc((n+i)/2);t<c&&(n<f&&this.computeOverlapsInternal(t,c,r,n,f,o),f<i&&this.computeOverlapsInternal(t,c,r,f,i,o)),c<e&&(n<f&&this.computeOverlapsInternal(c,e,r,n,f,o),f<i&&this.computeOverlapsInternal(c,e,r,f,i,o))},mr.prototype.interfaces_=function(){return[]},mr.prototype.getClass=function(){return mr};var vr=function(){};vr.prototype.interfaces_=function(){return[]},vr.prototype.getClass=function(){return vr},vr.getChainStartIndices=function(t){var e=0,r=new Ot;r.add(new M(e));do{var n=vr.findChainEnd(t,e);r.add(new M(n)),e=n}while(e<t.length-1);return vr.toIntArray(r)},vr.findChainEnd=function(t,e){for(var r=e;r<t.length-1&&t[r].equals2D(t[r+1]);)r++;if(r>=t.length-1)return t.length-1;for(var n=ze.quadrant(t[r],t[r+1]),i=e+1;i<t.length&&(t[i-1].equals2D(t[i])||ze.quadrant(t[i-1],t[i])===n);)i++;return i-1},vr.getChains=function(){if(1===arguments.length)return vr.getChains(arguments[0],null);if(2===arguments.length){for(var t=arguments[0],e=arguments[1],r=new Ot,n=vr.getChainStartIndices(t),i=0;i<n.length-1;i++){var o=new mr(t,n[i],n[i+1],e);r.add(o)}return r}},vr.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),r=0;r<e.length;r++)e[r]=t.get(r).intValue();return e};var _r=function(){};_r.prototype.computeNodes=function(t){},_r.prototype.getNodedSubstrings=function(){},_r.prototype.interfaces_=function(){return[]},_r.prototype.getClass=function(){return _r};var br=function(){if(this._segInt=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.setSegmentIntersector(t)}};br.prototype.setSegmentIntersector=function(t){this._segInt=t},br.prototype.interfaces_=function(){return[_r]},br.prototype.getClass=function(){return br};var wr=function(t){function e(e){e?t.call(this,e):t.call(this),this._monoChains=new Ot,this._index=new or,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={SegmentOverlapAction:{configurable:!0}};return e.prototype.getMonotoneChains=function(){return this._monoChains},e.prototype.getNodedSubstrings=function(){return hr.getNodedSubstrings(this._nodedSegStrings)},e.prototype.getIndex=function(){return this._index},e.prototype.add=function(t){for(var e=vr.getChains(t.getCoordinates(),t).iterator();e.hasNext();){var r=e.next();r.setId(this._idCounter++),this._index.insert(r.getEnvelope(),r),this._monoChains.add(r)}},e.prototype.computeNodes=function(t){this._nodedSegStrings=t;for(var e=t.iterator();e.hasNext();)this.add(e.next());this.intersectChains()},e.prototype.intersectChains=function(){for(var t=new Sr(this._segInt),e=this._monoChains.iterator();e.hasNext();)for(var r=e.next(),n=this._index.query(r.getEnvelope()).iterator();n.hasNext();){var i=n.next();if(i.getId()>r.getId()&&(r.computeOverlaps(i,t),this._nOverlaps++),this._segInt.isDone())return null}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},r.SegmentOverlapAction.get=function(){return Sr},Object.defineProperties(e,r),e}(br),Sr=function(t){function e(){t.call(this),this._si=null;var e=arguments[0];this._si=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.overlap=function(){if(4!==arguments.length)return t.prototype.overlap.apply(this,arguments);var e=arguments[1],r=arguments[2],n=arguments[3],i=arguments[0].getContext(),o=r.getContext();this._si.processIntersections(i,e,o,n)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(gr),Or=function t(){if(this._quadrantSegments=t.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=t.CAP_ROUND,this._joinStyle=t.JOIN_ROUND,this._mitreLimit=t.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=t.DEFAULT_SIMPLIFY_FACTOR,0===arguments.length);else if(1===arguments.length){var e=arguments[0];this.setQuadrantSegments(e)}else if(2===arguments.length){var r=arguments[0],n=arguments[1];this.setQuadrantSegments(r),this.setEndCapStyle(n)}else if(4===arguments.length){var i=arguments[0],o=arguments[1],a=arguments[2],s=arguments[3];this.setQuadrantSegments(i),this.setEndCapStyle(o),this.setJoinStyle(a),this.setMitreLimit(s)}},xr={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};Or.prototype.getEndCapStyle=function(){return this._endCapStyle},Or.prototype.isSingleSided=function(){return this._isSingleSided},Or.prototype.setQuadrantSegments=function(t){this._quadrantSegments=t,0===this._quadrantSegments&&(this._joinStyle=Or.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=Or.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),t<=0&&(this._quadrantSegments=1),this._joinStyle!==Or.JOIN_ROUND&&(this._quadrantSegments=Or.DEFAULT_QUADRANT_SEGMENTS)},Or.prototype.getJoinStyle=function(){return this._joinStyle},Or.prototype.setJoinStyle=function(t){this._joinStyle=t},Or.prototype.setSimplifyFactor=function(t){this._simplifyFactor=t<0?0:t},Or.prototype.getSimplifyFactor=function(){return this._simplifyFactor},Or.prototype.getQuadrantSegments=function(){return this._quadrantSegments},Or.prototype.setEndCapStyle=function(t){this._endCapStyle=t},Or.prototype.getMitreLimit=function(){return this._mitreLimit},Or.prototype.setMitreLimit=function(t){this._mitreLimit=t},Or.prototype.setSingleSided=function(t){this._isSingleSided=t},Or.prototype.interfaces_=function(){return[]},Or.prototype.getClass=function(){return Or},Or.bufferDistanceError=function(t){var e=Math.PI/2/t;return 1-Math.cos(e/2)},xr.CAP_ROUND.get=function(){return 1},xr.CAP_FLAT.get=function(){return 2},xr.CAP_SQUARE.get=function(){return 3},xr.JOIN_ROUND.get=function(){return 1},xr.JOIN_MITRE.get=function(){return 2},xr.JOIN_BEVEL.get=function(){return 3},xr.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8},xr.DEFAULT_MITRE_LIMIT.get=function(){return 5},xr.DEFAULT_SIMPLIFY_FACTOR.get=function(){return.01},Object.defineProperties(Or,xr);var Cr=function(t){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=st.COUNTERCLOCKWISE,this._inputLine=t||null},Er={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};Cr.prototype.isDeletable=function(t,e,r,n){var i=this._inputLine[t],o=this._inputLine[e],a=this._inputLine[r];return!!this.isConcave(i,o,a)&&!!this.isShallow(i,o,a,n)&&this.isShallowSampled(i,o,t,r,n)},Cr.prototype.deleteShallowConcavities=function(){for(var t=1,e=this.findNextNonDeletedIndex(t),r=this.findNextNonDeletedIndex(e),n=!1;r<this._inputLine.length;){var i=!1;this.isDeletable(t,e,r,this._distanceTol)&&(this._isDeleted[e]=Cr.DELETE,i=!0,n=!0),t=i?r:e,e=this.findNextNonDeletedIndex(t),r=this.findNextNonDeletedIndex(e)}return n},Cr.prototype.isShallowConcavity=function(t,e,r,n){return st.computeOrientation(t,e,r)===this._angleOrientation&&st.distancePointLine(e,t,r)<n},Cr.prototype.isShallowSampled=function(t,e,r,n,i){var o=Math.trunc((n-r)/Cr.NUM_PTS_TO_CHECK);o<=0&&(o=1);for(var a=r;a<n;a+=o)if(!this.isShallow(t,e,this._inputLine[a],i))return!1;return!0},Cr.prototype.isConcave=function(t,e,r){return st.computeOrientation(t,e,r)===this._angleOrientation},Cr.prototype.simplify=function(t){this._distanceTol=Math.abs(t),t<0&&(this._angleOrientation=st.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var e=!1;do{e=this.deleteShallowConcavities()}while(e);return this.collapseLine()},Cr.prototype.findNextNonDeletedIndex=function(t){for(var e=t+1;e<this._inputLine.length&&this._isDeleted[e]===Cr.DELETE;)e++;return e},Cr.prototype.isShallow=function(t,e,r,n){return st.distancePointLine(e,t,r)<n},Cr.prototype.collapseLine=function(){for(var t=new Ct,e=0;e<this._inputLine.length;e++)this._isDeleted[e]!==Cr.DELETE&&t.add(this._inputLine[e]);return t.toCoordinateArray()},Cr.prototype.interfaces_=function(){return[]},Cr.prototype.getClass=function(){return Cr},Cr.simplify=function(t,e){return new Cr(t).simplify(e)},Er.INIT.get=function(){return 0},Er.DELETE.get=function(){return 1},Er.KEEP.get=function(){return 1},Er.NUM_PTS_TO_CHECK.get=function(){return 10},Object.defineProperties(Cr,Er);var Pr=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new Ot},kr={COORDINATE_ARRAY_TYPE:{configurable:!0}};Pr.prototype.getCoordinates=function(){return this._ptList.toArray(Pr.COORDINATE_ARRAY_TYPE)},Pr.prototype.setPrecisionModel=function(t){this._precisionModel=t},Pr.prototype.addPt=function(t){var e=new x(t);if(this._precisionModel.makePrecise(e),this.isRedundant(e))return null;this._ptList.add(e)},Pr.prototype.revere=function(){},Pr.prototype.addPts=function(t,e){if(e)for(var r=0;r<t.length;r++)this.addPt(t[r]);else for(var n=t.length-1;n>=0;n--)this.addPt(t[n])},Pr.prototype.isRedundant=function(t){if(this._ptList.size()<1)return!1;var e=this._ptList.get(this._ptList.size()-1);return t.distance(e)<this._minimimVertexDistance},Pr.prototype.toString=function(){return(new me).createLineString(this.getCoordinates()).toString()},Pr.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var t=new x(this._ptList.get(0)),e=this._ptList.get(this._ptList.size()-1);if(t.equals(e))return null;this._ptList.add(t)},Pr.prototype.setMinimumVertexDistance=function(t){this._minimimVertexDistance=t},Pr.prototype.interfaces_=function(){return[]},Pr.prototype.getClass=function(){return Pr},kr.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)},Object.defineProperties(Pr,kr);var Tr=function(){},jr={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};Tr.prototype.interfaces_=function(){return[]},Tr.prototype.getClass=function(){return Tr},Tr.toDegrees=function(t){return 180*t/Math.PI},Tr.normalize=function(t){for(;t>Math.PI;)t-=Tr.PI_TIMES_2;for(;t<=-Math.PI;)t+=Tr.PI_TIMES_2;return t},Tr.angle=function(){if(1===arguments.length){var t=arguments[0];return Math.atan2(t.y,t.x)}if(2===arguments.length){var e=arguments[0],r=arguments[1],n=r.x-e.x,i=r.y-e.y;return Math.atan2(i,n)}},Tr.isAcute=function(t,e,r){var n=t.x-e.x,i=t.y-e.y;return n*(r.x-e.x)+i*(r.y-e.y)>0},Tr.isObtuse=function(t,e,r){var n=t.x-e.x,i=t.y-e.y;return n*(r.x-e.x)+i*(r.y-e.y)<0},Tr.interiorAngle=function(t,e,r){var n=Tr.angle(e,t),i=Tr.angle(e,r);return Math.abs(i-n)},Tr.normalizePositive=function(t){if(t<0){for(;t<0;)t+=Tr.PI_TIMES_2;t>=Tr.PI_TIMES_2&&(t=0)}else{for(;t>=Tr.PI_TIMES_2;)t-=Tr.PI_TIMES_2;t<0&&(t=0)}return t},Tr.angleBetween=function(t,e,r){var n=Tr.angle(e,t),i=Tr.angle(e,r);return Tr.diff(n,i)},Tr.diff=function(t,e){var r=null;return(r=t<e?e-t:t-e)>Math.PI&&(r=2*Math.PI-r),r},Tr.toRadians=function(t){return t*Math.PI/180},Tr.getTurn=function(t,e){var r=Math.sin(e-t);return r>0?Tr.COUNTERCLOCKWISE:r<0?Tr.CLOCKWISE:Tr.NONE},Tr.angleBetweenOriented=function(t,e,r){var n=Tr.angle(e,t),i=Tr.angle(e,r)-n;return i<=-Math.PI?i+Tr.PI_TIMES_2:i>Math.PI?i-Tr.PI_TIMES_2:i},jr.PI_TIMES_2.get=function(){return 2*Math.PI},jr.PI_OVER_2.get=function(){return Math.PI/2},jr.PI_OVER_4.get=function(){return Math.PI/4},jr.COUNTERCLOCKWISE.get=function(){return st.COUNTERCLOCKWISE},jr.CLOCKWISE.get=function(){return st.CLOCKWISE},jr.NONE.get=function(){return st.COLLINEAR},Object.defineProperties(Tr,jr);var Rr=function t(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new yr,this._seg1=new yr,this._offset0=new yr,this._offset1=new yr,this._side=0,this._hasNarrowConcaveAngle=!1;var e=arguments[0],r=arguments[1],n=arguments[2];this._precisionModel=e,this._bufParams=r,this._li=new it,this._filletAngleQuantum=Math.PI/2/r.getQuadrantSegments(),r.getQuadrantSegments()>=8&&r.getJoinStyle()===Or.JOIN_ROUND&&(this._closingSegLengthFactor=t.MAX_CLOSING_SEG_LEN_FACTOR),this.init(n)},Lr={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};Rr.prototype.addNextSegment=function(t,e){if(this._s0=this._s1,this._s1=this._s2,this._s2=t,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var r=st.computeOrientation(this._s0,this._s1,this._s2),n=r===st.CLOCKWISE&&this._side===Ce.LEFT||r===st.COUNTERCLOCKWISE&&this._side===Ce.RIGHT;0===r?this.addCollinear(e):n?this.addOutsideTurn(r,e):this.addInsideTurn(r,e)},Rr.prototype.addLineEndCap=function(t,e){var r=new yr(t,e),n=new yr;this.computeOffsetSegment(r,Ce.LEFT,this._distance,n);var i=new yr;this.computeOffsetSegment(r,Ce.RIGHT,this._distance,i);var o=e.x-t.x,a=e.y-t.y,s=Math.atan2(a,o);switch(this._bufParams.getEndCapStyle()){case Or.CAP_ROUND:this._segList.addPt(n.p1),this.addFilletArc(e,s+Math.PI/2,s-Math.PI/2,st.CLOCKWISE,this._distance),this._segList.addPt(i.p1);break;case Or.CAP_FLAT:this._segList.addPt(n.p1),this._segList.addPt(i.p1);break;case Or.CAP_SQUARE:var u=new x;u.x=Math.abs(this._distance)*Math.cos(s),u.y=Math.abs(this._distance)*Math.sin(s);var l=new x(n.p1.x+u.x,n.p1.y+u.y),c=new x(i.p1.x+u.x,i.p1.y+u.y);this._segList.addPt(l),this._segList.addPt(c)}},Rr.prototype.getCoordinates=function(){return this._segList.getCoordinates()},Rr.prototype.addMitreJoin=function(t,e,r,n){var i=!0,o=null;try{o=W.intersection(e.p0,e.p1,r.p0,r.p1),(n<=0?1:o.distance(t)/Math.abs(n))>this._bufParams.getMitreLimit()&&(i=!1)}catch(t){if(!(t instanceof U))throw t;o=new x(0,0),i=!1}i?this._segList.addPt(o):this.addLimitedMitreJoin(e,r,n,this._bufParams.getMitreLimit())},Rr.prototype.addFilletCorner=function(t,e,r,n,i){var o=e.x-t.x,a=e.y-t.y,s=Math.atan2(a,o),u=r.x-t.x,l=r.y-t.y,c=Math.atan2(l,u);n===st.CLOCKWISE?s<=c&&(s+=2*Math.PI):s>=c&&(s-=2*Math.PI),this._segList.addPt(e),this.addFilletArc(t,s,c,n,i),this._segList.addPt(r)},Rr.prototype.addOutsideTurn=function(t,e){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*Rr.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===Or.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===Or.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(e&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,t,this._distance),this._segList.addPt(this._offset1.p0))},Rr.prototype.createSquare=function(t){this._segList.addPt(new x(t.x+this._distance,t.y+this._distance)),this._segList.addPt(new x(t.x+this._distance,t.y-this._distance)),this._segList.addPt(new x(t.x-this._distance,t.y-this._distance)),this._segList.addPt(new x(t.x-this._distance,t.y+this._distance)),this._segList.closeRing()},Rr.prototype.addSegments=function(t,e){this._segList.addPts(t,e)},Rr.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)},Rr.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)},Rr.prototype.initSideSegments=function(t,e,r){this._s1=t,this._s2=e,this._side=r,this._seg1.setCoordinates(t,e),this.computeOffsetSegment(this._seg1,r,this._distance,this._offset1)},Rr.prototype.addLimitedMitreJoin=function(t,e,r,n){var i=this._seg0.p1,o=Tr.angle(i,this._seg0.p0),a=Tr.angleBetweenOriented(this._seg0.p0,i,this._seg1.p1)/2,s=Tr.normalize(o+a),u=Tr.normalize(s+Math.PI),l=n*r,c=r-l*Math.abs(Math.sin(a)),f=i.x+l*Math.cos(u),p=i.y+l*Math.sin(u),h=new x(f,p),y=new yr(i,h),d=y.pointAlongOffset(1,c),g=y.pointAlongOffset(1,-c);this._side===Ce.LEFT?(this._segList.addPt(d),this._segList.addPt(g)):(this._segList.addPt(g),this._segList.addPt(d))},Rr.prototype.computeOffsetSegment=function(t,e,r,n){var i=e===Ce.LEFT?1:-1,o=t.p1.x-t.p0.x,a=t.p1.y-t.p0.y,s=Math.sqrt(o*o+a*a),u=i*r*o/s,l=i*r*a/s;n.p0.x=t.p0.x-l,n.p0.y=t.p0.y+u,n.p1.x=t.p1.x-l,n.p1.y=t.p1.y+u},Rr.prototype.addFilletArc=function(t,e,r,n,i){var o=n===st.CLOCKWISE?-1:1,a=Math.abs(e-r),s=Math.trunc(a/this._filletAngleQuantum+.5);if(s<1)return null;for(var u=a/s,l=0,c=new x;l<a;){var f=e+o*l;c.x=t.x+i*Math.cos(f),c.y=t.y+i*Math.sin(f),this._segList.addPt(c),l+=u}},Rr.prototype.addInsideTurn=function(t,e){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*Rr.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var r=new x((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(r);var n=new x((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(n)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}},Rr.prototype.createCircle=function(t){var e=new x(t.x+this._distance,t.y);this._segList.addPt(e),this.addFilletArc(t,0,2*Math.PI,-1,this._distance),this._segList.closeRing()},Rr.prototype.addBevelJoin=function(t,e){this._segList.addPt(t.p1),this._segList.addPt(e.p0)},Rr.prototype.init=function(t){this._distance=t,this._maxCurveSegmentError=t*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Pr,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(t*Rr.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)},Rr.prototype.addCollinear=function(t){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===Or.JOIN_BEVEL||this._bufParams.getJoinStyle()===Or.JOIN_MITRE?(t&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,st.CLOCKWISE,this._distance))},Rr.prototype.closeRing=function(){this._segList.closeRing()},Rr.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle},Rr.prototype.interfaces_=function(){return[]},Rr.prototype.getClass=function(){return Rr},Lr.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return.001},Lr.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return.001},Lr.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6},Lr.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80},Object.defineProperties(Rr,Lr);var Ir=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var t=arguments[0],e=arguments[1];this._precisionModel=t,this._bufParams=e};Ir.prototype.getOffsetCurve=function(t,e){if(this._distance=e,0===e)return null;var r=e<0,n=Math.abs(e),i=this.getSegGen(n);t.length<=1?this.computePointCurve(t[0],i):this.computeOffsetCurve(t,r,i);var o=i.getCoordinates();return r&&Et.reverse(o),o},Ir.prototype.computeSingleSidedBufferCurve=function(t,e,r){var n=this.simplifyTolerance(this._distance);if(e){r.addSegments(t,!0);var i=Cr.simplify(t,-n),o=i.length-1;r.initSideSegments(i[o],i[o-1],Ce.LEFT),r.addFirstSegment();for(var a=o-2;a>=0;a--)r.addNextSegment(i[a],!0)}else{r.addSegments(t,!1);var s=Cr.simplify(t,n),u=s.length-1;r.initSideSegments(s[0],s[1],Ce.LEFT),r.addFirstSegment();for(var l=2;l<=u;l++)r.addNextSegment(s[l],!0)}r.addLastSegment(),r.closeRing()},Ir.prototype.computeRingBufferCurve=function(t,e,r){var n=this.simplifyTolerance(this._distance);e===Ce.RIGHT&&(n=-n);var i=Cr.simplify(t,n),o=i.length-1;r.initSideSegments(i[o-1],i[0],e);for(var a=1;a<=o;a++){var s=1!==a;r.addNextSegment(i[a],s)}r.closeRing()},Ir.prototype.computeLineBufferCurve=function(t,e){var r=this.simplifyTolerance(this._distance),n=Cr.simplify(t,r),i=n.length-1;e.initSideSegments(n[0],n[1],Ce.LEFT);for(var o=2;o<=i;o++)e.addNextSegment(n[o],!0);e.addLastSegment(),e.addLineEndCap(n[i-1],n[i]);var a=Cr.simplify(t,-r),s=a.length-1;e.initSideSegments(a[s],a[s-1],Ce.LEFT);for(var u=s-2;u>=0;u--)e.addNextSegment(a[u],!0);e.addLastSegment(),e.addLineEndCap(a[1],a[0]),e.closeRing()},Ir.prototype.computePointCurve=function(t,e){switch(this._bufParams.getEndCapStyle()){case Or.CAP_ROUND:e.createCircle(t);break;case Or.CAP_SQUARE:e.createSquare(t)}},Ir.prototype.getLineCurve=function(t,e){if(this._distance=e,e<0&&!this._bufParams.isSingleSided())return null;if(0===e)return null;var r=Math.abs(e),n=this.getSegGen(r);if(t.length<=1)this.computePointCurve(t[0],n);else if(this._bufParams.isSingleSided()){var i=e<0;this.computeSingleSidedBufferCurve(t,i,n)}else this.computeLineBufferCurve(t,n);return n.getCoordinates()},Ir.prototype.getBufferParameters=function(){return this._bufParams},Ir.prototype.simplifyTolerance=function(t){return t*this._bufParams.getSimplifyFactor()},Ir.prototype.getRingCurve=function(t,e,r){if(this._distance=r,t.length<=2)return this.getLineCurve(t,r);if(0===r)return Ir.copyCoordinates(t);var n=this.getSegGen(r);return this.computeRingBufferCurve(t,e,n),n.getCoordinates()},Ir.prototype.computeOffsetCurve=function(t,e,r){var n=this.simplifyTolerance(this._distance);if(e){var i=Cr.simplify(t,-n),o=i.length-1;r.initSideSegments(i[o],i[o-1],Ce.LEFT),r.addFirstSegment();for(var a=o-2;a>=0;a--)r.addNextSegment(i[a],!0)}else{var s=Cr.simplify(t,n),u=s.length-1;r.initSideSegments(s[0],s[1],Ce.LEFT),r.addFirstSegment();for(var l=2;l<=u;l++)r.addNextSegment(s[l],!0)}r.addLastSegment()},Ir.prototype.getSegGen=function(t){return new Rr(this._precisionModel,this._bufParams,t)},Ir.prototype.interfaces_=function(){return[]},Ir.prototype.getClass=function(){return Ir},Ir.copyCoordinates=function(t){for(var e=new Array(t.length).fill(null),r=0;r<e.length;r++)e[r]=new x(t[r]);return e};var Mr=function(){this._subgraphs=null,this._seg=new yr,this._cga=new st;var t=arguments[0];this._subgraphs=t},Ar={DepthSegment:{configurable:!0}};Mr.prototype.findStabbedSegments=function(){if(1===arguments.length){for(var t=arguments[0],e=new Ot,r=this._subgraphs.iterator();r.hasNext();){var n=r.next(),i=n.getEnvelope();t.y<i.getMinY()||t.y>i.getMaxY()||this.findStabbedSegments(t,n.getDirectedEdges(),e)}return e}if(3===arguments.length)if(j(arguments[2],St)&&arguments[0]instanceof x&&arguments[1]instanceof Ve){for(var o=arguments[0],a=arguments[1],s=arguments[2],u=a.getEdge().getCoordinates(),l=0;l<u.length-1;l++)if(this._seg.p0=u[l],this._seg.p1=u[l+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<o.x||this._seg.isHorizontal()||o.y<this._seg.p0.y||o.y>this._seg.p1.y||st.computeOrientation(this._seg.p0,this._seg.p1,o)===st.RIGHT)){var c=a.getDepth(Ce.LEFT);this._seg.p0.equals(u[l])||(c=a.getDepth(Ce.RIGHT));var f=new Dr(this._seg,c);s.add(f)}}else if(j(arguments[2],St)&&arguments[0]instanceof x&&j(arguments[1],St))for(var p=arguments[0],h=arguments[2],y=arguments[1].iterator();y.hasNext();){var d=y.next();d.isForward()&&this.findStabbedSegments(p,d,h)}},Mr.prototype.getDepth=function(t){var e=this.findStabbedSegments(t);return 0===e.size()?0:Qe.min(e)._leftDepth},Mr.prototype.interfaces_=function(){return[]},Mr.prototype.getClass=function(){return Mr},Ar.DepthSegment.get=function(){return Dr},Object.defineProperties(Mr,Ar);var Dr=function(){this._upwardSeg=null,this._leftDepth=null;var t=arguments[0],e=arguments[1];this._upwardSeg=new yr(t),this._leftDepth=e};Dr.prototype.compareTo=function(t){var e=t;if(this._upwardSeg.minX()>=e._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=e._upwardSeg.minX())return-1;var r=this._upwardSeg.orientationIndex(e._upwardSeg);return 0!==r||0!=(r=-1*e._upwardSeg.orientationIndex(this._upwardSeg))?r:this._upwardSeg.compareTo(e._upwardSeg)},Dr.prototype.compareX=function(t,e){var r=t.p0.compareTo(e.p0);return 0!==r?r:t.p1.compareTo(e.p1)},Dr.prototype.toString=function(){return this._upwardSeg.toString()},Dr.prototype.interfaces_=function(){return[w]},Dr.prototype.getClass=function(){return Dr};var Nr=function(t,e,r){this.p0=t||null,this.p1=e||null,this.p2=r||null};Nr.prototype.area=function(){return Nr.area(this.p0,this.p1,this.p2)},Nr.prototype.signedArea=function(){return Nr.signedArea(this.p0,this.p1,this.p2)},Nr.prototype.interpolateZ=function(t){if(null===t)throw new v("Supplied point is null.");return Nr.interpolateZ(t,this.p0,this.p1,this.p2)},Nr.prototype.longestSideLength=function(){return Nr.longestSideLength(this.p0,this.p1,this.p2)},Nr.prototype.isAcute=function(){return Nr.isAcute(this.p0,this.p1,this.p2)},Nr.prototype.circumcentre=function(){return Nr.circumcentre(this.p0,this.p1,this.p2)},Nr.prototype.area3D=function(){return Nr.area3D(this.p0,this.p1,this.p2)},Nr.prototype.centroid=function(){return Nr.centroid(this.p0,this.p1,this.p2)},Nr.prototype.inCentre=function(){return Nr.inCentre(this.p0,this.p1,this.p2)},Nr.prototype.interfaces_=function(){return[]},Nr.prototype.getClass=function(){return Nr},Nr.area=function(t,e,r){return Math.abs(((r.x-t.x)*(e.y-t.y)-(e.x-t.x)*(r.y-t.y))/2)},Nr.signedArea=function(t,e,r){return((r.x-t.x)*(e.y-t.y)-(e.x-t.x)*(r.y-t.y))/2},Nr.det=function(t,e,r,n){return t*n-e*r},Nr.interpolateZ=function(t,e,r,n){var i=e.x,o=e.y,a=r.x-i,s=n.x-i,u=r.y-o,l=n.y-o,c=a*l-s*u,f=t.x-i,p=t.y-o,h=(l*f-s*p)/c,y=(-u*f+a*p)/c;return e.z+h*(r.z-e.z)+y*(n.z-e.z)},Nr.longestSideLength=function(t,e,r){var n=t.distance(e),i=e.distance(r),o=r.distance(t),a=n;return i>a&&(a=i),o>a&&(a=o),a},Nr.isAcute=function(t,e,r){return!!Tr.isAcute(t,e,r)&&!!Tr.isAcute(e,r,t)&&!!Tr.isAcute(r,t,e)},Nr.circumcentre=function(t,e,r){var n=r.x,i=r.y,o=t.x-n,a=t.y-i,s=e.x-n,u=e.y-i,l=2*Nr.det(o,a,s,u),c=Nr.det(a,o*o+a*a,u,s*s+u*u),f=Nr.det(o,o*o+a*a,s,s*s+u*u);return new x(n-c/l,i+f/l)},Nr.perpendicularBisector=function(t,e){var r=e.x-t.x,n=e.y-t.y,i=new W(t.x+r/2,t.y+n/2,1),o=new W(t.x-n+r/2,t.y+r+n/2,1);return new W(i,o)},Nr.angleBisector=function(t,e,r){var n=e.distance(t),i=n/(n+e.distance(r)),o=r.x-t.x,a=r.y-t.y;return new x(t.x+i*o,t.y+i*a)},Nr.area3D=function(t,e,r){var n=e.x-t.x,i=e.y-t.y,o=e.z-t.z,a=r.x-t.x,s=r.y-t.y,u=r.z-t.z,l=i*u-o*s,c=o*a-n*u,f=n*s-i*a,p=l*l+c*c+f*f;return Math.sqrt(p)/2},Nr.centroid=function(t,e,r){var n=(t.x+e.x+r.x)/3,i=(t.y+e.y+r.y)/3;return new x(n,i)},Nr.inCentre=function(t,e,r){var n=e.distance(r),i=t.distance(r),o=t.distance(e),a=n+i+o,s=(n*t.x+i*e.x+o*r.x)/a,u=(n*t.y+i*e.y+o*r.y)/a;return new x(s,u)};var Fr=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new Ot;var t=arguments[0],e=arguments[1],r=arguments[2];this._inputGeom=t,this._distance=e,this._curveBuilder=r};Fr.prototype.addPoint=function(t){if(this._distance<=0)return null;var e=t.getCoordinates(),r=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(r,k.EXTERIOR,k.INTERIOR)},Fr.prototype.addPolygon=function(t){var e=this._distance,r=Ce.LEFT;this._distance<0&&(e=-this._distance,r=Ce.RIGHT);var n=t.getExteriorRing(),i=Et.removeRepeatedPoints(n.getCoordinates());if(this._distance<0&&this.isErodedCompletely(n,this._distance))return null;if(this._distance<=0&&i.length<3)return null;this.addPolygonRing(i,e,r,k.EXTERIOR,k.INTERIOR);for(var o=0;o<t.getNumInteriorRing();o++){var a=t.getInteriorRingN(o),s=Et.removeRepeatedPoints(a.getCoordinates());this._distance>0&&this.isErodedCompletely(a,-this._distance)||this.addPolygonRing(s,e,Ce.opposite(r),k.INTERIOR,k.EXTERIOR)}},Fr.prototype.isTriangleErodedCompletely=function(t,e){var r=new Nr(t[0],t[1],t[2]),n=r.inCentre();return st.distancePointLine(n,r.p0,r.p1)<Math.abs(e)},Fr.prototype.addLineString=function(t){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var e=Et.removeRepeatedPoints(t.getCoordinates()),r=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(r,k.EXTERIOR,k.INTERIOR)},Fr.prototype.addCurve=function(t,e,r){if(null===t||t.length<2)return null;var n=new hr(t,new Le(0,k.BOUNDARY,e,r));this._curveList.add(n)},Fr.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList},Fr.prototype.addPolygonRing=function(t,e,r,n,i){if(0===e&&t.length<ee.MINIMUM_VALID_SIZE)return null;var o=n,a=i;t.length>=ee.MINIMUM_VALID_SIZE&&st.isCCW(t)&&(o=i,a=n,r=Ce.opposite(r));var s=this._curveBuilder.getRingCurve(t,r,e);this.addCurve(s,o,a)},Fr.prototype.add=function(t){if(t.isEmpty())return null;t instanceof Qt?this.addPolygon(t):t instanceof Yt?this.addLineString(t):t instanceof Jt?this.addPoint(t):(t instanceof te||t instanceof Ut||t instanceof re||t instanceof Vt)&&this.addCollection(t)},Fr.prototype.isErodedCompletely=function(t,e){var r=t.getCoordinates();if(r.length<4)return e<0;if(4===r.length)return this.isTriangleErodedCompletely(r,e);var n=t.getEnvelopeInternal(),i=Math.min(n.getHeight(),n.getWidth());return e<0&&2*Math.abs(e)>i},Fr.prototype.addCollection=function(t){for(var e=0;e<t.getNumGeometries();e++){var r=t.getGeometryN(e);this.add(r)}},Fr.prototype.interfaces_=function(){return[]},Fr.prototype.getClass=function(){return Fr};var zr=function(){};zr.prototype.locate=function(t){},zr.prototype.interfaces_=function(){return[]},zr.prototype.getClass=function(){return zr};var Gr=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var t=arguments[0];this._parent=t,this._atStart=!0,this._index=0,this._max=t.getNumGeometries()};Gr.prototype.next=function(){if(this._atStart)return this._atStart=!1,Gr.isAtomic(this._parent)&&this._index++,this._parent;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new n;var t=this._parent.getGeometryN(this._index++);return t instanceof Vt?(this._subcollectionIterator=new Gr(t),this._subcollectionIterator.next()):t},Gr.prototype.remove=function(){throw new Error(this.getClass().getName())},Gr.prototype.hasNext=function(){if(this._atStart)return!0;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)},Gr.prototype.interfaces_=function(){return[wt]},Gr.prototype.getClass=function(){return Gr},Gr.isAtomic=function(t){return!(t instanceof Vt)};var Br=function(){this._geom=null;var t=arguments[0];this._geom=t};Br.prototype.locate=function(t){return Br.locate(t,this._geom)},Br.prototype.interfaces_=function(){return[zr]},Br.prototype.getClass=function(){return Br},Br.isPointInRing=function(t,e){return!!e.getEnvelopeInternal().intersects(t)&&st.isPointInRing(t,e.getCoordinates())},Br.containsPointInPolygon=function(t,e){if(e.isEmpty())return!1;var r=e.getExteriorRing();if(!Br.isPointInRing(t,r))return!1;for(var n=0;n<e.getNumInteriorRing();n++){var i=e.getInteriorRingN(n);if(Br.isPointInRing(t,i))return!1}return!0},Br.containsPoint=function(t,e){if(e instanceof Qt)return Br.containsPointInPolygon(t,e);if(e instanceof Vt)for(var r=new Gr(e);r.hasNext();){var n=r.next();if(n!==e&&Br.containsPoint(t,n))return!0}return!1},Br.locate=function(t,e){return e.isEmpty()?k.EXTERIOR:Br.containsPoint(t,e)?k.INTERIOR:k.EXTERIOR};var Vr=function(){this._edgeMap=new f,this._edgeList=null,this._ptInAreaLocation=[k.NONE,k.NONE]};Vr.prototype.getNextCW=function(t){this.getEdges();var e=this._edgeList.indexOf(t),r=e-1;return 0===e&&(r=this._edgeList.size()-1),this._edgeList.get(r)},Vr.prototype.propagateSideLabels=function(t){for(var e=k.NONE,r=this.iterator();r.hasNext();){var n=r.next().getLabel();n.isArea(t)&&n.getLocation(t,Ce.LEFT)!==k.NONE&&(e=n.getLocation(t,Ce.LEFT))}if(e===k.NONE)return null;for(var i=e,o=this.iterator();o.hasNext();){var a=o.next(),s=a.getLabel();if(s.getLocation(t,Ce.ON)===k.NONE&&s.setLocation(t,Ce.ON,i),s.isArea(t)){var u=s.getLocation(t,Ce.LEFT),l=s.getLocation(t,Ce.RIGHT);if(l!==k.NONE){if(l!==i)throw new ke("side location conflict",a.getCoordinate());u===k.NONE&&et.shouldNeverReachHere("found single null side (at "+a.getCoordinate()+")"),i=u}else et.isTrue(s.getLocation(t,Ce.LEFT)===k.NONE,"found single null side"),s.setLocation(t,Ce.RIGHT,i),s.setLocation(t,Ce.LEFT,i)}}},Vr.prototype.getCoordinate=function(){var t=this.iterator();return t.hasNext()?t.next().getCoordinate():null},Vr.prototype.print=function(t){q.out.println("EdgeEndStar:   "+this.getCoordinate());for(var e=this.iterator();e.hasNext();)e.next().print(t)},Vr.prototype.isAreaLabelsConsistent=function(t){return this.computeEdgeEndLabels(t.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)},Vr.prototype.checkAreaLabelsConsistent=function(t){var e=this.getEdges();if(e.size()<=0)return!0;var r=e.size()-1,n=e.get(r).getLabel().getLocation(t,Ce.LEFT);et.isTrue(n!==k.NONE,"Found unlabelled area edge");for(var i=n,o=this.iterator();o.hasNext();){var a=o.next().getLabel();et.isTrue(a.isArea(t),"Found non-area edge");var s=a.getLocation(t,Ce.LEFT),u=a.getLocation(t,Ce.RIGHT);if(s===u)return!1;if(u!==i)return!1;i=s}return!0},Vr.prototype.findIndex=function(t){this.iterator();for(var e=0;e<this._edgeList.size();e++)if(this._edgeList.get(e)===t)return e;return-1},Vr.prototype.iterator=function(){return this.getEdges().iterator()},Vr.prototype.getEdges=function(){return null===this._edgeList&&(this._edgeList=new Ot(this._edgeMap.values())),this._edgeList},Vr.prototype.getLocation=function(t,e,r){return this._ptInAreaLocation[t]===k.NONE&&(this._ptInAreaLocation[t]=Br.locate(e,r[t].getGeometry())),this._ptInAreaLocation[t]},Vr.prototype.toString=function(){var t=new I;t.append("EdgeEndStar:   "+this.getCoordinate()),t.append("\n");for(var e=this.iterator();e.hasNext();){var r=e.next();t.append(r),t.append("\n")}return t.toString()},Vr.prototype.computeEdgeEndLabels=function(t){for(var e=this.iterator();e.hasNext();)e.next().computeLabel(t)},Vr.prototype.computeLabelling=function(t){this.computeEdgeEndLabels(t[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var e=[!1,!1],r=this.iterator();r.hasNext();)for(var n=r.next().getLabel(),i=0;i<2;i++)n.isLine(i)&&n.getLocation(i)===k.BOUNDARY&&(e[i]=!0);for(var o=this.iterator();o.hasNext();)for(var a=o.next(),s=a.getLabel(),u=0;u<2;u++)if(s.isAnyNull(u)){var l=k.NONE;if(e[u])l=k.EXTERIOR;else{var c=a.getCoordinate();l=this.getLocation(u,c,t)}s.setAllLocationsIfNull(u,l)}},Vr.prototype.getDegree=function(){return this._edgeMap.size()},Vr.prototype.insertEdgeEnd=function(t,e){this._edgeMap.put(t,e),this._edgeList=null},Vr.prototype.interfaces_=function(){return[]},Vr.prototype.getClass=function(){return Vr};var Ur=function(t){function e(){t.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.linkResultDirectedEdges=function(){this.getResultAreaEdges();for(var t=null,e=null,r=this._SCANNING_FOR_INCOMING,n=0;n<this._resultAreaEdgeList.size();n++){var i=this._resultAreaEdgeList.get(n),o=i.getSym();if(i.getLabel().isArea())switch(null===t&&i.isInResult()&&(t=i),r){case this._SCANNING_FOR_INCOMING:if(!o.isInResult())continue;e=o,r=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!i.isInResult())continue;e.setNext(i),r=this._SCANNING_FOR_INCOMING}}if(r===this._LINKING_TO_OUTGOING){if(null===t)throw new ke("no outgoing dirEdge found",this.getCoordinate());et.isTrue(t.isInResult(),"unable to link last incoming dirEdge"),e.setNext(t)}},e.prototype.insert=function(t){var e=t;this.insertEdgeEnd(e,e)},e.prototype.getRightmostEdge=function(){var t=this.getEdges(),e=t.size();if(e<1)return null;var r=t.get(0);if(1===e)return r;var n=t.get(e-1),i=r.getQuadrant(),o=n.getQuadrant();return ze.isNorthern(i)&&ze.isNorthern(o)?r:ze.isNorthern(i)||ze.isNorthern(o)?0!==r.getDy()?r:0!==n.getDy()?n:(et.shouldNeverReachHere("found two horizontal edges incident on node"),null):n},e.prototype.print=function(t){q.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var e=this.iterator();e.hasNext();){var r=e.next();t.print("out "),r.print(t),t.println(),t.print("in "),r.getSym().print(t),t.println()}},e.prototype.getResultAreaEdges=function(){if(null!==this._resultAreaEdgeList)return this._resultAreaEdgeList;this._resultAreaEdgeList=new Ot;for(var t=this.iterator();t.hasNext();){var e=t.next();(e.isInResult()||e.getSym().isInResult())&&this._resultAreaEdgeList.add(e)}return this._resultAreaEdgeList},e.prototype.updateLabelling=function(t){for(var e=this.iterator();e.hasNext();){var r=e.next().getLabel();r.setAllLocationsIfNull(0,t.getLocation(0)),r.setAllLocationsIfNull(1,t.getLocation(1))}},e.prototype.linkAllDirectedEdges=function(){this.getEdges();for(var t=null,e=null,r=this._edgeList.size()-1;r>=0;r--){var n=this._edgeList.get(r),i=n.getSym();null===e&&(e=i),null!==t&&i.setNext(t),t=n}e.setNext(t)},e.prototype.computeDepths=function(){if(1===arguments.length){var t=arguments[0],e=this.findIndex(t),r=t.getDepth(Ce.LEFT),n=t.getDepth(Ce.RIGHT),i=this.computeDepths(e+1,this._edgeList.size(),r);if(this.computeDepths(0,e,i)!==n)throw new ke("depth mismatch at "+t.getCoordinate())}else if(3===arguments.length){for(var o=arguments[1],a=arguments[2],s=arguments[0];s<o;s++){var u=this._edgeList.get(s);u.setEdgeDepths(Ce.RIGHT,a),a=u.getDepth(Ce.LEFT)}return a}},e.prototype.mergeSymLabels=function(){for(var t=this.iterator();t.hasNext();){var e=t.next();e.getLabel().merge(e.getSym().getLabel())}},e.prototype.linkMinimalDirectedEdges=function(t){for(var e=null,r=null,n=this._SCANNING_FOR_INCOMING,i=this._resultAreaEdgeList.size()-1;i>=0;i--){var o=this._resultAreaEdgeList.get(i),a=o.getSym();switch(null===e&&o.getEdgeRing()===t&&(e=o),n){case this._SCANNING_FOR_INCOMING:if(a.getEdgeRing()!==t)continue;r=a,n=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(o.getEdgeRing()!==t)continue;r.setNextMin(o),n=this._SCANNING_FOR_INCOMING}}n===this._LINKING_TO_OUTGOING&&(et.isTrue(null!==e,"found null for first outgoing dirEdge"),et.isTrue(e.getEdgeRing()===t,"unable to link last incoming dirEdge"),r.setNextMin(e))},e.prototype.getOutgoingDegree=function(){if(0===arguments.length){for(var t=0,e=this.iterator();e.hasNext();)e.next().isInResult()&&t++;return t}if(1===arguments.length){for(var r=arguments[0],n=0,i=this.iterator();i.hasNext();)i.next().getEdgeRing()===r&&n++;return n}},e.prototype.getLabel=function(){return this._label},e.prototype.findCoveredLineEdges=function(){for(var t=k.NONE,e=this.iterator();e.hasNext();){var r=e.next(),n=r.getSym();if(!r.isLineEdge()){if(r.isInResult()){t=k.INTERIOR;break}if(n.isInResult()){t=k.EXTERIOR;break}}}if(t===k.NONE)return null;for(var i=t,o=this.iterator();o.hasNext();){var a=o.next(),s=a.getSym();a.isLineEdge()?a.getEdge().setCovered(i===k.INTERIOR):(a.isInResult()&&(i=k.EXTERIOR),s.isInResult()&&(i=k.INTERIOR))}},e.prototype.computeLabelling=function(e){t.prototype.computeLabelling.call(this,e),this._label=new Le(k.NONE);for(var r=this.iterator();r.hasNext();)for(var n=r.next().getEdge().getLabel(),i=0;i<2;i++){var o=n.getLocation(i);o!==k.INTERIOR&&o!==k.BOUNDARY||this._label.setLocation(i,k.INTERIOR)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Vr),qr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createNode=function(t){return new Ne(t,new Ur)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Ue),Wr=function t(){this._pts=null,this._orientation=null;var e=arguments[0];this._pts=e,this._orientation=t.orientation(e)};Wr.prototype.compareTo=function(t){var e=t;return Wr.compareOriented(this._pts,this._orientation,e._pts,e._orientation)},Wr.prototype.interfaces_=function(){return[w]},Wr.prototype.getClass=function(){return Wr},Wr.orientation=function(t){return 1===Et.increasingDirection(t)},Wr.compareOriented=function(t,e,r,n){for(var i=e?1:-1,o=n?1:-1,a=e?t.length:-1,s=n?r.length:-1,u=e?0:t.length-1,l=n?0:r.length-1;;){var c=t[u].compareTo(r[l]);if(0!==c)return c;var f=(u+=i)===a,p=(l+=o)===s;if(f&&!p)return-1;if(!f&&p)return 1;if(f&&p)return 0}};var Xr=function(){this._edges=new Ot,this._ocaMap=new f};Xr.prototype.print=function(t){t.print("MULTILINESTRING ( ");for(var e=0;e<this._edges.size();e++){var r=this._edges.get(e);e>0&&t.print(","),t.print("(");for(var n=r.getCoordinates(),i=0;i<n.length;i++)i>0&&t.print(","),t.print(n[i].x+" "+n[i].y);t.println(")")}t.print(")  ")},Xr.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next())},Xr.prototype.findEdgeIndex=function(t){for(var e=0;e<this._edges.size();e++)if(this._edges.get(e).equals(t))return e;return-1},Xr.prototype.iterator=function(){return this._edges.iterator()},Xr.prototype.getEdges=function(){return this._edges},Xr.prototype.get=function(t){return this._edges.get(t)},Xr.prototype.findEqualEdge=function(t){var e=new Wr(t.getCoordinates());return this._ocaMap.get(e)},Xr.prototype.add=function(t){this._edges.add(t);var e=new Wr(t.getCoordinates());this._ocaMap.put(e,t)},Xr.prototype.interfaces_=function(){return[]},Xr.prototype.getClass=function(){return Xr};var Zr=function(){};Zr.prototype.processIntersections=function(t,e,r,n){},Zr.prototype.isDone=function(){},Zr.prototype.interfaces_=function(){return[]},Zr.prototype.getClass=function(){return Zr};var Hr=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var t=arguments[0];this._li=t};Hr.prototype.isTrivialIntersection=function(t,e,r,n){if(t===r&&1===this._li.getIntersectionNum()){if(Hr.isAdjacentSegments(e,n))return!0;if(t.isClosed()){var i=t.size()-1;if(0===e&&n===i||0===n&&e===i)return!0}}return!1},Hr.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},Hr.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},Hr.prototype.getLineIntersector=function(){return this._li},Hr.prototype.hasProperIntersection=function(){return this._hasProper},Hr.prototype.processIntersections=function(t,e,r,n){if(t===r&&e===n)return null;this.numTests++;var i=t.getCoordinates()[e],o=t.getCoordinates()[e+1],a=r.getCoordinates()[n],s=r.getCoordinates()[n+1];this._li.computeIntersection(i,o,a,s),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(t,e,r,n)||(this._hasIntersection=!0,t.addIntersections(this._li,e,0),r.addIntersections(this._li,n,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))},Hr.prototype.hasIntersection=function(){return this._hasIntersection},Hr.prototype.isDone=function(){return!1},Hr.prototype.hasInteriorIntersection=function(){return this._hasInterior},Hr.prototype.interfaces_=function(){return[Zr]},Hr.prototype.getClass=function(){return Hr},Hr.isAdjacentSegments=function(t,e){return 1===Math.abs(t-e)};var Yr=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var t=arguments[0],e=arguments[1],r=arguments[2];this.coord=new x(t),this.segmentIndex=e,this.dist=r};Yr.prototype.getSegmentIndex=function(){return this.segmentIndex},Yr.prototype.getCoordinate=function(){return this.coord},Yr.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex),t.println(" dist = "+this.dist)},Yr.prototype.compareTo=function(t){var e=t;return this.compare(e.segmentIndex,e.dist)},Yr.prototype.isEndPoint=function(t){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===t},Yr.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist},Yr.prototype.getDistance=function(){return this.dist},Yr.prototype.compare=function(t,e){return this.segmentIndex<t?-1:this.segmentIndex>t?1:this.dist<e?-1:this.dist>e?1:0},Yr.prototype.interfaces_=function(){return[w]},Yr.prototype.getClass=function(){return Yr};var Kr=function(){this._nodeMap=new f,this.edge=null;var t=arguments[0];this.edge=t};Kr.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();)e.next().print(t)},Kr.prototype.iterator=function(){return this._nodeMap.values().iterator()},Kr.prototype.addSplitEdges=function(t){this.addEndpoints();for(var e=this.iterator(),r=e.next();e.hasNext();){var n=e.next(),i=this.createSplitEdge(r,n);t.add(i),r=n}},Kr.prototype.addEndpoints=function(){var t=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[t],t,0)},Kr.prototype.createSplitEdge=function(t,e){var r=e.segmentIndex-t.segmentIndex+2,n=this.edge.pts[e.segmentIndex],i=e.dist>0||!e.coord.equals2D(n);i||r--;var o=new Array(r).fill(null),a=0;o[a++]=new x(t.coord);for(var s=t.segmentIndex+1;s<=e.segmentIndex;s++)o[a++]=this.edge.pts[s];return i&&(o[a]=e.coord),new en(o,new Le(this.edge._label))},Kr.prototype.add=function(t,e,r){var n=new Yr(t,e,r),i=this._nodeMap.get(n);return null!==i?i:(this._nodeMap.put(n,n),n)},Kr.prototype.isIntersection=function(t){for(var e=this.iterator();e.hasNext();)if(e.next().coord.equals(t))return!0;return!1},Kr.prototype.interfaces_=function(){return[]},Kr.prototype.getClass=function(){return Kr};var Jr=function(){};Jr.prototype.getChainStartIndices=function(t){var e=0,r=new Ot;r.add(new M(e));do{var n=this.findChainEnd(t,e);r.add(new M(n)),e=n}while(e<t.length-1);return Jr.toIntArray(r)},Jr.prototype.findChainEnd=function(t,e){for(var r=ze.quadrant(t[e],t[e+1]),n=e+1;n<t.length&&ze.quadrant(t[n-1],t[n])===r;)n++;return n-1},Jr.prototype.interfaces_=function(){return[]},Jr.prototype.getClass=function(){return Jr},Jr.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),r=0;r<e.length;r++)e[r]=t.get(r).intValue();return e};var $r=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new X,this.env2=new X;var t=arguments[0];this.e=t,this.pts=t.getCoordinates();var e=new Jr;this.startIndex=e.getChainStartIndices(this.pts)};$r.prototype.getCoordinates=function(){return this.pts},$r.prototype.getMaxX=function(t){var e=this.pts[this.startIndex[t]].x,r=this.pts[this.startIndex[t+1]].x;return e>r?e:r},$r.prototype.getMinX=function(t){var e=this.pts[this.startIndex[t]].x,r=this.pts[this.startIndex[t+1]].x;return e<r?e:r},$r.prototype.computeIntersectsForChain=function(){if(4===arguments.length){var t=arguments[0],e=arguments[1],r=arguments[2],n=arguments[3];this.computeIntersectsForChain(this.startIndex[t],this.startIndex[t+1],e,e.startIndex[r],e.startIndex[r+1],n)}else if(6===arguments.length){var i=arguments[0],o=arguments[1],a=arguments[2],s=arguments[3],u=arguments[4],l=arguments[5],c=this.pts[i],f=this.pts[o],p=a.pts[s],h=a.pts[u];if(o-i==1&&u-s==1)return l.addIntersections(this.e,i,a.e,s),null;if(this.env1.init(c,f),this.env2.init(p,h),!this.env1.intersects(this.env2))return null;var y=Math.trunc((i+o)/2),d=Math.trunc((s+u)/2);i<y&&(s<d&&this.computeIntersectsForChain(i,y,a,s,d,l),d<u&&this.computeIntersectsForChain(i,y,a,d,u,l)),y<o&&(s<d&&this.computeIntersectsForChain(y,o,a,s,d,l),d<u&&this.computeIntersectsForChain(y,o,a,d,u,l))}},$r.prototype.getStartIndexes=function(){return this.startIndex},$r.prototype.computeIntersects=function(t,e){for(var r=0;r<this.startIndex.length-1;r++)for(var n=0;n<t.startIndex.length-1;n++)this.computeIntersectsForChain(r,t,n,e)},$r.prototype.interfaces_=function(){return[]},$r.prototype.getClass=function(){return $r};var Qr=function t(){this._depth=Array(2).fill().map((function(){return Array(3)}));for(var e=0;e<2;e++)for(var r=0;r<3;r++)this._depth[e][r]=t.NULL_VALUE},tn={NULL_VALUE:{configurable:!0}};Qr.prototype.getDepth=function(t,e){return this._depth[t][e]},Qr.prototype.setDepth=function(t,e,r){this._depth[t][e]=r},Qr.prototype.isNull=function(){if(0===arguments.length){for(var t=0;t<2;t++)for(var e=0;e<3;e++)if(this._depth[t][e]!==Qr.NULL_VALUE)return!1;return!0}if(1===arguments.length){var r=arguments[0];return this._depth[r][1]===Qr.NULL_VALUE}if(2===arguments.length){var n=arguments[0],i=arguments[1];return this._depth[n][i]===Qr.NULL_VALUE}},Qr.prototype.normalize=function(){for(var t=0;t<2;t++)if(!this.isNull(t)){var e=this._depth[t][1];this._depth[t][2]<e&&(e=this._depth[t][2]),e<0&&(e=0);for(var r=1;r<3;r++){var n=0;this._depth[t][r]>e&&(n=1),this._depth[t][r]=n}}},Qr.prototype.getDelta=function(t){return this._depth[t][Ce.RIGHT]-this._depth[t][Ce.LEFT]},Qr.prototype.getLocation=function(t,e){return this._depth[t][e]<=0?k.EXTERIOR:k.INTERIOR},Qr.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]},Qr.prototype.add=function(){if(1===arguments.length)for(var t=arguments[0],e=0;e<2;e++)for(var r=1;r<3;r++){var n=t.getLocation(e,r);n!==k.EXTERIOR&&n!==k.INTERIOR||(this.isNull(e,r)?this._depth[e][r]=Qr.depthAtLocation(n):this._depth[e][r]+=Qr.depthAtLocation(n))}else if(3===arguments.length){var i=arguments[0],o=arguments[1];arguments[2]===k.INTERIOR&&this._depth[i][o]++}},Qr.prototype.interfaces_=function(){return[]},Qr.prototype.getClass=function(){return Qr},Qr.depthAtLocation=function(t){return t===k.EXTERIOR?0:t===k.INTERIOR?1:Qr.NULL_VALUE},tn.NULL_VALUE.get=function(){return-1},Object.defineProperties(Qr,tn);var en=function(t){function e(){if(t.call(this),this.pts=null,this._env=null,this.eiList=new Kr(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Qr,this._depthDelta=0,1===arguments.length){var r=arguments[0];e.call(this,r,null)}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.pts=n,this._label=i}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDepth=function(){return this._depth},e.prototype.getCollapsedEdge=function(){var t=new Array(2).fill(null);return t[0]=this.pts[0],t[1]=this.pts[1],new e(t,Le.toLineLabel(this._label))},e.prototype.isIsolated=function(){return this._isIsolated},e.prototype.getCoordinates=function(){return this.pts},e.prototype.setIsolated=function(t){this._isIsolated=t},e.prototype.setName=function(t){this._name=t},e.prototype.equals=function(t){if(!(t instanceof e))return!1;var r=t;if(this.pts.length!==r.pts.length)return!1;for(var n=!0,i=!0,o=this.pts.length,a=0;a<this.pts.length;a++)if(this.pts[a].equals2D(r.pts[a])||(n=!1),this.pts[a].equals2D(r.pts[--o])||(i=!1),!n&&!i)return!1;return!0},e.prototype.getCoordinate=function(){if(0===arguments.length)return this.pts.length>0?this.pts[0]:null;if(1===arguments.length){var t=arguments[0];return this.pts[t]}},e.prototype.print=function(t){t.print("edge "+this._name+": "),t.print("LINESTRING (");for(var e=0;e<this.pts.length;e++)e>0&&t.print(","),t.print(this.pts[e].x+" "+this.pts[e].y);t.print(")  "+this._label+" "+this._depthDelta)},e.prototype.computeIM=function(t){e.updateIM(this._label,t)},e.prototype.isCollapsed=function(){return!!this._label.isArea()&&3===this.pts.length&&!!this.pts[0].equals(this.pts[2])},e.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},e.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},e.prototype.getDepthDelta=function(){return this._depthDelta},e.prototype.getNumPoints=function(){return this.pts.length},e.prototype.printReverse=function(t){t.print("edge "+this._name+": ");for(var e=this.pts.length-1;e>=0;e--)t.print(this.pts[e]+" ");t.println("")},e.prototype.getMonotoneChainEdge=function(){return null===this._mce&&(this._mce=new $r(this)),this._mce},e.prototype.getEnvelope=function(){if(null===this._env){this._env=new X;for(var t=0;t<this.pts.length;t++)this._env.expandToInclude(this.pts[t])}return this._env},e.prototype.addIntersection=function(t,e,r,n){var i=new x(t.getIntersection(n)),o=e,a=t.getEdgeDistance(r,n),s=o+1;if(s<this.pts.length){var u=this.pts[s];i.equals2D(u)&&(o=s,a=0)}this.eiList.add(i,o,a)},e.prototype.toString=function(){var t=new I;t.append("edge "+this._name+": "),t.append("LINESTRING (");for(var e=0;e<this.pts.length;e++)e>0&&t.append(","),t.append(this.pts[e].x+" "+this.pts[e].y);return t.append(")  "+this._label+" "+this._depthDelta),t.toString()},e.prototype.isPointwiseEqual=function(t){if(this.pts.length!==t.pts.length)return!1;for(var e=0;e<this.pts.length;e++)if(!this.pts[e].equals2D(t.pts[e]))return!1;return!0},e.prototype.setDepthDelta=function(t){this._depthDelta=t},e.prototype.getEdgeIntersectionList=function(){return this.eiList},e.prototype.addIntersections=function(t,e,r){for(var n=0;n<t.getIntersectionNum();n++)this.addIntersection(t,e,r,n)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.updateIM=function(){if(2!==arguments.length)return t.prototype.updateIM.apply(this,arguments);var e=arguments[0],r=arguments[1];r.setAtLeastIfValid(e.getLocation(0,Ce.ON),e.getLocation(1,Ce.ON),1),e.isArea()&&(r.setAtLeastIfValid(e.getLocation(0,Ce.LEFT),e.getLocation(1,Ce.LEFT),2),r.setAtLeastIfValid(e.getLocation(0,Ce.RIGHT),e.getLocation(1,Ce.RIGHT),2))},e}(De),rn=function(t){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new Xr,this._bufParams=t||null};rn.prototype.setWorkingPrecisionModel=function(t){this._workingPrecisionModel=t},rn.prototype.insertUniqueEdge=function(t){var e=this._edgeList.findEqualEdge(t);if(null!==e){var r=e.getLabel(),n=t.getLabel();e.isPointwiseEqual(t)||(n=new Le(t.getLabel())).flip(),r.merge(n);var i=rn.depthDelta(n),o=e.getDepthDelta()+i;e.setDepthDelta(o)}else this._edgeList.add(t),t.setDepthDelta(rn.depthDelta(t.getLabel()))},rn.prototype.buildSubgraphs=function(t,e){for(var r=new Ot,n=t.iterator();n.hasNext();){var i=n.next(),o=i.getRightmostCoordinate(),a=new Mr(r).getDepth(o);i.computeDepth(a),i.findResultEdges(),r.add(i),e.add(i.getDirectedEdges(),i.getNodes())}},rn.prototype.createSubgraphs=function(t){for(var e=new Ot,r=t.getNodes().iterator();r.hasNext();){var n=r.next();if(!n.isVisited()){var i=new je;i.create(n),e.add(i)}}return Qe.sort(e,Qe.reverseOrder()),e},rn.prototype.createEmptyResultGeometry=function(){return this._geomFact.createPolygon()},rn.prototype.getNoder=function(t){if(null!==this._workingNoder)return this._workingNoder;var e=new wr,r=new it;return r.setPrecisionModel(t),e.setSegmentIntersector(new Hr(r)),e},rn.prototype.buffer=function(t,e){var r=this._workingPrecisionModel;null===r&&(r=t.getPrecisionModel()),this._geomFact=t.getFactory();var n=new Ir(r,this._bufParams),i=new Fr(t,e,n).getCurves();if(i.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(i,r),this._graph=new qe(new qr),this._graph.addEdges(this._edgeList.getEdges());var o=this.createSubgraphs(this._graph),a=new We(this._geomFact);this.buildSubgraphs(o,a);var s=a.getPolygons();return s.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(s)},rn.prototype.computeNodedEdges=function(t,e){var r=this.getNoder(e);r.computeNodes(t);for(var n=r.getNodedSubstrings().iterator();n.hasNext();){var i=n.next(),o=i.getCoordinates();if(2!==o.length||!o[0].equals2D(o[1])){var a=i.getData(),s=new en(i.getCoordinates(),new Le(a));this.insertUniqueEdge(s)}}},rn.prototype.setNoder=function(t){this._workingNoder=t},rn.prototype.interfaces_=function(){return[]},rn.prototype.getClass=function(){return rn},rn.depthDelta=function(t){var e=t.getLocation(0,Ce.LEFT),r=t.getLocation(0,Ce.RIGHT);return e===k.INTERIOR&&r===k.EXTERIOR?1:e===k.EXTERIOR&&r===k.INTERIOR?-1:0},rn.convertSegStrings=function(t){for(var e=new me,r=new Ot;t.hasNext();){var n=t.next(),i=e.createLineString(n.getCoordinates());r.add(i)}return e.buildGeometry(r)};var nn=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,2===arguments.length){var t=arguments[0],e=arguments[1];this._noder=t,this._scaleFactor=e,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(4===arguments.length){var r=arguments[0],n=arguments[1],i=arguments[2],o=arguments[3];this._noder=r,this._scaleFactor=n,this._offsetX=i,this._offsetY=o,this._isScaled=!this.isIntegerPrecision()}};nn.prototype.rescale=function(){if(j(arguments[0],bt))for(var t=arguments[0].iterator();t.hasNext();){var e=t.next();this.rescale(e.getCoordinates())}else if(arguments[0]instanceof Array){for(var r=arguments[0],n=0;n<r.length;n++)r[n].x=r[n].x/this._scaleFactor+this._offsetX,r[n].y=r[n].y/this._scaleFactor+this._offsetY;2===r.length&&r[0].equals2D(r[1])&&q.out.println(r)}},nn.prototype.scale=function(){if(j(arguments[0],bt)){for(var t=arguments[0],e=new Ot,r=t.iterator();r.hasNext();){var n=r.next();e.add(new hr(this.scale(n.getCoordinates()),n.getData()))}return e}if(arguments[0]instanceof Array){for(var i=arguments[0],o=new Array(i.length).fill(null),a=0;a<i.length;a++)o[a]=new x(Math.round((i[a].x-this._offsetX)*this._scaleFactor),Math.round((i[a].y-this._offsetY)*this._scaleFactor),i[a].z);return Et.removeRepeatedPoints(o)}},nn.prototype.isIntegerPrecision=function(){return 1===this._scaleFactor},nn.prototype.getNodedSubstrings=function(){var t=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(t),t},nn.prototype.computeNodes=function(t){var e=t;this._isScaled&&(e=this.scale(t)),this._noder.computeNodes(e)},nn.prototype.interfaces_=function(){return[_r]},nn.prototype.getClass=function(){return nn};var on=function(){this._li=new it,this._segStrings=null;var t=arguments[0];this._segStrings=t},an={fact:{configurable:!0}};on.prototype.checkEndPtVertexIntersections=function(){if(0===arguments.length)for(var t=this._segStrings.iterator();t.hasNext();){var e=t.next().getCoordinates();this.checkEndPtVertexIntersections(e[0],this._segStrings),this.checkEndPtVertexIntersections(e[e.length-1],this._segStrings)}else if(2===arguments.length)for(var r=arguments[0],n=arguments[1].iterator();n.hasNext();)for(var i=n.next().getCoordinates(),o=1;o<i.length-1;o++)if(i[o].equals(r))throw new Q("found endpt/interior pt intersection at index "+o+" :pt "+r)},on.prototype.checkInteriorIntersections=function(){if(0===arguments.length)for(var t=this._segStrings.iterator();t.hasNext();)for(var e=t.next(),r=this._segStrings.iterator();r.hasNext();){var n=r.next();this.checkInteriorIntersections(e,n)}else if(2===arguments.length)for(var i=arguments[0],o=arguments[1],a=i.getCoordinates(),s=o.getCoordinates(),u=0;u<a.length-1;u++)for(var l=0;l<s.length-1;l++)this.checkInteriorIntersections(i,u,o,l);else if(4===arguments.length){var c=arguments[0],f=arguments[1],p=arguments[2],h=arguments[3];if(c===p&&f===h)return null;var y=c.getCoordinates()[f],d=c.getCoordinates()[f+1],g=p.getCoordinates()[h],m=p.getCoordinates()[h+1];if(this._li.computeIntersection(y,d,g,m),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,y,d)||this.hasInteriorIntersection(this._li,g,m)))throw new Q("found non-noded intersection at "+y+"-"+d+" and "+g+"-"+m)}},on.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()},on.prototype.checkCollapses=function(){if(0===arguments.length)for(var t=this._segStrings.iterator();t.hasNext();){var e=t.next();this.checkCollapses(e)}else if(1===arguments.length)for(var r=arguments[0].getCoordinates(),n=0;n<r.length-2;n++)this.checkCollapse(r[n],r[n+1],r[n+2])},on.prototype.hasInteriorIntersection=function(t,e,r){for(var n=0;n<t.getIntersectionNum();n++){var i=t.getIntersection(n);if(!i.equals(e)&&!i.equals(r))return!0}return!1},on.prototype.checkCollapse=function(t,e,r){if(t.equals(r))throw new Q("found non-noded collapse at "+on.fact.createLineString([t,e,r]))},on.prototype.interfaces_=function(){return[]},on.prototype.getClass=function(){return on},an.fact.get=function(){return new me},Object.defineProperties(on,an);var sn=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var t=arguments[0],e=arguments[1],r=arguments[2];if(this._originalPt=t,this._pt=t,this._scaleFactor=e,this._li=r,e<=0)throw new v("Scale factor must be non-zero");1!==e&&(this._pt=new x(this.scale(t.x),this.scale(t.y)),this._p0Scaled=new x,this._p1Scaled=new x),this.initCorners(this._pt)},un={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};sn.prototype.intersectsScaled=function(t,e){var r=Math.min(t.x,e.x),n=Math.max(t.x,e.x),i=Math.min(t.y,e.y),o=Math.max(t.y,e.y),a=this._maxx<r||this._minx>n||this._maxy<i||this._miny>o;if(a)return!1;var s=this.intersectsToleranceSquare(t,e);return et.isTrue(!(a&&s),"Found bad envelope test"),s},sn.prototype.initCorners=function(t){this._minx=t.x-.5,this._maxx=t.x+.5,this._miny=t.y-.5,this._maxy=t.y+.5,this._corner[0]=new x(this._maxx,this._maxy),this._corner[1]=new x(this._minx,this._maxy),this._corner[2]=new x(this._minx,this._miny),this._corner[3]=new x(this._maxx,this._miny)},sn.prototype.intersects=function(t,e){return 1===this._scaleFactor?this.intersectsScaled(t,e):(this.copyScaled(t,this._p0Scaled),this.copyScaled(e,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))},sn.prototype.scale=function(t){return Math.round(t*this._scaleFactor)},sn.prototype.getCoordinate=function(){return this._originalPt},sn.prototype.copyScaled=function(t,e){e.x=this.scale(t.x),e.y=this.scale(t.y)},sn.prototype.getSafeEnvelope=function(){if(null===this._safeEnv){var t=sn.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new X(this._originalPt.x-t,this._originalPt.x+t,this._originalPt.y-t,this._originalPt.y+t)}return this._safeEnv},sn.prototype.intersectsPixelClosure=function(t,e){return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),this._li.hasIntersection()))))},sn.prototype.intersectsToleranceSquare=function(t,e){var r=!1,n=!1;return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),this._li.isProper()||(this._li.hasIntersection()&&(r=!0),this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),this._li.isProper()||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),this._li.isProper()||r&&n||t.equals(this._pt)||e.equals(this._pt)))))},sn.prototype.addSnappedNode=function(t,e){var r=t.getCoordinate(e),n=t.getCoordinate(e+1);return!!this.intersects(r,n)&&(t.addIntersection(this.getCoordinate(),e),!0)},sn.prototype.interfaces_=function(){return[]},sn.prototype.getClass=function(){return sn},un.SAFE_ENV_EXPANSION_FACTOR.get=function(){return.75},Object.defineProperties(sn,un);var ln=function(){this.tempEnv1=new X,this.selectedSegment=new yr};ln.prototype.select=function(){if(1===arguments.length);else if(2===arguments.length){var t=arguments[1];arguments[0].getLineSegment(t,this.selectedSegment),this.select(this.selectedSegment)}},ln.prototype.interfaces_=function(){return[]},ln.prototype.getClass=function(){return ln};var cn=function(){this._index=null;var t=arguments[0];this._index=t},fn={HotPixelSnapAction:{configurable:!0}};cn.prototype.snap=function(){if(1===arguments.length){var t=arguments[0];return this.snap(t,null,-1)}if(3===arguments.length){var e=arguments[0],r=arguments[1],n=arguments[2],i=e.getSafeEnvelope(),o=new pn(e,r,n);return this._index.query(i,{interfaces_:function(){return[Ye]},visitItem:function(t){t.select(i,o)}}),o.isNodeAdded()}},cn.prototype.interfaces_=function(){return[]},cn.prototype.getClass=function(){return cn},fn.HotPixelSnapAction.get=function(){return pn},Object.defineProperties(cn,fn);var pn=function(t){function e(){t.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var e=arguments[0],r=arguments[1],n=arguments[2];this._hotPixel=e,this._parentEdge=r,this._hotPixelVertexIndex=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isNodeAdded=function(){return this._isNodeAdded},e.prototype.select=function(){if(2!==arguments.length)return t.prototype.select.apply(this,arguments);var e=arguments[1],r=arguments[0].getContext();if(null!==this._parentEdge&&r===this._parentEdge&&e===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(r,e)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(ln),hn=function(){this._li=null,this._interiorIntersections=null;var t=arguments[0];this._li=t,this._interiorIntersections=new Ot};hn.prototype.processIntersections=function(t,e,r,n){if(t===r&&e===n)return null;var i=t.getCoordinates()[e],o=t.getCoordinates()[e+1],a=r.getCoordinates()[n],s=r.getCoordinates()[n+1];if(this._li.computeIntersection(i,o,a,s),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var u=0;u<this._li.getIntersectionNum();u++)this._interiorIntersections.add(this._li.getIntersection(u));t.addIntersections(this._li,e,0),r.addIntersections(this._li,n,1)}},hn.prototype.isDone=function(){return!1},hn.prototype.getInteriorIntersections=function(){return this._interiorIntersections},hn.prototype.interfaces_=function(){return[Zr]},hn.prototype.getClass=function(){return hn};var yn=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var t=arguments[0];this._pm=t,this._li=new it,this._li.setPrecisionModel(t),this._scaleFactor=t.getScale()};yn.prototype.checkCorrectness=function(t){var e=hr.getNodedSubstrings(t),r=new on(e);try{r.checkValid()}catch(t){if(!(t instanceof V))throw t;t.printStackTrace()}},yn.prototype.getNodedSubstrings=function(){return hr.getNodedSubstrings(this._nodedSegStrings)},yn.prototype.snapRound=function(t,e){var r=this.findInteriorIntersections(t,e);this.computeIntersectionSnaps(r),this.computeVertexSnaps(t)},yn.prototype.findInteriorIntersections=function(t,e){var r=new hn(e);return this._noder.setSegmentIntersector(r),this._noder.computeNodes(t),r.getInteriorIntersections()},yn.prototype.computeVertexSnaps=function(){if(j(arguments[0],bt))for(var t=arguments[0].iterator();t.hasNext();){var e=t.next();this.computeVertexSnaps(e)}else if(arguments[0]instanceof hr)for(var r=arguments[0],n=r.getCoordinates(),i=0;i<n.length;i++){var o=new sn(n[i],this._scaleFactor,this._li);this._pointSnapper.snap(o,r,i)&&r.addIntersection(n[i],i)}},yn.prototype.computeNodes=function(t){this._nodedSegStrings=t,this._noder=new wr,this._pointSnapper=new cn(this._noder.getIndex()),this.snapRound(t,this._li)},yn.prototype.computeIntersectionSnaps=function(t){for(var e=t.iterator();e.hasNext();){var r=e.next(),n=new sn(r,this._scaleFactor,this._li);this._pointSnapper.snap(n)}},yn.prototype.interfaces_=function(){return[_r]},yn.prototype.getClass=function(){return yn};var dn=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new Or,this._resultGeometry=null,this._saveException=null,1===arguments.length){var t=arguments[0];this._argGeom=t}else if(2===arguments.length){var e=arguments[0],r=arguments[1];this._argGeom=e,this._bufParams=r}},gn={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};dn.prototype.bufferFixedPrecision=function(t){var e=new nn(new yn(new he(1)),t.getScale()),r=new rn(this._bufParams);r.setWorkingPrecisionModel(t),r.setNoder(e),this._resultGeometry=r.buffer(this._argGeom,this._distance)},dn.prototype.bufferReducedPrecision=function(){var t=this;if(0===arguments.length){for(var e=dn.MAX_PRECISION_DIGITS;e>=0;e--){try{t.bufferReducedPrecision(e)}catch(e){if(!(e instanceof ke))throw e;t._saveException=e}if(null!==t._resultGeometry)return null}throw this._saveException}if(1===arguments.length){var r=arguments[0],n=dn.precisionScaleFactor(this._argGeom,this._distance,r),i=new he(n);this.bufferFixedPrecision(i)}},dn.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),null!==this._resultGeometry)return null;var t=this._argGeom.getFactory().getPrecisionModel();t.getType()===he.FIXED?this.bufferFixedPrecision(t):this.bufferReducedPrecision()},dn.prototype.setQuadrantSegments=function(t){this._bufParams.setQuadrantSegments(t)},dn.prototype.bufferOriginalPrecision=function(){try{var t=new rn(this._bufParams);this._resultGeometry=t.buffer(this._argGeom,this._distance)}catch(t){if(!(t instanceof Q))throw t;this._saveException=t}},dn.prototype.getResultGeometry=function(t){return this._distance=t,this.computeGeometry(),this._resultGeometry},dn.prototype.setEndCapStyle=function(t){this._bufParams.setEndCapStyle(t)},dn.prototype.interfaces_=function(){return[]},dn.prototype.getClass=function(){return dn},dn.bufferOp=function(){if(2===arguments.length){var t=arguments[1];return new dn(arguments[0]).getResultGeometry(t)}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof ct&&"number"==typeof arguments[1]){var e=arguments[1],r=arguments[2],n=new dn(arguments[0]);return n.setQuadrantSegments(r),n.getResultGeometry(e)}if(arguments[2]instanceof Or&&arguments[0]instanceof ct&&"number"==typeof arguments[1]){var i=arguments[1];return new dn(arguments[0],arguments[2]).getResultGeometry(i)}}else if(4===arguments.length){var o=arguments[1],a=arguments[2],s=arguments[3],u=new dn(arguments[0]);return u.setQuadrantSegments(a),u.setEndCapStyle(s),u.getResultGeometry(o)}},dn.precisionScaleFactor=function(t,e,r){var n=t.getEnvelopeInternal(),i=R.max(Math.abs(n.getMaxX()),Math.abs(n.getMaxY()),Math.abs(n.getMinX()),Math.abs(n.getMinY()))+2*(e>0?e:0),o=r-Math.trunc(Math.log(i)/Math.log(10)+1);return Math.pow(10,o)},gn.CAP_ROUND.get=function(){return Or.CAP_ROUND},gn.CAP_BUTT.get=function(){return Or.CAP_FLAT},gn.CAP_FLAT.get=function(){return Or.CAP_FLAT},gn.CAP_SQUARE.get=function(){return Or.CAP_SQUARE},gn.MAX_PRECISION_DIGITS.get=function(){return 12},Object.defineProperties(dn,gn);var mn=function(){this._pt=[new x,new x],this._distance=_.NaN,this._isNull=!0};mn.prototype.getCoordinates=function(){return this._pt},mn.prototype.getCoordinate=function(t){return this._pt[t]},mn.prototype.setMinimum=function(){if(1===arguments.length){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],r=arguments[1];if(this._isNull)return this.initialize(e,r),null;var n=e.distance(r);n<this._distance&&this.initialize(e,r,n)}},mn.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(3===arguments.length){var r=arguments[0],n=arguments[1],i=arguments[2];this._pt[0].setCoordinate(r),this._pt[1].setCoordinate(n),this._distance=i,this._isNull=!1}},mn.prototype.getDistance=function(){return this._distance},mn.prototype.setMaximum=function(){if(1===arguments.length){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],r=arguments[1];if(this._isNull)return this.initialize(e,r),null;var n=e.distance(r);n>this._distance&&this.initialize(e,r,n)}},mn.prototype.interfaces_=function(){return[]},mn.prototype.getClass=function(){return mn};var vn=function(){};vn.prototype.interfaces_=function(){return[]},vn.prototype.getClass=function(){return vn},vn.computeDistance=function(){if(arguments[2]instanceof mn&&arguments[0]instanceof Yt&&arguments[1]instanceof x)for(var t=arguments[1],e=arguments[2],r=arguments[0].getCoordinates(),n=new yr,i=0;i<r.length-1;i++){n.setCoordinates(r[i],r[i+1]);var o=n.closestPoint(t);e.setMinimum(o,t)}else if(arguments[2]instanceof mn&&arguments[0]instanceof Qt&&arguments[1]instanceof x){var a=arguments[0],s=arguments[1],u=arguments[2];vn.computeDistance(a.getExteriorRing(),s,u);for(var l=0;l<a.getNumInteriorRing();l++)vn.computeDistance(a.getInteriorRingN(l),s,u)}else if(arguments[2]instanceof mn&&arguments[0]instanceof ct&&arguments[1]instanceof x){var c=arguments[0],f=arguments[1],p=arguments[2];if(c instanceof Yt)vn.computeDistance(c,f,p);else if(c instanceof Qt)vn.computeDistance(c,f,p);else if(c instanceof Vt)for(var h=c,y=0;y<h.getNumGeometries();y++){var d=h.getGeometryN(y);vn.computeDistance(d,f,p)}else p.setMinimum(c.getCoordinate(),f)}else if(arguments[2]instanceof mn&&arguments[0]instanceof yr&&arguments[1]instanceof x){var g=arguments[1],m=arguments[2],v=arguments[0].closestPoint(g);m.setMinimum(v,g)}};var _n=function(t){this._maxPtDist=new mn,this._inputGeom=t||null},bn={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};_n.prototype.computeMaxMidpointDistance=function(t){var e=new Sn(this._inputGeom);t.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())},_n.prototype.computeMaxVertexDistance=function(t){var e=new wn(this._inputGeom);t.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())},_n.prototype.findDistance=function(t){return this.computeMaxVertexDistance(t),this.computeMaxMidpointDistance(t),this._maxPtDist.getDistance()},_n.prototype.getDistancePoints=function(){return this._maxPtDist},_n.prototype.interfaces_=function(){return[]},_n.prototype.getClass=function(){return _n},bn.MaxPointDistanceFilter.get=function(){return wn},bn.MaxMidpointDistanceFilter.get=function(){return Sn},Object.defineProperties(_n,bn);var wn=function(t){this._maxPtDist=new mn,this._minPtDist=new mn,this._geom=t||null};wn.prototype.filter=function(t){this._minPtDist.initialize(),vn.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},wn.prototype.getMaxPointDistance=function(){return this._maxPtDist},wn.prototype.interfaces_=function(){return[ht]},wn.prototype.getClass=function(){return wn};var Sn=function(t){this._maxPtDist=new mn,this._minPtDist=new mn,this._geom=t||null};Sn.prototype.filter=function(t,e){if(0===e)return null;var r=t.getCoordinate(e-1),n=t.getCoordinate(e),i=new x((r.x+n.x)/2,(r.y+n.y)/2);this._minPtDist.initialize(),vn.computeDistance(this._geom,i,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},Sn.prototype.isDone=function(){return!1},Sn.prototype.isGeometryChanged=function(){return!1},Sn.prototype.getMaxPointDistance=function(){return this._maxPtDist},Sn.prototype.interfaces_=function(){return[Bt]},Sn.prototype.getClass=function(){return Sn};var On=function(t){this._comps=t||null};On.prototype.filter=function(t){t instanceof Qt&&this._comps.add(t)},On.prototype.interfaces_=function(){return[Gt]},On.prototype.getClass=function(){return On},On.getPolygons=function(){if(1===arguments.length)return On.getPolygons(arguments[0],new Ot);if(2===arguments.length){var t=arguments[0],e=arguments[1];return t instanceof Qt?e.add(t):t instanceof Vt&&t.apply(new On(e)),e}};var xn=function(){if(this._lines=null,this._isForcedToLineString=!1,1===arguments.length){var t=arguments[0];this._lines=t}else if(2===arguments.length){var e=arguments[0],r=arguments[1];this._lines=e,this._isForcedToLineString=r}};xn.prototype.filter=function(t){if(this._isForcedToLineString&&t instanceof ee){var e=t.getFactory().createLineString(t.getCoordinateSequence());return this._lines.add(e),null}t instanceof Yt&&this._lines.add(t)},xn.prototype.setForceToLineString=function(t){this._isForcedToLineString=t},xn.prototype.interfaces_=function(){return[lt]},xn.prototype.getClass=function(){return xn},xn.getGeometry=function(){if(1===arguments.length){var t=arguments[0];return t.getFactory().buildGeometry(xn.getLines(t))}if(2===arguments.length){var e=arguments[0],r=arguments[1];return e.getFactory().buildGeometry(xn.getLines(e,r))}},xn.getLines=function(){if(1===arguments.length)return xn.getLines(arguments[0],!1);if(2===arguments.length){if(j(arguments[0],bt)&&j(arguments[1],bt)){for(var t=arguments[1],e=arguments[0].iterator();e.hasNext();){var r=e.next();xn.getLines(r,t)}return t}if(arguments[0]instanceof ct&&"boolean"==typeof arguments[1]){var n=arguments[0],i=arguments[1],o=new Ot;return n.apply(new xn(o,i)),o}if(arguments[0]instanceof ct&&j(arguments[1],bt)){var a=arguments[0],s=arguments[1];return a instanceof Yt?s.add(a):a.apply(new xn(s)),s}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&j(arguments[0],bt)&&j(arguments[1],bt)){for(var u=arguments[1],l=arguments[2],c=arguments[0].iterator();c.hasNext();){var f=c.next();xn.getLines(f,u,l)}return u}if("boolean"==typeof arguments[2]&&arguments[0]instanceof ct&&j(arguments[1],bt)){var p=arguments[1],h=arguments[2];return arguments[0].apply(new xn(p,h)),p}}};var Cn=function(){if(this._boundaryRule=yt.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];if(null===t)throw new v("Rule must be non-null");this._boundaryRule=t}};Cn.prototype.locateInternal=function(){if(arguments[0]instanceof x&&arguments[1]instanceof Qt){var t=arguments[0],e=arguments[1];if(e.isEmpty())return k.EXTERIOR;var r=e.getExteriorRing(),n=this.locateInPolygonRing(t,r);if(n===k.EXTERIOR)return k.EXTERIOR;if(n===k.BOUNDARY)return k.BOUNDARY;for(var i=0;i<e.getNumInteriorRing();i++){var o=e.getInteriorRingN(i),a=this.locateInPolygonRing(t,o);if(a===k.INTERIOR)return k.EXTERIOR;if(a===k.BOUNDARY)return k.BOUNDARY}return k.INTERIOR}if(arguments[0]instanceof x&&arguments[1]instanceof Yt){var s=arguments[0],u=arguments[1];if(!u.getEnvelopeInternal().intersects(s))return k.EXTERIOR;var l=u.getCoordinates();return u.isClosed()||!s.equals(l[0])&&!s.equals(l[l.length-1])?st.isOnLine(s,l)?k.INTERIOR:k.EXTERIOR:k.BOUNDARY}if(arguments[0]instanceof x&&arguments[1]instanceof Jt){var c=arguments[0];return arguments[1].getCoordinate().equals2D(c)?k.INTERIOR:k.EXTERIOR}},Cn.prototype.locateInPolygonRing=function(t,e){return e.getEnvelopeInternal().intersects(t)?st.locatePointInRing(t,e.getCoordinates()):k.EXTERIOR},Cn.prototype.intersects=function(t,e){return this.locate(t,e)!==k.EXTERIOR},Cn.prototype.updateLocationInfo=function(t){t===k.INTERIOR&&(this._isIn=!0),t===k.BOUNDARY&&this._numBoundaries++},Cn.prototype.computeLocation=function(t,e){if(e instanceof Jt&&this.updateLocationInfo(this.locateInternal(t,e)),e instanceof Yt)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof Qt)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof Ut)for(var r=e,n=0;n<r.getNumGeometries();n++){var i=r.getGeometryN(n);this.updateLocationInfo(this.locateInternal(t,i))}else if(e instanceof re)for(var o=e,a=0;a<o.getNumGeometries();a++){var s=o.getGeometryN(a);this.updateLocationInfo(this.locateInternal(t,s))}else if(e instanceof Vt)for(var u=new Gr(e);u.hasNext();){var l=u.next();l!==e&&this.computeLocation(t,l)}},Cn.prototype.locate=function(t,e){return e.isEmpty()?k.EXTERIOR:e instanceof Yt||e instanceof Qt?this.locateInternal(t,e):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(t,e),this._boundaryRule.isInBoundary(this._numBoundaries)?k.BOUNDARY:this._numBoundaries>0||this._isIn?k.INTERIOR:k.EXTERIOR)},Cn.prototype.interfaces_=function(){return[]},Cn.prototype.getClass=function(){return Cn};var En=function t(){if(this._component=null,this._segIndex=null,this._pt=null,2===arguments.length)t.call(this,arguments[0],t.INSIDE_AREA,arguments[1]);else if(3===arguments.length){var e=arguments[0],r=arguments[1],n=arguments[2];this._component=e,this._segIndex=r,this._pt=n}},Pn={INSIDE_AREA:{configurable:!0}};En.prototype.isInsideArea=function(){return this._segIndex===En.INSIDE_AREA},En.prototype.getCoordinate=function(){return this._pt},En.prototype.getGeometryComponent=function(){return this._component},En.prototype.getSegmentIndex=function(){return this._segIndex},En.prototype.interfaces_=function(){return[]},En.prototype.getClass=function(){return En},Pn.INSIDE_AREA.get=function(){return-1},Object.defineProperties(En,Pn);var kn=function(t){this._pts=t||null};kn.prototype.filter=function(t){t instanceof Jt&&this._pts.add(t)},kn.prototype.interfaces_=function(){return[Gt]},kn.prototype.getClass=function(){return kn},kn.getPoints=function(){if(1===arguments.length){var t=arguments[0];return t instanceof Jt?Qe.singletonList(t):kn.getPoints(t,new Ot)}if(2===arguments.length){var e=arguments[0],r=arguments[1];return e instanceof Jt?r.add(e):e instanceof Vt&&e.apply(new kn(r)),r}};var Tn=function(){this._locations=null;var t=arguments[0];this._locations=t};Tn.prototype.filter=function(t){(t instanceof Jt||t instanceof Yt||t instanceof Qt)&&this._locations.add(new En(t,0,t.getCoordinate()))},Tn.prototype.interfaces_=function(){return[Gt]},Tn.prototype.getClass=function(){return Tn},Tn.getLocations=function(t){var e=new Ot;return t.apply(new Tn(e)),e};var jn=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new Cn,this._minDistanceLocation=null,this._minDistance=_.MAX_VALUE,2===arguments.length){var t=arguments[0],e=arguments[1];this._geom=[t,e],this._terminateDistance=0}else if(3===arguments.length){var r=arguments[0],n=arguments[1],i=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=r,this._geom[1]=n,this._terminateDistance=i}};jn.prototype.computeContainmentDistance=function(){if(0===arguments.length){var t=new Array(2).fill(null);if(this.computeContainmentDistance(0,t),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,t)}else if(2===arguments.length){var e=arguments[0],r=arguments[1],n=1-e,i=On.getPolygons(this._geom[e]);if(i.size()>0){var o=Tn.getLocations(this._geom[n]);if(this.computeContainmentDistance(o,i,r),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[n]=r[0],this._minDistanceLocation[e]=r[1],null}}else if(3===arguments.length)if(arguments[2]instanceof Array&&j(arguments[0],St)&&j(arguments[1],St)){for(var a=arguments[0],s=arguments[1],u=arguments[2],l=0;l<a.size();l++)for(var c=a.get(l),f=0;f<s.size();f++)if(this.computeContainmentDistance(c,s.get(f),u),this._minDistance<=this._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof En&&arguments[1]instanceof Qt){var p=arguments[0],h=arguments[1],y=arguments[2],d=p.getCoordinate();if(k.EXTERIOR!==this._ptLocator.locate(d,h))return this._minDistance=0,y[0]=p,y[1]=new En(h,d),null}},jn.prototype.computeMinDistanceLinesPoints=function(t,e,r){for(var n=0;n<t.size();n++)for(var i=t.get(n),o=0;o<e.size();o++){var a=e.get(o);if(this.computeMinDistance(i,a,r),this._minDistance<=this._terminateDistance)return null}},jn.prototype.computeFacetDistance=function(){var t=new Array(2).fill(null),e=xn.getLines(this._geom[0]),r=xn.getLines(this._geom[1]),n=kn.getPoints(this._geom[0]),i=kn.getPoints(this._geom[1]);return this.computeMinDistanceLines(e,r,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(e,i,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(r,n,t),this.updateMinDistance(t,!0),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistancePoints(n,i,t),void this.updateMinDistance(t,!1))))},jn.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation},jn.prototype.updateMinDistance=function(t,e){if(null===t[0])return null;e?(this._minDistanceLocation[0]=t[1],this._minDistanceLocation[1]=t[0]):(this._minDistanceLocation[0]=t[0],this._minDistanceLocation[1]=t[1])},jn.prototype.nearestPoints=function(){return this.computeMinDistance(),[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()]},jn.prototype.computeMinDistance=function(){if(0===arguments.length){if(null!==this._minDistanceLocation)return null;if(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance)return null;this.computeFacetDistance()}else if(3===arguments.length)if(arguments[2]instanceof Array&&arguments[0]instanceof Yt&&arguments[1]instanceof Jt){var t=arguments[0],e=arguments[1],r=arguments[2];if(t.getEnvelopeInternal().distance(e.getEnvelopeInternal())>this._minDistance)return null;for(var n=t.getCoordinates(),i=e.getCoordinate(),o=0;o<n.length-1;o++){var a=st.distancePointLine(i,n[o],n[o+1]);if(a<this._minDistance){this._minDistance=a;var s=new yr(n[o],n[o+1]).closestPoint(i);r[0]=new En(t,o,s),r[1]=new En(e,0,i)}if(this._minDistance<=this._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof Yt&&arguments[1]instanceof Yt){var u=arguments[0],l=arguments[1],c=arguments[2];if(u.getEnvelopeInternal().distance(l.getEnvelopeInternal())>this._minDistance)return null;for(var f=u.getCoordinates(),p=l.getCoordinates(),h=0;h<f.length-1;h++)for(var y=0;y<p.length-1;y++){var d=st.distanceLineLine(f[h],f[h+1],p[y],p[y+1]);if(d<this._minDistance){this._minDistance=d;var g=new yr(f[h],f[h+1]),m=new yr(p[y],p[y+1]),v=g.closestPoints(m);c[0]=new En(u,h,v[0]),c[1]=new En(l,y,v[1])}if(this._minDistance<=this._terminateDistance)return null}}},jn.prototype.computeMinDistancePoints=function(t,e,r){for(var n=0;n<t.size();n++)for(var i=t.get(n),o=0;o<e.size();o++){var a=e.get(o),s=i.getCoordinate().distance(a.getCoordinate());if(s<this._minDistance&&(this._minDistance=s,r[0]=new En(i,0,i.getCoordinate()),r[1]=new En(a,0,a.getCoordinate())),this._minDistance<=this._terminateDistance)return null}},jn.prototype.distance=function(){if(null===this._geom[0]||null===this._geom[1])throw new v("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)},jn.prototype.computeMinDistanceLines=function(t,e,r){for(var n=0;n<t.size();n++)for(var i=t.get(n),o=0;o<e.size();o++){var a=e.get(o);if(this.computeMinDistance(i,a,r),this._minDistance<=this._terminateDistance)return null}},jn.prototype.interfaces_=function(){return[]},jn.prototype.getClass=function(){return jn},jn.distance=function(t,e){return new jn(t,e).distance()},jn.isWithinDistance=function(t,e,r){return new jn(t,e,r).distance()<=r},jn.nearestPoints=function(t,e){return new jn(t,e).nearestPoints()};var Rn=function(){this._pt=[new x,new x],this._distance=_.NaN,this._isNull=!0};Rn.prototype.getCoordinates=function(){return this._pt},Rn.prototype.getCoordinate=function(t){return this._pt[t]},Rn.prototype.setMinimum=function(){if(1===arguments.length){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],r=arguments[1];if(this._isNull)return this.initialize(e,r),null;var n=e.distance(r);n<this._distance&&this.initialize(e,r,n)}},Rn.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(3===arguments.length){var r=arguments[0],n=arguments[1],i=arguments[2];this._pt[0].setCoordinate(r),this._pt[1].setCoordinate(n),this._distance=i,this._isNull=!1}},Rn.prototype.toString=function(){return $.toLineString(this._pt[0],this._pt[1])},Rn.prototype.getDistance=function(){return this._distance},Rn.prototype.setMaximum=function(){if(1===arguments.length){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],r=arguments[1];if(this._isNull)return this.initialize(e,r),null;var n=e.distance(r);n>this._distance&&this.initialize(e,r,n)}},Rn.prototype.interfaces_=function(){return[]},Rn.prototype.getClass=function(){return Rn};var Ln=function(){};Ln.prototype.interfaces_=function(){return[]},Ln.prototype.getClass=function(){return Ln},Ln.computeDistance=function(){if(arguments[2]instanceof Rn&&arguments[0]instanceof Yt&&arguments[1]instanceof x)for(var t=arguments[0],e=arguments[1],r=arguments[2],n=new yr,i=t.getCoordinates(),o=0;o<i.length-1;o++){n.setCoordinates(i[o],i[o+1]);var a=n.closestPoint(e);r.setMinimum(a,e)}else if(arguments[2]instanceof Rn&&arguments[0]instanceof Qt&&arguments[1]instanceof x){var s=arguments[0],u=arguments[1],l=arguments[2];Ln.computeDistance(s.getExteriorRing(),u,l);for(var c=0;c<s.getNumInteriorRing();c++)Ln.computeDistance(s.getInteriorRingN(c),u,l)}else if(arguments[2]instanceof Rn&&arguments[0]instanceof ct&&arguments[1]instanceof x){var f=arguments[0],p=arguments[1],h=arguments[2];if(f instanceof Yt)Ln.computeDistance(f,p,h);else if(f instanceof Qt)Ln.computeDistance(f,p,h);else if(f instanceof Vt)for(var y=f,d=0;d<y.getNumGeometries();d++){var g=y.getGeometryN(d);Ln.computeDistance(g,p,h)}else h.setMinimum(f.getCoordinate(),p)}else if(arguments[2]instanceof Rn&&arguments[0]instanceof yr&&arguments[1]instanceof x){var m=arguments[1],v=arguments[2],_=arguments[0].closestPoint(m);v.setMinimum(_,m)}};var In=function(){this._g0=null,this._g1=null,this._ptDist=new Rn,this._densifyFrac=0;var t=arguments[0],e=arguments[1];this._g0=t,this._g1=e},Mn={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};In.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()},In.prototype.setDensifyFraction=function(t){if(t>1||t<=0)throw new v("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=t},In.prototype.compute=function(t,e){this.computeOrientedDistance(t,e,this._ptDist),this.computeOrientedDistance(e,t,this._ptDist)},In.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()},In.prototype.computeOrientedDistance=function(t,e,r){var n=new An(e);if(t.apply(n),r.setMaximum(n.getMaxPointDistance()),this._densifyFrac>0){var i=new Dn(e,this._densifyFrac);t.apply(i),r.setMaximum(i.getMaxPointDistance())}},In.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()},In.prototype.interfaces_=function(){return[]},In.prototype.getClass=function(){return In},In.distance=function(){if(2===arguments.length)return new In(arguments[0],arguments[1]).distance();if(3===arguments.length){var t=arguments[2],e=new In(arguments[0],arguments[1]);return e.setDensifyFraction(t),e.distance()}},Mn.MaxPointDistanceFilter.get=function(){return An},Mn.MaxDensifiedByFractionDistanceFilter.get=function(){return Dn},Object.defineProperties(In,Mn);var An=function(){this._maxPtDist=new Rn,this._minPtDist=new Rn,this._euclideanDist=new Ln,this._geom=null;var t=arguments[0];this._geom=t};An.prototype.filter=function(t){this._minPtDist.initialize(),Ln.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},An.prototype.getMaxPointDistance=function(){return this._maxPtDist},An.prototype.interfaces_=function(){return[ht]},An.prototype.getClass=function(){return An};var Dn=function(){this._maxPtDist=new Rn,this._minPtDist=new Rn,this._geom=null,this._numSubSegs=0;var t=arguments[0],e=arguments[1];this._geom=t,this._numSubSegs=Math.trunc(Math.round(1/e))};Dn.prototype.filter=function(t,e){if(0===e)return null;for(var r=t.getCoordinate(e-1),n=t.getCoordinate(e),i=(n.x-r.x)/this._numSubSegs,o=(n.y-r.y)/this._numSubSegs,a=0;a<this._numSubSegs;a++){var s=r.x+a*i,u=r.y+a*o,l=new x(s,u);this._minPtDist.initialize(),Ln.computeDistance(this._geom,l,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)}},Dn.prototype.isDone=function(){return!1},Dn.prototype.isGeometryChanged=function(){return!1},Dn.prototype.getMaxPointDistance=function(){return this._maxPtDist},Dn.prototype.interfaces_=function(){return[Bt]},Dn.prototype.getClass=function(){return Dn};var Nn=function(t,e,r){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._bufDistance=e||null,this._result=r||null},Fn={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};Nn.prototype.checkMaximumDistance=function(t,e,r){var n=new In(e,t);if(n.setDensifyFraction(.25),this._maxDistanceFound=n.orientedDistance(),this._maxDistanceFound>r){this._isValid=!1;var i=n.getCoordinates();this._errorLocation=i[1],this._errorIndicator=t.getFactory().createLineString(i),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+$.toLineString(i[0],i[1])+")"}},Nn.prototype.isValid=function(){var t=Math.abs(this._bufDistance),e=Nn.MAX_DISTANCE_DIFF_FRAC*t;return this._minValidDistance=t-e,this._maxValidDistance=t+e,!(!this._input.isEmpty()&&!this._result.isEmpty())||(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),Nn.VERBOSE&&q.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)},Nn.prototype.checkNegativeValid=function(){if(!(this._input instanceof Qt||this._input instanceof re||this._input instanceof Vt))return null;var t=this.getPolygonLines(this._input);if(this.checkMinimumDistance(t,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(t,this._result,this._maxValidDistance)},Nn.prototype.getErrorIndicator=function(){return this._errorIndicator},Nn.prototype.checkMinimumDistance=function(t,e,r){var n=new jn(t,e,r);if(this._minDistanceFound=n.distance(),this._minDistanceFound<r){this._isValid=!1;var i=n.nearestPoints();this._errorLocation=n.nearestPoints()[1],this._errorIndicator=t.getFactory().createLineString(i),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+$.toLineString(i[0],i[1])+" )"}},Nn.prototype.checkPositiveValid=function(){var t=this._result.getBoundary();if(this.checkMinimumDistance(this._input,t,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,t,this._maxValidDistance)},Nn.prototype.getErrorLocation=function(){return this._errorLocation},Nn.prototype.getPolygonLines=function(t){for(var e=new Ot,r=new xn(e),n=On.getPolygons(t).iterator();n.hasNext();)n.next().apply(r);return t.getFactory().buildGeometry(e)},Nn.prototype.getErrorMessage=function(){return this._errMsg},Nn.prototype.interfaces_=function(){return[]},Nn.prototype.getClass=function(){return Nn},Fn.VERBOSE.get=function(){return!1},Fn.MAX_DISTANCE_DIFF_FRAC.get=function(){return.012},Object.defineProperties(Nn,Fn);var zn=function(t,e,r){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._distance=e||null,this._result=r||null},Gn={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};zn.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid},zn.prototype.checkEnvelope=function(){if(this._distance<0)return null;var t=this._distance*zn.MAX_ENV_DIFF_FRAC;0===t&&(t=.001);var e=new X(this._input.getEnvelopeInternal());e.expandBy(this._distance);var r=new X(this._result.getEnvelopeInternal());r.expandBy(t),r.contains(e)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(r)),this.report("Envelope")},zn.prototype.checkDistance=function(){var t=new Nn(this._input,this._distance,this._result);t.isValid()||(this._isValid=!1,this._errorMsg=t.getErrorMessage(),this._errorLocation=t.getErrorLocation(),this._errorIndicator=t.getErrorIndicator()),this.report("Distance")},zn.prototype.checkArea=function(){var t=this._input.getArea(),e=this._result.getArea();this._distance>0&&t>e&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&t<e&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")},zn.prototype.checkPolygonal=function(){this._result instanceof Qt||this._result instanceof re||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")},zn.prototype.getErrorIndicator=function(){return this._errorIndicator},zn.prototype.getErrorLocation=function(){return this._errorLocation},zn.prototype.checkExpectedEmpty=function(){return this._input.getDimension()>=2||this._distance>0?null:(this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),void this.report("ExpectedEmpty"))},zn.prototype.report=function(t){if(!zn.VERBOSE)return null;q.out.println("Check "+t+": "+(this._isValid?"passed":"FAILED"))},zn.prototype.getErrorMessage=function(){return this._errorMsg},zn.prototype.interfaces_=function(){return[]},zn.prototype.getClass=function(){return zn},zn.isValidMsg=function(t,e,r){var n=new zn(t,e,r);return n.isValid()?null:n.getErrorMessage()},zn.isValid=function(t,e,r){return!!new zn(t,e,r).isValid()},Gn.VERBOSE.get=function(){return!1},Gn.MAX_ENV_DIFF_FRAC.get=function(){return.012},Object.defineProperties(zn,Gn);var Bn=function(){this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e};Bn.prototype.getCoordinates=function(){return this._pts},Bn.prototype.size=function(){return this._pts.length},Bn.prototype.getCoordinate=function(t){return this._pts[t]},Bn.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},Bn.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:cr.octant(this.getCoordinate(t),this.getCoordinate(t+1))},Bn.prototype.setData=function(t){this._data=t},Bn.prototype.getData=function(){return this._data},Bn.prototype.toString=function(){return $.toLineString(new ue(this._pts))},Bn.prototype.interfaces_=function(){return[fr]},Bn.prototype.getClass=function(){return Bn};var Vn=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new Ot,this._intersectionCount=0,this._keepIntersections=!0;var t=arguments[0];this._li=t,this._interiorIntersection=null};Vn.prototype.getInteriorIntersection=function(){return this._interiorIntersection},Vn.prototype.setCheckEndSegmentsOnly=function(t){this._isCheckEndSegmentsOnly=t},Vn.prototype.getIntersectionSegments=function(){return this._intSegments},Vn.prototype.count=function(){return this._intersectionCount},Vn.prototype.getIntersections=function(){return this._intersections},Vn.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t},Vn.prototype.setKeepIntersections=function(t){this._keepIntersections=t},Vn.prototype.processIntersections=function(t,e,r,n){if(!this._findAllIntersections&&this.hasIntersection())return null;if(t===r&&e===n)return null;if(this._isCheckEndSegmentsOnly&&!this.isEndSegment(t,e)&&!this.isEndSegment(r,n))return null;var i=t.getCoordinates()[e],o=t.getCoordinates()[e+1],a=r.getCoordinates()[n],s=r.getCoordinates()[n+1];this._li.computeIntersection(i,o,a,s),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=i,this._intSegments[1]=o,this._intSegments[2]=a,this._intSegments[3]=s,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)},Vn.prototype.isEndSegment=function(t,e){return 0===e||e>=t.size()-2},Vn.prototype.hasIntersection=function(){return null!==this._interiorIntersection},Vn.prototype.isDone=function(){return!this._findAllIntersections&&null!==this._interiorIntersection},Vn.prototype.interfaces_=function(){return[Zr]},Vn.prototype.getClass=function(){return Vn},Vn.createAllIntersectionsFinder=function(t){var e=new Vn(t);return e.setFindAllIntersections(!0),e},Vn.createAnyIntersectionFinder=function(t){return new Vn(t)},Vn.createIntersectionCounter=function(t){var e=new Vn(t);return e.setFindAllIntersections(!0),e.setKeepIntersections(!1),e};var Un=function(){this._li=new it,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var t=arguments[0];this._segStrings=t};Un.prototype.execute=function(){if(null!==this._segInt)return null;this.checkInteriorIntersections()},Un.prototype.getIntersections=function(){return this._segInt.getIntersections()},Un.prototype.isValid=function(){return this.execute(),this._isValid},Un.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t},Un.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new Vn(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var t=new wr;if(t.setSegmentIntersector(this._segInt),t.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null},Un.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new ke(this.getErrorMessage(),this._segInt.getInteriorIntersection())},Un.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var t=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+$.toLineString(t[0],t[1])+" and "+$.toLineString(t[2],t[3])},Un.prototype.interfaces_=function(){return[]},Un.prototype.getClass=function(){return Un},Un.computeIntersections=function(t){var e=new Un(t);return e.setFindAllIntersections(!0),e.isValid(),e.getIntersections()};var qn=function t(){this._nv=null;var e=arguments[0];this._nv=new Un(t.toSegmentStrings(e))};qn.prototype.checkValid=function(){this._nv.checkValid()},qn.prototype.interfaces_=function(){return[]},qn.prototype.getClass=function(){return qn},qn.toSegmentStrings=function(t){for(var e=new Ot,r=t.iterator();r.hasNext();){var n=r.next();e.add(new Bn(n.getCoordinates(),n))}return e},qn.checkValid=function(t){new qn(t).checkValid()};var Wn=function(t){this._mapOp=t};Wn.prototype.map=function(t){for(var e=new Ot,r=0;r<t.getNumGeometries();r++){var n=this._mapOp.map(t.getGeometryN(r));n.isEmpty()||e.add(n)}return t.getFactory().createGeometryCollection(me.toGeometryArray(e))},Wn.prototype.interfaces_=function(){return[]},Wn.prototype.getClass=function(){return Wn},Wn.map=function(t,e){return new Wn(e).map(t)};var Xn=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new Ot,this._resultLineList=new Ot;var t=arguments[0],e=arguments[1],r=arguments[2];this._op=t,this._geometryFactory=e,this._ptLocator=r};Xn.prototype.collectLines=function(t){for(var e=this._op.getGraph().getEdgeEnds().iterator();e.hasNext();){var r=e.next();this.collectLineEdge(r,t,this._lineEdgesList),this.collectBoundaryTouchEdge(r,t,this._lineEdgesList)}},Xn.prototype.labelIsolatedLine=function(t,e){var r=this._ptLocator.locate(t.getCoordinate(),this._op.getArgGeometry(e));t.getLabel().setLocation(e,r)},Xn.prototype.build=function(t){return this.findCoveredLineEdges(),this.collectLines(t),this.buildLines(t),this._resultLineList},Xn.prototype.collectLineEdge=function(t,e,r){var n=t.getLabel(),i=t.getEdge();t.isLineEdge()&&(t.isVisited()||!Ei.isResultOfOp(n,e)||i.isCovered()||(r.add(i),t.setVisitedEdge(!0)))},Xn.prototype.findCoveredLineEdges=function(){for(var t=this._op.getGraph().getNodes().iterator();t.hasNext();)t.next().getEdges().findCoveredLineEdges();for(var e=this._op.getGraph().getEdgeEnds().iterator();e.hasNext();){var r=e.next(),n=r.getEdge();if(r.isLineEdge()&&!n.isCoveredSet()){var i=this._op.isCoveredByA(r.getCoordinate());n.setCovered(i)}}},Xn.prototype.labelIsolatedLines=function(t){for(var e=t.iterator();e.hasNext();){var r=e.next(),n=r.getLabel();r.isIsolated()&&(n.isNull(0)?this.labelIsolatedLine(r,0):this.labelIsolatedLine(r,1))}},Xn.prototype.buildLines=function(t){for(var e=this._lineEdgesList.iterator();e.hasNext();){var r=e.next(),n=this._geometryFactory.createLineString(r.getCoordinates());this._resultLineList.add(n),r.setInResult(!0)}},Xn.prototype.collectBoundaryTouchEdge=function(t,e,r){var n=t.getLabel();return t.isLineEdge()||t.isVisited()||t.isInteriorAreaEdge()||t.getEdge().isInResult()?null:(et.isTrue(!(t.isInResult()||t.getSym().isInResult())||!t.getEdge().isInResult()),void(Ei.isResultOfOp(n,e)&&e===Ei.INTERSECTION&&(r.add(t.getEdge()),t.setVisitedEdge(!0))))},Xn.prototype.interfaces_=function(){return[]},Xn.prototype.getClass=function(){return Xn};var Zn=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new Ot;var t=arguments[0],e=arguments[1];this._op=t,this._geometryFactory=e};Zn.prototype.filterCoveredNodeToPoint=function(t){var e=t.getCoordinate();if(!this._op.isCoveredByLA(e)){var r=this._geometryFactory.createPoint(e);this._resultPointList.add(r)}},Zn.prototype.extractNonCoveredResultNodes=function(t){for(var e=this._op.getGraph().getNodes().iterator();e.hasNext();){var r=e.next();if(!(r.isInResult()||r.isIncidentEdgeInResult()||0!==r.getEdges().getDegree()&&t!==Ei.INTERSECTION)){var n=r.getLabel();Ei.isResultOfOp(n,t)&&this.filterCoveredNodeToPoint(r)}}},Zn.prototype.build=function(t){return this.extractNonCoveredResultNodes(t),this._resultPointList},Zn.prototype.interfaces_=function(){return[]},Zn.prototype.getClass=function(){return Zn};var Hn=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};Hn.prototype.transformPoint=function(t,e){return this._factory.createPoint(this.transformCoordinates(t.getCoordinateSequence(),t))},Hn.prototype.transformPolygon=function(t,e){var r=!0,n=this.transformLinearRing(t.getExteriorRing(),t);null!==n&&n instanceof ee&&!n.isEmpty()||(r=!1);for(var i=new Ot,o=0;o<t.getNumInteriorRing();o++){var a=this.transformLinearRing(t.getInteriorRingN(o),t);null===a||a.isEmpty()||(a instanceof ee||(r=!1),i.add(a))}if(r)return this._factory.createPolygon(n,i.toArray([]));var s=new Ot;return null!==n&&s.add(n),s.addAll(i),this._factory.buildGeometry(s)},Hn.prototype.createCoordinateSequence=function(t){return this._factory.getCoordinateSequenceFactory().create(t)},Hn.prototype.getInputGeometry=function(){return this._inputGeom},Hn.prototype.transformMultiLineString=function(t,e){for(var r=new Ot,n=0;n<t.getNumGeometries();n++){var i=this.transformLineString(t.getGeometryN(n),t);null!==i&&(i.isEmpty()||r.add(i))}return this._factory.buildGeometry(r)},Hn.prototype.transformCoordinates=function(t,e){return this.copy(t)},Hn.prototype.transformLineString=function(t,e){return this._factory.createLineString(this.transformCoordinates(t.getCoordinateSequence(),t))},Hn.prototype.transformMultiPoint=function(t,e){for(var r=new Ot,n=0;n<t.getNumGeometries();n++){var i=this.transformPoint(t.getGeometryN(n),t);null!==i&&(i.isEmpty()||r.add(i))}return this._factory.buildGeometry(r)},Hn.prototype.transformMultiPolygon=function(t,e){for(var r=new Ot,n=0;n<t.getNumGeometries();n++){var i=this.transformPolygon(t.getGeometryN(n),t);null!==i&&(i.isEmpty()||r.add(i))}return this._factory.buildGeometry(r)},Hn.prototype.copy=function(t){return t.copy()},Hn.prototype.transformGeometryCollection=function(t,e){for(var r=new Ot,n=0;n<t.getNumGeometries();n++){var i=this.transform(t.getGeometryN(n));null!==i&&(this._pruneEmptyGeometry&&i.isEmpty()||r.add(i))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(me.toGeometryArray(r)):this._factory.buildGeometry(r)},Hn.prototype.transform=function(t){if(this._inputGeom=t,this._factory=t.getFactory(),t instanceof Jt)return this.transformPoint(t,null);if(t instanceof te)return this.transformMultiPoint(t,null);if(t instanceof ee)return this.transformLinearRing(t,null);if(t instanceof Yt)return this.transformLineString(t,null);if(t instanceof Ut)return this.transformMultiLineString(t,null);if(t instanceof Qt)return this.transformPolygon(t,null);if(t instanceof re)return this.transformMultiPolygon(t,null);if(t instanceof Vt)return this.transformGeometryCollection(t,null);throw new v("Unknown Geometry subtype: "+t.getClass().getName())},Hn.prototype.transformLinearRing=function(t,e){var r=this.transformCoordinates(t.getCoordinateSequence(),t);if(null===r)return this._factory.createLinearRing(null);var n=r.size();return n>0&&n<4&&!this._preserveType?this._factory.createLineString(r):this._factory.createLinearRing(r)},Hn.prototype.interfaces_=function(){return[]},Hn.prototype.getClass=function(){return Hn};var Yn=function t(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new yr,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof Yt&&"number"==typeof arguments[1]){var e=arguments[1];t.call(this,arguments[0].getCoordinates(),e)}else if(arguments[0]instanceof Array&&"number"==typeof arguments[1]){var r=arguments[0],n=arguments[1];this._srcPts=r,this._isClosed=t.isClosed(r),this._snapTolerance=n}};Yn.prototype.snapVertices=function(t,e){for(var r=this._isClosed?t.size()-1:t.size(),n=0;n<r;n++){var i=t.get(n),o=this.findSnapForVertex(i,e);null!==o&&(t.set(n,new x(o)),0===n&&this._isClosed&&t.set(t.size()-1,new x(o)))}},Yn.prototype.findSnapForVertex=function(t,e){for(var r=0;r<e.length;r++){if(t.equals2D(e[r]))return null;if(t.distance(e[r])<this._snapTolerance)return e[r]}return null},Yn.prototype.snapTo=function(t){var e=new Ct(this._srcPts);return this.snapVertices(e,t),this.snapSegments(e,t),e.toCoordinateArray()},Yn.prototype.snapSegments=function(t,e){if(0===e.length)return null;var r=e.length;e[0].equals2D(e[e.length-1])&&(r=e.length-1);for(var n=0;n<r;n++){var i=e[n],o=this.findSegmentIndexToSnap(i,t);o>=0&&t.add(o+1,new x(i),!1)}},Yn.prototype.findSegmentIndexToSnap=function(t,e){for(var r=_.MAX_VALUE,n=-1,i=0;i<e.size()-1;i++){if(this._seg.p0=e.get(i),this._seg.p1=e.get(i+1),this._seg.p0.equals2D(t)||this._seg.p1.equals2D(t)){if(this._allowSnappingToSourceVertices)continue;return-1}var o=this._seg.distance(t);o<this._snapTolerance&&o<r&&(r=o,n=i)}return n},Yn.prototype.setAllowSnappingToSourceVertices=function(t){this._allowSnappingToSourceVertices=t},Yn.prototype.interfaces_=function(){return[]},Yn.prototype.getClass=function(){return Yn},Yn.isClosed=function(t){return!(t.length<=1)&&t[0].equals2D(t[t.length-1])};var Kn=function(t){this._srcGeom=t||null},Jn={SNAP_PRECISION_FACTOR:{configurable:!0}};Kn.prototype.snapTo=function(t,e){var r=this.extractTargetCoordinates(t);return new $n(e,r).transform(this._srcGeom)},Kn.prototype.snapToSelf=function(t,e){var r=this.extractTargetCoordinates(this._srcGeom),n=new $n(t,r,!0).transform(this._srcGeom),i=n;return e&&j(i,$t)&&(i=n.buffer(0)),i},Kn.prototype.computeSnapTolerance=function(t){return this.computeMinimumSegmentLength(t)/10},Kn.prototype.extractTargetCoordinates=function(t){for(var e=new h,r=t.getCoordinates(),n=0;n<r.length;n++)e.add(r[n]);return e.toArray(new Array(0).fill(null))},Kn.prototype.computeMinimumSegmentLength=function(t){for(var e=_.MAX_VALUE,r=0;r<t.length-1;r++){var n=t[r].distance(t[r+1]);n<e&&(e=n)}return e},Kn.prototype.interfaces_=function(){return[]},Kn.prototype.getClass=function(){return Kn},Kn.snap=function(t,e,r){var n=new Array(2).fill(null),i=new Kn(t);n[0]=i.snapTo(e,r);var o=new Kn(e);return n[1]=o.snapTo(n[0],r),n},Kn.computeOverlaySnapTolerance=function(){if(1===arguments.length){var t=arguments[0],e=Kn.computeSizeBasedSnapTolerance(t),r=t.getPrecisionModel();if(r.getType()===he.FIXED){var n=1/r.getScale()*2/1.415;n>e&&(e=n)}return e}if(2===arguments.length){var i=arguments[0],o=arguments[1];return Math.min(Kn.computeOverlaySnapTolerance(i),Kn.computeOverlaySnapTolerance(o))}},Kn.computeSizeBasedSnapTolerance=function(t){var e=t.getEnvelopeInternal();return Math.min(e.getHeight(),e.getWidth())*Kn.SNAP_PRECISION_FACTOR},Kn.snapToSelf=function(t,e,r){return new Kn(t).snapToSelf(e,r)},Jn.SNAP_PRECISION_FACTOR.get=function(){return 1e-9},Object.defineProperties(Kn,Jn);var $n=function(t){function e(e,r,n){t.call(this),this._snapTolerance=e||null,this._snapPts=r||null,this._isSelfSnap=void 0!==n&&n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.snapLine=function(t,e){var r=new Yn(t,this._snapTolerance);return r.setAllowSnappingToSourceVertices(this._isSelfSnap),r.snapTo(e)},e.prototype.transformCoordinates=function(t,e){var r=t.toCoordinateArray(),n=this.snapLine(r,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(n)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Hn),Qn=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};Qn.prototype.getCommon=function(){return _.longBitsToDouble(this._commonBits)},Qn.prototype.add=function(t){var e=_.doubleToLongBits(t);return this._isFirst?(this._commonBits=e,this._commonSignExp=Qn.signExpBits(this._commonBits),this._isFirst=!1,null):Qn.signExpBits(e)!==this._commonSignExp?(this._commonBits=0,null):(this._commonMantissaBitsCount=Qn.numCommonMostSigMantissaBits(this._commonBits,e),void(this._commonBits=Qn.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))))},Qn.prototype.toString=function(){if(1===arguments.length){var t=arguments[0],e=_.longBitsToDouble(t),r="0000000000000000000000000000000000000000000000000000000000000000"+_.toBinaryString(t),n=r.substring(r.length-64);return n.substring(0,1)+"  "+n.substring(1,12)+"(exp) "+n.substring(12)+" [ "+e+" ]"}},Qn.prototype.interfaces_=function(){return[]},Qn.prototype.getClass=function(){return Qn},Qn.getBit=function(t,e){return 0!=(t&1<<e)?1:0},Qn.signExpBits=function(t){return t>>52},Qn.zeroLowerBits=function(t,e){return t&~((1<<e)-1)},Qn.numCommonMostSigMantissaBits=function(t,e){for(var r=0,n=52;n>=0;n--){if(Qn.getBit(t,n)!==Qn.getBit(e,n))return r;r++}return 52};var ti=function(){this._commonCoord=null,this._ccFilter=new ri},ei={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};ti.prototype.addCommonBits=function(t){var e=new ni(this._commonCoord);t.apply(e),t.geometryChanged()},ti.prototype.removeCommonBits=function(t){if(0===this._commonCoord.x&&0===this._commonCoord.y)return t;var e=new x(this._commonCoord);e.x=-e.x,e.y=-e.y;var r=new ni(e);return t.apply(r),t.geometryChanged(),t},ti.prototype.getCommonCoordinate=function(){return this._commonCoord},ti.prototype.add=function(t){t.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()},ti.prototype.interfaces_=function(){return[]},ti.prototype.getClass=function(){return ti},ei.CommonCoordinateFilter.get=function(){return ri},ei.Translater.get=function(){return ni},Object.defineProperties(ti,ei);var ri=function(){this._commonBitsX=new Qn,this._commonBitsY=new Qn};ri.prototype.filter=function(t){this._commonBitsX.add(t.x),this._commonBitsY.add(t.y)},ri.prototype.getCommonCoordinate=function(){return new x(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())},ri.prototype.interfaces_=function(){return[ht]},ri.prototype.getClass=function(){return ri};var ni=function(){this.trans=null;var t=arguments[0];this.trans=t};ni.prototype.filter=function(t,e){var r=t.getOrdinate(e,0)+this.trans.x,n=t.getOrdinate(e,1)+this.trans.y;t.setOrdinate(e,0,r),t.setOrdinate(e,1,n)},ni.prototype.isDone=function(){return!1},ni.prototype.isGeometryChanged=function(){return!0},ni.prototype.interfaces_=function(){return[Bt]},ni.prototype.getClass=function(){return ni};var ii=function(t,e){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=t,this._geom[1]=e,this.computeSnapTolerance()};ii.prototype.selfSnap=function(t){return new Kn(t).snapTo(t,this._snapTolerance)},ii.prototype.removeCommonBits=function(t){this._cbr=new ti,this._cbr.add(t[0]),this._cbr.add(t[1]);var e=new Array(2).fill(null);return e[0]=this._cbr.removeCommonBits(t[0].copy()),e[1]=this._cbr.removeCommonBits(t[1].copy()),e},ii.prototype.prepareResult=function(t){return this._cbr.addCommonBits(t),t},ii.prototype.getResultGeometry=function(t){var e=this.snap(this._geom),r=Ei.overlayOp(e[0],e[1],t);return this.prepareResult(r)},ii.prototype.checkValid=function(t){t.isValid()||q.out.println("Snapped geometry is invalid")},ii.prototype.computeSnapTolerance=function(){this._snapTolerance=Kn.computeOverlaySnapTolerance(this._geom[0],this._geom[1])},ii.prototype.snap=function(t){var e=this.removeCommonBits(t);return Kn.snap(e[0],e[1],this._snapTolerance)},ii.prototype.interfaces_=function(){return[]},ii.prototype.getClass=function(){return ii},ii.overlayOp=function(t,e,r){return new ii(t,e).getResultGeometry(r)},ii.union=function(t,e){return ii.overlayOp(t,e,Ei.UNION)},ii.intersection=function(t,e){return ii.overlayOp(t,e,Ei.INTERSECTION)},ii.symDifference=function(t,e){return ii.overlayOp(t,e,Ei.SYMDIFFERENCE)},ii.difference=function(t,e){return ii.overlayOp(t,e,Ei.DIFFERENCE)};var oi=function(t,e){this._geom=new Array(2).fill(null),this._geom[0]=t,this._geom[1]=e};oi.prototype.getResultGeometry=function(t){var e=null,r=!1,n=null;try{e=Ei.overlayOp(this._geom[0],this._geom[1],t),r=!0}catch(t){if(!(t instanceof Q))throw t;n=t}if(!r)try{e=ii.overlayOp(this._geom[0],this._geom[1],t)}catch(t){throw t instanceof Q?n:t}return e},oi.prototype.interfaces_=function(){return[]},oi.prototype.getClass=function(){return oi},oi.overlayOp=function(t,e,r){return new oi(t,e).getResultGeometry(r)},oi.union=function(t,e){return oi.overlayOp(t,e,Ei.UNION)},oi.intersection=function(t,e){return oi.overlayOp(t,e,Ei.INTERSECTION)},oi.symDifference=function(t,e){return oi.overlayOp(t,e,Ei.SYMDIFFERENCE)},oi.difference=function(t,e){return oi.overlayOp(t,e,Ei.DIFFERENCE)};var ai=function(){this.mce=null,this.chainIndex=null;var t=arguments[0],e=arguments[1];this.mce=t,this.chainIndex=e};ai.prototype.computeIntersections=function(t,e){this.mce.computeIntersectsForChain(this.chainIndex,t.mce,t.chainIndex,e)},ai.prototype.interfaces_=function(){return[]},ai.prototype.getClass=function(){return ai};var si=function t(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,2===arguments.length){var e=arguments[0],r=arguments[1];this._eventType=t.DELETE,this._xValue=e,this._insertEvent=r}else if(3===arguments.length){var n=arguments[0],i=arguments[1],o=arguments[2];this._eventType=t.INSERT,this._label=n,this._xValue=i,this._obj=o}},ui={INSERT:{configurable:!0},DELETE:{configurable:!0}};si.prototype.isDelete=function(){return this._eventType===si.DELETE},si.prototype.setDeleteEventIndex=function(t){this._deleteEventIndex=t},si.prototype.getObject=function(){return this._obj},si.prototype.compareTo=function(t){var e=t;return this._xValue<e._xValue?-1:this._xValue>e._xValue?1:this._eventType<e._eventType?-1:this._eventType>e._eventType?1:0},si.prototype.getInsertEvent=function(){return this._insertEvent},si.prototype.isInsert=function(){return this._eventType===si.INSERT},si.prototype.isSameLabel=function(t){return null!==this._label&&this._label===t._label},si.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex},si.prototype.interfaces_=function(){return[w]},si.prototype.getClass=function(){return si},ui.INSERT.get=function(){return 1},ui.DELETE.get=function(){return 2},Object.defineProperties(si,ui);var li=function(){};li.prototype.interfaces_=function(){return[]},li.prototype.getClass=function(){return li};var ci=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var t=arguments[0],e=arguments[1],r=arguments[2];this._li=t,this._includeProper=e,this._recordIsolated=r};ci.prototype.isTrivialIntersection=function(t,e,r,n){if(t===r&&1===this._li.getIntersectionNum()){if(ci.isAdjacentSegments(e,n))return!0;if(t.isClosed()){var i=t.getNumPoints()-1;if(0===e&&n===i||0===n&&e===i)return!0}}return!1},ci.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},ci.prototype.setIsDoneIfProperInt=function(t){this._isDoneWhenProperInt=t},ci.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},ci.prototype.isBoundaryPointInternal=function(t,e){for(var r=e.iterator();r.hasNext();){var n=r.next().getCoordinate();if(t.isIntersection(n))return!0}return!1},ci.prototype.hasProperIntersection=function(){return this._hasProper},ci.prototype.hasIntersection=function(){return this._hasIntersection},ci.prototype.isDone=function(){return this._isDone},ci.prototype.isBoundaryPoint=function(t,e){return!(null===e||!this.isBoundaryPointInternal(t,e[0])&&!this.isBoundaryPointInternal(t,e[1]))},ci.prototype.setBoundaryNodes=function(t,e){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=t,this._bdyNodes[1]=e},ci.prototype.addIntersections=function(t,e,r,n){if(t===r&&e===n)return null;this.numTests++;var i=t.getCoordinates()[e],o=t.getCoordinates()[e+1],a=r.getCoordinates()[n],s=r.getCoordinates()[n+1];this._li.computeIntersection(i,o,a,s),this._li.hasIntersection()&&(this._recordIsolated&&(t.setIsolated(!1),r.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(t,e,r,n)||(this._hasIntersection=!0,!this._includeProper&&this._li.isProper()||(t.addIntersections(this._li,e,0),r.addIntersections(this._li,n,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))},ci.prototype.interfaces_=function(){return[]},ci.prototype.getClass=function(){return ci},ci.isAdjacentSegments=function(t,e){return 1===Math.abs(t-e)};var fi=function(t){function e(){t.call(this),this.events=new Ot,this.nOverlaps=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.prepareEvents=function(){Qe.sort(this.events);for(var t=0;t<this.events.size();t++){var e=this.events.get(t);e.isDelete()&&e.getInsertEvent().setDeleteEventIndex(t)}},e.prototype.computeIntersections=function(){if(1===arguments.length){var t=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var e=0;e<this.events.size();e++){var r=this.events.get(e);if(r.isInsert()&&this.processOverlaps(e,r.getDeleteEventIndex(),r,t),t.isDone())break}}else if(3===arguments.length)if(arguments[2]instanceof ci&&j(arguments[0],St)&&j(arguments[1],St)){var n=arguments[0],i=arguments[1],o=arguments[2];this.addEdges(n,n),this.addEdges(i,i),this.computeIntersections(o)}else if("boolean"==typeof arguments[2]&&j(arguments[0],St)&&arguments[1]instanceof ci){var a=arguments[0],s=arguments[1];arguments[2]?this.addEdges(a,null):this.addEdges(a),this.computeIntersections(s)}},e.prototype.addEdge=function(t,e){for(var r=t.getMonotoneChainEdge(),n=r.getStartIndexes(),i=0;i<n.length-1;i++){var o=new ai(r,i),a=new si(e,r.getMinX(i),o);this.events.add(a),this.events.add(new si(r.getMaxX(i),a))}},e.prototype.processOverlaps=function(t,e,r,n){for(var i=r.getObject(),o=t;o<e;o++){var a=this.events.get(o);if(a.isInsert()){var s=a.getObject();r.isSameLabel(a)||(i.computeIntersections(s,n),this.nOverlaps++)}}},e.prototype.addEdges=function(){if(1===arguments.length)for(var t=arguments[0].iterator();t.hasNext();){var e=t.next();this.addEdge(e,e)}else if(2===arguments.length)for(var r=arguments[1],n=arguments[0].iterator();n.hasNext();){var i=n.next();this.addEdge(i,r)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(li),pi=function(){this._min=_.POSITIVE_INFINITY,this._max=_.NEGATIVE_INFINITY},hi={NodeComparator:{configurable:!0}};pi.prototype.getMin=function(){return this._min},pi.prototype.intersects=function(t,e){return!(this._min>e||this._max<t)},pi.prototype.getMax=function(){return this._max},pi.prototype.toString=function(){return $.toLineString(new x(this._min,0),new x(this._max,0))},pi.prototype.interfaces_=function(){return[]},pi.prototype.getClass=function(){return pi},hi.NodeComparator.get=function(){return yi},Object.defineProperties(pi,hi);var yi=function(){};yi.prototype.compare=function(t,e){var r=t,n=e,i=(r._min+r._max)/2,o=(n._min+n._max)/2;return i<o?-1:i>o?1:0},yi.prototype.interfaces_=function(){return[O]},yi.prototype.getClass=function(){return yi};var di=function(t){function e(){t.call(this),this._item=null;var e=arguments[0],r=arguments[1],n=arguments[2];this._min=e,this._max=r,this._item=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.query=function(t,e,r){if(!this.intersects(t,e))return null;r.visitItem(this._item)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(pi),gi=function(t){function e(){t.call(this),this._node1=null,this._node2=null;var e=arguments[0],r=arguments[1];this._node1=e,this._node2=r,this.buildExtent(this._node1,this._node2)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildExtent=function(t,e){this._min=Math.min(t._min,e._min),this._max=Math.max(t._max,e._max)},e.prototype.query=function(t,e,r){if(!this.intersects(t,e))return null;null!==this._node1&&this._node1.query(t,e,r),null!==this._node2&&this._node2.query(t,e,r)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(pi),mi=function(){this._leaves=new Ot,this._root=null,this._level=0};mi.prototype.buildTree=function(){Qe.sort(this._leaves,new pi.NodeComparator);for(var t=this._leaves,e=null,r=new Ot;;){if(this.buildLevel(t,r),1===r.size())return r.get(0);e=t,t=r,r=e}},mi.prototype.insert=function(t,e,r){if(null!==this._root)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new di(t,e,r))},mi.prototype.query=function(t,e,r){this.init(),this._root.query(t,e,r)},mi.prototype.buildRoot=function(){if(null!==this._root)return null;this._root=this.buildTree()},mi.prototype.printNode=function(t){q.out.println($.toLineString(new x(t._min,this._level),new x(t._max,this._level)))},mi.prototype.init=function(){if(null!==this._root)return null;this.buildRoot()},mi.prototype.buildLevel=function(t,e){this._level++,e.clear();for(var r=0;r<t.size();r+=2){var n=t.get(r);if(null===(r+1<t.size()?t.get(r):null))e.add(n);else{var i=new gi(t.get(r),t.get(r+1));e.add(i)}}},mi.prototype.interfaces_=function(){return[]},mi.prototype.getClass=function(){return mi};var vi=function(){this._items=new Ot};vi.prototype.visitItem=function(t){this._items.add(t)},vi.prototype.getItems=function(){return this._items},vi.prototype.interfaces_=function(){return[Ye]},vi.prototype.getClass=function(){return vi};var _i=function(){this._index=null;var t=arguments[0];if(!j(t,$t))throw new v("Argument must be Polygonal");this._index=new Si(t)},bi={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};_i.prototype.locate=function(t){var e=new at(t),r=new wi(e);return this._index.query(t.y,t.y,r),e.getLocation()},_i.prototype.interfaces_=function(){return[zr]},_i.prototype.getClass=function(){return _i},bi.SegmentVisitor.get=function(){return wi},bi.IntervalIndexedGeometry.get=function(){return Si},Object.defineProperties(_i,bi);var wi=function(){this._counter=null;var t=arguments[0];this._counter=t};wi.prototype.visitItem=function(t){var e=t;this._counter.countSegment(e.getCoordinate(0),e.getCoordinate(1))},wi.prototype.interfaces_=function(){return[Ye]},wi.prototype.getClass=function(){return wi};var Si=function(){this._index=new mi;var t=arguments[0];this.init(t)};Si.prototype.init=function(t){for(var e=xn.getLines(t).iterator();e.hasNext();){var r=e.next().getCoordinates();this.addLine(r)}},Si.prototype.addLine=function(t){for(var e=1;e<t.length;e++){var r=new yr(t[e-1],t[e]),n=Math.min(r.p0.y,r.p1.y),i=Math.max(r.p0.y,r.p1.y);this._index.insert(n,i,r)}},Si.prototype.query=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],r=new vi;return this._index.query(t,e,r),r.getItems()}if(3===arguments.length){var n=arguments[0],i=arguments[1],o=arguments[2];this._index.query(n,i,o)}},Si.prototype.interfaces_=function(){return[]},Si.prototype.getClass=function(){return Si};var Oi=function(t){function e(){if(t.call(this),this._parentGeom=null,this._lineEdgeMap=new pe,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new Cn,2===arguments.length){var e=arguments[0],r=arguments[1],n=yt.OGC_SFS_BOUNDARY_RULE;this._argIndex=e,this._parentGeom=r,this._boundaryNodeRule=n,null!==r&&this.add(r)}else if(3===arguments.length){var i=arguments[0],o=arguments[1],a=arguments[2];this._argIndex=i,this._parentGeom=o,this._boundaryNodeRule=a,null!==o&&this.add(o)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertBoundaryPoint=function(t,r){var n=this._nodes.addNode(r).getLabel(),i=1;n.getLocation(t,Ce.ON)===k.BOUNDARY&&i++;var o=e.determineBoundary(this._boundaryNodeRule,i);n.setLocation(t,o)},e.prototype.computeSelfNodes=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return this.computeSelfNodes(t,e,!1)}if(3===arguments.length){var r=arguments[1],n=arguments[2],i=new ci(arguments[0],!0,!1);i.setIsDoneIfProperInt(n);var o=this.createEdgeSetIntersector(),a=this._parentGeom instanceof ee||this._parentGeom instanceof Qt||this._parentGeom instanceof re,s=r||!a;return o.computeIntersections(this._edges,i,s),this.addSelfIntersectionNodes(this._argIndex),i}},e.prototype.computeSplitEdges=function(t){for(var e=this._edges.iterator();e.hasNext();)e.next().eiList.addSplitEdges(t)},e.prototype.computeEdgeIntersections=function(t,e,r){var n=new ci(e,r,!0);return n.setBoundaryNodes(this.getBoundaryNodes(),t.getBoundaryNodes()),this.createEdgeSetIntersector().computeIntersections(this._edges,t._edges,n),n},e.prototype.getGeometry=function(){return this._parentGeom},e.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},e.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},e.prototype.addPoint=function(){if(arguments[0]instanceof Jt){var t=arguments[0].getCoordinate();this.insertPoint(this._argIndex,t,k.INTERIOR)}else if(arguments[0]instanceof x){var e=arguments[0];this.insertPoint(this._argIndex,e,k.INTERIOR)}},e.prototype.addPolygon=function(t){this.addPolygonRing(t.getExteriorRing(),k.EXTERIOR,k.INTERIOR);for(var e=0;e<t.getNumInteriorRing();e++){var r=t.getInteriorRingN(e);this.addPolygonRing(r,k.INTERIOR,k.EXTERIOR)}},e.prototype.addEdge=function(t){this.insertEdge(t);var e=t.getCoordinates();this.insertPoint(this._argIndex,e[0],k.BOUNDARY),this.insertPoint(this._argIndex,e[e.length-1],k.BOUNDARY)},e.prototype.addLineString=function(t){var e=Et.removeRepeatedPoints(t.getCoordinates());if(e.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=e[0],null;var r=new en(e,new Le(this._argIndex,k.INTERIOR));this._lineEdgeMap.put(t,r),this.insertEdge(r),et.isTrue(e.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,e[0]),this.insertBoundaryPoint(this._argIndex,e[e.length-1])},e.prototype.getInvalidPoint=function(){return this._invalidPoint},e.prototype.getBoundaryPoints=function(){for(var t=this.getBoundaryNodes(),e=new Array(t.size()).fill(null),r=0,n=t.iterator();n.hasNext();){var i=n.next();e[r++]=i.getCoordinate().copy()}return e},e.prototype.getBoundaryNodes=function(){return null===this._boundaryNodes&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},e.prototype.addSelfIntersectionNode=function(t,e,r){if(this.isBoundaryNode(t,e))return null;r===k.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(t,e):this.insertPoint(t,e,r)},e.prototype.addPolygonRing=function(t,e,r){if(t.isEmpty())return null;var n=Et.removeRepeatedPoints(t.getCoordinates());if(n.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=n[0],null;var i=e,o=r;st.isCCW(n)&&(i=r,o=e);var a=new en(n,new Le(this._argIndex,k.BOUNDARY,i,o));this._lineEdgeMap.put(t,a),this.insertEdge(a),this.insertPoint(this._argIndex,n[0],k.BOUNDARY)},e.prototype.insertPoint=function(t,e,r){var n=this._nodes.addNode(e),i=n.getLabel();null===i?n._label=new Le(t,r):i.setLocation(t,r)},e.prototype.createEdgeSetIntersector=function(){return new fi},e.prototype.addSelfIntersectionNodes=function(t){for(var e=this._edges.iterator();e.hasNext();)for(var r=e.next(),n=r.getLabel().getLocation(t),i=r.eiList.iterator();i.hasNext();){var o=i.next();this.addSelfIntersectionNode(t,o.coord,n)}},e.prototype.add=function(){if(1!==arguments.length)return t.prototype.add.apply(this,arguments);var e=arguments[0];if(e.isEmpty())return null;if(e instanceof re&&(this._useBoundaryDeterminationRule=!1),e instanceof Qt)this.addPolygon(e);else if(e instanceof Yt)this.addLineString(e);else if(e instanceof Jt)this.addPoint(e);else if(e instanceof te)this.addCollection(e);else if(e instanceof Ut)this.addCollection(e);else if(e instanceof re)this.addCollection(e);else{if(!(e instanceof Vt))throw new Error(e.getClass().getName());this.addCollection(e)}},e.prototype.addCollection=function(t){for(var e=0;e<t.getNumGeometries();e++){var r=t.getGeometryN(e);this.add(r)}},e.prototype.locate=function(t){return j(this._parentGeom,$t)&&this._parentGeom.getNumGeometries()>50?(null===this._areaPtLocator&&(this._areaPtLocator=new _i(this._parentGeom)),this._areaPtLocator.locate(t)):this._ptLocator.locate(t,this._parentGeom)},e.prototype.findEdge=function(){if(1===arguments.length){var e=arguments[0];return this._lineEdgeMap.get(e)}return t.prototype.findEdge.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.determineBoundary=function(t,e){return t.isInBoundary(e)?k.BOUNDARY:k.INTERIOR},e}(qe),xi=function(){if(this._li=new it,this._resultPrecisionModel=null,this._arg=null,1===arguments.length){var t=arguments[0];this.setComputationPrecision(t.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new Oi(0,t)}else if(2===arguments.length){var e=arguments[0],r=arguments[1],n=yt.OGC_SFS_BOUNDARY_RULE;e.getPrecisionModel().compareTo(r.getPrecisionModel())>=0?this.setComputationPrecision(e.getPrecisionModel()):this.setComputationPrecision(r.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Oi(0,e,n),this._arg[1]=new Oi(1,r,n)}else if(3===arguments.length){var i=arguments[0],o=arguments[1],a=arguments[2];i.getPrecisionModel().compareTo(o.getPrecisionModel())>=0?this.setComputationPrecision(i.getPrecisionModel()):this.setComputationPrecision(o.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Oi(0,i,a),this._arg[1]=new Oi(1,o,a)}};xi.prototype.getArgGeometry=function(t){return this._arg[t].getGeometry()},xi.prototype.setComputationPrecision=function(t){this._resultPrecisionModel=t,this._li.setPrecisionModel(this._resultPrecisionModel)},xi.prototype.interfaces_=function(){return[]},xi.prototype.getClass=function(){return xi};var Ci=function(){};Ci.prototype.interfaces_=function(){return[]},Ci.prototype.getClass=function(){return Ci},Ci.map=function(){if(arguments[0]instanceof ct&&j(arguments[1],Ci.MapOp)){for(var t=arguments[0],e=arguments[1],r=new Ot,n=0;n<t.getNumGeometries();n++){var i=e.map(t.getGeometryN(n));null!==i&&r.add(i)}return t.getFactory().buildGeometry(r)}if(j(arguments[0],bt)&&j(arguments[1],Ci.MapOp)){for(var o=arguments[0],a=arguments[1],s=new Ot,u=o.iterator();u.hasNext();){var l=u.next(),c=a.map(l);null!==c&&s.add(c)}return s}},Ci.MapOp=function(){};var Ei=function(t){function e(){var e=arguments[0],r=arguments[1];t.call(this,e,r),this._ptLocator=new Cn,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new Xr,this._resultPolyList=new Ot,this._resultLineList=new Ot,this._resultPointList=new Ot,this._graph=new qe(new qr),this._geomFact=e.getFactory()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertUniqueEdge=function(t){var e=this._edgeList.findEqualEdge(t);if(null!==e){var r=e.getLabel(),n=t.getLabel();e.isPointwiseEqual(t)||(n=new Le(t.getLabel())).flip();var i=e.getDepth();i.isNull()&&i.add(r),i.add(n),r.merge(n)}else this._edgeList.add(t)},e.prototype.getGraph=function(){return this._graph},e.prototype.cancelDuplicateResultEdges=function(){for(var t=this._graph.getEdgeEnds().iterator();t.hasNext();){var e=t.next(),r=e.getSym();e.isInResult()&&r.isInResult()&&(e.setInResult(!1),r.setInResult(!1))}},e.prototype.isCoveredByLA=function(t){return!!this.isCovered(t,this._resultLineList)||!!this.isCovered(t,this._resultPolyList)},e.prototype.computeGeometry=function(t,r,n,i){var o=new Ot;return o.addAll(t),o.addAll(r),o.addAll(n),o.isEmpty()?e.createEmptyResult(i,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(o)},e.prototype.mergeSymLabels=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();)t.next().getEdges().mergeSymLabels()},e.prototype.isCovered=function(t,e){for(var r=e.iterator();r.hasNext();){var n=r.next();if(this._ptLocator.locate(t,n)!==k.EXTERIOR)return!0}return!1},e.prototype.replaceCollapsedEdges=function(){for(var t=new Ot,e=this._edgeList.iterator();e.hasNext();){var r=e.next();r.isCollapsed()&&(e.remove(),t.add(r.getCollapsedEdge()))}this._edgeList.addAll(t)},e.prototype.updateNodeLabelling=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();){var e=t.next(),r=e.getEdges().getLabel();e.getLabel().merge(r)}},e.prototype.getResultGeometry=function(t){return this.computeOverlay(t),this._resultGeom},e.prototype.insertUniqueEdges=function(t){for(var e=t.iterator();e.hasNext();){var r=e.next();this.insertUniqueEdge(r)}},e.prototype.computeOverlay=function(t){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var e=new Ot;this._arg[0].computeSplitEdges(e),this._arg[1].computeSplitEdges(e),this.insertUniqueEdges(e),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),qn.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(t),this.cancelDuplicateResultEdges();var r=new We(this._geomFact);r.add(this._graph),this._resultPolyList=r.getPolygons();var n=new Xn(this,this._geomFact,this._ptLocator);this._resultLineList=n.build(t);var i=new Zn(this,this._geomFact,this._ptLocator);this._resultPointList=i.build(t),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,t)},e.prototype.labelIncompleteNode=function(t,e){var r=this._ptLocator.locate(t.getCoordinate(),this._arg[e].getGeometry());t.getLabel().setLocation(e,r)},e.prototype.copyPoints=function(t){for(var e=this._arg[t].getNodeIterator();e.hasNext();){var r=e.next();this._graph.addNode(r.getCoordinate()).setLabel(t,r.getLabel().getLocation(t))}},e.prototype.findResultAreaEdges=function(t){for(var r=this._graph.getEdgeEnds().iterator();r.hasNext();){var n=r.next(),i=n.getLabel();i.isArea()&&!n.isInteriorAreaEdge()&&e.isResultOfOp(i.getLocation(0,Ce.RIGHT),i.getLocation(1,Ce.RIGHT),t)&&n.setInResult(!0)}},e.prototype.computeLabelsFromDepths=function(){for(var t=this._edgeList.iterator();t.hasNext();){var e=t.next(),r=e.getLabel(),n=e.getDepth();if(!n.isNull()){n.normalize();for(var i=0;i<2;i++)r.isNull(i)||!r.isArea()||n.isNull(i)||(0===n.getDelta(i)?r.toLine(i):(et.isTrue(!n.isNull(i,Ce.LEFT),"depth of LEFT side has not been initialized"),r.setLocation(i,Ce.LEFT,n.getLocation(i,Ce.LEFT)),et.isTrue(!n.isNull(i,Ce.RIGHT),"depth of RIGHT side has not been initialized"),r.setLocation(i,Ce.RIGHT,n.getLocation(i,Ce.RIGHT))))}}},e.prototype.computeLabelling=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();)t.next().getEdges().computeLabelling(this._arg);this.mergeSymLabels(),this.updateNodeLabelling()},e.prototype.labelIncompleteNodes=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();){var e=t.next(),r=e.getLabel();e.isIsolated()&&(r.isNull(0)?this.labelIncompleteNode(e,0):this.labelIncompleteNode(e,1)),e.getEdges().updateLabelling(r)}},e.prototype.isCoveredByA=function(t){return!!this.isCovered(t,this._resultPolyList)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(xi);Ei.overlayOp=function(t,e,r){return new Ei(t,e).getResultGeometry(r)},Ei.intersection=function(t,e){if(t.isEmpty()||e.isEmpty())return Ei.createEmptyResult(Ei.INTERSECTION,t,e,t.getFactory());if(t.isGeometryCollection()){var r=e;return Wn.map(t,{interfaces_:function(){return[Ci.MapOp]},map:function(t){return t.intersection(r)}})}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),oi.overlayOp(t,e,Ei.INTERSECTION)},Ei.symDifference=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return Ei.createEmptyResult(Ei.SYMDIFFERENCE,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),oi.overlayOp(t,e,Ei.SYMDIFFERENCE)},Ei.resultDimension=function(t,e,r){var n=e.getDimension(),i=r.getDimension(),o=-1;switch(t){case Ei.INTERSECTION:o=Math.min(n,i);break;case Ei.UNION:o=Math.max(n,i);break;case Ei.DIFFERENCE:o=n;break;case Ei.SYMDIFFERENCE:o=Math.max(n,i)}return o},Ei.createEmptyResult=function(t,e,r,n){var i=null;switch(Ei.resultDimension(t,e,r)){case-1:i=n.createGeometryCollection(new Array(0).fill(null));break;case 0:i=n.createPoint();break;case 1:i=n.createLineString();break;case 2:i=n.createPolygon()}return i},Ei.difference=function(t,e){return t.isEmpty()?Ei.createEmptyResult(Ei.DIFFERENCE,t,e,t.getFactory()):e.isEmpty()?t.copy():(t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),oi.overlayOp(t,e,Ei.DIFFERENCE))},Ei.isResultOfOp=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],r=t.getLocation(0),n=t.getLocation(1);return Ei.isResultOfOp(r,n,e)}if(3===arguments.length){var i=arguments[0],o=arguments[1];switch(i===k.BOUNDARY&&(i=k.INTERIOR),o===k.BOUNDARY&&(o=k.INTERIOR),arguments[2]){case Ei.INTERSECTION:return i===k.INTERIOR&&o===k.INTERIOR;case Ei.UNION:return i===k.INTERIOR||o===k.INTERIOR;case Ei.DIFFERENCE:return i===k.INTERIOR&&o!==k.INTERIOR;case Ei.SYMDIFFERENCE:return i===k.INTERIOR&&o!==k.INTERIOR||i!==k.INTERIOR&&o===k.INTERIOR}return!1}},Ei.INTERSECTION=1,Ei.UNION=2,Ei.DIFFERENCE=3,Ei.SYMDIFFERENCE=4;var Pi=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new Cn,this._seg=new yr;var t=arguments[0],e=arguments[1];this._g=t,this._boundaryDistanceTolerance=e,this._linework=this.extractLinework(t)};Pi.prototype.isWithinToleranceOfBoundary=function(t){for(var e=0;e<this._linework.getNumGeometries();e++)for(var r=this._linework.getGeometryN(e).getCoordinateSequence(),n=0;n<r.size()-1;n++)if(r.getCoordinate(n,this._seg.p0),r.getCoordinate(n+1,this._seg.p1),this._seg.distance(t)<=this._boundaryDistanceTolerance)return!0;return!1},Pi.prototype.getLocation=function(t){return this.isWithinToleranceOfBoundary(t)?k.BOUNDARY:this._ptLocator.locate(t,this._g)},Pi.prototype.extractLinework=function(t){var e=new ki;t.apply(e);var r=e.getLinework(),n=me.toLineStringArray(r);return t.getFactory().createMultiLineString(n)},Pi.prototype.interfaces_=function(){return[]},Pi.prototype.getClass=function(){return Pi};var ki=function(){this._linework=null,this._linework=new Ot};ki.prototype.getLinework=function(){return this._linework},ki.prototype.filter=function(t){if(t instanceof Qt){var e=t;this._linework.add(e.getExteriorRing());for(var r=0;r<e.getNumInteriorRing();r++)this._linework.add(e.getInteriorRingN(r))}},ki.prototype.interfaces_=function(){return[Gt]},ki.prototype.getClass=function(){return ki};var Ti=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var t=arguments[0];this._g=t};Ti.prototype.extractPoints=function(t,e,r){for(var n=t.getCoordinates(),i=0;i<n.length-1;i++)this.computeOffsetPoints(n[i],n[i+1],e,r)},Ti.prototype.setSidesToGenerate=function(t,e){this._doLeft=t,this._doRight=e},Ti.prototype.getPoints=function(t){for(var e=new Ot,r=xn.getLines(this._g).iterator();r.hasNext();){var n=r.next();this.extractPoints(n,t,e)}return e},Ti.prototype.computeOffsetPoints=function(t,e,r,n){var i=e.x-t.x,o=e.y-t.y,a=Math.sqrt(i*i+o*o),s=r*i/a,u=r*o/a,l=(e.x+t.x)/2,c=(e.y+t.y)/2;if(this._doLeft){var f=new x(l-u,c+s);n.add(f)}if(this._doRight){var p=new x(l+u,c-s);n.add(p)}},Ti.prototype.interfaces_=function(){return[]},Ti.prototype.getClass=function(){return Ti};var ji=function t(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=t.TOLERANCE,this._testCoords=new Ot;var e=arguments[0],r=arguments[1],n=arguments[2];this._boundaryDistanceTolerance=t.computeBoundaryDistanceTolerance(e,r),this._geom=[e,r,n],this._locFinder=[new Pi(this._geom[0],this._boundaryDistanceTolerance),new Pi(this._geom[1],this._boundaryDistanceTolerance),new Pi(this._geom[2],this._boundaryDistanceTolerance)]},Ri={TOLERANCE:{configurable:!0}};ji.prototype.reportResult=function(t,e,r){q.out.println("Overlay result invalid - A:"+k.toLocationSymbol(e[0])+" B:"+k.toLocationSymbol(e[1])+" expected:"+(r?"i":"e")+" actual:"+k.toLocationSymbol(e[2]))},ji.prototype.isValid=function(t){return this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]),this.checkValid(t)},ji.prototype.checkValid=function(){if(1===arguments.length){for(var t=arguments[0],e=0;e<this._testCoords.size();e++){var r=this._testCoords.get(e);if(!this.checkValid(t,r))return this._invalidLocation=r,!1}return!0}if(2===arguments.length){var n=arguments[0],i=arguments[1];return this._location[0]=this._locFinder[0].getLocation(i),this._location[1]=this._locFinder[1].getLocation(i),this._location[2]=this._locFinder[2].getLocation(i),!!ji.hasLocation(this._location,k.BOUNDARY)||this.isValidResult(n,this._location)}},ji.prototype.addTestPts=function(t){var e=new Ti(t);this._testCoords.addAll(e.getPoints(5*this._boundaryDistanceTolerance))},ji.prototype.isValidResult=function(t,e){var r=Ei.isResultOfOp(e[0],e[1],t),n=!(r^e[2]===k.INTERIOR);return n||this.reportResult(t,e,r),n},ji.prototype.getInvalidLocation=function(){return this._invalidLocation},ji.prototype.interfaces_=function(){return[]},ji.prototype.getClass=function(){return ji},ji.hasLocation=function(t,e){for(var r=0;r<3;r++)if(t[r]===e)return!0;return!1},ji.computeBoundaryDistanceTolerance=function(t,e){return Math.min(Kn.computeSizeBasedSnapTolerance(t),Kn.computeSizeBasedSnapTolerance(e))},ji.isValid=function(t,e,r,n){return new ji(t,e,n).isValid(r)},Ri.TOLERANCE.get=function(){return 1e-6},Object.defineProperties(ji,Ri);var Li=function t(e){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=t.extractFactory(e),this._inputGeoms=e};Li.prototype.extractElements=function(t,e){if(null===t)return null;for(var r=0;r<t.getNumGeometries();r++){var n=t.getGeometryN(r);this._skipEmpty&&n.isEmpty()||e.add(n)}},Li.prototype.combine=function(){for(var t=new Ot,e=this._inputGeoms.iterator();e.hasNext();){var r=e.next();this.extractElements(r,t)}return 0===t.size()?null!==this._geomFactory?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(t)},Li.prototype.interfaces_=function(){return[]},Li.prototype.getClass=function(){return Li},Li.combine=function(){return 1===arguments.length?new Li(arguments[0]).combine():2===arguments.length?new Li(Li.createList(arguments[0],arguments[1])).combine():3===arguments.length?new Li(Li.createList(arguments[0],arguments[1],arguments[2])).combine():void 0},Li.extractFactory=function(t){return t.isEmpty()?null:t.iterator().next().getFactory()},Li.createList=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],r=new Ot;return r.add(t),r.add(e),r}if(3===arguments.length){var n=arguments[0],i=arguments[1],o=arguments[2],a=new Ot;return a.add(n),a.add(i),a.add(o),a}};var Ii=function(){this._inputPolys=null,this._geomFactory=null;var t=arguments[0];this._inputPolys=t,null===this._inputPolys&&(this._inputPolys=new Ot)},Mi={STRTREE_NODE_CAPACITY:{configurable:!0}};Ii.prototype.reduceToGeometries=function(t){for(var e=new Ot,r=t.iterator();r.hasNext();){var n=r.next(),i=null;j(n,St)?i=this.unionTree(n):n instanceof ct&&(i=n),e.add(i)}return e},Ii.prototype.extractByEnvelope=function(t,e,r){for(var n=new Ot,i=0;i<e.getNumGeometries();i++){var o=e.getGeometryN(i);o.getEnvelopeInternal().intersects(t)?n.add(o):r.add(o)}return this._geomFactory.buildGeometry(n)},Ii.prototype.unionOptimized=function(t,e){var r=t.getEnvelopeInternal(),n=e.getEnvelopeInternal();if(!r.intersects(n))return Li.combine(t,e);if(t.getNumGeometries()<=1&&e.getNumGeometries()<=1)return this.unionActual(t,e);var i=r.intersection(n);return this.unionUsingEnvelopeIntersection(t,e,i)},Ii.prototype.union=function(){if(null===this._inputPolys)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var t=new or(Ii.STRTREE_NODE_CAPACITY),e=this._inputPolys.iterator();e.hasNext();){var r=e.next();t.insert(r.getEnvelopeInternal(),r)}this._inputPolys=null;var n=t.itemsTree();return this.unionTree(n)},Ii.prototype.binaryUnion=function(){if(1===arguments.length){var t=arguments[0];return this.binaryUnion(t,0,t.size())}if(3===arguments.length){var e=arguments[0],r=arguments[1],n=arguments[2];if(n-r<=1){var i=Ii.getGeometry(e,r);return this.unionSafe(i,null)}if(n-r==2)return this.unionSafe(Ii.getGeometry(e,r),Ii.getGeometry(e,r+1));var o=Math.trunc((n+r)/2),a=this.binaryUnion(e,r,o),s=this.binaryUnion(e,o,n);return this.unionSafe(a,s)}},Ii.prototype.repeatedUnion=function(t){for(var e=null,r=t.iterator();r.hasNext();){var n=r.next();e=null===e?n.copy():e.union(n)}return e},Ii.prototype.unionSafe=function(t,e){return null===t&&null===e?null:null===t?e.copy():null===e?t.copy():this.unionOptimized(t,e)},Ii.prototype.unionActual=function(t,e){return Ii.restrictToPolygons(t.union(e))},Ii.prototype.unionTree=function(t){var e=this.reduceToGeometries(t);return this.binaryUnion(e)},Ii.prototype.unionUsingEnvelopeIntersection=function(t,e,r){var n=new Ot,i=this.extractByEnvelope(r,t,n),o=this.extractByEnvelope(r,e,n),a=this.unionActual(i,o);return n.add(a),Li.combine(n)},Ii.prototype.bufferUnion=function(){if(1===arguments.length){var t=arguments[0];return t.get(0).getFactory().buildGeometry(t).buffer(0)}if(2===arguments.length){var e=arguments[0],r=arguments[1];return e.getFactory().createGeometryCollection([e,r]).buffer(0)}},Ii.prototype.interfaces_=function(){return[]},Ii.prototype.getClass=function(){return Ii},Ii.restrictToPolygons=function(t){if(j(t,$t))return t;var e=On.getPolygons(t);return 1===e.size()?e.get(0):t.getFactory().createMultiPolygon(me.toPolygonArray(e))},Ii.getGeometry=function(t,e){return e>=t.size()?null:t.get(e)},Ii.union=function(t){return new Ii(t).union()},Mi.STRTREE_NODE_CAPACITY.get=function(){return 4},Object.defineProperties(Ii,Mi);var Ai=function(){};Ai.prototype.interfaces_=function(){return[]},Ai.prototype.getClass=function(){return Ai},Ai.union=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return Ei.createEmptyResult(Ei.UNION,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),oi.overlayOp(t,e,Ei.UNION)},t.GeoJSONReader=Oe,t.GeoJSONWriter=xe,t.OverlayOp=Ei,t.UnionOp=Ai,t.BufferOp=dn,Object.defineProperty(t,"__esModule",{value:!0})}(e)}},e={};function r(n){var i=e[n];if(void 0!==i)return i.exports;var o=e[n]={id:n,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.nc=void 0;var n={};(()=>{r.d(n,{VT:()=>_z,VD:()=>mz,WB:()=>i});var t=["billboard","label","polyline","polygon","point","rectangle"],e={clampToGround:!0};function i(t){t(e)}var o={ibo:"ibo",cta:"cta",ter:"ter",cia:"cia",img:"img",cva:"cva",vec:"vec"},a={"EPSG:4490":"c","EPSG:4326":"c","EPSG:3857":"c",WEB:"w"};function s(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"EPSG:3857";return"".concat(o[t],"_").concat(a[e])}var u=r(3379),l=r.n(u),c=r(7795),f=r.n(c),p=r(569),h=r.n(p),y=r(3565),d=r.n(y),g=r(9216),m=r.n(g),v=r(4589),_=r.n(v),b=r(892),w={};w.styleTagTransform=_(),w.setAttributes=d(),w.insert=h().bind(null,"head"),w.domAPI=f(),w.insertStyleElement=m(),l()(b.Z,w),b.Z&&b.Z.locals&&b.Z.locals;var S=40487.57,O=7096758e-11,x=91610.74,C=-40467.74;function E(t){return Math.round(x*Math.pow((S-C)/(t-C)-1,1/O))}function P(t){return Math.round(C+(S-C)/(1+Math.pow(t/x,O)))}function k(t,e){return Cesium.toLonLat(t.scene.globe.pick(t.camera.getPickRay(e),t.scene))}function T(t,e){return t.scene.globe.pick(t.camera.getPickRay(e),t.scene)}function j(t,e,r){var n=t.scene.globe.ellipsoid,i=n.cartesianToCartographic(e),o=r||t.getHeight();return(o<t.getMinHeight()||o>t.getMaxHeight())&&(o=t.getHeight()),n.cartographicToCartesian(Cesium.Cartographic.fromDegrees(Cesium.Math.toDegrees(i.longitude),Cesium.Math.toDegrees(i.latitude),o))}function R(t){return Array.isArray(t)?Cesium.BoundingSphere.fromPoints(t.map((function(t){return Cesium.fromLonLat(t)}))).center:Cesium.fromLonLat(t)}function I(t){return Cesium.toLonLat(R(t))}function M(t){if(Array.isArray(t)){var e=new Cesium.BoundingSphere;return t.forEach((function(t){Cesium.BoundingSphere.expand(e,M(t))})),e.center}return t.polygon?Cesium.BoundingSphere.fromPoints(t.polygon.hierarchy.getValue(Cesium.JulianDate.now()).positions).center:t.polyline?Cesium.BoundingSphere.fromPoints(t.polyline.positions.getValue(Cesium.JulianDate.now())).center:t.position.getValue(Cesium.JulianDate.now())}function A(t,e){return Cesium.toLonLat(M(t),e)}function D(t,e){var r;return r=t.polygon?Cesium.BoundingSphere.fromPoints(t.polygon.hierarchy.getValue(Cesium.JulianDate.now()).positions):t.polyline?Cesium.BoundingSphere.fromPoints(t.polyline.positions.getValue(Cesium.JulianDate.now())):Cesium.BoundingSphere.fromPoints([t.position.getValue(Cesium.JulianDate.now())]),e&&Cesium.BoundingSphere.union(e,r,e),r}function N(t,e){var r=Cesium.BoundingSphere.fromPoints(t.map((function(t){return Cesium.fromLonLat(t)})));return Cesium.toLonLat(r.center,e)}function F(t){for(var e=0,r=0;r<t.length-2;r++){var n=t[r],i=t[r+1],o=t[r+2],a=Cesium.Cartesian3.subtract(n,i,new Cesium.Cartesian3),s=Cesium.Cartesian3.subtract(o,i,new Cesium.Cartesian3),u=Cesium.Cartesian3.cross(a,s,a);e+=.5*Cesium.Cartesian3.magnitude(u)}return e}function z(t,e){var r=this,n=function(){if(!e[i].type)return 1;var n=e[i].value;switch(e[i].type){case"color":t[i]=Cesium.Color.fromCssColorString(n),t.material=t.materialText?r.drawCircleImage(t.materialText,n,200,200):Cesium.Color.fromCssColorString(n);break;case"array":n instanceof Array&&2===n.length?t[i]=new Cesium.DistanceDisplayCondition(n[0],n[1]):console.warn("配置DistanceDisplayCondition属性需给出数组",n);break;case"scaleByDistance":n instanceof Array&&4===n.length?t[i]=new Cesium.NearFarScalar(n[0],n[1],n[2],n[3]):console.warn("配置scaleByDistance属性需给出数组",n);break;case"cartesian2":n instanceof Array&&2===n.length?t[i]=new Cesium.Cartesian2(n[0],n[1]):console.warn("配置Cartesian2属性需给出数组",n);break;case"cartesian3":n instanceof Array&&3===n.length?t[i]=new Cesium.Cartesian3(n[0],n[1],n[2]):console.warn("配置Cartesian3属性需给出数组",n);break;case"image":var o=n.includes("http")?n:Cesium.buildModuleUrl(n);if(o.endsWith("gif")||o.endsWith("GIF")){var a=[],s=0;r.loadGif(o,a),t[i]=new Cesium.CallbackProperty((function(t){return a.length?(s=s<1*(a.length-1)?s+1:0,a[Math.floor(s/1)]):o}),!1)}else t[i]=o;break;case"callback":var u=0,l=1;t[i]=new Cesium.CallbackProperty((function(t){return((l=u%2==0?l-.04:l+.04)<=.3||l>=1)&&u++,Cesium.Color.fromCssColorString(n).withAlpha(l)}),!1);break;case"position":n instanceof Array&&2===n.length?t[i]=Cesium.Cartesian3.fromDegreesArray(n)[0]:n instanceof Array&&3===n.length?t[i]=Cesium.Cartesian3.fromDegreesArrayHeights(n)[0]:console.warn("配置position属性需给出位置数组以及有效的经纬度范围",n);break;default:t[i]=n,"disableDepthTestDistance"==i&&n>=1e7&&(t[i]=Number.POSITIVE_INFINITY)}};for(var i in e)n()}function G(t,e){t.billboard&&e.billboard&&z(t.billboard,e.billboard),t.label&&e.label&&z(t.label,e.label),t.point&&e.point&&z(t.point,e.point),t.polygon&&e.polygon&&z(t.polygon,e.polygon),t.polyline&&e.polyline&&z(t.polyline,e.polyline),t.rectangle&&e.rectangle&&z(t.rectangle,e.rectangle)}function B(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function V(t){return V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},V(t)}function U(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function q(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,X(n.key),n)}}function W(t,e,r){return e&&q(t.prototype,e),r&&q(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function X(t){var e=function(t,e){if("object"!=V(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=V(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==V(e)?e:String(e)}var Z=new(function(){function t(){U(this,t),this.divOverlays=[],this._start=!1,this.__listenter=this._listenter.bind(this),this._time=void 0}return W(t,[{key:"on",value:function(t,e){this.divOverlays.push(e),this._start||(this._start=!0,t.camera.changed.addEventListener(this.__listenter),t.camera.moveEnd.addEventListener(this.__listenter))}},{key:"off",value:function(t,e){var r=this.divOverlays.findIndex((function(t){return t===e}));r>=0&&this.divOverlays.splice(r,1),0===this.divOverlays.length&&(this._start=!1,t.camera.changed.removeEventListener(this.__listenter),t.camera.moveEnd.removeEventListener(this.__listenter))}},{key:"_listenter",value:function(t){var e=this;this._time&&clearTimeout(this._time),this._time=setTimeout((function(){e.divOverlays.forEach((function(t){t._update()}))}),50)}}]),t}()),H=function(){function t(e){U(this,t),this.map=void 0,this.options=void 0,this._latLng=void 0,this._parentContainer=void 0,this._container=void 0,this._content=void 0,this.options=e,this._init()}return W(t,[{key:"_getParentContainer",get:function(){var t=this._parentContainer||this.map.canvas.parentNode.querySelector("#bimmap-smap-popup");return t||((t=document.createElement("div")).setAttribute("id","bimmap-smap-popup"),t.classList.add("bimmap-smap-popus"),this.map.canvas.parentNode.appendChild(t)),t}},{key:"_init",value:function(){var t=this.options.className,e=void 0===t?"":t;this._container=document.createElement("div"),this._container.classList.add("bimmap-smap-popup");var r,n,i=e.split(" ").filter((function(t){return!!t}));i.length>0&&(r=this._container.classList).add.apply(r,function(t){if(Array.isArray(t))return B(t)}(n=i)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||function(t,e){if(t){if("string"==typeof t)return B(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?B(t,e):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),this._content=document.createElement("div"),this._content.classList.add("bimmap-smap-popup_content"),this._container.appendChild(this._content)}},{key:"_update",value:function(){if(this.map){var t=this.options,e=t.offset,r=void 0===e?[0,0]:e,n=t.clampToGround,i=(c=this.map,f=Cesium.fromLonLat(this._latLng,n?0:void 0),Cesium.SceneTransforms.wgs84ToWindowCoordinates(c.scene,f));if(i){var o=this._getParentContainer.contains(this._container);o||(this._container.style.visibility="hidden",document.body.appendChild(this._container));var a=this._container.clientWidth,s=this._container.clientHeight;this._container.style.cssText="transform:translate3d(".concat(a/2+i.x,"px, ").concat(s/2+i.y,"px, 0px);");var u=this._content.clientWidth,l=this._content.clientHeight;this._content.style.left="".concat(-(u+a/2)/2+r[0],"px"),this._content.style.top="".concat(-(l+s)+r[1],"px"),o||(document.body.removeChild(this._container),this._container.style.visibility="visible")}}var c,f}},{key:"addTo",value:function(t){this.map=t;var e=this._getParentContainer;e.contains(this._container)||(this._update(),e.appendChild(this._container),Z.on(t,this))}},{key:"remove",value:function(){var t=this._getParentContainer;t.contains(this._container)&&(Z.off(this.map,this),t.removeChild(this._container))}},{key:"getLatLng",value:function(){return this._latLng}},{key:"setLatLng",value:function(t){this._latLng=t,this._update()}},{key:"getElement",value:function(){return this._content}},{key:"setContent",value:function(t){t instanceof HTMLElement?this._content.appendChild(t):this._content.innerHTML=t,this._update()}}]),t}();function Y(t){t.DivOverlay=H,t.popup=function(t){return new H(t)},t.CustomViewer.prototype.addDivOverlay=function(t){t.addTo(this)},t.CustomViewer.prototype.removeDivOverlay=function(t){t.remove()}}function K(t){return K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},K(t)}function J(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}var $=Object.prototype.toString;function Q(t){return"[object Object]"===$.call(t)}function tt(){var t=(new Date).getTime(),e=performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(r){var n=16*Math.random();return t>0?(n=(t+n)%16|0,t=Math.floor(t/16)):(n=(e+n)%16|0,e=Math.floor(e/16)),("x"===r?n:3&n|8).toString(16)}))}function et(t){return null==t||""===t||Number.isNaN(t)||t===1/0}function rt(t){for(var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"warn",n=arguments.length,i=new Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];(e=console)[r].apply(e,["🚀 ~ bimmap ~ 提示：",t].concat(i))}function nt(t,e,r){return Q(t)&&Q(e)&&Object.keys(e).forEach((function(n){r&&r.includes(n)||!Reflect.has(t,n)||!Q(t[n])||!Q(e[n])?Q(e[n])?t[n]=nt({},e[n]):t[n]=e[n]:nt(t[n],e[n])})),t}function it(t,e){var r=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?J(Object(r),!0).forEach((function(e){var n,i,o,a;n=t,i=e,o=r[e],a=function(t,e){if("object"!=K(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=K(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(i),(i="symbol"==K(a)?a:String(a))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):J(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},t);return Q(r)&&Q(e)&&Object.keys(e).forEach((function(t){Reflect.has(r,t)&&Q(r[t])&&Q(e[t])?it(r[t],e[t]):Q(e[t])?r[t]=it({},e[t]):r[t]=e[t]})),r}function ot(t){return JSON.parse(JSON.stringify(t))}function at(t,e){var r=Array.isArray(t)?t.join("\n"):t;return e?e instanceof HTMLElement?e:e.replace(/\$\{text\}/gi,r):r}function st(t){var e=[1,1];if(t)if("number"==typeof t)e[0]=t,e[1]=t;else{if(!(t.length<2))return t;e[0]=t[0],e[1]=t[0]}return e}function ut(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=arguments.length>3?arguments[3]:void 0;Object.keys(e).forEach((function(i){!Reflect.has(t,i)||r.includes(i)||n&&!n.includes(i)||(t[i]=e[i])}))}function lt(t,e,r){return!1!==e?t?t/1e3:r||t:t?1e3*t:r||t}function ct(t){var e=(t.indexOf("?")>=0?t.split("?")[1]:t).split("&"),r={};return e.forEach((function(t){var e=t.split("=");r[e[0].trim()]=e[1]?decodeURIComponent(e[1].trim()):e[1]})),r}function ft(t,e){return et(e)?t/1e3/1e3:+(t/1e3/1e3).toFixed(e)}function pt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"m",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"km";return t<1?"".concat((1e3*t).toFixed(0)," ").concat(e):"".concat(t.toFixed(3)," ").concat(r)}function ht(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"m²",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"km²";return t<1e5?"".concat((t/100).toFixed(0)," ").concat(e):"".concat((t/1e3/1e3).toFixed(3)," ").concat(r)}function yt(t){return yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yt(t)}function dt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function gt(t){return gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gt(t)}function mt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,vt(n.key),n)}}function vt(t){var e=function(t,e){if("object"!=gt(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=gt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==gt(e)?e:String(e)}var _t=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._dispose=!1}var e,r;return e=t,(r=[{key:"dispose",value:function(){this._dispose=!0}}])&&mt(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function bt(t){return bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bt(t)}function wt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function St(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ot(n.key),n)}}function Ot(t){var e=function(t,e){if("object"!=bt(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=bt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==bt(e)?e:String(e)}function xt(){return xt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Et(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},xt.apply(this,arguments)}function Ct(t,e){return Ct=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ct(t,e)}function Et(t){return Et=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Et(t)}var Pt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ct(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Et(n);if(i){var r=Et(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===bt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(t=o.call.apply(o,[this].concat(r)))._layers=[],t._map=void 0,t}return e=a,r=[{key:"layers",get:function(){return this._layers}},{key:"addLayer",value:function(t){var e=this;return Array.isArray(t)?t.forEach((function(t){e.addLayer(t)})):this._layers.includes(t)||(this._layers.push(t),this._map.dataSources.add(t)),this}},{key:"hasLayer",value:function(t){return this._layers.includes(t)}},{key:"removeLayer",value:function(t){var e=this;if(!t)return this._map.dataSources.removeAll(),void(this._layers.length=0);if(Array.isArray(t))t.forEach((function(t){e.removeLayer(t)}));else{var r=this.findIndexLayer((function(e){return e===t}));if(r<0)return;this._layers.splice(r,1),this._map.dataSources.remove(t,!0)}}},{key:"clearLayers",value:function(){var t=this;return this._layers.forEach((function(e){return t._map.dataSources.remove(e,!0)})),this._layers.length=0,this}},{key:"getLayers",value:function(t,e){var r=[];if("string"==typeof t)this._layers.forEach((function(n){var i;(null===(i=n.options)||void 0===i?void 0:i[t])===e&&r.push(n)}));else{var n=Object.keys(t);this._layers.forEach((function(e){n.some((function(r){var n;return(null===(n=e.options)||void 0===n?void 0:n[r])===t[r]}))&&r.push(e)}))}return r}},{key:"searchLayers",value:function(t){var e=this,r=[];return Array.isArray(t)?t.forEach((function(t){var n,i=e.searchLayers(t);r.push.apply(r,function(t){if(Array.isArray(t))return wt(t)}(n=i)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||function(t,e){if(t){if("string"==typeof t)return wt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?wt(t,e):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())})):this._layers.forEach((function(e){var n;(null===(n=e.options)||void 0===n?void 0:n.name)===t&&r.push(e)})),r}},{key:"filterLayer",value:function(t){for(var e=[],r=0,n=this._layers.length;r<n;r++)!0===t(this._layers[r],r)&&e.push(this._layers[r]);return e}},{key:"findLayer",value:function(t){for(var e=0,r=this._layers.length;e<r;e++)if(!0===t(this._layers[e],e))return this._layers[e]}},{key:"findIndexLayer",value:function(t){for(var e=0,r=this._layers.length;e<r;e++)if(!0===t(this._layers[e],e))return e;return-1}},{key:"forEachLayer",value:function(t){for(var e=0,r=this._layers.length;e<r;e++)t(this._layers[e],e);return this}},{key:"filterVisibleLayer",value:function(t,e){var r=!1!==e;return this._layers.forEach((function(e){!0===t(e.get("item"),e)&&e.show!==r&&(e.show=r)})),this}},{key:"filterRemoveLayer",value:function(t){for(var e=0,r=this._layers.length;e<r;e++)t(this._layers[e].get("item"),this._layers[e])&&(this._layers.splice(e,1),this._map.dataSources.remove(this._layers[e],!0),e--);return this}},{key:"visibleLayers",value:function(t,e){if(Array.isArray(t))this._layers.filter((function(e){return t.includes(e.get("name"))})).forEach((function(t){t.show=e}));else{var r=this.findLayer((function(e){return e.get("name")===t}));r&&(r.show=e)}return this}},{key:"zoomByLayers",value:function(t,e){if(Array.isArray(t)){var r=this._layers.filter((function(e){return t.includes(e.get("name"))}));r.length>0&&this._map._cameraService.zoomTo(r[r.length-1])}else{var n=this.findLayer((function(e){return e.get("name")===t}));n&&this._map._cameraService.zoomTo(n)}return this}},{key:"dispose",value:function(){xt(Et(a.prototype),"dispose",this).call(this),this.clearLayers()}}],r&&St(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t);const kt=Pt;function Tt(t){return Tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Tt(t)}var jt=["maxZoom","padding","duration"];function Rt(t){return function(t){if(Array.isArray(t))return Lt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Lt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Lt(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Lt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function It(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Mt(n.key),n)}}function Mt(t){var e=function(t,e){if("object"!=Tt(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Tt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Tt(e)?e:String(e)}function At(){return At="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Nt(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},At.apply(this,arguments)}function Dt(t,e){return Dt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Dt(t,e)}function Nt(t){return Nt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Nt(t)}var Ft=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Dt(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Nt(n);if(i){var r=Nt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Tt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this))._options=void 0,r._layerGroup=new Map,r._map=void 0,r._map=t,r._options=e,null!=e&&e.group&&e.group.forEach((function(t){r.addLayerGroup(t.name,t.layers)})),r}return e=a,r=[{key:"map",get:function(){return this._map}},{key:"addLayerGroup",value:function(t,e){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!1===(!(arguments.length>2&&void 0!==arguments[2])||arguments[2])&&this.removeLayerGroup(t),this._layerGroup.has(t)){var n=this._layerGroup.get(t);n&&(Array.isArray(e)?n.push.apply(n,Rt(e)):n.push(e))}else this._layerGroup.set(t,Array.isArray(e)?Rt(e):[e]);return!0===r&&this.toMap(t),this}},{key:"addLayerGroups",value:function(t){var e=this;t.forEach((function(t){e.addLayerGroup(t.groupName,t.layer,t.isAppend,t.isToMap)}))}},{key:"removeLayerGroup",value:function(t){var e=this;return Array.isArray(t)?t.forEach((function(t){e.removeLayerGroup(t)})):this._layerGroup.has(t)&&this._layerGroup.delete(t),this}},{key:"visibleLayerGroup",value:function(t,e){var r=Array.isArray(t)?t:[t],n=this._layerGroup,i=[],o=this.map;return r.forEach((function(t){if(n.has(t)){var r=n.get(t);if(r)for(var a=0;a<r.length;a++){var s=r[a];e?(o.dataSources.contains(s)||o.dataSources.add(s),i.push(s)):o.dataSources.contains(s)&&o.dataSources.remove(s)}}})),this}},{key:"getLayerExtent",value:function(t){var e=new Cesium.BoundingSphere;return Array.isArray(t)?t.forEach((function(t){t.entities.values.forEach((function(t){e=D(t,e)}))})):t.entities.values.forEach((function(t){D(t,e)})),e}},{key:"toMap",value:function(t){var e=this,r=Array.isArray(t)?t:[t],n=this._layerGroup,i=[];return r.forEach((function(t){if(n.has(t)){var e=n.get(t);e&&i.push.apply(i,Rt(e))}})),i.length>0&&i.forEach((function(t){var r;e.map.dataSources.contains(t)||null===(r=e.map)||void 0===r||r.dataSources.add(t)})),this}},{key:"zoomToCenter",value:function(t,e,r){if(this.map){var n=Array.isArray(t)?new Cesium.CustomDataSource:t;Array.isArray(t)&&t.forEach((function(t){t.entities.values.forEach((function(t){return n.entities.add(t)}))}));var i=r||{},o=(i.maxZoom,i.padding,i.duration);(function(t,e){if(null==t)return{};var r,n,i=function(t,e){if(null==t)return{};var r,n,i={},o=Object.keys(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||(i[r]=t[r]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}})(i,jt),this._map._cameraService.mapFlyTo(n,{duration:lt(o,!0,1),maximumHeight:E(e)})}}},{key:"groupToZoomToCenter",value:function(t,e,r){if(this._layerGroup.has(t)){var n=this._layerGroup.get(t);n&&this.zoomToCenter(n,e,r)}}},{key:"dispose",value:function(){At(Nt(a.prototype),"dispose",this).call(this),this._layerGroup.clear()}}],r&&It(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t);const zt=Ft;function Gt(t){return Gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gt(t)}function Bt(){return Bt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Wt(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},Bt.apply(this,arguments)}function Vt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ut(n.key),n)}}function Ut(t){var e=function(t,e){if("object"!=Gt(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Gt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Gt(e)?e:String(e)}function qt(t,e){return qt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},qt(t,e)}function Wt(t){return Wt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Wt(t)}var Xt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&qt(t,e)}(s,t);var e,r,n,i,o,a=(e=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,n=Wt(e);if(r){var i=Wt(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return function(t,e){if(e&&("object"===Gt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t,e,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(n=a.call(this))._running=void 0,n._forward=!0,n._offset=0,n._options={duration:1,step:.3,offset:8,hoverStop:!0},n._callback=void 0,n._pauseCallback=void 0,n._callback=t,e&&Object.assign(n._options,e),n._pauseCallback=r,n.start(),n}return n=s,(i=[{key:"duration",get:function(){return this._options.offset/this._options.step/(1e3/30)}},{key:"options",get:function(){return this._options}},{key:"offset",get:function(){return this._offset}},{key:"start",value:function(){this._running=!0,this._animate()}},{key:"stop",value:function(){this._running=!1}},{key:"_animate",value:function(){this._dispose||(this._pauseCallback&&!1===this._pauseCallback()||(this._offset>=this._options.offset?this._forward=!1:this._offset<=0&&(this._forward=!0),this._forward?this._offset+=this._options.step:this._offset-=this._options.step,this._callback&&this._callback.call(this,this._offset)),this._running&&requestAnimationFrame(this._animate.bind(this)))}},{key:"callback",value:function(t){this._pauseCallback&&!1===this._pauseCallback()||this._callback&&this._callback.call(this,t)}},{key:"dispose",value:function(){Bt(Wt(s.prototype),"dispose",this).call(this),this.stop()}}])&&Vt(n.prototype,i),o&&Vt(n,o),Object.defineProperty(n,"prototype",{writable:!1}),s}(_t);function Zt(t){return Zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Zt(t)}function Ht(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Yt(n.key),n)}}function Yt(t){var e=function(t,e){if("object"!=Zt(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Zt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Zt(e)?e:String(e)}function Kt(){return Kt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=$t(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},Kt.apply(this,arguments)}function Jt(t,e){return Jt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Jt(t,e)}function $t(t){return $t=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},$t(t)}var Qt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Jt(t,e)}(s,t);var e,r,n,i,o,a=(i=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=$t(i);if(o){var r=$t(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Zt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(r=a.call(this))._running=void 0,r._radius=0,r._step=1,r._options=s.getDefaultOptions(),r._diffuseSpace=0,r._diffuseGroup=[],r._callback=void 0,r._callback=t,e&&Object.assign(r._options,e),r._init(),r.start(),r}return e=s,n=[{key:"getDefaultOptions",value:function(t){return Object.assign({type:"rippled",duration:2,gradient:.5,count:3,width:1,height:0,radius:80,color:"rgba(255,0,0,1)",fillColor:"rgba(255,0,0,1)",fixedRadius:!1},t||{})}}],(r=[{key:"options",get:function(){return this._options}},{key:"_init",value:function(){var t=this._options,e=t.count,r=t.duration,n=t.radius;this._diffuseSpace=n/e,this._step=n/2/(1e3*r/30)}},{key:"start",value:function(){this._running=!0,this._animate()}},{key:"stop",value:function(){this._running=!1}},{key:"_animate",value:function(){var t=this;if(!this._dispose){var e=this._options,r=e.count,n=e.radius,i=this._diffuseGroup.length;this._diffuseGroup.length>0?(i<r&&this._diffuseGroup[0].value>=this._diffuseSpace&&this._diffuseGroup.unshift({value:0,opacity:1}),this._diffuseGroup[i-1].value>=n&&(this._diffuseGroup.pop(),this._diffuseGroup.unshift({value:0,opacity:1}))):this._diffuseGroup.push({value:0,opacity:1}),this._diffuseGroup.forEach((function(e){e.value+=t._step,e.opacity=1-e.value/n})),this._callback&&this._callback.call(this,this._diffuseGroup),this._running&&requestAnimationFrame(this._animate.bind(this))}}},{key:"dispose",value:function(){Kt($t(s.prototype),"dispose",this).call(this),this.stop()}}])&&Ht(e.prototype,r),n&&Ht(e,n),Object.defineProperty(e,"prototype",{writable:!1}),s}(_t);function te(t){return te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},te(t)}function ee(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,re(n.key),n)}}function re(t){var e=function(t,e){if("object"!=te(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=te(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==te(e)?e:String(e)}function ne(){return ne="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=oe(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},ne.apply(this,arguments)}function ie(t,e){return ie=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ie(t,e)}function oe(t){return oe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},oe(t)}var ae=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ie(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=oe(n);if(i){var r=oe(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===te(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(n=o.call(this))._running=void 0,n._forward=!0,n._opacity=0,n._options={min:.05,max:1,step:.1,hoverStop:!0},n._callback=void 0,n._pauseCallback=void 0,n._callback=t,e&&Object.assign(n._options,e),n._pauseCallback=r,n.start(),n}return e=a,(r=[{key:"duration",get:function(){return(this._options.max-this._options.min)/this._options.step/(1e3/30)}},{key:"options",get:function(){return this._options}},{key:"opacity",get:function(){return this._opacity}},{key:"start",value:function(){this._running=!0,this._animate()}},{key:"stop",value:function(){this._running=!1}},{key:"_animate",value:function(){this._dispose||(this._pauseCallback&&!1===this._pauseCallback()||(this._forward?this._opacity+=this._options.step:this._opacity-=this._options.step,this._opacity>=this._options.max?(this._forward=!1,this._opacity=this._options.max):this._opacity<=this._options.min&&(this._forward=!0,this._opacity=this._options.min),this._callback&&this._callback.call(this,this._opacity)),this._running&&requestAnimationFrame(this._animate.bind(this)))}},{key:"dispose",value:function(){ne(oe(a.prototype),"dispose",this).call(this),this.stop()}}])&&ee(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t);function se(t){return se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},se(t)}function ue(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,le(n.key),n)}}function le(t){var e=function(t,e){if("object"!=se(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=se(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==se(e)?e:String(e)}function ce(){return ce="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=pe(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},ce.apply(this,arguments)}function fe(t,e){return fe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},fe(t,e)}function pe(t){return pe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},pe(t)}var he=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&fe(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=pe(n);if(i){var r=pe(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===se(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(t=o.call.apply(o,[this].concat(r)))._gifMap=new Map,t._gifLoadError=new Set,t._bounceMap=new Map,t._flickerMap=new Map,t._diffuseMap=new Map,t}return e=a,r=[{key:"diffuseMap",get:function(){return this._diffuseMap}},{key:"loadBounce",value:function(t,e,r){if(this._bounceMap.has(t)){var n=this._bounceMap.get(t);n._running||n.start()}else{var i=!1!==(null==r?void 0:r.hoverStop),o=new Xt((function(t){}),r,(function(){return!i||!0!==t.get("_hover",!0)}));if(e.billboard){var a,s=(null===(a=e.billboard.pixelOffset)||void 0===a?void 0:a.clone())||new Cesium.Cartesian2(0,0);e.billboard.pixelOffset=new Cesium.CallbackProperty((function(){return new Cesium.Cartesian2(s.x,s.y+o._offset)}),!0)}if(e.label){var u,l=(null===(u=e.label.pixelOffset)||void 0===u?void 0:u.clone())||new Cesium.Cartesian2(0,0);e.label.pixelOffset=new Cesium.CallbackProperty((function(t,e){return new Cesium.Cartesian2(l.x,l.y+o._offset)}),!0)}this._bounceMap.set(t,o)}}},{key:"removeBounce",value:function(t){this._bounceMap.has(t)&&(this._bounceMap.get(t).dispose(),this._bounceMap.delete(t))}},{key:"loadFlicker",value:function(t,e,r){if(this._flickerMap.has(t)){var n=this._flickerMap.get(t);n._running||n.start()}else{var i=!1!==(null==r?void 0:r.hoverStop),o=new ae((function(t){}),r,(function(){return!i||!0!==t.get("_hover",!0)}));e.billboard&&(e.billboard.color=new Cesium.CallbackProperty((function(){return Cesium.Color.WHITE.withAlpha(o._opacity)}),!0)),this._flickerMap.set(t,o)}}},{key:"removeFlicker",value:function(t){this._flickerMap.has(t)&&(this._flickerMap.get(t).dispose(),this._flickerMap.delete(t))}},{key:"loadDiffuse",value:function(t,e){this._diffuseMap.has(t)||this._diffuseMap.set(t,e)}},{key:"getDefaultDiffuse",value:function(t){return Qt.getDefaultOptions(t)}},{key:"removeDiffuse",value:function(t){this._diffuseMap.has(t)&&this._diffuseMap.delete(t)}},{key:"load",value:function(t){var e=this;if(!this._gifMap.has(t)){var r,n,i={url:t,gifler:null,canvas:null},o=null===(r=(n=window).gifler)||void 0===r?void 0:r.call(n,t);o?o._animatorPromise.then((function(r){return i.gifler=r,o.frames(document.createElement("canvas"),(function(t,e){i.canvas=e.buffer.toDataURL()}),!0).then((function(){})).catch((function(r){e._gifLoadError.add(t)}))})).catch((function(r){e._gifLoadError.add(t)})):(this._gifLoadError.add(t),window.gifler||rt('使用动态GIF图，请引入gifler插件，MapInit初始化时设置：plugin: ["gif"]',"warn")),this._gifMap.set(t,i)}var a=this._gifMap.get(t);return new Cesium.CallbackProperty((function(e){return a.canvas||t}),!0)}},{key:"remove",value:function(t){var e;this._gifLoadError.has(t)&&this._gifLoadError.delete(t),this._gifMap.has(t)&&(null===(e=this._gifMap.get(t).gifler)||void 0===e||e.stop())}},{key:"has",value:function(t){return this._gifMap.has(t)}},{key:"hasError",value:function(t){return this._gifLoadError.has(t)}},{key:"dispose",value:function(){ce(pe(a.prototype),"dispose",this).call(this),this._gifLoadError.clear(),this._gifMap.forEach((function(t){t.gifler.stop()})),this._gifMap.clear(),this._bounceMap.forEach((function(t){return t.dispose()})),this._bounceMap.clear(),this._flickerMap.forEach((function(t){return t.dispose()})),this._flickerMap.clear(),this._diffuseMap.clear()}}],r&&ue(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t),ye=new he;function de(t){return de="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},de(t)}function ge(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,me(n.key),n)}}function me(t){var e=function(t,e){if("object"!=de(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=de(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==de(e)?e:String(e)}function ve(){return ve="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=be(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},ve.apply(this,arguments)}function _e(t,e){return _e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},_e(t,e)}function be(t){return be=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},be(t)}var we=new(function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_e(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=be(n);if(i){var r=be(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===de(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(t=o.call.apply(o,[this].concat(r)))._imagesCache=new Map,t._callbackQueue=[],t}return e=a,(r=[{key:"_createContainer",value:function(t){var e=document.createElement("div");return e.setAttribute("style","position:fixed;z-index:-9999;top:-999999px;left:-999999px;"),e.appendChild(t),document.body.appendChild(e),e}},{key:"_textToDom",value:function(t){var e,r=(new DOMParser).parseFromString(t,"text/html");return(null==r||null===(e=r.body)||void 0===e?void 0:e.childNodes.length)>0?r.body.childNodes[0]:null}},{key:"_excuteQueue",value:function(t,e){for(var r=0;r<this._callbackQueue.length;r++)this._callbackQueue[r].html===t&&(this._callbackQueue[r].callbak(e),this._callbackQueue.splice(r,1),r--)}},{key:"set",value:function(t,e){this._imagesCache.set(t,e)}},{key:"get",value:function(t){return this._imagesCache.get(t)||null}},{key:"add",value:function(t,e){this._imagesCache.has(t)&&this._imagesCache.get(t)?e(this._imagesCache.get(t)):this._callbackQueue.push({html:t,callbak:e})}},{key:"load",value:function(t){var e=this;if(!window.html2canvas)return rt('使用html文本转换，请引入html2canvas插件，MapInit初始化时设置：plugin: ["html2canvas"]',"warn"),null;if(!this._imagesCache.has(t)){this.set(t,null);var r=t instanceof HTMLElement?t:this._textToDom(t);if(r){var n=this._createContainer(r);window.html2canvas(r,{allowTaint:!0,backgroundColor:null,width:r.offsetWidth,height:r.offsetHeight,useCORS:!0}).then((function(r){e.set(t,r.toDataURL("image/png")),e._excuteQueue(t,e._imagesCache.get(t)),document.body.removeChild(n)})).catch((function(){e._imagesCache.delete(t),document.body.removeChild(n)}))}}return this._imagesCache.get(t)}},{key:"loadCanvas",value:function(t){var e=this;if(!window.html2canvas)return rt('使用html文本转换，请引入html2canvas插件，MapInit初始化时设置：plugin: ["html2canvas"]',"warn"),null;if(!this._imagesCache.has(t)){this.set(t,null);var r=t instanceof HTMLElement?t:this._textToDom(t);if(r){var n=this._createContainer(r);window.html2canvas(r,{allowTaint:!0,backgroundColor:null,width:r.offsetWidth,height:r.offsetHeight,useCORS:!0}).then((function(r){e.set(t,r),e._excuteQueue(t,r),document.body.removeChild(n)})).catch((function(){e._imagesCache.delete(t),document.body.removeChild(n)}))}}return this._imagesCache.get(t)}},{key:"remove",value:function(t){this._imagesCache.has(t)&&this._imagesCache.delete(t)}},{key:"clear",value:function(){this._imagesCache.clear()}},{key:"dispose",value:function(){ve(be(a.prototype),"dispose",this).call(this),this._callbackQueue.length=0,this._imagesCache.clear()}}])&&ge(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t));function Se(t,e,r){switch(r){case"eq":return t===e;case"ne":return t!==e;case"gt":return t>e;case"lt":return t<e;case"ge":return t>=e;case"le":return t<=e;case"like":return String(t).includes(e);case"between":return t>=e&&t<=e;case"in":if(e instanceof Array)return-1!==e.findIndex((function(e){return e===t}))}return!1}function Oe(t,e){if(!e)return!1;if(!Array.isArray(e))return Se(e.value,t[e.key],e.rule);for(var r=0,n=e.length;r<n;r++)if(Se(e[r].value,t[e[r].key],e[r].rule))return!0;return!1}function xe(t,e){if(!t||!Reflect.has(t,"get")||!e)return null;var r=t.get("item")||t.get("filter");if(r&&Q(r))if(Array.isArray(e)){for(var n=0,i=e.length;n<i;n++)if(Oe(r,e[n].rules))return e[n].style}else if(Oe(r,e.rules))return e.style;return null}function Ce(t){return Ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ce(t)}var Ee=["_rules"];function Pe(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function ke(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Pe(Object(r),!0).forEach((function(e){Te(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Pe(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Te(t,e,r){return(e=Ie(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function je(t){return function(t){if(Array.isArray(t))return Re(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Re(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Re(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Re(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Le(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ie(n.key),n)}}function Ie(t){var e=function(t,e){if("object"!=Ce(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Ce(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ce(e)?e:String(e)}function Me(){return Me="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=De(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},Me.apply(this,arguments)}function Ae(t,e){return Ae=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ae(t,e)}function De(t){return De=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},De(t)}var Ne=function(r){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ae(t,e)}(u,r);var n,i,o,a,s=(o=u,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=De(o);if(a){var r=De(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Ce(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function u(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),(e=s.call(this))._cacheStyle=new Map,e._cacheRuleStyle=new Map,e._excludeCacheEventNames=[],e._defaultOptions=null,e._cacheDefaultStyleOptions=null,e._options={},e.currentDefaultEventName="default",t&&nt(e._options,t),e}return n=u,i=[{key:"options",get:function(){return this._options}},{key:"_getTextCanvas",value:function(t,e,r){var n,i,o=document.createElement("canvas"),a=o.getContext("2d");if(!a)return o;a.font=(null==r?void 0:r.fontStyle)||"12px Microsoft YaHei";var s=a.measureText(t),u=((null==r||null===(n=r.badge)||void 0===n?void 0:n.rectWidth)||s.width)+10;o.width=(u<s.width?s.width:u<38?38:u)*e[0];var l=(null==r||null===(i=r.badge)||void 0===i?void 0:i.rectHeight)||26;o.height=(l<26?26:l)*e[1];var c=o.width,f=o.height;return a.beginPath(),a.fillStyle=null==r?void 0:r.fillColor,a.fillRect(0,0,c,f),a.fill(),a.translate(c/2,f/2+2),a.textAlign="center",a.textBaseline="middle",a.fillStyle=r.fontColor||"#ffffff",a.fillText(t,0,0),o}},{key:"_getConvertStyles",value:function(t){var r,n,i={};if((t.fill||t.strokeColor||t.strokeWidth)&&(i.polygon={fill:!!t.fill,material:Cesium.Color.fromCssColorString(t.fill||"rgba(0,0,0,0.2)"),outline:!et(t.strokeWidth),outlineWidth:0,outlineColor:Cesium.Color.fromCssColorString(t.strokeColor||"rgba(14,78,142,0.6)"),heightReference:e.clampToGround?Cesium.HeightReference.CLAMP_TO_GROUND:Cesium.HeightReference.NONE,show:!0,zIndex:t._zIndex},i.polyline={show:!0,width:et(t.strokeWidth)?1:t.strokeWidth,material:"dash"===t.lineType?new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.fromCssColorString(t.strokeColor||"rgba(255,0,255,1)"),dashLength:t.lineDash&&t.lineDash.length>0?t.lineDash[0]:16,gapColor:null!==(r=t.background)&&void 0!==r&&r.fill?Cesium.Color.fromCssColorString(null===(n=t.background)||void 0===n?void 0:n.fill):Cesium.Color.WHITE.withAlpha(0)}):Cesium.Color.fromCssColorString(t.strokeColor||"rgba(255,0,255,1)"),clampToGround:e.clampToGround,zIndex:t._zIndex}),t.radius&&(i.point={show:!0,pixelSize:t.radius||5,heightReference:e.clampToGround?Cesium.HeightReference.CLAMP_TO_GROUND:Cesium.HeightReference.NONE,color:Cesium.Color.fromCssColorString(t.fill||"rgba(0,0,0,0.2)"),outlineColor:Cesium.Color.fromCssColorString(t.strokeColor||"rgba(14,78,142,0.6)"),outlineWidth:t.strokeWidth||1}),t.iconUrl||t.img||t.html){var o=st(t.scale),a=t.imgSize?[t.imgSize[0]*o[0],t.imgSize[1]*o[1]]:[void 0,void 0],s=t.imgOffset||[0,0],u=t.iconUrl||(t.img instanceof HTMLImageElement?t.img.src:t.img?t.img.toDataURL():void 0);if(t.html){var l=at(t.text,t.html);we.loadCanvas(l),u=new Cesium.CallbackProperty((function(){return we.get(l)}),!0)}else u&&/\.gif$/i.test(u)&&(Object.defineProperty(i,"_gif",{value:u,configurable:!1}),u=ye.load(u));i.billboard={show:!0,image:u,scaleByDistance:new Cesium.NearFarScalar(0,.95,8e4,.7),verticalOrigin:Cesium.VerticalOrigin.CENTER,horizontalOrigin:Cesium.HorizontalOrigin.CENTER,heightReference:e.clampToGround?Cesium.HeightReference.CLAMP_TO_GROUND:Cesium.HeightReference.NONE,distanceDisplayCondition:new Cesium.DistanceDisplayCondition(0,Number.POSITIVE_INFINITY),scale:Math.max.apply(Math,je(o)),width:a[0],height:a[1],pixelOffset:new Cesium.Cartesian2(s[0]*o[0],s[1]*o[1]),color:t.opacity?Cesium.Color.WHITE.withAlpha(t.opacity):void 0}}if(!t.html&&t.text){var c,f,p,h,y,d,g,m=st(t.scale);null!==(c=t.background)&&void 0!==c&&c.url&&!i.billboard&&(i.billboard={show:!0,image:null===(g=t.background)||void 0===g?void 0:g.url,verticalOrigin:Cesium.VerticalOrigin.CENTER,horizontalOrigin:Cesium.HorizontalOrigin.CENTER,heightReference:e.clampToGround?Cesium.HeightReference.CLAMP_TO_GROUND:Cesium.HeightReference.NONE,distanceDisplayCondition:new Cesium.DistanceDisplayCondition(0,Number.POSITIVE_INFINITY),scale:Math.min.apply(Math,je(m)),eyeOffset:new Cesium.Cartesian3(0,0,-1)});var v=t.offset||[0,0];i.label={show:!0,text:Array.isArray(t.text)?t.text.join("\n"):t.text,font:t.fontStyle||"normal 12px MicroSoft YaHei",style:Cesium.LabelStyle.FILL_AND_OUTLINE,showBackground:!(null===(f=t.background)||void 0===f||!f.fill),backgroundColor:null!==(p=t.background)&&void 0!==p&&p.fill?Cesium.Color.fromCssColorString(null===(h=t.background)||void 0===h?void 0:h.fill):void 0,scale:Math.min.apply(Math,je(m)),backgroundPadding:new Cesium.Cartesian2(8,7),pixelOffset:new Cesium.Cartesian2(v[0]*m[0],v[1]*m[1]),eyeOffset:new Cesium.Cartesian3(0,-10,-10),horizontalOrigin:Cesium.HorizontalOrigin.CENTER,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,heightReference:e.clampToGround?Cesium.HeightReference.CLAMP_TO_GROUND:Cesium.HeightReference.NONE,fillColor:Cesium.Color.fromCssColorString(t.fontColor||"#333333"),outlineColor:Cesium.Color.fromCssColorString((null===(y=t.background)||void 0===y?void 0:y.strokeColor)||"#ffffff"),outlineWidth:(null===(d=t.background)||void 0===d?void 0:d.strokeWidth)||0,distanceDisplayCondition:new Cesium.DistanceDisplayCondition(0,Number.POSITIVE_INFINITY)}}if(t._zIndex&&(i.zIndex=t._zIndex),t._cesium&&G(i,t._cesium),t._bounce&&Object.defineProperty(i,"_bounce",{value:t._bounce,configurable:!1}),t._opacity&&(t.opacity&&!t._opacity.max&&(t._opacity.max=t.opacity),Object.defineProperty(i,"_opacity",{value:t._opacity,configurable:!1})),t._diffuse)if(Cesium.CircleWaveMaterialProperty){var _=ye.getDefaultDiffuse(t._diffuse),b={duration:1e3*_.duration,gradient:_.gradient,color:Cesium.Color.fromCssColorString(_.color),count:_.count};i.ellipse={heightReference:e.clampToGround?Cesium.HeightReference.CLAMP_TO_GROUND:Cesium.HeightReference.NONE,height:_.height,semiMinorAxis:_.radius,semiMajorAxis:_.radius,classificationType:Cesium.ClassificationType.BOTH,show:!0,distanceDisplayCondition:new Cesium.DistanceDisplayCondition(0,Number.POSITIVE_INFINITY),material:new Cesium.CircleWaveMaterialProperty(ke(ke({},b),{},{color:Cesium.Color.clone(b.color)})),zIndex:t._zIndex||1},_.fixedRadius||Object.defineProperty(i,"_diffuse",{value:_,configurable:!1})}else rt('使用动态GIF图，请引入CircleWaveMaterialProperty插件，MapInit初始化时设置：plugin: ["diffuse"]');return i}},{key:"_getOptionsToStyle",value:function(t,e){var r=this._getConvertStyles(e);return Object.defineProperty(r,"_options",{value:e,configurable:!1}),Object.defineProperty(r,"_eventName",{value:t,configurable:!1}),r}},{key:"_styleIntercept",value:function(t,e){t instanceof Cesium.CustomEntity&&(e&&Reflect.has(e,"_bounce")?t.get("_bounce",!0)||(ye.loadBounce(t,e,Reflect.get(e,"_bounce")),t.set("_bounce",!0,!0)):t.get("_bounce",!0)&&(t.unset("_bounce",!0),ye.removeBounce(t)),e&&Reflect.has(e,"_opacity")?t.get("_opacity",!0)||(ye.loadFlicker(t,e,Reflect.get(e,"_opacity")),t.set("_opacity",!0,!0)):t.get("_opacity",!0)&&(t.unset("_opacity",!0),ye.removeFlicker(t)),e&&Reflect.has(e,"_diffuse")?t.get("_diffuse",!0)||(ye.loadDiffuse(t,Reflect.get(e,"_diffuse")),t.set("_diffuse",!0,!0)):t.get("_diffuse",!0)&&(t.unset("_diffuse",!0),ye.removeDiffuse(t)))}},{key:"_convertStyles",value:function(t){var e=this;if(!t)return{};var r=ot(t),n=(r._rules,function(t,e){if(null==t)return{};var r,n,i=function(t,e){if(null==t)return{};var r,n,i={},o=Object.keys(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||(i[r]=t[r]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}(r,Ee)),i={};return i[this.currentDefaultEventName]=this._getOptionsToStyle(this.currentDefaultEventName,n),Object.keys(n).forEach((function(t){t.startsWith("_")&&t.endsWith("Style")&&(i[t]=e._getOptionsToStyle(t,it(n[t],n)))})),i}},{key:"_getFeatureDefaultStyle",value:function(t){if(this._cacheStyle.has(t)){var e=this._cacheStyle.get(t)[this.currentDefaultEventName];if(e&&Reflect.has(e,"_options"))return Reflect.get(e,"_options")}}},{key:"_getFeatureStyle",value:function(t,e,r){var n;if(this._cacheStyle.has(t)?n=this._cacheStyle.get(t)[e]:this._cacheStyle.set(t,{}),n){if(r&&!1!==(null==r?void 0:r.isMergeStyle))if(e===this.currentDefaultEventName)n=this._getOptionsToStyle(e,this.getMergeStyleOptions(t,r));else{var i=this._getFeatureDefaultStyle(t),o=i?this.getMergeStyleOptions(t,r,i):this.getMergeStyleOptions(t,r);n=this._getOptionsToStyle(e,o[e]?this.getMergeStyleOptions(t,o[e],o):o)}}else{if(e===this.currentDefaultEventName)n=this._getOptionsToStyle(e,this.getMergeStyleOptions(t,r));else{var a=this._getFeatureDefaultStyle(t),s=a?this.getMergeStyleOptions(t,r,a):this.getMergeStyleOptions(t,r);n=this._getOptionsToStyle(e,s[e]?this.getMergeStyleOptions(t,s[e],s):s)}e!==this.currentDefaultEventName&&this._excludeCacheEventNames.includes(e)||(this._cacheStyle.get(t)[e]=n)}return n}},{key:"getMergeStyleOptions",value:function(e,r,n){var i=ot(n||this._defaultOptions);if(i._rules){var o=xe(e,i._rules);o&&(i=nt(i,o,t))}return r?nt(i,r):i}},{key:"addExcludeCacheEventName",value:function(t){var e;(e=this._excludeCacheEventNames).push.apply(e,je(Array.isArray(t)?t:[t]))}},{key:"removeExcludeCacheEventName",value:function(t){var e=Array.isArray(t)?t:[t];this._excludeCacheEventNames=this._excludeCacheEventNames.filter((function(t){return!e.includes(t)}))}},{key:"setOptions",value:function(t){t&&nt(this._options,t)}},{key:"setDefaultOptions",value:function(t){return this._defaultOptions=t,this._cacheDefaultStyleOptions=this._convertStyles(t),this}},{key:"removeStyle",value:function(t){this._cacheStyle.has(t)&&this._cacheStyle.delete(t)}},{key:"removeFeatureStyle",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";if(this._cacheStyle.has(t)){var r=this._cacheStyle.get(t);r[e]||Reflect.deleteProperty(r,e)}}},{key:"addStyle",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",r=arguments.length>2?arguments[2]:void 0;return this._getFeatureStyle(t,e,r)}},{key:"getStyle",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",r=arguments.length>2?arguments[2]:void 0;if(!r&&("_hoverStyle"===e||"_clickStyle"===e)){var n=t.getStyle();n&&Reflect.get(n,"_eventName")!==this.currentDefaultEventName&&Reflect.has(n,"_options")&&(r=Te({},e,Reflect.get(n,"_options")[e]))}var i=this._getFeatureStyle(t,e,r);if(i||this._cacheDefaultStyleOptions){var o=i||this._cacheDefaultStyleOptions[e];return this._styleIntercept(t,o),o}}},{key:"dispose",value:function(){Me(De(u.prototype),"dispose",this).call(this),this._cacheStyle.clear(),this._defaultOptions=null,this._cacheDefaultStyleOptions=null}}],i&&Le(n.prototype,i),Object.defineProperty(n,"prototype",{writable:!1}),u}(_t);function Fe(t){return Fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fe(t)}function ze(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ge(n.key),n)}}function Ge(t){var e=function(t,e){if("object"!=Fe(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Fe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Fe(e)?e:String(e)}function Be(){return Be="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=qe(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},Be.apply(this,arguments)}function Ve(t,e){return Ve=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ve(t,e)}function Ue(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function qe(t){return qe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},qe(t)}var We=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ve(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=qe(n);if(i){var r=qe(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Fe(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Ue(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,e))._state_key=void 0,r._zoomChangeHandler=void 0,r.parent=void 0,r._selected=null,r._hoverSelected=null,r._events=[],r._layerClick=r.layerClick.bind(Ue(r)),r._layerMove=r.layerMove.bind(Ue(r)),r._initEvent={click:!1,hover:!1},r._state_key=Symbol("stateService"),r.parent=t,r.setDefaultOptions(e),r._initStyleEvent(e),r}return e=a,r=[{key:"map",get:function(){return this.parent.map}},{key:"selected",get:function(){return this._selected}},{key:"hoverSelected",get:function(){return this._hoverSelected}},{key:"hoverEvent",get:function(){return this._events.filter((function(t){return"hover"===t.type}))}},{key:"clickEvent",get:function(){return this._events.filter((function(t){return"click"===t.type}))}},{key:"_initStyleEvent",value:function(t){var e=this;t._clickStyle&&(this._onDefaultEvent("click"),this.on({type:"click",change:function(t,r,n){r&&r!==t&&(r.setStyle(r.get("__oldStyle",!0)),r.unset("__oldStyle",!0)),t&&r!==t&&(t.has("__oldStyle",!0)||t.set("__oldStyle",t.getStyle(),!0),t.setStyle(e.getStyle(t,"_clickStyle")))}})),t._hoverStyle&&(this._onDefaultEvent("hover"),this.on({type:"hover",change:function(t,r,n){r&&r!==t&&(e.parent.options._clickStyle&&e._selected===r||(r.setStyle(r.get("__oldStyle",!0)),r.unset("__oldStyle",!0))),t&&r!==t&&e._selected!==t&&(t.has("__oldStyle",!0)||t.set("__oldStyle",t.getStyle(),!0),t.setStyle(e.getStyle(t,"_hoverStyle")))}}))}},{key:"_onDefaultEvent",value:function(t){"click"!==t||this._initEvent.click?"hover"!==t||this._initEvent.hover||(this._initEvent.hover=!0,this.map._cameraService.on(Cesium.ScreenSpaceEventType.MOUSE_MOVE,this._layerMove,this._state_key)):(this._initEvent.click=!0,this.map._cameraService.on(Cesium.ScreenSpaceEventType.LEFT_CLICK,this._layerClick,this._state_key))}},{key:"__zoomChange",value:function(t,e){if(Array.isArray(t)?e>=t[0]&&e<=t[1]:e>=t){var r=Cesium.JulianDate.now(),n=this.map.camera.computeViewRectangle();this.parent.forEach((function(t){Cesium.Rectangle.contains(n,Cesium.Cartographic.fromCartesian(t.position.getValue(r)))?t.label&&(t.label.show=!0):t.label&&(t.label.show=!1)}))}else this.parent.forEach((function(t){t.label&&(t.label.show=!1)}))}},{key:"_zoomChangeShowLabel",value:function(t,e){this._zoomChangeHandler&&(this.map._cameraService.offZoom(this._zoomChangeHandler),this._zoomChangeHandler=null),t&&(this._zoomChangeHandler=this.__zoomChange.bind(this,t),this.map._cameraService.onZoom(this._zoomChangeHandler),!0===e&&this._zoomChangeHandler(t,this.map.getZoom()))}},{key:"_hasGetEntity",value:function(t){var e=(Array.isArray(t)?this.parent.filter((function(e){return t.includes(e)})):this.parent.find((function(e){return e===t})))||null;return Array.isArray(e)&&0===e.length&&(e=null),e}},{key:"layerClick",value:function(t,e){var r=this,n=null;Cesium.defined(t)&&(n=this._hasGetEntity(t.id),e.target=t);var i=this.parent,o=n;this.clickEvent.forEach((function(t){return t.change.call(i.layer,o,r._selected,e)})),this._selected=o}},{key:"layerMove",value:function(t,e){var r=this,n=null;Cesium.defined(t)&&(n=this._hasGetEntity(t.id),e.target=t),n===this._hoverSelected||Array.isArray(n)&&Array.isArray(this._hoverSelected)&&this._hoverSelected.every((function(t){return n.some((function(e){return e===t}))}))||(this.hoverEvent.forEach((function(t){return t.change.call(r.parent.layer,n,r._hoverSelected,e)})),this._hoverSelected=n)}},{key:"setSelected",value:function(t,e){return t?this._hasGetEntity(t)&&(e&&this.map._cameraService.mapFlyTo(t,e),this._selected!==t&&(this._selected&&this.setSelected(),t.has("__oldStyle",!0)||t.set("__oldStyle",t.getStyle(),!0),t.setStyle(this.getStyle(t,"_clickStyle")),this._selected=t)):this._selected&&(this._selected.has("__oldStyle",!0)?(this._selected.setStyle(this._selected.get("__oldStyle",!0)),this._selected.unset("__oldStyle",!0)):this._selected.setStyle(this.getStyle(this._selected)),this._selected=null),this}},{key:"setStyle",value:function(t,e,r){var n=this,i=e?r||"_temp":void 0;return Array.isArray(t)?t.forEach((function(t){return t.setStyle(n.getStyle(t,i,e))})):t.setStyle(this.getStyle(t,i,e)),this}},{key:"resetState",value:function(){return this._selected&&(this._selected.setStyle(this.getStyle(this._selected)),this._selected=null),this._hoverSelected&&(this._hoverSelected.setStyle(this.getStyle(this._hoverSelected)),this._hoverSelected=null),this}},{key:"on",value:function(t){return"click"!==t.type||this._initEvent.click?"hover"!==t.type||this._initEvent.hover||this._onDefaultEvent("hover"):this._onDefaultEvent("click"),this._events.push(t),this}},{key:"off",value:function(t){for(var e=0;e<this._events.length;e++)this._events[e].id!==t&&this._events[e].change!==t||(this._events.splice(e,1),e--);return this}},{key:"dispose",value:function(){this._zoomChangeShowLabel(),this.map._cameraService.off(this._state_key),this._selected=null,this._hoverSelected=null,this._events.length=0,Be(qe(a.prototype),"dispose",this).call(this)}}],r&&ze(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(Ne);function Xe(t){return Xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Xe(t)}function Ze(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function He(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ke(n.key),n)}}function Ye(t,e,r){return e&&He(t.prototype,e),r&&He(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ke(t){var e=function(t,e){if("object"!=Xe(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Xe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Xe(e)?e:String(e)}function Je(){return Je="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=er(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},Je.apply(this,arguments)}function $e(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Qe(t,e)}function Qe(t,e){return Qe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Qe(t,e)}function tr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=er(t);if(e){var i=er(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===Xe(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function er(t){return er=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},er(t)}var rr=function(t){$e(r,t);var e=tr(r);function r(){var t;Ze(this,r);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i)))._events=[],t}return Ye(r,[{key:"addEventListener",value:function(t,e){var r=Symbol(t);return this._events.push({key:r,type:t,fun:e}),r}},{key:"removeEventListener",value:function(t,e){var r=this._events.findIndex((function(r){return r.type===t&&r.fun===e}));r>=0&&this._events.splice(r,1)}},{key:"removeEventListenerKey",value:function(t){var e=this._events.findIndex((function(e){return e.key===t}));e>=0&&this._events.splice(e,1)}},{key:"fire",value:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];this._events.forEach((function(e){var n;e.type===t&&(n=e.fun).call.apply(n,[e].concat(r))}))}},{key:"fireKey",value:function(t){var e=this._events.find((function(e){return e.key===t}));if(e){for(var r,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];(r=e.fun).call.apply(r,[e].concat(i))}}},{key:"clearAllEventListeners",value:function(){this._events.length=0}},{key:"dispose",value:function(){Je(er(r.prototype),"dispose",this).call(this),this._events.length=0}}]),r}(_t),nr=function(t){$e(r,t);var e=tr(r);function r(){var t;Ze(this,r);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))).options={disabled:!1,disabledClick:!1,disabledDblClick:!1,disabledContextmenu:!1,disabledMove:!1,disabledWheel:!1,disabledCameraChanged:!1},t}return Ye(r,[{key:"setOptions",value:function(t){var e=this;if(t){var r={};Object.keys(t).forEach((function(n){Object.is(t[n],e.options[n])||(e.options[n]=t[n],e.fire(n,t[n]),r[n]=t[n])})),Object.keys(r).length>=0&&this.fire("changed",r)}}},{key:"judgeControl",value:function(t){return!0===(null==t?void 0:t.uncontrolled)}},{key:"judgeCesium",value:function(t,e){if(!0===(null==e?void 0:e.uncontrolled))return!0;var r=this.options,n=r.disabled,i=r.disabledClick,o=r.disabledDblClick,a=r.disabledContextmenu,s=r.disabledWheel,u=r.disabledMove,l=r.disabledCameraChanged;return!(!0===n||!0===i&&(t===Cesium.ScreenSpaceEventType.LEFT_CLICK||t===Cesium.ScreenSpaceEventType.LEFT_DOWN||t===Cesium.ScreenSpaceEventType.LEFT_UP||t===Cesium.ScreenSpaceEventType.MIDDLE_CLICK||t===Cesium.ScreenSpaceEventType.MIDDLE_DOWN||t===Cesium.ScreenSpaceEventType.MIDDLE_UP)||!0===o&&t===Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK||!0===a&&(t===Cesium.ScreenSpaceEventType.RIGHT_CLICK||t===Cesium.ScreenSpaceEventType.RIGHT_DOWN||t===Cesium.ScreenSpaceEventType.RIGHT_UP)||!0===s&&(t===Cesium.ScreenSpaceEventType.WHEEL||"moveEnd"===t||"moveStart"===t)||!0===l&&"changed"===t||!0===u&&t===Cesium.ScreenSpaceEventType.MOUSE_MOVE)}},{key:"judgeOpl",value:function(t,e){if(!0===(null==e?void 0:e.uncontrolled))return!0;var r=this.options,n=r.disabled,i=r.disabledClick,o=r.disabledDblClick,a=r.disabledContextmenu,s=r.disabledWheel,u=r.disabledMove;return!(!0===n||!0===i&&("click"===t||"mousedown"===t)||!0===o&&"dblclick"===t||!0===a&&"contextmenu"===t||!0===s&&("wheel"===t||"change:resolution"===t)||!0===u&&"mousemove"===t)}}]),r}(rr);function ir(t){return ir="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ir(t)}function or(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ar(n.key),n)}}function ar(t){var e=function(t,e){if("object"!=ir(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=ir(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ir(e)?e:String(e)}function sr(){return sr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=lr(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},sr.apply(this,arguments)}function ur(t,e){return ur=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ur(t,e)}function lr(t){return lr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},lr(t)}var cr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ur(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=lr(n);if(i){var r=lr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===ir(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(t=o.call.apply(o,[this].concat(r)))._stateService=void 0,t._map=void 0,t}return e=a,r=[{key:"initState",value:function(t,e){return this._stateService&&this._stateService.dispose(),this._stateService=new We(t,e),this}},{key:"zoomChangeShowLabel",value:function(t,e){return this._stateService._zoomChangeShowLabel(t,e),this}},{key:"selected",get:function(){return this._stateService.selected}},{key:"setSelected",value:function(t,e){return this._stateService.setSelected(t,e),this}},{key:"setStyle",value:function(t,e,r){return this._stateService.setStyle(t,e,r),this}},{key:"getStyle",value:function(t,e,r){return this._stateService.getStyle(t,e,r)}},{key:"addHover",value:function(t,e){var r=this;return this._stateService.on({id:e,type:"hover",change:function(e,n,i){var o=!!e,a=o?e:n;a.set("_hover",o,!0),t&&t({zoom:r._map.getZoom(),item:a.get("item"),hover:o,position:k(r._map,i.endPosition),featurePosition:A(a),feature:a,e:i})}}),this}},{key:"removeHover",value:function(t){return this._stateService.off(t),this}},{key:"addClick",value:function(t,e,r){var n=this;return this._stateService.on({id:e,type:"click",change:function(e,i,o){e?t&&t({zoom:n._map.getZoom(),item:e.get("item"),position:k(n._map,o.position),featurePosition:A(e),feature:e}):i&&r&&r.cancelCallback&&r.cancelCallback({zoom:P(n._map.camera.positionCartographic.height),item:i.get("item"),position:k(n._map,o.position),featurePosition:A(i),feature:i})}}),this}},{key:"removeClick",value:function(t){return this._stateService.off(t),this}},{key:"dispose",value:function(){sr(lr(a.prototype),"dispose",this).call(this),this._stateService.dispose()}}],r&&or(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(rr);function fr(t){return fr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fr(t)}function pr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,hr(n.key),n)}}function hr(t){var e=function(t,e){if("object"!=fr(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=fr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==fr(e)?e:String(e)}function yr(t,e){return yr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},yr(t,e)}function dr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function gr(t){return gr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},gr(t)}var mr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&yr(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=gr(n);if(i){var r=gr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===fr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return dr(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this))._options=void 0,r._features=[],r._layer=new Cesium.BimMapDataSource,r._map=t,r._options=e,r.initState(dr(r),e),r}return e=a,(r=[{key:"map",get:function(){return this._map}},{key:"features",get:function(){return this._layer.entities.values}},{key:"layer",get:function(){return this._layer}},{key:"show",get:function(){return this._layer.show},set:function(t){this._layer.show=t}},{key:"addFeature",value:function(t){var e=this,r=this._layer.getStyle(),n="function"==typeof r;return Array.isArray(t)?t.filter((function(t){return!e.hasFeature(t)})).forEach((function(t){e._features.push(t),e._layer.entities.add(t),r&&!t.getStyle()&&t.setStyle(n?r(t):r)})):this.hasFeature(t)||(this._features.push(t),this._layer.entities.add(t),r&&!t.getStyle()&&t.setStyle(n?r(t):r)),this}},{key:"hasFeature",value:function(t){return this._features.includes(t)}},{key:"removeFeature",value:function(t){var e=this;if(Array.isArray(t))t.forEach((function(t){e.removeFeature(t)}));else{var r=this._features.findIndex((function(e){return e===t}));r>=0&&(this._layer.entities.remove(this._features[r]),this._features.splice(r,1))}return this}},{key:"clearFeatures",value:function(){return this._layer.entities.removeAll(),this._features.length=0,this}},{key:"getFeatures",value:function(t,e){var r=[];if("string"==typeof t)this._features.forEach((function(n){var i;(null===(i=n.options)||void 0===i?void 0:i[t])===e&&r.push(n)}));else{var n=Object.keys(t);this._features.forEach((function(e){n.some((function(r){var n;return(null===(n=e.options)||void 0===n?void 0:n[r])===t[r]}))&&r.push(e)}))}return r}},{key:"filter",value:function(t){for(var e=[],r=0,n=this._features.length;r<n;r++)!0===t(this._features[r],r)&&e.push(this._features[r]);return e}},{key:"find",value:function(t){for(var e=0,r=this._features.length;e<r;e++)if(!0===t(this._features[e],e))return this._features[e]}},{key:"findLast",value:function(t){for(var e=this._features.length-1;e>=0;e--)if(!0===t(this._features[e],e))return this._features[e]}},{key:"findIndex",value:function(t){for(var e=0,r=this._features.length;e<r;e++)if(!0===t(this._features[e],e))return e;return-1}},{key:"findLastIndex",value:function(t){for(var e=this._features.length-1;e>=0;e--)if(!0===t(this._features[e],e))return e;return-1}},{key:"forEach",value:function(t){for(var e=0,r=this._features.length;e<r;e++)t(this._features[e],e);return this}},{key:"filterVisible",value:function(t){for(var e=0,r=this._features.length;e<r;e++){var n=this._features[e];!0===t(n.get("item"),n)?n.show=!0:n.show=!1}return this}},{key:"filterRemove",value:function(t){for(var e=this,r=[],n=0;n<this._features.length;n++){var i=this._features[n];!0===t(i.get("item"),i)?(this._features.splice(n,1),n--):r.push(i)}return r.length!==this._features.length&&(this._layer.entities.removeAll(),r.forEach((function(t){return e._layer.entities.add(t)}))),this}},{key:"options",get:function(){return this._options}},{key:"dispose",value:function(){this.clearFeatures()}}])&&pr(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(cr);const vr=mr;function _r(t){return _r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_r(t)}function br(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,wr(n.key),n)}}function wr(t){var e=function(t,e){if("object"!=_r(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=_r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==_r(e)?e:String(e)}function Sr(){return Sr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=xr(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},Sr.apply(this,arguments)}function Or(t,e){return Or=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Or(t,e)}function xr(t){return xr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},xr(t)}function Cr(t,e){var r,n,i,o,a;return t?(!t.strokeColor&&null!==(r=t.stroke)&&void 0!==r&&r.color&&(t.strokeColor=null===(i=t.stroke)||void 0===i?void 0:i.color),!t.strokeWidth&&null!==(n=t.stroke)&&void 0!==n&&n.width&&(t.strokeWidth=null===(o=t.stroke)||void 0===o?void 0:o.width),t.fill&&"string"!=typeof t.fill&&(t.fill=null===(a=t.fill)||void 0===a?void 0:a.color),e&&(t.strokeColor||(t.strokeColor="rgba(14,78,142,.6)"),et(t.strokeWidth)&&(t.strokeWidth=1),t.fill||(t.fill="rgba(0,0,0,0.2)")),t):t}var Er=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Or(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=xr(n);if(i){var r=xr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===_r(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,Cr(e)))._mapLayerUN=null,r._layer.set("name",e.name||"areaMapStyle"),r}return e=a,r=[{key:"setOptions",value:function(t){for(var e in t)this._options[e]=t[e]}},{key:"register",value:function(t){this.addFeature(t),this.setAreaStyle(this._options)}},{key:"initAreaMapStyle",value:function(t,e){var r=this;return t?("string"==typeof t?fetch(t||"四川.json").then((function(t){return t.json()})):Promise.resolve(t)).then((function(t){return(new Cesium.GeoJsonDataSource).load(t,e).then((function(t){r.register(t.entities.values)})).catch((function(t){console.error("🚀 ~ 加载geojson异常:",t)})),!0})).catch((function(){return Promise.resolve(!1)})):Promise.resolve(!1)}},{key:"setAreaStyle",value:function(t){this._layer.setStyle(this._stateService.getStyle(this._layer,void 0,Cr(t,!0)))}},{key:"setChildAreaStyle",value:function(t,e){var r=this;Array.isArray(t)?t.forEach((function(t){return r.setChildAreaStyle(t,e)})):t.setStyle(e?this._stateService.getStyle(t,void 0,e):this._stateService.getStyle(this._layer)),this._map.scene.requestRender()}},{key:"dispose",value:function(){Sr(xr(a.prototype),"dispose",this).call(this),this._mapLayerUN&&this._mapLayerUN()}}],r&&br(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(vr);function Pr(t){return Pr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pr(t)}function kr(t,e){if(t){if("string"==typeof t)return Tr(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Tr(t,e):void 0}}function Tr(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function jr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Rr(n.key),n)}}function Rr(t){var e=function(t,e){if("object"!=Pr(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Pr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Pr(e)?e:String(e)}var Lr=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._instances=[],this._parent=void 0,this._parent=e}var e,r;return e=t,(r=[{key:"instances",get:function(){return this._instances.map((function(t){return t.instance}))}},{key:"instancesToName",get:function(){var t={};return this._instances.forEach((function(e){e.instance.layer&&e.instance.layer.get("name")&&(t[e.instance.layer.get("name")]=e.instance)})),t}},{key:"add",value:function(t,e){var r,n,i=this;return Array.isArray(t)?((r=this._instances).push.apply(r,function(t){if(Array.isArray(t))return Tr(t)}(n=t.map((function(t){return{instance:t,toLayer:e}})))||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||kr(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),e&&t.forEach((function(t){t.layer&&i._parent.addLayer(t.layer)}))):(this._instances.push({instance:t,toLayer:e}),e&&t.layer&&this._parent.addLayer(t.layer)),t}},{key:"findLayerToInstance",value:function(t){return this._instances.find((function(e){return!0===e.toLayer&&e.instance.layer===t}))}},{key:"remove",value:function(t){var e,r,n=this;if(!t)return this._instances.forEach((function(t){t.instance.dispose(),t.toLayer&&t.instance.layer&&n._parent.removeLayer(t.instance.layer)})),void(this._instances.length=0);if(Array.isArray(t))t.forEach((function(t){return n.remove(t)}));else{var i=this._instances.findIndex((function(e){return e.instance===t}));if(i>=0){var o=(e=this._instances.splice(i,1),r=1,function(t){if(Array.isArray(t))return t}(e)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,o,a,s=[],u=!0,l=!1;try{if(o=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(s.push(n.value),s.length!==e);u=!0);}catch(t){l=!0,i=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw i}}return s}}(e,r)||kr(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0];t.dispose(),o.toLayer&&o.instance.layer&&this._parent.removeLayer(o.instance.layer)}}return this}},{key:"dispose",value:function(){this.remove()}}])&&jr(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Ir(t){return Ir="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ir(t)}var Mr=["padding","duration"];function Ar(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Dr(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Ar(Object(r),!0).forEach((function(e){var n,i,o;n=t,i=e,o=r[e],(i=Fr(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ar(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Nr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Fr(n.key),n)}}function Fr(t){var e=function(t,e){if("object"!=Ir(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Ir(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ir(e)?e:String(e)}function zr(){return zr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Vr(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},zr.apply(this,arguments)}function Gr(t,e){return Gr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Gr(t,e)}function Br(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Vr(t){return Vr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Vr(t)}var Ur=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Gr(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Vr(n);if(i){var r=Vr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Ir(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Br(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),e.badge&&(e._badgeStyle=e.badge),(r=o.call(this,t,e))._styleCache={},r._cluster=void 0,r._zIndex=0,r._selected=null,r._cacheBadgeImages=new Map,r.__clusterEvent=r._clusterEvent.bind(Br(r)),r._setClusterOptions(e),r._layer.set("name",e.name||"clusterPoint"),r._layer.setStyle((function(t){return r._stateService.getStyle(t,"default",{text:t.get("label")})})),r}return e=a,r=[{key:"_setClusterOptions",value:function(t){this._layer.clustering.enabled=!0,this._layer.clustering.pixelRange=t.distance||50,this._layer.clustering.minimumClusterSize=2,this._layer.clustering.clusterBillboards=!0,this._layer.clustering.clusterLabels=!0,this._layer.clustering.clusterPoints=!0,this._layer.clustering.show=!0,this._layer.clustering.clusterEvent.addEventListener(this.__clusterEvent)}},{key:"_clusterEvent",value:function(t,e){t.length>1&&(e.billboard.id=e.label.id,e.point.id=e.label.id,this._clusterStyle(t,e))}},{key:"_clusterStyle",value:function(t,e){var r,n=t.length,i=this._cacheBadgeImages.has(n+"")?this._cacheBadgeImages.get(n+""):{},o=st(this._options.badge?this._options.badge.scale:1),a=i.canvas||this._createBadge(n,this._options,o),s=i.style||this._stateService.getStyle(e.billboard,"default_".concat(n),{text:n+"",background:{fill:"#ffffff"}});this._cacheBadgeImages.set(n+"",{style:s,canvas:a}),null!==(r=s.billboard)&&void 0!==r&&r.image?(e.label.show=!1,ut(e.billboard,s.billboard,["image"]),e.billboard.setImage(n+"",this._createImageCallback.bind(this)),e.billboard.show=!0):s.billboard?ut(e.billboard,s.billboard):(e.label.text=n+"",e.point.show=!0,e.point.pixelSize=10)}},{key:"create",value:function(t,e){if(Array.isArray(t)){var r=t.map((function(t){var e=new Cesium.CustomEntity({position:Cesium.fromLonLat(t.point),label:t.label&&{text:t.label}});return e.set({item:t,label:t.label}),e}));this.addFeature(r)}else{var n=new Cesium.CustomEntity({position:Cesium.fromLonLat(t.point),label:t.label&&{text:t.label}});n.set({item:t,label:t.label}),e&&n.setStyle(this._stateService.getStyle(n,"default",Dr(Dr({},e),{},{text:t.label}))),this.addFeature(n)}return this}},{key:"addClick",value:function(t,e,r){var n=this;return this._stateService.on({id:e,type:"click",change:function(e,i,o){if(Array.isArray(e)||Array.isArray(i)){var a,s=Array.isArray(e)?e:Array.isArray(i)?i:[];if(!0!==(null==r?void 0:r.disableZoom)){var u=r||{},l=(u.padding,u.duration);(function(t,e){if(null==t)return{};var r,n,i=function(t,e){if(null==t)return{};var r,n,i={},o=Object.keys(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||(i[r]=t[r]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}})(u,Mr),n._map.flyTo(e||i,{duration:lt(l,!0,1)})}var c=null==o||null===(a=o.target)||void 0===a||null===(a=a.primitive)||void 0===a?void 0:a.position,f=Cesium.toLonLat(T(n._map,o.position));t&&t({zoom:n._map.getZoom(),item:s.map((function(t){return t.get("item")})),position:f,featurePosition:c?Cesium.toLonLat(c):f,limited:1===s.length||n._map.getZoom()>=n._map.getMaxZoom(),features:s,isCluster:!0,e:o})}else e?t&&t({zoom:n._map.getZoom(),item:e.get("item"),position:Cesium.toLonLat(T(n._map,o.position)),featurePosition:A(e),limited:!0,features:[e],isCluster:!1,e:o}):i&&r&&r.cancelCallback&&r.cancelCallback({zoom:n._map.getZoom(),item:i.get("item"),position:Cesium.toLonLat(T(n._map,o.position)),featurePosition:A(i),limited:!0,features:[i],isCluster:!1,e:o})}}),this}},{key:"addHover",value:function(t,e){var r=this;return this._stateService.on({id:e,type:"hover",change:function(e,n,i){if(Array.isArray(e)||Array.isArray(n)){var o,a=Array.isArray(e)?e:Array.isArray(n)?n:[],s=null==i||null===(o=i.target)||void 0===o||null===(o=o.primitive)||void 0===o?void 0:o.position,u=Cesium.toLonLat(T(r._map,i.endPosition));t&&t({zoom:r._map.getZoom(),position:u,featurePosition:s?Cesium.toLonLat(s):u,item:a.map((function(t){return t.get("item")})),hover:!!e,isCluster:!0,features:a,e:i})}else if(e||n){var l=e||n;t&&t({zoom:r._map.getZoom(),position:Cesium.toLonLat(T(r._map,i.endPosition)),featurePosition:A(l),item:l.get("item"),hover:!!e,isCluster:!1,features:[l],e:i})}}}),this}},{key:"_createImageCallback",value:function(t){var e=this;return new Promise((function(r,n){var i,o=new Image,a=e._cacheBadgeImages.has(t)?e._cacheBadgeImages.get(t):{},s=a.style,u=a.canvas;null!==(i=s.billboard)&&void 0!==i&&i.image?(o.onload=function(){r(u?e._mergeCanvas(o,u,s):o)},o.onerror=function(){n()},o.src=s.billboard.image):r(o)}))}},{key:"_mergeCanvas",value:function(t,e,r){var n=document.createElement("canvas"),i=n.getContext("2d");if(i){var o,a=st(r._options.scale),s={w:t.width*a[0],h:t.height*a[1]},u=(null===(o=r._options)||void 0===o||null===(o=o.badge)||void 0===o?void 0:o.offset)||[0,0],l={w:e.width/1.6+u[0],h:e.height/1.8+u[1]};return n.width=s.w+l.w,n.height=s.h+l.h,i.drawImage(t,0,l.h,s.w,s.h),i.drawImage(e,n.width-e.width,0),n}return t}},{key:"_createBadge",value:function(t,e,r){var n,i,o,a,s,u=(null==e||null===(n=e.badge)||void 0===n?void 0:n.rectRadius)||10,l=document.createElement("canvas"),c=l.getContext("2d");if(!c)return l;c.font=(null==e?void 0:e.fontStyle)||"12px Microsoft YaHei";var f=c.measureText(t),p=((null==e||null===(i=e.badge)||void 0===i?void 0:i.rectWidth)||f.width)+10;l.width=(p<f.width?f.width:p<38?38:p)*r[0];var h=(null==e||null===(o=e.badge)||void 0===o?void 0:o.rectHeight)||26;l.height=(h<26?26:h)*r[1];var y=l.width,d=l.height,g=d/2;u&&u>0&&u<g&&(g=u),c.beginPath(),c.fillStyle=(null==e||null===(a=e.badge)||void 0===a?void 0:a.strokeColor)||"#fff",c.moveTo(0+g,0),c.arcTo(0+y,0,0+y,0+d,g),c.arcTo(0+y,0+d,0,0+d,g),c.arcTo(0,0+d,0,0,g),c.arcTo(0,0,0+y,0,g),c.closePath(),c.fill(),c.beginPath();var m=(null==e||null===(s=e.badge)||void 0===s?void 0:s.fill)||["#0e4e8e","#1786f4"];if(Array.isArray(m))if(0===m.length)m="#0e4e8e";else{for(var v=c.createLinearGradient(0+g+1.5,2.5,0+g+1.5,2.5+d),_=1/(m.length-1),b=0,w=m.length;b<w;b++)v.addColorStop(b===w-1?1:b*_,m[b]);m=v}return c.fillStyle=m,c.moveTo(0+g+1.5,2.5),c.arcTo(0+y-1.5,2.5,0+y-1.5,0+d-.5,g),c.arcTo(0+y-1.5,0+d-.5,1.5,0+d-.5,g),c.arcTo(1.5,0+d-.5,1.5,2.5,g),c.arcTo(1.5,2.5,0+y-1.5,2.5,g),c.closePath(),c.fill(),c.translate(y/2,d/2+2),c.textAlign="center",c.textBaseline="middle",c.fillStyle=e.fontColor||"#ffffff",c.fillText(t,0,0),l}},{key:"dispose",value:function(){zr(Vr(a.prototype),"dispose",this).call(this),this._layer.clustering.clusterEvent.removeEventListener(this.__clusterEvent),this._cacheBadgeImages.clear()}}],r&&Nr(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(vr);const qr=Ur;function Wr(t){return Wr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Wr(t)}function Xr(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Zr(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Xr(Object(r),!0).forEach((function(e){var n,i,o;n=t,i=e,o=r[e],(i=Yr(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Xr(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Hr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Yr(n.key),n)}}function Yr(t){var e=function(t,e){if("object"!=Wr(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Wr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Wr(e)?e:String(e)}function Kr(t,e){return Kr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Kr(t,e)}function Jr(t){return Jr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Jr(t)}var $r=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Kr(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Jr(n);if(i){var r=Jr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Wr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,e))._zIndex=0,r._layer.set("name",e.name||"iconPoint"),r._layer.setStyle((function(t){return r._stateService.getStyle(t,"default",{text:t.get("label")})})),r}return e=a,r=[{key:"create",value:function(t,e){var r=this;if(Array.isArray(t)){var n=t.map((function(t){var n=new Cesium.CustomEntity({position:Cesium.fromLonLat(t.point),label:t.label&&{text:t.label}});return n.set({item:t,label:t.label}),e&&n.setStyle(r._stateService.getStyle(n,"default",Zr(Zr({},e),{},{text:t.label}))),n}));this.addFeature(n)}else{var i=new Cesium.CustomEntity({position:Cesium.fromLonLat(t.point),label:t.label&&{text:t.label}});i.set({item:t,label:t.label}),e&&i.setStyle(this._stateService.getStyle(i,"default",Zr(Zr({},e),{},{text:t.label}))),this.addFeature(i)}return this}}],r&&Hr(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(vr);function Qr(t){return Qr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qr(t)}function tn(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function en(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,rn(n.key),n)}}function rn(t){var e=function(t,e){if("object"!=Qr(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Qr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Qr(e)?e:String(e)}function nn(){return nn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=an(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},nn.apply(this,arguments)}function on(t,e){return on=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},on(t,e)}function an(t){return an=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},an(t)}var sn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&on(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=an(n);if(i){var r=an(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Qr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=o.call(this))._overlays=[],e._map=void 0,e._map=t,e}return e=a,r=[{key:"map",get:function(){return this._map}},{key:"overlays",get:function(){return this._overlays}},{key:"addOverlay",value:function(t){var e=this;return Array.isArray(t)?t.forEach((function(t){e.addOverlay(t)})):this._overlays.includes(t)||(this._overlays.push(t),this._map.addDivOverlay(t)),this}},{key:"searchOverlays",value:function(t){var e=this,r=[];return Array.isArray(t)?t.forEach((function(t){var n,i=e.searchOverlays(t);r.push.apply(r,function(t){if(Array.isArray(t))return tn(t)}(n=i)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||function(t,e){if(t){if("string"==typeof t)return tn(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?tn(t,e):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())})):this._overlays.forEach((function(e){e.get("name")===t&&r.push(e)})),r}},{key:"getOverlays",value:function(t,e){var r=[];if("string"==typeof t)this._overlays.forEach((function(n){n.get(t)===e&&r.push(n)}));else{var n=Object.keys(t);this._overlays.forEach((function(e){n.some((function(r){return e.get(r)===t[r]}))&&r.push(e)}))}return r}},{key:"filter",value:function(t){for(var e=[],r=0,n=this._overlays.length;r<n;r++)!0===t(this._overlays[r],r)&&e.push(this._overlays[r]);return e}},{key:"find",value:function(t){for(var e=0,r=this._overlays.length;e<r;e++)if(!0===t(this._overlays[e],e))return this._overlays[e]}},{key:"findIndex",value:function(t){for(var e=0,r=this._overlays.length;e<r;e++)if(!0===t(this._overlays[e],e))return e;return-1}},{key:"forEach",value:function(t){for(var e=0,r=this._overlays.length;e<r;e++)t(this._overlays[e],e);return this}},{key:"filterVisible",value:function(t){throw new Error("Method not implemented.")}},{key:"filterRemove",value:function(t){throw new Error("Method not implemented.")}},{key:"removeOverlay",value:function(t){var e=this;if(!t)return this._overlays.forEach((function(t){return e._map.removeDivOverlay(t)})),void(this._overlays.length=0);if(Array.isArray(t))t.forEach((function(t){e.removeOverlay(t)}));else{var r=this.findIndex((function(e){return e.get("id")===t||e===t}));if(r<0)return;this._map.removeDivOverlay(this._overlays[r]),this._overlays.splice(r,1)}}},{key:"clearOverlays",value:function(){return this.removeOverlay(),this}},{key:"dispose",value:function(){nn(an(a.prototype),"dispose",this).call(this),this.clearOverlays()}}],r&&en(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t);function un(t){return un="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},un(t)}var ln=["element","position","point"];function cn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,fn(n.key),n)}}function fn(t){var e=function(t,e){if("object"!=un(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=un(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==un(e)?e:String(e)}function pn(t,e){return pn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},pn(t,e)}function hn(t){return hn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},hn(t)}var yn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&pn(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=hn(n);if(i){var r=hn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===un(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t))._options=void 0,r._container=void 0,r._options=e,r._container=document.createElement("div"),r._container.classList.add("bimmap-csm-popups"),r}return e=a,r=[{key:"container",get:function(){return this._container}},{key:"_createMarkElement",value:function(t){var e=document.createElement("div");return e.classList.add("bimmap-csm-popup_text"),t instanceof HTMLElement?e.insertAdjacentElement("afterbegin",t):e.innerHTML=t,e.setAttribute("target","popup"),e}},{key:"_getOverlayElement",value:function(t){var e=this._createMarkElement(t.element);return t.useTitle&&(e.title=t.label),e}},{key:"_createOneOverlay",value:function(t){var e=this._options?Object.assign({},this._options,t):t,r=this._getOverlayElement(e);delete e.innerHTML;var n=e.offset||[0,0],i=Cesium.popup({id:e.id,name:e.name||"overlay",item:e,autoElement:!(e.element instanceof Element),className:"bimmap-csm-popup bimmap-csm-popup_".concat(e.positioning||"bottom-center"," ").concat(e.className||""),autoClose:!1,closeButton:!1,closeOnEscapeKey:!1,closeOnClick:!1,offset:n,bubblingMouseEvents:!1,clampToGround:e.clampToGround});return i.setLatLng(e.position||e.point),i.setContent(r),i}},{key:"_addClickCallback",value:function(t,e,r){r.stopPropagation(),t&&t({zoom:this._map.getZoom(),item:e.get("item"),position:e.getLatLng(),featurePosition:e.getLatLng(),overlay:e})}},{key:"addClick",value:function(t){var e=this;return this.overlays.forEach((function(r){var n=r.getElement();Reflect.has(n,"_overlay_click_")&&n.removeEventListener("click",Reflect.get(n,"_overlay_click_"));var i=e._addClickCallback.bind(e,t,r);Object.defineProperty(n,"_overlay_click_",{value:i}),n.addEventListener("click",i)})),this}},{key:"create",value:function(t){var e=this;if(Array.isArray(t)){var r=t.map((function(t){return e._createOneOverlay(t)}));this.addOverlay(r)}else{var n=this._createOneOverlay(t);this.addOverlay(n)}return this}},{key:"update",value:function(t,e){var r=e.element,n=e.position,i=e.point,o=function(t,e){if(null==t)return{};var r,n,i=function(t,e){if(null==t)return{};var r,n,i={},o=Object.keys(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||(i[r]=t[r]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}(e,ln);return r&&t.setContent(this._getOverlayElement(e)),(n||i)&&t.setLatLng(n||i),t.setProperties(o),this}}],r&&cn(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(sn);function dn(t){return dn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dn(t)}function gn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,mn(n.key),n)}}function mn(t){var e=function(t,e){if("object"!=dn(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=dn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==dn(e)?e:String(e)}function vn(t,e){return vn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},vn(t,e)}function _n(t){return _n=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_n(t)}var bn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&vn(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=_n(n);if(i){var r=_n(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===dn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,e))._layer.set("name",e.name||"fontLayer"),r._layer.setStyle((function(t){return r._stateService.getStyle(t,"default",{text:t.get("label")})})),r}return e=a,r=[{key:"create",value:function(t){var e=this;if(Array.isArray(t))t.forEach((function(t){var r=new Cesium.CustomEntity({position:Cesium.fromLonLat(t.point),label:{text:t.label}});r.set({item:t,label:t.label}),e.addFeature(r)}));else{var r=new Cesium.CustomEntity({position:Cesium.fromLonLat(t.point),label:{text:t.label}});r.set({item:t,label:t.label}),this.addFeature(r)}return this}},{key:"addSelect",value:function(t,e){return this.addHover(e,t),this}}],r&&gn(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(vr);function wn(t){return wn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wn(t)}function Sn(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function On(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,xn(n.key),n)}}function xn(t){var e=function(t,e){if("object"!=wn(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=wn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==wn(e)?e:String(e)}function Cn(t,e){return Cn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Cn(t,e)}function En(t){return En=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},En(t)}var Pn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Cn(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=En(n);if(i){var r=En(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===wn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,e))._layer.set("name",e.name||"lineString"),r._layer.setStyle((function(t){return r._stateService.getStyle(t,"default")})),r}return e=a,r=[{key:"_checkHeight",value:function(t){return(t||[]).map((function(t){return t.length>2?t:[].concat(function(t){if(Array.isArray(t))return Sn(t)}(e=t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||function(t,e){if(t){if("string"==typeof t)return Sn(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Sn(t,e):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[0]);var e}))}},{key:"create",value:function(t,e){var r=new Cesium.CustomEntity({polyline:{positions:Cesium.Cartesian3.fromDegreesArrayHeights(this._checkHeight(t.points||t.coords).flat())}});return r.set({item:t,label:t.label}),e&&r.setStyle(this._stateService.getStyle(r,"default",e)),this.addFeature(r),this}}],r&&On(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(vr);function kn(t){return kn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kn(t)}function Tn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,jn(n.key),n)}}function jn(t){var e=function(t,e){if("object"!=kn(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=kn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==kn(e)?e:String(e)}function Rn(){return Rn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Mn(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},Rn.apply(this,arguments)}function Ln(t,e){return Ln=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ln(t,e)}function In(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Mn(t){return Mn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Mn(t)}var An=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ln(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Mn(n);if(i){var r=Mn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===kn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return In(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,nt({strokeColor:"rgba(0, 0, 255, 0.8)",strokeWidth:0},e)))._key=void 0,r._useRight=!0,r.__zoomEvent=r._bindEvent.bind(In(r)),r._timer=void 0,r._layer.set("name",e.name||"gridPolygon"),r._key=Symbol(e.name||"gridPolygon"),r._layer.setStyle((function(t){return r._returnStyle(t)})),r._stateService.addExcludeCacheEventName(["_clickStyle","_hoverStyle"]),r._map._cameraService.on(Cesium.ScreenSpaceEventType.WHEEL,r.__zoomEvent,r._key),r}return e=a,r=[{key:"_bindEvent",value:function(t,e){var r=this;this._timer&&(clearTimeout(this._timer),this._timer=null),this._timer=setTimeout((function(){var t=r._layer.getStyle(),e="function"==typeof t;r.features.forEach((function(r){r.setStyle(e?t(r):t)})),r._timer=null}),400)}},{key:"_createPolygonHierarchy",value:function(t){var e=Cesium.Cartesian3.fromDegreesArrayHeights(t.map((function(t){return t.length>2?t:t.concat(0)})).flat(1)),r=new Cesium.PolygonHierarchy(e),n=window.Cesium.PolygonPipeline;if(n){for(var i=n.triangulate(e),o=[],a=0;a<i.length;a+=3)o.push.apply(o,[e[i[a]],e[i[a+1]],e[i[a+2]]]);var s=new Cesium.PolygonHierarchy(o);return{hierarchy:s,center:Cesium.BoundingSphere.fromPoints(s.positions).center}}return{hierarchy:r,center:Cesium.BoundingSphere.fromPoints(e).center}}},{key:"create",value:function(t){if(Array.isArray(t)){var e=t.map((function(t){var e=new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArrayHeights(t.points.map((function(t){return t.length>2?t:t.concat(0)})).flat(1))),r=new Cesium.CustomEntity({position:Cesium.BoundingSphere.fromPoints(e.positions).center,polygon:{hierarchy:e}});return r.set({item:t,name:t.name,label:t.label}),r}));this.addFeature(e)}else{var r=new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArrayHeights(t.points.map((function(t){return t.length>2?t:t.concat(0)})).flat(1))),n=new Cesium.CustomEntity({position:Cesium.BoundingSphere.fromPoints(r.positions).center,polygon:{hierarchy:r}});n.set({item:t,name:t.name,label:t.label}),this.addFeature(n)}return this}},{key:"addRightClick",value:function(t,e){return this}},{key:"getCenterCoordinates",value:function(t){return A(t)}},{key:"addSelect",value:function(t,e){return this.addClick(t,e),this}},{key:"_returnStyle",value:function(t){return P(this._map.camera.positionCartographic.height)<(this._options.minZoomShow||0)?(this._stateService.currentDefaultEventName="_defaultFeatureStyle",this._stateService.getStyle(t,"_defaultFeatureStyle")):(this._stateService.currentDefaultEventName="default",this._stateService.getStyle(t,"default",{text:t.get("label")}))}},{key:"dispose",value:function(){Rn(Mn(a.prototype),"dispose",this).call(this),this._map._cameraService.off(this._key),this._timer&&(clearTimeout(this._timer),this._timer=null)}}],r&&Tn(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(vr);function Dn(t){return Dn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Dn(t)}function Nn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Fn(n.key),n)}}function Fn(t){var e=function(t,e){if("object"!=Dn(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Dn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Dn(e)?e:String(e)}function zn(){return zn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Bn(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},zn.apply(this,arguments)}function Gn(t,e){return Gn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Gn(t,e)}function Bn(t){return Bn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Bn(t)}var Vn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Gn(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Bn(n);if(i){var r=Bn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Dn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,e))._animating=!1,r._speed=void 0,r._distance=300,r._index=0,r._Latlngs=[],r._linePositions=[],r._positionProperty=void 0,r._animatedMarker=void 0,r._polyline=void 0,r._realTimePolyline=void 0,r._date=[],r._speed=e.speed||.1,r._layer.set("name",e.name||"trajectory"),r._layer.setStyle((function(t){return r._stateService.getStyle(t,"default")})),r}return e=a,r=[{key:"_setDefaultStyle",value:function(){this._speed=this._options.speed||.1,this._polyline.setStyle({polyline:{material:Cesium.Color.fromCssColorString(this._options.strokeColor||"rgba(255,255,255,0.8)"),width:this._options.strokeWidth||5}});var t=this._options.lineDash||[5,5];this._realTimePolyline.setStyle({polyline:{width:this._options.strokeWidth||3,material:new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.fromCssColorString(this._options.fill||"rgba(0,0,0,0.9)"),dashLength:t[0]})}})}},{key:"_getAngle",value:function(t,e){var r=Math.atan2(e[1]-t[1],e[0]-t[0])*(180/Math.PI);return r>0?r=90-r:r<0&&(r=Math.abs(r)+90),r}},{key:"_getCoureAngle",value:function(t,e){var r=Math.atan2(e.y-t.y,e.x-t.x)*(180/Math.PI);return r<0&&(r+=360),Cesium.Math.toRadians(r)+Math.PI/180*90}},{key:"_reset",value:function(){this._animating=!0,this._linePositions.length=0,this._positionProperty=new Cesium.SampledPositionProperty,this._realTimePolyline.position=this._positionProperty,this._realTimePolyline.orientation=new Cesium.VelocityOrientationProperty(this._positionProperty),this._setDefaultStyle(),requestAnimationFrame(this._animation.bind(this))}},{key:"_animation",value:function(){if(this._animating){if(!this._Latlngs)return;for(var t=this,e=0,r=0;r<this._Latlngs.length-1;r++)e+=Cesium.Cartesian3.distance(this._Latlngs[r],this._Latlngs[r+1]);for(var n=100*this._speed,i=e/n,o=this._map.clock.currentTime,a=Cesium.JulianDate.addSeconds(o,n,new Cesium.JulianDate),s=0,u=1;u<this._Latlngs.length;u++){1===u&&(t._positionProperty.addSample(o,this._Latlngs[0]),this._date.push(o));var l=Cesium.Cartesian3.distance(this._Latlngs[u],this._Latlngs[u-1]),c=Cesium.JulianDate.addSeconds(o,l/i+s,new Cesium.JulianDate);t._positionProperty.addSample(c,this._Latlngs[u]),this._date.push(c),s+=l/i}this._map.clock.currentTime=o,this._map.clock.multiplier=1,this._map.clock.shouldAnimate=!0,this._map.clock.stopTime=a,this._map.clock.clockRange=Cesium.ClockRange.CLAMPED;var f=this._map.clock.onStop.addEventListener((function(){f&&f(),t._animating=!1}))}}},{key:"create",value:function(t){var e=this,r=(null==t?void 0:t.points)||(null==t?void 0:t.route)||[];if(0!==r.length){if(this._Latlngs=Cesium.Cartesian3.fromDegreesArray(r.flat()),this._polyline?this._polyline.polyline.positions.setValue(this._Latlngs):(this._polyline=new Cesium.CustomEntity({polyline:{clampToGround:!0,positions:this._Latlngs,zIndex:1}}),this.addFeature(this._polyline)),!this._realTimePolyline){var n=this,i=0;this._realTimePolyline=new Cesium.CustomEntity({polyline:{clampToGround:!0,positions:new Cesium.CallbackProperty((function(t,r){var o=n._positionProperty.getValue(t);return o&&(Cesium.JulianDate.compare(t,e._date[i])>0&&i<e._date.length-1&&(n._animatedMarker.billboard.rotation=n._getCoureAngle(n._positionProperty.getValue(e._date[i]),n._positionProperty.getValue(e._date[i+1])),i++),n._linePositions.push(o),n._linePositions.length>2&&n._animatedMarker.position.setValue(n._linePositions[n._linePositions.length-1])),n._linePositions}),!1),zIndex:2}}),this.addFeature(this._realTimePolyline)}return this._animatedMarker||(this._animatedMarker=new Cesium.CustomEntity({position:this._Latlngs[0],billboard:{rotation:this._getCoureAngle(this._Latlngs[0],this._Latlngs[1])}}),this.addFeature(this._animatedMarker)),this}}},{key:"start",value:function(){this._reset()}},{key:"stop",value:function(){this._map.clock.stopTime=Cesium.JulianDate.now()}},{key:"getCenterCoordinates",value:function(t){return N(t)}},{key:"dispose",value:function(){zn(Bn(a.prototype),"dispose",this).call(this),this.stop(),this._animating=!1,this._Latlngs.length=0,this._linePositions.length=0}}],r&&Nn(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(vr);function Un(t){return Un="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Un(t)}function qn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Wn(n.key),n)}}function Wn(t){var e=function(t,e){if("object"!=Un(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Un(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Un(e)?e:String(e)}function Xn(){return Xn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Hn(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},Xn.apply(this,arguments)}function Zn(t,e){return Zn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Zn(t,e)}function Hn(t){return Hn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Hn(t)}var Yn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Zn(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Hn(n);if(i){var r=Hn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Un(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,e))._key=void 0,r._defaultStyleOptions={radius:6,strokeColor:"rgba(255, 0, 255, 0.5)",strokeWidth:6,background:{strokeColor:"rgba(255, 255, 255, 1)",strokeWidth:2},fill:"rgba(255, 255, 255, 0.5)",interactive:!1},r._startMarker=new Cesium.CustomEntity({position:Cesium.Cartesian3.fromArray([0,0]),point:{pixelSize:5}}),r._latlngs=[],r._polyline=new Cesium.CustomEntity({polyline:{positions:[]},polygon:{hierarchy:[]}}),r._start=!1,r._completeCallback=void 0,r._polylinePoint=[],r._movePoint=void 0,nt(r._defaultStyleOptions,e),r._layer.set("name",e.name||"drawLine"),r._key=Symbol(e.name||"drawLine"),r._layer.setStyle((function(t){return r._stateService.getStyle(t,"default",r._defaultStyleOptions)})),r._initEvent(),r}return e=a,(r=[{key:"_initEvent",value:function(){this._map._cameraService.on(Cesium.ScreenSpaceEventType.MOUSE_MOVE,this._mapEvent.bind(this,"mousemove"),this._key,{uncontrolled:!0}),this._map._cameraService.on(Cesium.ScreenSpaceEventType.LEFT_CLICK,this._mapEvent.bind(this,"click"),this._key,{uncontrolled:!0}),this._map._cameraService.on(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK,this._mapEvent.bind(this,"dblclick"),this._key,{uncontrolled:!0}),this._map._cameraService.on(Cesium.ScreenSpaceEventType.RIGHT_CLICK,this._mapEvent.bind(this,"contextmenu"),this._key,{uncontrolled:!0})}},{key:"_createPolylinePoint",value:function(t){0===this._latlngs.length?this.fire("drawstart"):this.fire("drawchange",this._latlngs.map((function(t){return Cesium.toLonLat(t)})),Cesium.toLonLat(t)),this._latlngs.push(t);var e=new Cesium.CustomEntity({position:t,point:{pixelSize:this._defaultStyleOptions.radius}});this._polylinePoint.push(e),this.addFeature(e)}},{key:"_mapEvent",value:function(t,e,r){if("contextmenu"!==t){var n=r.position||r.endPosition;if("mousemove"===t)this._movePoint=r.endPosition,this._startMarker.position=T(this._map,n);else{if(!this._start)return;this._createPolylinePoint(T(this._map,n)),"dblclick"===t&&(this._start=!1,this.fire("drawend"),this._completeCallback&&(this._completeCallback(this.getValue()),this._reset()))}}else this.rmLastPoint()}},{key:"_reset",value:function(){var t=this;if(this.removeFeature(this._polylinePoint),this._startMarker.point.pixelSize=new Cesium.ConstantProperty(this._defaultStyleOptions.radius),this._latlngs.length=0,this._polyline.polyline.positions=new Cesium.CallbackProperty((function(e){if(t._start&&t._latlngs.length>0&&t._movePoint){var r=T(t._map,t._movePoint);return r?t._latlngs.map((function(t){return t.clone()})).concat(r):t._latlngs.map((function(t){return t.clone()}))}return t._latlngs.map((function(t){return t.clone()}))}),!1),"Polygon"===this._options.type){var e=new Cesium.PolygonHierarchy([],[]);this._polyline.polygon.hierarchy=new Cesium.CallbackProperty((function(r){if(t._start&&t._latlngs.length>0&&t._movePoint){var n=T(t._map,t._movePoint);n&&(e.positions=t._latlngs.map((function(t){return t.clone()})).concat(n))}else e.positions=t._latlngs.map((function(t){return t.clone()}));return e}),!1)}this._start=!0}},{key:"draw",value:function(t){return this.map.canvas.style.cursor="crosshair",this._map._appHandler.setOptions({disabled:!0}),this._completeCallback=t,this.addFeature(this._startMarker),this.addFeature(this._polyline),this._reset(),this}},{key:"getValue",value:function(){return Cesium.toLonLat(this._latlngs)}},{key:"rmLastPoint",value:function(){return this._polylinePoint.length>0&&(this.removeFeature(this._polylinePoint.pop()),this._latlngs.pop()),this}},{key:"dispose",value:function(){Xn(Hn(a.prototype),"dispose",this).call(this),this.map.canvas.style.cursor="",this._map._appHandler.setOptions({disabled:!1}),this._map._cameraService.off(this._key),this._reset(),this._start=!1}}])&&qn(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(vr);function Kn(t){return Kn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kn(t)}function Jn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,$n(n.key),n)}}function $n(t){var e=function(t,e){if("object"!=Kn(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Kn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Kn(e)?e:String(e)}function Qn(){return Qn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ei(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},Qn.apply(this,arguments)}function ti(t,e){return ti=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ti(t,e)}function ei(t){return ei=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ei(t)}var ri=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ti(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ei(n);if(i){var r=ei(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Kn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,e))._heatmap=void 0,r._layer.set("name",e.name||"heatMap"),r}return e=a,r=[{key:"_getBounds",value:function(t,e){t.east=Math.max(t.east,e[0]),t.west=Math.min(t.west,e[0]),t.north=Math.max(t.north,e[1]),t.south=Math.min(t.south,e[1])}},{key:"_initHeatmap",value:function(t){this._heatmap=Cesium.Heatmap(this._map,t,{blur:(100-(this.options.blur||20))/100,radius:this.options.radius||25,minOpacity:.1,gradient:{0:"rgba(0, 0, 255, 0)",.3:"cyan",.4:"lime",.7:"#ffff00",.8:"orange",1:"#ff0000"}}),this._heatmap||rt("使用热力图必须引用插件[CesiumHeatmap.js]！")}},{key:"create",value:function(t){var e=this;this._heatmap&&(this._heatmap.deleteLayer(),this._heatmap=null);var r={west:106.243911,east:106.270811,south:29.244545,north:29.289995};if(Array.isArray(t)){var n=t.map((function(t){return e._getBounds(r,t.point),{x:t.point[0],y:t.point[1],value:t.weight||1}}));this._initHeatmap(r),this._heatmap&&this._heatmap.setWGS84Data(0,1,n)}else this._getBounds(r,t.point),this._initHeatmap(r),this._heatmap&&this._heatmap.setWGS84Data(0,1,[{x:t.point[0],y:t.point[1],value:t.weight||1}]);return this}},{key:"dispose",value:function(){Qn(ei(a.prototype),"dispose",this).call(this),this._heatmap&&this._heatmap.deleteLayer()}}],r&&Jn(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(vr);function ni(t){return ni="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ni(t)}function ii(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,oi(n.key),n)}}function oi(t){var e=function(t,e){if("object"!=ni(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=ni(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ni(e)?e:String(e)}function ai(t,e){return ai=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ai(t,e)}function si(t){return si=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},si(t)}var ui=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ai(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=si(n);if(i){var r=si(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===ni(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,e))._layer.set("name",e.name||"loadGeojson"),r._layer.setStyle((function(t){return r._stateService.getStyle(t,"default",{text:t.get("name")})})),r}return e=a,r=[{key:"loadUrl",value:function(t){var e=this;return new Promise((function(r,n){fetch(t).then((function(t){return t.json()})).then((function(t){e.load(t,r)})).catch((function(){r(!1)}))}))}},{key:"load",value:function(t,e){var r=this;return Cesium.GeoJsonDataSource.load(t,{clampToGround:!0}).then((function(t){r.addFeature(t.entities.values.map((function(t){return t}))),e&&e(!0)})).catch((function(t){rt("加载geojson异常 ","error",t)})),this}}],r&&ii(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(vr);function li(t){switch(t){case"click":default:return Cesium.ScreenSpaceEventType.LEFT_CLICK;case"dblclick":return Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK;case"zoom":return Cesium.ScreenSpaceEventType.WHEEL;case"down":return Cesium.ScreenSpaceEventType.LEFT_DOWN;case"up":return Cesium.ScreenSpaceEventType.LEFT_UP;case"middleclick":return Cesium.ScreenSpaceEventType.MIDDLE_CLICK;case"middledown":return Cesium.ScreenSpaceEventType.MIDDLE_DOWN;case"middleup":return Cesium.ScreenSpaceEventType.MIDDLE_UP;case"mousemove":return Cesium.ScreenSpaceEventType.MOUSE_MOVE;case"contextmenu":return Cesium.ScreenSpaceEventType.RIGHT_CLICK;case"rightdown":return Cesium.ScreenSpaceEventType.RIGHT_DOWN;case"rightup":return Cesium.ScreenSpaceEventType.RIGHT_UP}}function ci(t){return ci="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ci(t)}function fi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,pi(n.key),n)}}function pi(t){var e=function(t,e){if("object"!=ci(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=ci(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ci(e)?e:String(e)}function hi(){return hi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=di(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},hi.apply(this,arguments)}function yi(t,e){return yi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},yi(t,e)}function di(t){return di=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},di(t)}var gi=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&yi(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=di(n);if(i){var r=di(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===ci(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,e))._datasources=[],r._layer.set("name",e.name||"kml"),r._layer.setStyle((function(t){return r._stateService.getStyle(t,"default")})),r}return e=a,r=[{key:"load",value:function(t,e){var r=this;return Cesium.KmlDataSource.load(t).then((function(t){r._datasources.push(t),r._map.dataSources.add(t),null!=e&&e.flyTo&&r._map._cameraService.zoomTo(t)})).catch((function(e){console.error("加载 kml 失败：",t,e)})),this}},{key:"dispose",value:function(){var t=this;hi(di(a.prototype),"dispose",this).call(this),this._datasources.forEach((function(e){return t._map.dataSources.remove(e)})),this._datasources.length=0}}],r&&fi(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(vr);function mi(t){return mi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mi(t)}function vi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,_i(n.key),n)}}function _i(t){var e=function(t,e){if("object"!=mi(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=mi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==mi(e)?e:String(e)}function bi(){return bi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Si(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},bi.apply(this,arguments)}function wi(t,e){return wi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},wi(t,e)}function Si(t){return Si=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Si(t)}var Oi=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&wi(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Si(n);if(i){var r=Si(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===mi(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this))._name=void 0,r._map=void 0,r._imageLayers=new Map,r._options=void 0,r._map=t,r._options=e,r._name=(null==e?void 0:e.name)||"obliquePhotography",r}return e=a,r=[{key:"name",get:function(){return this._name}},{key:"options",get:function(){return this._options}},{key:"_setLayerStyle",value:function(t,e,r){var n,i;t.show=!1!==r.visible;var o=e.backColor||(null==r?void 0:r.backColor)||(null===(n=this._options)||void 0===n?void 0:n.backColor);t.transparentBackColor=o?Cesium.Color.fromCssColorString(o):Cesium.ImageryLayer.DEFAULT_TRANSPERANTBACKCOLOR||Cesium.ImageryLayer.DEFAULT_TRANSPARENTBACKCOLOR,t.transparentBackColorTolerance=e.tolerance||(null==r?void 0:r.tolerance)||(null===(i=this._options)||void 0===i?void 0:i.tolerance)||Cesium.ImageryLayer.DEFAULT_TRANSPERANTBACKCOLORTOLERANCE||Cesium.ImageryLayer.DEFAULT_TRANSPARENTBACKCOLORTOLERANCE}},{key:"load",value:function(t,e){var r=this,n=e.name||"defaultImageryLayer";return this._imageLayers.has(n)?(this._map.zoomTo(this._imageLayers.get(n)[0]),this):(this._imageLayers.set(n,t.map((function(t){var e=t.url.startsWith("http")?t.url:t.baseUrl+t.url,n=r._map.imageryLayers.addImageryProvider(new Cesium.UrlTemplateImageryProvider({url:e,tilingScheme:t.tilingScheme?new Cesium.GeographicTilingScheme:void 0}));return t.layerName&&(n.set("layerName",t.layerName),n.set("item",t)),n})).filter((function(t){return!!t}))),this)}},{key:"setVisible",value:function(t,e){return this._imageLayers.has(t)&&this._imageLayers.get(t).forEach((function(t){t.show})),this}},{key:"remove",value:function(t){var e=this;return t?this._imageLayers.has(t)&&(this._imageLayers.forEach((function(t){t.forEach((function(t){return e._map.imageryLayers.remove(t,!0)}))})),this._imageLayers.delete(t)):this._map.imageryLayers.removeAll(!0),this}},{key:"dispose",value:function(){bi(Si(a.prototype),"dispose",this).call(this),this.remove(),this._imageLayers.clear()}}],r&&vi(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t);function xi(t){return xi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xi(t)}function Ci(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Ei(){Ei=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var o=e&&e.prototype instanceof m?e:m,a=Object.create(o.prototype),s=new j(n||[]);return i(a,"_invoke",{value:E(t,r,s)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var p="suspendedStart",h="suspendedYield",y="executing",d="completed",g={};function m(){}function v(){}function _(){}var b={};l(b,a,(function(){return this}));var w=Object.getPrototypeOf,S=w&&w(w(R([])));S&&S!==r&&n.call(S,a)&&(b=S);var O=_.prototype=m.prototype=Object.create(b);function x(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function C(t,e){function r(i,o,a,s){var u=f(t[i],t,o);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==xi(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(c).then((function(t){l.value=t,a(l)}),(function(t){return r("throw",t,a,s)}))}s(u.arg)}var o;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return o=o?o.then(i,i):i()}})}function E(e,r,n){var i=p;return function(o,a){if(i===y)throw new Error("Generator is already running");if(i===d){if("throw"===o)throw a;return{value:t,done:!0}}for(n.method=o,n.arg=a;;){var s=n.delegate;if(s){var u=P(s,n);if(u){if(u===g)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===p)throw i=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=y;var l=f(e,r,n);if("normal"===l.type){if(i=n.done?d:h,l.arg===g)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=d,n.method="throw",n.arg=l.arg)}}}function P(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var o=f(i,e.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,g;var a=o.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function k(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function j(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(k,this),this.reset(!0)}function R(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return o.next=o}}throw new TypeError(xi(e)+" is not iterable")}return v.prototype=_,i(O,"constructor",{value:_,configurable:!0}),i(_,"constructor",{value:v,configurable:!0}),v.displayName=l(_,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,_):(t.__proto__=_,l(t,u,"GeneratorFunction")),t.prototype=Object.create(O),t},e.awrap=function(t){return{__await:t}},x(C.prototype),l(C.prototype,s,(function(){return this})),e.AsyncIterator=C,e.async=function(t,r,n,i,o){void 0===o&&(o=Promise);var a=new C(c(t,r,n,i),o);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},x(O),l(O,u,"Generator"),l(O,a,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=R,j.prototype={constructor:j,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return s.type="throw",s.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),l=n.call(a,"finallyLoc");if(u&&l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),T(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;T(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:R(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}function Pi(t,e,r,n,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,i)}function ki(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ti(n.key),n)}}function Ti(t){var e=function(t,e){if("object"!=xi(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=xi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==xi(e)?e:String(e)}function ji(){return ji="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Li(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},ji.apply(this,arguments)}function Ri(t,e){return Ri=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ri(t,e)}function Li(t){return Li=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Li(t)}var Ii=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ri(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Li(n);if(i){var r=Li(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===xi(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this))._key=void 0,r._name=void 0,r._options={selectedColor:"rgba(0,0,255, 0.3)",selectedLineColor:"rgba(0,0,255, 0.3)"},r._map=void 0,r._3dtileset=new Map,r._primitives=void 0,r._events=[],r._state={s3mOpacity:new Map,s3mFilterOpacity:.1,selected:null,selectedOpacity:.5,handSetSelected:null,handSetTilesetStyle:new Map,currentDepth:0},e&&Object.assign(r._options,e),r._name=(null==e?void 0:e.name)||"s3MTiles",r._map=t,r._key=Symbol(r._name),r._primitives=r._map.scene.primitives.add(new Cesium.PrimitiveCollection),r._initEvent(),r}return e=a,r=[{key:"name",get:function(){return this._name}},{key:"options",get:function(){return this._options}},{key:"clicks",get:function(){return this._events.filter((function(t){return"click"===t.type}))}},{key:"hovers",get:function(){return this._events.filter((function(t){return"hover"===t.type}))}},{key:"selected",get:function(){return this._state.selected}},{key:"_findSelectedTileParent",value:function(t){if(t._depth>=this._state.currentDepth)return t;for(;t.parent&&t._depth>this._state.currentDepth;)t=t.parent;return t}},{key:"_initEvent",value:function(){var t=this;this._map._cameraService.on(Cesium.ScreenSpaceEventType.LEFT_CLICK,(function(e,r){(e||t._state.selected)&&(!e||e instanceof Cesium.Cesium3DTileFeature)&&(e?Cesium.defined(e)&&!0===e.primitive.selectEnabled&&t._setSelected(e.content.tile,null==e?void 0:e.featureId):t._setSelected(null,null))}),this._key)}},{key:"_setSelected",value:function(t,e,r){var n,i=this._state.selected;i!==t&&(this._state.selected=t,!t&&i&&i.tileset.makeStyleDirty(),t&&(t.tileset.makeStyleDirty(),!1!==(null===(n=this._options)||void 0===n?void 0:n.clickFlyTo)&&this.zoomTo(t)),!1!==r&&this.clicks.forEach((function(r){var n,i;r.event(null==t||null===(n=t.tileset)||void 0===n||null===(i=n.get)||void 0===i?void 0:i.call(n,"item"),t,e)})))}},{key:"_assemble3DTile",value:function(t){var e=this,r=null;t.tileLoad.addEventListener((function(t){e._state.currentDepth!==t._depth&&(e._state.currentDepth=t._depth),e._state.selected&&(r&&clearTimeout(r),r=setTimeout((function(){t.tileset.makeStyleDirty()}),400))}))}},{key:"_setTilesetStyle",value:function(t,e){if(!0===e.selectEnabled){var r=this._state,n=Cesium.Color.fromCssColorString(e.selectedColor),i=Cesium.Color.fromCssColorString("rgba(255,255,255,0.2)");t.style=new Cesium.Cesium3DTileStyle({color:{evaluateColor:function(t,e){return r.selected?t.content.tile===r.selected?n.withAlpha(r.selectedOpacity,e):i.clone(e):r.handSetSelected&&t.tileset===r.handSetSelected[0]&&t.content.tile._depth===r.currentDepth&&r.handSetSelected[1].includes("".concat(t.featureId))?n.withAlpha(r.selectedOpacity,e):r.handSetTilesetStyle.has(t.tileset)?Cesium.Color.fromCssColorString(r.handSetTilesetStyle.get(t.tileset),e):r.s3mOpacity.has(t.tileset)?Cesium.Color.WHITE.withAlpha(r.s3mOpacity.get(t.tileset),e):Cesium.Color.WHITE.clone(e)},evaluate:function(t,e){return e}}})}}},{key:"load",value:function(t,e){var r=this,n=this,i=e.name||"defaultModel";if(!this._3dtileset.has(i))return n._3dtileset.set(i,[]),new Promise(function(){var o,a=(o=Ei().mark((function o(a,s){var u;return Ei().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:u=[],t.forEach((function(t){u.push(Cesium.Cesium3DTileset.fromUrl("".concat(t.url.startsWith("http")?t.url:(t.baseUrl||"")+t.url),{preloadWhenHidden:!0,cullWithChildrenBounds:!0,preferLeaves:!1}))})),Promise.all(u).then((function(o){o.forEach((function(r,i){n._setTilesetStyle(r,Object.assign(n.options,e||{})),n._assemble3DTile(r),n._primitives.add(r),r.set("name",t[i].layerName),r.set("item",t[i]),r.set("selectEnabled",!1!==(null==e?void 0:e.selectEnabled),!0)})),n._3dtileset.set(i,o),!1!==(null==e?void 0:e.zoomTo)&&r._map._cameraService.setViewToHeight(o[o.length-1].boundingSphere.center),a(o)}));case 3:case"end":return o.stop()}}),o)})),function(){var t=this,e=arguments;return new Promise((function(r,n){var i=o.apply(t,e);function a(t){Pi(i,r,n,a,s,"next",t)}function s(t){Pi(i,r,n,a,s,"throw",t)}a(void 0)}))});return function(t,e){return a.apply(this,arguments)}}());var o=this._3dtileset.get(i);o&&o.length>0&&!1!==(null==e?void 0:e.zoomTo)&&this._map._cameraService.setViewToHeight(o[0].boundingSphere.center)}},{key:"on",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"click";return this._events.push({type:e,event:t}),this}},{key:"off",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"click",r=this._events.findIndex((function(r){return r.type===e&&r.event===t}));return r>=0&&this._events.splice(r,1),this}},{key:"find",value:function(t,e){var r=e||"defaultModel";if(this._3dtileset.has(r)){var n=this._3dtileset.get(r);if(n&&n.length>0)return n.find((function(e){var r;return e.get("name")===t||(null===(r=e.get("item"))||void 0===r?void 0:r.id)===t}))}return null}},{key:"filter",value:function(t,e){var r=e||"defaultModel";if(this._3dtileset.has(r)){var n=this._3dtileset.get(r);if(n&&n.length>0)return n.filter((function(e){return t(e.get("item"),e)}))}return null}},{key:"setSelected",value:function(t,e){return t?this.find(t,e):this._setSelected(null),this}},{key:"setLayerStyle",value:function(t){var e=this;if(Array.isArray(t))t.forEach((function(t){return e.setLayerStyle(t)}));else{var r=this.find(t.name);r&&(this._state.handSetTilesetStyle.set(r,t.color),r.makeStyleDirty())}return this}},{key:"setSelection",value:function(t,e){var r="string"==typeof t?this.find(t):t;return r&&(e?(this._state.handSetSelected=[r,e],r.makeStyleDirty()):(this._state.handSetSelected=null,r.makeStyleDirty())),this}},{key:"setOpacity",value:function(t,e){var r=this,n=e&&e<=0&&e<=1?e:-1;return-1!==n&&(this._state.s3mFilterOpacity=n),t.forEach((function(t){var e=r.find(t.name);e&&(r._state.s3mOpacity.set(e,t.opacity),e.makeStyleDirty())})),this}},{key:"setVisibleByName",value:function(t,e){return this._3dtileset.has(t)&&this._3dtileset.get(t).forEach((function(t){t.show=e})),this}},{key:"setVisible",value:function(t,e,r){if(t&&0!==t.length){for(var n=0,i=this._primitives.length;n<i;n++)t.includes(this._primitives.get(n).get("name"))?this._primitives.get(n).show=e:!0===r&&(this._primitives.get(n).show=!e);return this}}},{key:"setS3mStyle",value:function(t,e,r){return"string"==typeof t&&this.find(t),this}},{key:"setS3mVisible",value:function(t,e,r,n){return("string"==typeof t?this.find(t):t)&&(!0===n||e.length),this}},{key:"layerToTop",value:function(t){var e="string"==typeof t?this.find(t):t;return e&&this._primitives.raiseToTop(e),this}},{key:"layerToBottom",value:function(t){var e="string"==typeof t?this.find(t):t;return e&&this._primitives.lowerToBottom(e),this}},{key:"zoomTo",value:function(t,e){return this._map._cameraService.flyToBoundingSphere(t.boundingSphere,function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Ci(Object(r),!0).forEach((function(e){var n,i,o;n=t,i=e,o=r[e],(i=Ti(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ci(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({duration:1},e)),this}},{key:"remove",value:function(t){var e=this;return t?this._3dtileset.has(t)&&(this._3dtileset.get(t).forEach((function(t){e._primitives.remove(t)})),this._3dtileset.delete(t)):(this._primitives.removeAll(),this._3dtileset.clear()),this}},{key:"dispose",value:function(){ji(Li(a.prototype),"dispose",this).call(this),this._map._cameraService.off(this._key),this._state.s3mOpacity.clear(),this._state.handSetSelected=null,this._state.handSetTilesetStyle.clear(),this._events.length=0,this.remove()}}],r&&ki(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t);function Mi(t){return Mi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Mi(t)}function Ai(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Di(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ni(n.key),n)}}function Ni(t){var e=function(t,e){if("object"!=Mi(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Mi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Mi(e)?e:String(e)}function Fi(){return Fi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Gi(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},Fi.apply(this,arguments)}function zi(t,e){return zi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},zi(t,e)}function Gi(t){return Gi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Gi(t)}var Bi=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&zi(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Gi(n);if(i){var r=Gi(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Mi(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this))._name=void 0,r._options=void 0,r._map=void 0,r._terrainsUrl=void 0,r._map=t,r._options=e,r._name=(null==e?void 0:e.name)||"terrain",r}return e=a,r=[{key:"name",get:function(){return this._name}},{key:"options",get:function(){return this._options}},{key:"_createDefaultTerrain",value:function(){return new Cesium.EllipsoidTerrainProvider({ellipsoid:Cesium.Ellipsoid.WGS84})}},{key:"load",value:function(t,e){var r=this;return t?(this._terrainsUrl=t,Cesium.CesiumTerrainProvider.fromUrl(t+(t.endsWith("/")?"":"/"),function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Ai(Object(r),!0).forEach((function(e){var n,i,o;n=t,i=e,o=r[e],(i=Ni(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ai(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({requestVertexNormals:!1},e)).then((function(t){r._map.terrainProvider=t})).catch((function(t){console.error("加载地形失败，",t)})),this):(this._terrainsUrl=null,void(this._map.terrainProvider=this._createDefaultTerrain()))}},{key:"setVisible",value:function(t){var e,r;return t?this._terrainsUrl&&null!==(e=this._map.terrainProvider)&&void 0!==e&&null!==(e=e._baseUrl)&&void 0!==e&&e.includes(this._terrainsUrl)?this._map.terrainProvider.visible=!0:this._map.terrainProvider||(this._map.terrainProvider=this._createDefaultTerrain()):this._terrainsUrl&&null!==(r=this._map)&&void 0!==r&&null!==(r=r.terrainProvider)&&void 0!==r&&null!==(r=r._baseUrl)&&void 0!==r&&r.includes(this._terrainsUrl)?this._map.terrainProvider.visible=!1:this._map.terrainLayers.removeAll(),this}},{key:"remove",value:function(){return this._map.terrainLayers.removeAll(),this}},{key:"dispose",value:function(){Fi(Gi(a.prototype),"dispose",this).call(this),this.remove()}}],r&&Di(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t),Vi=function(t){return t.gltf="gltf",t.point="point",t.tiles3d="3dtiles",t}({});function Ui(t){return Ui="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ui(t)}var qi=["name","data","scale"],Wi=["name","data","scale"],Xi=["point","scale","minimumPixelSize"],Zi=["name","data"],Hi=["name","data"],Yi=["name","data"];function Ki(){Ki=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var o=e&&e.prototype instanceof m?e:m,a=Object.create(o.prototype),s=new j(n||[]);return i(a,"_invoke",{value:E(t,r,s)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var p="suspendedStart",h="suspendedYield",y="executing",d="completed",g={};function m(){}function v(){}function _(){}var b={};l(b,a,(function(){return this}));var w=Object.getPrototypeOf,S=w&&w(w(R([])));S&&S!==r&&n.call(S,a)&&(b=S);var O=_.prototype=m.prototype=Object.create(b);function x(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function C(t,e){function r(i,o,a,s){var u=f(t[i],t,o);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==Ui(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(c).then((function(t){l.value=t,a(l)}),(function(t){return r("throw",t,a,s)}))}s(u.arg)}var o;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return o=o?o.then(i,i):i()}})}function E(e,r,n){var i=p;return function(o,a){if(i===y)throw new Error("Generator is already running");if(i===d){if("throw"===o)throw a;return{value:t,done:!0}}for(n.method=o,n.arg=a;;){var s=n.delegate;if(s){var u=P(s,n);if(u){if(u===g)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===p)throw i=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=y;var l=f(e,r,n);if("normal"===l.type){if(i=n.done?d:h,l.arg===g)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=d,n.method="throw",n.arg=l.arg)}}}function P(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var o=f(i,e.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,g;var a=o.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function k(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function j(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(k,this),this.reset(!0)}function R(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return o.next=o}}throw new TypeError(Ui(e)+" is not iterable")}return v.prototype=_,i(O,"constructor",{value:_,configurable:!0}),i(_,"constructor",{value:v,configurable:!0}),v.displayName=l(_,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,_):(t.__proto__=_,l(t,u,"GeneratorFunction")),t.prototype=Object.create(O),t},e.awrap=function(t){return{__await:t}},x(C.prototype),l(C.prototype,s,(function(){return this})),e.AsyncIterator=C,e.async=function(t,r,n,i,o){void 0===o&&(o=Promise);var a=new C(c(t,r,n,i),o);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},x(O),l(O,u,"Generator"),l(O,a,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=R,j.prototype={constructor:j,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return s.type="throw",s.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),l=n.call(a,"finallyLoc");if(u&&l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),T(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;T(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:R(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}function Ji(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function $i(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Ji(Object(r),!0).forEach((function(e){var n,i,o;n=t,i=e,o=r[e],(i=ro(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ji(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Qi(t,e){if(null==t)return{};var r,n,i=function(t,e){if(null==t)return{};var r,n,i={},o=Object.keys(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||(i[r]=t[r]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function to(t,e,r,n,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,i)}function eo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ro(n.key),n)}}function ro(t){var e=function(t,e){if("object"!=Ui(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Ui(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ui(e)?e:String(e)}function no(){return no="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=oo(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},no.apply(this,arguments)}function io(t,e){return io=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},io(t,e)}function oo(t){return oo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},oo(t)}var ao=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&io(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=oo(n);if(i){var r=oo(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Ui(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this))._key=void 0,r._name=void 0,r._options=void 0,r._map=void 0,r._gltfPrimitives=new Cesium.PrimitiveCollection,r._pointPrimitives=new Cesium.PointPrimitiveCollection,r._3dTilesPrimitives=new Cesium.PrimitiveCollection,r._events=[],r._state={selected:null,hoverSelected:null},r._map=t,r._options=e,r._name=(null==e?void 0:e.name)||"primitive",r._key=Symbol(r._name),r._map.scene.primitives.add(r._gltfPrimitives),r._map.scene.primitives.add(r._pointPrimitives),r._map.scene.primitives.add(r._3dTilesPrimitives),r._initEvent(),r}return e=a,r=[{key:"name",get:function(){return this._name}},{key:"options",get:function(){return this._options}},{key:"clicks",get:function(){var t=this;return function(e){return t._events.filter((function(t){return"click"===t.type&&t.pType===e}))}}},{key:"hovers",get:function(){var t=this;return function(e){return t._events.filter((function(t){return"hover"===t.type&&t.pType===e}))}}},{key:"_containTo",value:function(t){return this._gltfPrimitives.contains(t)||this._pointPrimitives.contains(t)||this._3dTilesPrimitives.contains(t)}},{key:"_convertStyleColor",value:function(t){if(/^rgba\((.*)\.(.*)\.(.*)\.(.*)\)$/.test(t)){var e=Number(RegExp.$1),r=Number(RegExp.$2),n=Number(RegExp.$3),i=Number(RegExp.$4);return"vec4(".concat(e/255,",").concat(r/255,",").concat(n/255,",").concat(i,")")}return"color('".concat(t,"')")}},{key:"_zoomToPosition",value:function(t,e){var r;r=t instanceof Cesium.PointPrimitive?j(this._map,t.position):t instanceof Cesium.Cesium3DTileset?j(this._map,t.boundingSphere.center):j(this._map,Cesium.Matrix4.multiplyByPoint(t.modelMatrix,t.boundingSphere.center,new Cesium.Cartesian3)),this._map._cameraService.flyTo({destination:r,orientation:{heading:Cesium.Math.toRadians(0),pitch:Cesium.Math.toRadians(-90),roll:0},duration:1})}},{key:"_setSelected",value:function(t,e,r){var n;t&&!this._containTo(t)&&(t=null);var i=!1!==(null===(n=this._options)||void 0===n?void 0:n.clickFlyTo),o=this._state.selected;if(o!==t&&(o||t)){this._state.selected=t;var a=(t||o).get("__primitive_type",!0);!1!==r&&(t&&o&&t.get("__primitive_type",!0)!==o.get("__primitive_type",!0)&&this.clicks(o.get("__primitive_type",!0)).forEach((function(t){t.event(null,null,null,o)})),this.clicks(a).forEach((function(r){var n;r.event(null===(n=t)||void 0===n?void 0:n.get("data"),t,e,o)})))}i&&t&&this._zoomToPosition(t)}},{key:"_setHoverSelected",value:function(t,e,r){t&&!this._containTo(t)&&(t=null);var n=this._state.hoverSelected;if(n!==t&&(n||t)){this._state.hoverSelected=t;var i=(t||n).get("__primitive_type",!0);!1!==r&&(t&&n&&t.get("__primitive_type",!0)!==n.get("__primitive_type",!0)&&this.hovers(n.get("__primitive_type",!0)).forEach((function(t){t.event(null,null,null,n)})),this.hovers(i).forEach((function(r){var i;r.event(null===(i=t)||void 0===i?void 0:i.get("data"),t,e,n)})))}}},{key:"_initEvent",value:function(){var t,e,r=this;!0===(null===(t=this._options)||void 0===t?void 0:t.listenClickEvent)&&this._map._cameraService.on(Cesium.ScreenSpaceEventType.LEFT_CLICK,(function(t,e){r._setSelected(null==t?void 0:t.primitive,(null==t?void 0:t.id)||(null==t?void 0:t._batchId))}),this._key),!0===(null===(e=this._options)||void 0===e?void 0:e.listenHoverEvent)&&this._map._cameraService.on(Cesium.ScreenSpaceEventType.MOUSE_MOVE,(function(t,e){r._setHoverSelected(null==t?void 0:t.primitive,null==t?void 0:t.id)}),this._key)}},{key:"loadGltf",value:function(t,e){var r=this;return new Promise((function(n,i){if(Array.isArray(t)){var o=[];t.forEach(function(){var t,e=(t=Ki().mark((function t(e){var n,i,a,s,u,l;return Ki().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.name,i=e.data,a=e.scale,s=void 0===a?1:a,u=Qi(e,qi),l=Cesium.Matrix4.fromTranslation(Cesium.fromLonLat(u.point)),Cesium.Matrix4.setScale(l,new Cesium.Cartesian3(s,s,s),l),o.push(Cesium.Model.fromGltfAsync($i($i({},u),{},{modelMatrix:l,minimumPixelSize:u.minimumPixelSize||60,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND})).then((function(t){return console.log("🚀 ~ .then ~ model:",t),t.set("name",n||"model"),t.set("data",i),t.set("__primitive_type",Vi.gltf,!0),r._gltfPrimitives.add(t),t})).catch((function(t){return Promise.reject(t)})));case 4:case"end":return t.stop()}}),t)})),function(){var e=this,r=arguments;return new Promise((function(n,i){var o=t.apply(e,r);function a(t){to(o,n,i,a,s,"next",t)}function s(t){to(o,n,i,a,s,"throw",t)}a(void 0)}))});return function(t){return e.apply(this,arguments)}}()),Promise.all(o).then((function(i){!0===(null==e?void 0:e.flyTo)&&(r._map.camera.cancelFlight(),r._map.camera.setView({destination:j(r._map,Cesium.BoundingSphere.fromPoints(t.map((function(t){return Cesium.fromLonLat(t.point)}))).center)})),n(i)})).catch((function(t){i(t)}))}else{var a=t.name,s=t.data,u=t.scale,l=void 0===u?1:u,c=Qi(t,Wi),f=Cesium.Matrix4.fromTranslation(Cesium.fromLonLat(c.point));Cesium.Matrix4.setScale(f,new Cesium.Cartesian3(l,l,l),f),Cesium.Model.fromGltfAsync($i($i({},c),{},{modelMatrix:f,minimumPixelSize:c.minimumPixelSize||60,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND})).then((function(t){t.set("name",a||"model"),t.set("data",s),t.set("__primitive_type",Vi.gltf,!0),r._gltfPrimitives.add(t),!0===(null==e?void 0:e.flyTo)&&(r._map.camera.cancelFlight(),r._map.camera.setView({destination:Cesium.fromLonLat(c.point,r._map.getHeight())})),n(t)})).catch((function(t){i(t)}))}}))}},{key:"setGltfVisible",value:function(t,e,r){if("function"==typeof t)for(var n=0;n<this._gltfPrimitives.length;n++){var i=this._gltfPrimitives.get(n);!0===r?i.show=t(i.get("name"),i.get("data"),i):!0===t(i.get("name"),i.get("data"),i)&&(i.show=e)}else if(0===t.length)this._gltfPrimitives.show=e;else for(var o=0;o<this._gltfPrimitives.length;o++){var a=this._gltfPrimitives.get(o);t.includes(a.get("name"))?a.show=e:!0===r&&(a.show=!e)}return this}},{key:"removeGltf",value:function(t){if(t&&0!==t.length)for(var e=0;e<this._gltfPrimitives.length;e++){var r=this._gltfPrimitives.get(e);t.includes(r.get("name"))&&this._gltfPrimitives.remove(r)&&e--}else this._gltfPrimitives.removeAll();return this}},{key:"updateGltfOptions",value:function(t,e){if(e){var r=e.point,n=e.scale,i=e.minimumPixelSize,o=Qi(e,Xi),a="string"==typeof t?this.find(t,"gltf"):t;a&&(a.modelMatrix&&(r&&Cesium.Matrix4.setTranslation(a.modelMatrix,Cesium.fromLonLat(r),a.modelMatrix),n&&Cesium.Matrix4.setScale(a.modelMatrix,new Cesium.Cartesian3(n,n,n),a.modelMatrix)),i&&(a.minimumPixelSize=i),o&&Object.keys(o).forEach((function(t){Reflect.has(a,t)&&Reflect.set(a,t,o[t])})))}return this}},{key:"loadPoint",value:function(t,e){var r=this;if(Array.isArray(t))t.forEach((function(t){var e=t.name,n=t.data,i=Qi(t,Zi),o=r._pointPrimitives.add($i($i({},i),{},{position:Cesium.fromLonLat(i.point),color:Cesium.Color.fromCssColorString(i.color||"rgba(0,0,255, 0.9)"),pixelSize:i.pixelSize||10,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND}));o.set("name",e||"point"),o.set("data",n),o.set("__primitive_type",Vi.point,!0)})),!0===(null==e?void 0:e.flyTo)&&(this._map.camera.cancelFlight(),this._map.camera.setView({destination:j(this._map,Cesium.BoundingSphere.fromPoints(t.map((function(t){return Cesium.fromLonLat(t.point)}))).center)}));else{var n=t.name,i=t.data,o=Qi(t,Hi),a=this._pointPrimitives.add($i($i({},o),{},{position:Cesium.fromLonLat(o.point),color:Cesium.Color.fromCssColorString(o.color||"rgba(0,0,255, 0.9)"),pixelSize:o.pixelSize||10,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND}));a.set("name",n||"point"),a.set("data",i),a.set("__primitive_type",Vi.point,!0),!0===(null==e?void 0:e.flyTo)&&(this._map.camera.cancelFlight(),this._map.camera.setView({destination:Cesium.fromLonLat(o.point,this._map.getHeight())}))}return this}},{key:"setPointVisible",value:function(t,e,r){if("function"==typeof t)for(var n=0;n<this._pointPrimitives.length;n++){var i=this._pointPrimitives.get(n);!0===r?i.show=t(i.get("name"),i.get("data"),i):!0===t(i.get("name"),i.get("data"),i)&&(i.show=e)}else if(0===t.length)this._pointPrimitives.show=e;else for(var o=0;o<this._pointPrimitives.length;o++){var a=this._pointPrimitives.get(o);t.includes(a.get("name"))?a.show=e:!0===r&&(a.show=!e)}return this}},{key:"removePoint",value:function(t){if(t&&0!==t.length)for(var e=0;e<this._pointPrimitives.length;e++){var r=this._pointPrimitives.get(e);t.includes(r.get("name"))&&this._pointPrimitives.remove(r)&&e--}else this._pointPrimitives.removeAll();return this}},{key:"updatePointOptions",value:function(t,e){var r="string"==typeof t?this.find(t,"point"):t;return r&&(e.color&&(r.color=Cesium.Color.fromCssColorString(e.color)),e.pixelSize&&(r.pixelSize=e.pixelSize)),this}},{key:"load3DTiles",value:function(t,e){var r=this;return new Promise((function(n,i){if(Array.isArray(t)){var o=t.map((function(t){return Cesium.Cesium3DTileset.fromUrl(t.url,{})}));Promise.all(o).then((function(i){i.forEach((function(e,n){e.set("name",t[n].name||"3dtiles"),e.set("data",t[n].data),e.set("__primitive_type",Vi.tiles3d,!0),e.colorBlendMode=Cesium.Cesium3DTileColorBlendMode.REPLACE,r._3dTilesPrimitives.add(e)})),!1!==(null==e?void 0:e.flyTo)&&r._map._cameraService.setViewToHeight(i[0].boundingSphere.center),n(i)})).catch((function(t){i(t)}))}else{var a=t.name,s=t.data,u=Qi(t,Yi);Cesium.Cesium3DTileset.fromUrl(u.url,{}).then((function(t){t.set("name",a||"3dtiles"),t.set("data",s),t.set("__primitive_type",Vi.tiles3d,!0),t.colorBlendMode=Cesium.Cesium3DTileColorBlendMode.REPLACE,r._3dTilesPrimitives.add(t),!1!==(null==e?void 0:e.flyTo)&&r._map._cameraService.setViewToHeight(t[0].boundingSphere.center),n(t)})).catch((function(t){i(t)}))}}))}},{key:"set3DTilesVisible",value:function(t,e,r){if("function"==typeof t)for(var n=0;n<this._3dTilesPrimitives.length;n++){var i=this._3dTilesPrimitives.get(n);!0===r?i.show=t(i.get("name"),i.get("data"),i):!0===t(i.get("name"),i.get("data"),i)&&(i.show=e)}else if(0===t.length)this._3dTilesPrimitives.show=e;else for(var o=0;o<this._3dTilesPrimitives.length;o++){var a=this._3dTilesPrimitives.get(o);t.includes(a.get("name"))?a.show=e:!0===r&&(a.show=!e)}return this}},{key:"remove3DTiles",value:function(t){if(t&&0!==t.length)for(var e=0;e<this._3dTilesPrimitives.length;e++){var r=this._3dTilesPrimitives.get(e);t.includes(r.get("name"))&&this._3dTilesPrimitives.remove(r)&&e--}else this._3dTilesPrimitives.removeAll();return this}},{key:"update3DTilesOptions",value:function(t,e){var r="string"==typeof t?this.find(t,"3dtiles"):t;return r&&(r.style||(r.style=new Cesium.Cesium3DTileStyle),e.color&&(r.style.color=new Cesium.Expression(this._convertStyleColor(e.color))),e.backgroundColor&&(r.style.backgroundColor=new Cesium.Expression(this._convertStyleColor(e.backgroundColor))),r.makeStyleDirty()),this}},{key:"find",value:function(t,e){for(var r="point"===e?this._pointPrimitives:"3dtiles"===e?this._3dTilesPrimitives:this._gltfPrimitives,n=0;n<r.length;n++){var i=r.get(n);if(i.get("name")===t)return i}return null}},{key:"on",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"click",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Vi.gltf;return this._events.push({type:e,event:t,pType:r}),this}},{key:"off",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"click",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Vi.gltf,n=this._events.findIndex((function(n){return n.type===e&&n.pType===r&&n.event===t}));return n>=0&&this._events.splice(n,1),this}},{key:"dispose",value:function(){no(oo(a.prototype),"dispose",this).call(this),this._map._cameraService.off(this._key),this._events.length=0,this._state.selected=null,this._state.hoverSelected=null,this._gltfPrimitives.destroy(),this._map.scene.primitives.remove(this._gltfPrimitives),this._pointPrimitives.destroy(),this._map.scene.primitives.remove(this._pointPrimitives),this._3dTilesPrimitives.destroy(),this._map.scene.primitives.remove(this._3dTilesPrimitives)}}],r&&eo(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t);function so(t){return so="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},so(t)}function uo(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function lo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,co(n.key),n)}}function co(t){var e=function(t,e){if("object"!=so(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=so(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==so(e)?e:String(e)}function fo(){return fo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=yo(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},fo.apply(this,arguments)}function po(t,e){return po=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},po(t,e)}function ho(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function yo(t){return yo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},yo(t)}var go=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&po(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=yo(n);if(i){var r=yo(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===so(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return ho(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this))._name=void 0,r._options={model:"first",cameraDistance:1.5,cameraHeight:1.8},r._map=void 0,r._start=void 0,r._stop=void 0,r._customRoamingEntity=void 0,r.__customRoamingEvent=r._customRoamingEvent.bind(ho(r)),r._map=t,r.setOptions(e),r._name=(null==e?void 0:e.name)||"dataRoam",r}return e=a,r=[{key:"name",get:function(){return this._name}},{key:"options",get:function(){return this._options}},{key:"clampToGround",get:function(){var t;return!0===(null===(t=this._options)||void 0===t?void 0:t.clampToGround)}},{key:"model",set:function(t){this._options.model=t,this._changeModel()}},{key:"setOptions",value:function(t){t&&Object.assign(this._options,t)}},{key:"_adjustCamera",value:function(t,e){var r=Cesium.Matrix4.fromRotationTranslation(Cesium.Matrix3.fromQuaternion(e),t);this._map.scene.camera.lookAtTransform(r),this._map.scene.camera.position=new Cesium.Cartesian3(-this._options.cameraDistance||1.5,0,this._options.cameraHeight||1.8),this._map.scene.camera.direction=new Cesium.Cartesian3(-t.x,0,0),this._map.scene.camera.right=new Cesium.Cartesian3(0,t.y,0),this._map.scene.camera.up=new Cesium.Cartesian3(0,0,t.z),this._map.scene.camera.lookDown(Cesium.Math.PI/60)}},{key:"_changeModel",value:function(){var t=this._options.model;switch(this._map.trackedEntity=void 0,t){case"follow":this._map.trackedEntity=this._customRoamingEntity;break;case"first":var e=this._customRoamingEntity.position.getValue(this._start),r=this._customRoamingEntity.orientation.getValue(this._start);this._adjustCamera(e,r),this._map.scene.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);break;case"god":this._map.zoomTo(this._customRoamingEntity,new Cesium.HeadingPitchRange(0,Cesium.Math.toRadians(-90),1e3))}}},{key:"_computeDistance",value:function(t){if(0===t.length)return 0;var e=t.length;if(e<2)return 0;for(var r=0,n=0;n<e-1;n++)r+=Cesium.Cartesian3.distance(t[n],t[n+1]);return+Math.abs(r).toFixed(2)}},{key:"_computeSamplePosition",value:function(t,e,r,n){for(var i=0,o=t.length;i<o;i++){var a=this._computeDistance(t.slice(0,i+1)),s=Cesium.JulianDate.addSeconds(this._start,a*e,Cesium.JulianDate.now());n.addSample(s,a),r.addSample(s,t[i])}}},{key:"_customRoamingEvent",value:function(){if(this._customRoamingEntity)if("first"===this._options.model){var t=this._customRoamingEntity.orientation.getValue(this._map.clock.currentTime),e=this._customRoamingEntity.position.getValue(this._map.clock.currentTime);Cesium.defined(t)&&this._adjustCamera(e,t)}else"god"===this._options.model&&this._map.zoomTo(this._customRoamingEntity,new Cesium.HeadingPitchRange(0,Cesium.Math.toRadians(-90),1e3));Cesium.JulianDate.greaterThanOrEquals(this._map.clock.currentTime,this._stop)&&(this._map.trackedEntity=void 0,this._map.scene.camera.lookAtTransform(Cesium.Matrix4.IDENTITY),this._map.clock.onTick.removeEventListener(this.__customRoamingEvent),this._map.clock.multiplier=0,this._map.clock.currentTime=this._start.clone())}},{key:"_customRoaming",value:function(t,e){var r,n=Cesium.Cartesian3.fromDegreesArrayHeights(t);this._map.clock.onTick.removeEventListener(this.__customRoamingEvent),this._start=Cesium.JulianDate.now(),this._stop=Cesium.JulianDate.addSeconds(this._start,e,Cesium.JulianDate.now());var i=this._computeDistance(n),o=new Cesium.SampledPositionProperty,a=new Cesium.SampledProperty(Number);this._map.clock.currentTime=this._start.clone(),this._map.clock.startTime=this._start.clone(),this._map.clock.stopTime=this._stop.clone(),this._map.clock.clockRange=Cesium.ClockRange.CLAMPED,this._map.clock.multiplier=1,this.remove(),this._computeSamplePosition(n,e/i,o,a),this._customRoamingEntity=this._map.entities.add({availability:new Cesium.TimeIntervalCollection([new Cesium.TimeInterval({start:this._start,stop:this._stop})]),position:o,orientation:new Cesium.VelocityOrientationProperty(o),model:{uri:(null===(r=this._options)||void 0===r?void 0:r.gltfSrc)||"static/gltf/PureMilkTruck1.gltf",minimumPixelSize:64,heightReference:this.clampToGround?Cesium.HeightReference.CLAMP_TO_GROUND:Cesium.HeightReference.NONE},path:{resolution:1,material:new Cesium.PolylineGlowMaterialProperty({glowPower:.1,color:Cesium.Color.AQUA}),width:10},properties:new Cesium.PropertyBag({roaming:a})}),this._customRoamingEntity.position.setInterpolationOptions({interpolationDegree:6,interpolationAlgorithm:Cesium.LinearApproximation}),this._changeModel(),Cesium.JulianDate.equals(this._map.clock.currentTime,this._start)&&this._map.clock.onTick.addEventListener(this.__customRoamingEvent)}},{key:"create",value:function(t){var e=t.positions,r=t.duration;this.stop();var n,i=this.clampToGround?e.map((function(t){return[t[0],t[1],0]})):e;return this._customRoaming(function(t){if(Array.isArray(t))return uo(t)}(n=i.flat())||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||function(t,e){if(t){if("string"==typeof t)return uo(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?uo(t,e):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),r||6),this}},{key:"stop",value:function(){return this._map.clock.multiplier=0,this._map.trackedEntity=void 0,this._map.scene.camera.lookAtTransform(Cesium.Matrix4.IDENTITY),this}},{key:"pause",value:function(){this._map.clock.multiplier=0,this._map.trackedEntity=void 0,this._map.scene.camera.lookAtTransform(Cesium.Matrix4.IDENTITY)}},{key:"remove",value:function(){return this._customRoamingEntity&&(this._map.entities.remove(this._customRoamingEntity),this._customRoamingEntity=null),this}},{key:"dispose",value:function(){fo(yo(a.prototype),"dispose",this).call(this),this.stop(),this.remove()}}],r&&lo(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t);function mo(t){return mo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mo(t)}function vo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,_o(n.key),n)}}function _o(t){var e=function(t,e){if("object"!=mo(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=mo(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==mo(e)?e:String(e)}function bo(){return bo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=So(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},bo.apply(this,arguments)}function wo(t,e){return wo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},wo(t,e)}function So(t){return So=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},So(t)}var Oo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&wo(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=So(n);if(i){var r=So(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===mo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=o.call(this)).map=void 0,e._instances=[],e.map=t,e}return e=a,r=[{key:"instances",get:function(){return this._instances}},{key:"viewToExtents",value:function(t,e,r,n){return this.map._cameraService.viewToExtents(t,e,r,n),this}},{key:"setDepthTestAgainstTerrain",value:function(t){return this.map._cameraService.setDepthTestAgainstTerrain(t),this}},{key:"getCameraVisualAngle",value:function(){return this.map._cameraService.getCameraVisualAngle()}},{key:"setCameraVisualAngle",value:function(t,e){return this.map._cameraService.setCameraVisualAngle(t,e),this}},{key:"setView",value:function(t,e){return this.map._cameraService.setView({destination:Cesium.fromLonLat(t),orientation:e||{heading:6.283185307179586,pitch:-1.5707936357425476,roll:0}}),this}},{key:"S3MTiles",value:function(t){var e=new Ii(this.map,t);return this._instances.push(e),e}},{key:"obliquePhotography",value:function(t){var e=new Oi(this.map,t);return this._instances.push(e),e}},{key:"Terrain",value:function(t){var e=new Bi(this.map,t);return this._instances.push(e),e}},{key:"Primitive",value:function(t){var e=new ao(this.map,t);return this._instances.push(e),e}},{key:"DataRoam",value:function(t){var e=new go(this.map,t);return this._instances.push(e),e}},{key:"findInstance",value:function(t){return this._instances.find((function(e){return e.name===t}))}},{key:"filterInstance",value:function(t){return this._instances.filter((function(e){return e.name===t}))}},{key:"removeInstance",value:function(t){var e=this;if(!t)return this._instances.forEach((function(t){return t.dispose()})),void(this._instances.length=0);if(Array.isArray(t))t.forEach((function(t){return e.removeInstance(t)}));else{var r=this._instances.findIndex((function(e){return e===t}));r>=0&&(this._instances[r].dispose(),this._instances.splice(r,1))}return this}},{key:"dispose",value:function(){bo(So(a.prototype),"dispose",this).call(this),this.removeInstance()}}],r&&vo(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t);function xo(t){return xo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xo(t)}function Co(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Eo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Po(n.key),n)}}function Po(t){var e=function(t,e){if("object"!=xo(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=xo(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==xo(e)?e:String(e)}function ko(){return ko="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=jo(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},ko.apply(this,arguments)}function To(t,e){return To=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},To(t,e)}function jo(t){return jo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},jo(t)}var Ro=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&To(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=jo(n);if(i){var r=jo(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===xo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=o.call(this)).map=void 0,e._enableClickAndDblClickTestTimer=void 0,e._events=[],e._registered=new Set,e._eventsCamera=[],e._registeredCamera=new Map,e._eventsZoom=[],e._zoomCallback=[],e.map=t,e}return e=a,r=[{key:"_useEvents",get:function(){var t=this;return function(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t._events.filter((function(n){return n.type===e&&(!r||t.map._appHandler.judgeCesium(e,n.params))}))}}},{key:"_useCameraEvents",get:function(){var t=this;return function(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t._eventsCamera.filter((function(n){return n.type===e&&(!r||t.map._appHandler.judgeCesium(e,n.params))}))}}},{key:"_enableClickAndDblClickTest",get:function(){return this._registered.has(Cesium.ScreenSpaceEventType.LEFT_CLICK)&&this._registered.has(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)}},{key:"_clearTestTimer",value:function(){this._enableClickAndDblClickTestTimer&&(clearTimeout(this._enableClickAndDblClickTestTimer),this._enableClickAndDblClickTestTimer=null)}},{key:"_fireEvent",value:function(t,e){var r=t===Cesium.ScreenSpaceEventType.WHEEL?null:this.map.scene.pick(e.position||e.endPosition||e.position2)||null;this._useEvents(t,!0).forEach((function(t){return t.fun(r,e)}))}},{key:"_registryEvent",value:function(t){var e=this;this._registered.has(t)||(this._registered.add(t),this.map.screenSpaceEventHandler.setInputAction((function(r){if(t!==Cesium.ScreenSpaceEventType.WHEEL){var n=T(e.map,r.position||r.endPosition||r.position2);if(!Cesium.defined(n))return}if(t===Cesium.ScreenSpaceEventType.LEFT_CLICK&&e._enableClickAndDblClickTest)return e._clearTestTimer(),void(e._enableClickAndDblClickTestTimer=setTimeout((function(r){e._enableClickAndDblClickTestTimer=null,e._fireEvent(t,r)}),200,r));t===Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK&&e._enableClickAndDblClickTestTimer&&e._clearTestTimer(),e._fireEvent(t,r)}),t))}},{key:"_fireCameraEvent",value:function(t,e){this._useCameraEvents(t,!0).forEach((function(t){return t.fun(e)}))}},{key:"hasCameraEventType",value:function(t){return["changed","moveEnd","moveStart"].includes(t)}},{key:"on",value:function(t,e,r,n){return this._registryEvent(t),this._events.push({type:t,fun:e,key:r,params:n}),this}},{key:"off",value:function(t,e){for(var r="function"==typeof t,n=(e?this._useEvents(e):this._events).filter((function(e){return r?e.fun===t:e.key===t})),i=0;i<this._events.length;i++)if(n.includes(this._events[i])){var o=this._events[i].type;this._events.splice(i,1),0===this._useEvents(o).length&&this._registered.has(o)&&(this._registered.delete(o),this.map.screenSpaceEventHandler.removeInputAction(o)),i--}return this}},{key:"onCamera",value:function(t,e,r,n){var i=this;return this.map.camera[t]&&Reflect.has(this.map.camera[t],"addEventListener")&&(this._registeredCamera.has(t)||(this._registeredCamera.set(t,(function(e){i._useCameraEvents(t).forEach((function(t){return t.fun(e)}))})),this.map.camera[t].addEventListener(this._registeredCamera.get(t))),this._eventsCamera.push({type:t,fun:e,key:r,params:n})),this}},{key:"offCamera",value:function(t,e){var r=this;if(t){for(var n="function"==typeof t,i=(e?this._useCameraEvents(e):this._eventsCamera).filter((function(e){return n?e.fun===t:e.key===t})),o=0;o<this._eventsCamera.length;o++)if(i.includes(this._eventsCamera[o])){var a=this._eventsCamera[o].type;this._eventsCamera.splice(o,1),0===this._useCameraEvents(a).length&&(this._registeredCamera.delete(a),this.map.camera[a].removeEventListener(this._registeredCamera.get(a)),this._registeredCamera.delete(a)),o--}}else this._eventsCamera.length=0,this._registeredCamera.forEach((function(t,e){r.map.camera[e].removeEventListener(t)})),this._registeredCamera.clear();return this}},{key:"onZoom",value:function(t,e){var r=this;if(0===this._zoomCallback.length){var n=this.map.getZoom(),i=function(t,e){var i=r.map.getZoom();i!==n&&(n=i,r._eventsZoom.filter((function(e){return r.map._appHandler.judgeCesium(t,e.params)})).forEach((function(t){return t.fun(i,e)})))};this._zoomCallback.push({type:"moveEnd",fun:i.bind(this,"moveEnd")},{type:"changed",fun:i.bind(this,"changed")}),this._zoomCallback.forEach((function(t){return r.onCamera(t.type,t.fun,null,e)}))}return this._eventsZoom.push({fun:t,params:e}),this}},{key:"offZoom",value:function(t){var e=this;if(t){var r=this._eventsZoom.findIndex((function(e){return e.fun===t}));r>=0&&this._eventsZoom.splice(r,1)}else this._eventsZoom.length=0;return 0===this._eventsZoom.length&&(this._zoomCallback.forEach((function(t){return e.offCamera(t.fun,t.type)})),this._zoomCallback.length=0),this}},{key:"viewToExtents",value:function(t,e,r,n){return this.map.camera.setView({destination:Cesium.Rectangle.fromDegrees(t,e,r,n)}),this}},{key:"setDepthTestAgainstTerrain",value:function(t){return this.map.scene.globe.depthTestAgainstTerrain=t,this}},{key:"getCameraVisualAngle",value:function(){return{position:this.map.scene.camera.positionCartographic.clone(),heading:this.map.scene.camera.heading,pitch:this.map.scene.camera.pitch,roll:this.map.scene.camera.roll}}},{key:"setCameraVisualAngle",value:function(t,e){return this.map.camera.cancelFlight(),this.map.camera.flyTo({destination:Cesium.Cartesian3.fromRadians(t.position.longitude,t.position.latitude,t.position.height),orientation:{heading:t.heading,pitch:t.pitch,roll:t.roll},duration:lt(null==e?void 0:e.duration,void 0,1),maximumHeight:null==e?void 0:e.maximumHeight}),this}},{key:"flyTo",value:function(t,e){return!1!==e&&this.map.camera.cancelFlight(),this.map.camera.flyTo(t),this}},{key:"flyToBoundingSphere",value:function(t,e,r){return!1!==r&&this.map.camera.cancelFlight(),this.map.camera.flyToBoundingSphere(t,e),this}},{key:"setView",value:function(t,e){return!1!==e&&this.map.camera.cancelFlight(),this.map.camera.setView(t),this}},{key:"setViewToHeight",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,r=arguments.length>2?arguments[2]:void 0;!1!==(arguments.length>3?arguments[3]:void 0)&&this.map.camera.cancelFlight();var n=this.map.getMinHeight();return this.map.camera.setView(function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Co(Object(r),!0).forEach((function(e){var n,i,o;n=t,i=e,o=r[e],(i=Po(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Co(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({destination:j(this.map,t,e<n?n:e),orientation:{heading:6.283185307179586,pitch:-1.5707936357425476,roll:0}},r)),this}},{key:"zoomTo",value:function(t,e,r){return!1!==r&&this.map.camera.cancelFlight(),this.map.zoomTo(t,e)}},{key:"mapFlyTo",value:function(t,e,r){return!1!==r&&this.map.camera.cancelFlight(),this.map.flyTo(t,e)}},{key:"clear",value:function(){this._clearTestTimer(),this.map.screenSpaceEventHandler.destroy(),this._events.length=0,this._registered.clear(),this.offCamera(),this.offZoom()}},{key:"dispose",value:function(){ko(jo(a.prototype),"dispose",this).call(this),this.clear()}}],r&&Eo(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t);function Lo(t){return Lo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Lo(t)}var Io=["name","flyTo","bounds","zoom","opacity"];function Mo(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Ao(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Do(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,No(n.key),n)}}function No(t){var e=function(t,e){if("object"!=Lo(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Lo(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Lo(e)?e:String(e)}function Fo(){return Fo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Go(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},Fo.apply(this,arguments)}function zo(t,e){return zo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},zo(t,e)}function Go(t){return Go=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Go(t)}var Bo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&zo(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Go(n);if(i){var r=Go(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Lo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this))._layers=[],r.map=void 0,r.map=t,r}return e=a,r=[{key:"load",value:function(t,e){var r,n,i=e||{},o=i.name,a=(i.flyTo,i.bounds),s=(i.zoom,i.opacity,function(t,e){if(null==t)return{};var r,n,i=function(t,e){if(null==t)return{};var r,n,i={},o=Object.keys(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||(i[r]=t[r]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}(i,Io)),u=a?new Cesium.GeographicTilingScheme({rectangle:(r=Cesium.Rectangle).fromDegrees.apply(r,(n=a.flat(),function(t){if(Array.isArray(t))return Ao(t)}(n)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||function(t,e){if(t){if("string"==typeof t)return Ao(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ao(t,e):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()))}):void 0,l=this.map.imageryLayers.addImageryProvider(new Cesium.UrlTemplateImageryProvider(function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Mo(Object(r),!0).forEach((function(e){var n,i,o;n=t,i=e,o=r[e],(i=No(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Mo(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({url:t,minimumLevel:e.minZoom||this.map.getMaxZoom(),maximumLevel:e.maxZoom||this.map.getMinZoom(),tilingScheme:u},s)));return o&&Object.defineProperty(l,"name",{value:o,configurable:!1}),this._layers.push(l),a&&this.map._cameraService.flyTo({destination:Cesium.BoundingSphere.fromPoints(Cesium.Cartesian3.fromDegreesArray(a.flat(1))).center}),this}},{key:"find",value:function(t){return this._layers.find((function(e){return Reflect.get(e,"name")===t}))}},{key:"remove",value:function(t){var e=this;if(t){var r=this._layers.findIndex((function(e){return Reflect.get(e,"name")===t}));r>=0&&(this.map.imageryLayers.remove(this._layers[r],!0),this._layers.slice(r,1))}else this._layers.forEach((function(t){return e.map.imageryLayers.remove(t,!0)})),this._layers.length=0;return this}},{key:"setVisible",value:function(t,e){var r=this.find(t);return r&&(r.show=e),this}},{key:"dispose",value:function(){Fo(Go(a.prototype),"dispose",this).call(this),this.remove()}}],r&&Do(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t);function Vo(t){return Vo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vo(t)}function Uo(t){return function(t){if(Array.isArray(t))return qo(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return qo(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?qo(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function qo(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Wo(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Xo(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Wo(Object(r),!0).forEach((function(e){var n,i,o;n=t,i=e,o=r[e],(i=Ho(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Wo(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Zo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ho(n.key),n)}}function Ho(t){var e=function(t,e){if("object"!=Vo(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Vo(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Vo(e)?e:String(e)}function Yo(){return Yo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Jo(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},Yo.apply(this,arguments)}function Ko(t,e){return Ko=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ko(t,e)}function Jo(t){return Jo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Jo(t)}var $o=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ko(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Jo(n);if(i){var r=Jo(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Vo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this)).map=void 0,r._options=void 0,r._clampMode="1",r._drawInstance=null,r._elevationRamp=[0,.045,.1,.15,.37,.54,1],r._slopeRamp=[0,.29,.5,Math.sqrt(2)/2,.87,.91,1],r._layer=new Cesium.BimMapDataSource,r._contourOptions={showContour:!1,spacing:50,width:2,contourType:"none"},r.map=t,r._options=e,r._layer.set("name",e.name||"measure"),t.dataSources.add(r._layer),r}return e=a,r=[{key:"clampMode",get:function(){return this._clampMode||"1"},set:function(t){this._clampMode=t||"1"}},{key:"_getColorRamp",value:function(t){var e=document.createElement("canvas");e.width=100,e.height=1;var r,n=e.getContext("2d");if("elevation"===t?r=this._elevationRamp:"slope"===t&&(r=this._slopeRamp),n&&r){var i=n.createLinearGradient(0,0,100,0);i.addColorStop(r[0],"#000000"),i.addColorStop(r[1],"#2747E0"),i.addColorStop(r[2],"#D33B7D"),i.addColorStop(r[3],"#D33038"),i.addColorStop(r[4],"#FF9742"),i.addColorStop(r[5],"#ffd700"),i.addColorStop(r[6],"#ffffff"),n.fillStyle=i,n.fillRect(0,0,100,1)}return e}},{key:"_getSlopeContourMaterial",value:function(){return new Cesium.Material({fabric:{type:"SlopeColorContour",materials:{contourMaterial:{type:"ElevationContour"},slopeRampMaterial:{type:"SlopeRamp"}},components:{diffuse:"contourMaterial.alpha == 0.0 ? slopeRampMaterial.diffuse : contourMaterial.diffuse",alpha:"max(contourMaterial.alpha, slopeRampMaterial.alpha)"}},translucent:!1})}},{key:"_getElevationContourMaterial",value:function(){return new Cesium.Material({fabric:{type:"ElevationColorContour",materials:{contourMaterial:{type:"ElevationContour"},elevationRampMaterial:{type:"ElevationRamp"}},components:{diffuse:"contourMaterial.alpha == 0.0 ? elevationRampMaterial.diffuse : contourMaterial.diffuse",alpha:"max(contourMaterial.alpha, elevationRampMaterial.alpha)"}},translucent:!1})}},{key:"_updateMaterial",value:function(t){var e,r={},n={};t.enableContour?("elevation"===t.contourType?(r=(e=this._getElevationContourMaterial()).materials.elevationRampMaterial.uniforms,n=e.materials.contourMaterial.uniforms):"slope"===t.contourType?(this.map.terrainProvider._requestVertexNormals=!0,r=(e=this._getSlopeContourMaterial()).materials.slopeRampMaterial.uniforms,n=e.materials.contourMaterial.uniforms):n=(e=Cesium.Material.fromType("ElevationContour")).uniforms,n.width=t.contourWidth,n.spacing=t.contourSpacing,n.color=t.contourColor):"elevation"===t.contourType?r=(e=Cesium.Material.fromType("ElevationRamp")).uniforms:"slope"===t.contourType&&(this.map.terrainProvider._requestVertexNormals=!1,r=(e=Cesium.Material.fromType("SlopeRamp")).uniforms),"none"!==t.contourType&&(r.image=this._getColorRamp(t.contourType)),this.map.scene.globe.material=e,this.map.scene.requestRender()}},{key:"_getLabel",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Cesium.LabelGraphics({text:t,style:Cesium.LabelStyle.FILL_AND_OUTLINE,showBackground:!0,backgroundColor:Cesium.Color.fromCssColorString("rgba(255,255,255,0.5)"),backgroundPadding:new Cesium.Cartesian2(5,5),font:"16px Microsoft YaHei",show:!0,distanceDisplayCondition:new Cesium.DistanceDisplayCondition(0,Number.POSITIVE_INFINITY),fillColor:Cesium.Color.fromCssColorString("#000000"),eyeOffset:new Cesium.Cartesian3(0,-10,-10),horizontalOrigin:Cesium.HorizontalOrigin.CENTER,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,heightReference:e?Cesium.HeightReference.CLAMP_TO_GROUND:Cesium.HeightReference.NONE})}},{key:"_setStyle",value:function(t,e,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];e.setStyle(t.layer.getStyle()),e.label=this._getLabel(r,n),e.point.show=!1,e.polyline.clampToGround=n,this._layer.entities.add(e)}},{key:"_createPoint",value:function(t,e,r,n){var i=this;r.forEach((function(r){var o=new Cesium.CustomEntity({position:Cesium.fromLonLat(r),point:{pixelSize:5}});o.setStyle(t.layer.getStyle()),n&&(o.point.heightReference=Cesium.HeightReference.NONE),i._layer.entities.add(o),e.push(o)}))}},{key:"distance",value:function(t,e){var r=this;this._drawInstance&&this.clear(!0);var n=new Yn(this.map,Xo(Xo({name:"distance",strokeColor:"rgba(81, 255,0,1)",radius:6,strokeWidth:2,fill:"rgba(225, 229,0,0.2)",background:{strokeColor:"rgba(225, 229,0,1)",strokeWidth:2}},e),{},{type:"LineString"}));this.map.dataSources.add(n.layer);var i=[];this._drawInstance={draw:n,features:i},n.addEventListener("drawstart",(function(t){if(!0===r._options.drawClear)for(;i.length>0;)r._layer.entities.remove(i.pop())})),n.draw((function(e){var o=0;if(e.length>1)for(var a="1"===r.clampMode,s=1;s<e.length;s++)o+=a?Cesium.Cartesian3.distance(Cesium.fromLonLat([e[s-1][0],e[s-1][1],0]),Cesium.fromLonLat([e[s][0],e[s][1],0]))/1e3:Cesium.Cartesian3.distance(Cesium.fromLonLat(e[s-1]),Cesium.fromLonLat(e[s]))/1e3;var u=new Cesium.CustomEntity({position:e.length>1?Cesium.fromLonLat(e[Math.floor(e.length/2)],0):void 0,polyline:{positions:Cesium.Cartesian3.fromDegreesArrayHeights(e.flat())}});r._setStyle(n,u,pt(o),!0),i.push(u),r._createPoint(n,i,e),t(o)}))}},{key:"area",value:function(t,e){var r=this;this._drawInstance&&this.clear(!0);var n=new Yn(this.map,Xo(Xo({name:"area",strokeColor:"rgba(81, 255,0,1)",radius:6,strokeWidth:2,fill:"rgba(225, 229,0,0.2)",background:{strokeColor:"rgba(225, 229,0,1)",strokeWidth:2}},e),{},{type:"Polygon"}));this.map.dataSources.add(n.layer);var i=[];this._drawInstance={draw:n,features:i},n.addEventListener("drawstart",(function(){if(!0===r._options.drawClear)for(;i.length>0;)r._layer.entities.remove(i.pop())})),n.draw((function(e){var o=e.length>1&&e[0][0]!==e[e.length-1][0]&&e[0][1]!==e[e.length-1][1]?e.concat([e[0]]):e,a=0;if("2"===r.clampMode)a=F(Cesium.Cartesian3.fromDegreesArrayHeights(o.flat()));else{var s=Uo(n._latlngs);a=F(s.concat(s[0]))}var u=new Cesium.CustomEntity({position:R(e.map((function(t){return[t[0],t[1],0]}))),polyline:{positions:Cesium.Cartesian3.fromDegreesArrayHeights(o.flat())},polygon:{hierarchy:Cesium.Cartesian3.fromDegreesArrayHeights(e.flat())}});r._setStyle(n,u,ht(a)),i.push(u),r._createPoint(n,i,e),t(a)}))}},{key:"height",value:function(t,e){var r=this;this._drawInstance&&this.clear(!0);var n=new Yn(this.map,Xo(Xo({name:"height",strokeColor:"rgba(81, 255,0,1)",radius:6,strokeWidth:2,fill:"rgba(225, 229,0,0.2)",background:{strokeColor:"rgba(225, 229,0,1)",strokeWidth:2}},e),{},{type:"LineString"}));this.map.dataSources.add(n.layer);var i=[];this._drawInstance={draw:n,features:i},n.addEventListener("drawstart",(function(t){if(!0===r._options.drawClear)for(;i.length>0;)r._layer.entities.remove(i.pop())})),n.addEventListener("drawchange",(function(t){t.length>=2&&n.rmLastPoint()})),n.draw((function(e){var o=Uo(n._latlngs);if(o.length>1){var a=o.map((function(t){return Cesium.toLonLat(t)})),s=Cesium.Cartesian3.distance(Cesium.fromLonLat(Cesium.toLonLat(o[0],0)),Cesium.fromLonLat(Cesium.toLonLat(o[o.length-1],0)))/1e3,u=Cesium.Cartesian3.distance(o[0],o[o.length-1])/1e3,l=Math.abs(o[0].z-o[o.length-1].z)/1e3,c=Uo(a[a.length-1]);c[2]=a[0][2];var f=new Cesium.CustomEntity({position:e.length>1?R([a[a.length-1],c]):void 0,polyline:{positions:Cesium.Cartesian3.fromDegreesArrayHeights(a.concat(c,a[0]).flat()),clampToGround:!1}});r._setStyle(n,f,"垂直距离："+pt(l),!1),i.push(f);var p=new Cesium.CustomEntity({position:Cesium.fromLonLat(a[0]),label:r._getLabel("空间距离：".concat(pt(u)),!1)});i.push(p),r._layer.entities.add(p);var h=new Cesium.CustomEntity({position:e.length>1?R([a[0],c]):void 0,label:r._getLabel("水平距离：".concat(pt(s)),!1)});i.push(h),r._layer.entities.add(h),r._createPoint(n,i,a.concat([c]),!0),t(l,u,s)}}))}},{key:"updateContour",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1?arguments[1]:void 0;return e&&Object.assign(this._contourOptions,e),this._updateMaterial({enableContour:t&&this._contourOptions.showContour,contourSpacing:this._contourOptions.spacing,contourWidth:this._contourOptions.width,contourType:t?this._contourOptions.contourType:"none",minHeight:-414,maxHeight:8777,contourColor:Cesium.Color.RED.withAlpha(.4)}),this}},{key:"clear",value:function(t){var e=this;this._drawInstance&&(this._drawInstance.features.forEach((function(t,r){e._layer.entities.remove(t)})),this._drawInstance.features.length=0,t&&(this._drawInstance.draw.dispose(),this.map.dataSources.remove(this._drawInstance.draw.layer,!0),this._drawInstance=null))}},{key:"dispose",value:function(){Yo(Jo(a.prototype),"dispose",this).call(this),this.clear(!0),this._layer.entities.removeAll(),this.map.dataSources.remove(this._layer,!0)}}],r&&Zo(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t);function Qo(t){return Qo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qo(t)}function ta(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ea(n.key),n)}}function ea(t){var e=function(t,e){if("object"!=Qo(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Qo(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Qo(e)?e:String(e)}var ra=function(){function t(e){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.mapboxRenderer=void 0,this.ready=!1,this.readyPromise=void 0,this.tilingScheme=void 0,this.rectangle=void 0,this.tileSize=void 0,this.tileWidth=void 0,this.tileHeight=void 0,this.maximumLevel=void 0,this.minimumLevel=void 0,this.tileDiscardPolicy=void 0,this.errorEvent=void 0,this.credit=void 0,this.proxy=void 0,this.hasAlphaChannel=void 0,this.sourceFilter=void 0,this.enablePickFeatures=void 0,this.mapboxRenderer=new window.mapbox.BasicRenderer({style:e.style,requestTransformFn:e.requestTransformFn}),this.ready=!1,this.readyPromise=this.mapboxRenderer._style.loadedPromise.then((function(){return r.ready=!0})),this.tilingScheme=new Cesium.WebMercatorTilingScheme({ellipsoid:Cesium.Ellipsoid.WGS84}),this.rectangle=this.tilingScheme.rectangle,this.tileSize=this.tileWidth=this.tileHeight=e.tileSize||512,this.maximumLevel=e.maximumLevel||Number.MAX_SAFE_INTEGER,this.minimumLevel=e.minimumLevel||0,this.tileDiscardPolicy=void 0,this.errorEvent=new Cesium.Event,this.credit=new Cesium.Credit(e.credit||"",!1),this.proxy=new Cesium.DefaultProxy(""),this.hasAlphaChannel=void 0===e.hasAlphaChannel||e.hasAlphaChannel,this.sourceFilter=e.sourceFilter,e.mapboxAccessToken&&(window.mapbox.accessToken=e.mapboxAccessToken),this.enablePickFeatures=!("enablePickFeatures"in e)||!!e.enablePickFeatures}var e,r;return e=t,r=[{key:"getTileCredits",value:function(t,e,r){return[]}},{key:"createTile",value:function(){var t=document.createElement("canvas");return t.width=this.tileSize,t.height=this.tileSize,t.style.imageRendering="pixelated",t.getContext("2d").globalCompositeOperation="copy",t}},{key:"_getTilesSpec",value:function(t,e){for(var r=t.x,n=t.y,i=t.zoom,o=this.tileSize,a=[],s=(1<<i)-1,u=-1;u<=1;u++){var l=r+u;l<0&&(l=s),l>s&&(l=0);for(var c=-1;c<=1;c++){var f=n+c;f<0||f>s||a.push({source:e,z:i,x:l,y:f,left:0+u*o,top:0+c*o,size:o})}}return a}},{key:"requestImage",value:function(t,e,r){var n=this,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(r>this.maximumLevel||r<this.minimumLevel)return Promise.reject(void 0);this.mapboxRenderer.filterForZoom(r);var o=this.mapboxRenderer.getVisibleSources().reduce((function(i,o){return i.concat(n._getTilesSpec({x:t,y:e,zoom:r},o))}),[]);return new Promise((function(t,e){var r=n.createTile(),a=r.getContext("2d"),s=n.mapboxRenderer.renderTiles(a,{srcLeft:0,srcTop:0,width:n.tileSize,height:n.tileSize,destLeft:0,destTop:0},o,(function(o){"string"!=typeof o||o.endsWith("tiles not available")?i?(s.consumer.ctx=void 0,t(r),n.mapboxRenderer.releaseRender(s)):t(s):e(void 0)}))}))}},{key:"pickFeatures",value:function(t,e,r,n,i){var o=this;if(this.ready&&this.enablePickFeatures)return this.requestImage(t,e,r,!1).then((function(t){var e=o.mapboxRenderer.getVisibleSources();e=o.sourceFilter?o.sourceFilter(e):e;var a=[];return n=Cesium.Math.toDegrees(n),i=Cesium.Math.toDegrees(i),e.forEach((function(t){a.push({data:o.mapboxRenderer.queryRenderedFeatures({source:t,renderedZoom:r,lng:n,lat:i,tileZ:r})})})),t.consumer.ctx=void 0,o.mapboxRenderer.releaseRender(t),a}))}},{key:"destroy",value:function(){this.mapboxRenderer._cancelAllPendingRenders(),Object.values(this.mapboxRenderer._style.sourceCaches).forEach((function(t){return t._tileCache.reset()})),this.mapboxRenderer._gl.getExtension("WEBGL_lose_context").loseContext()}}],r&&ta(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();const na=ra;function ia(t){return ia="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ia(t)}var oa=["url","type","proj","key","maxZoom"],aa=["url","maxZoom"],sa=["url","type","format","maxZoom","minZoom"];function ua(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function la(t,e){if(null==t)return{};var r,n,i=function(t,e){if(null==t)return{};var r,n,i={},o=Object.keys(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||(i[r]=t[r]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function ca(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function fa(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ca(Object(r),!0).forEach((function(e){var n,i,o;n=t,i=e,o=r[e],(i=ha(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ca(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function pa(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ha(n.key),n)}}function ha(t){var e=function(t,e){if("object"!=ia(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=ia(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ia(e)?e:String(e)}function ya(t,e){return ya=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ya(t,e)}function da(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ga(t){return ga=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ga(t)}var ma=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ya(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ga(n);if(i){var r=ga(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===ia(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return da(t)}(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=o.call(this))._instance=new Lr(da(e)),e._mapLayers=[],e._options=void 0,e._domMarker=void 0,e._stopRenderInterval=!0,e.tdService=void 0,e._options=t,e}return e=a,r=[{key:"Cesium",get:function(){return window.Cesium}},{key:"map",get:function(){if(this._dispose)throw Error("BimMap(cesium)资源已被释放，请重新实例化后使用！");return this._map}},{key:"instances",get:function(){return this._instance.instances}},{key:"instancesToName",get:function(){return this._instance.instancesToName}},{key:"interactions",get:function(){return[]}},{key:"overlays",get:function(){return this._domMarker.overlays}},{key:"options",get:function(){return this._options}},{key:"_init",value:function(t){return this._map=new Cesium.CustomViewer(t.target,fa({animation:!1,timeline:!1,fullscreenButton:!1,geocoder:!1,homeButton:!1,navigationHelpButton:!1,baseLayerPicker:!1,sceneModePicker:!1,infoBox:!1,selectionIndicator:!1,navigationInstructionsInitiallyVisible:!1,creditContainer:document.createElement("DIV"),terrainProvider:new Cesium.EllipsoidTerrainProvider({ellipsoid:Cesium.Ellipsoid.WGS84}),requestRenderMode:!1,maximumRenderTimeChange:.2,scene3DOnly:!0,contextOptions:{webgl:{preserveDrawingBuffer:!0,alpha:!0},requestWebgl1:!1}},t)),this._map._appHandler=new nr,this._map._cameraService=new Ro(this._map),this.tdService=new Oo(this._map),this.tdService.viewToExtents(98.70117187500001,28.497660832963472,109.24804687500001,32.667124733120325),this.tdService.setDepthTestAgainstTerrain(!1),this._domMarker=new yn(this._map),this._map}},{key:"_useInnerLoop",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:33;if(t){var r=this;this.map.useDefaultRenderLoop=!1;var n=this.map,i=Date.now();this._stopRenderInterval=!1,function t(){Date.now()-i>=e&&(n.render(),n.scene.requestRender(),i=Date.now()),r._stopRenderInterval||requestAnimationFrame(t)}()}else this._stopRenderInterval=!0,this.map.useDefaultRenderLoop=!0}},{key:"addView",value:function(t){var e=t.maxZoom,r=void 0===e?18:e,n=(t.proj,t.center),i=t.zoom,o=t.minZoom,a=void 0===o?7:o,s=this._options;a&&(s.minZoom=a),r&&(s.maxZoom=r),i&&(s.zoom=i),this._init(this._options);var u=n&&n.length>1?n:[103.11767578125001,30.72294882477251];return this.map._cameraService.flyTo({destination:Cesium.fromLonLat([u[0],u[1],u.length>2?u[2]:E(Math.min(i||a,a))])}),a<=r&&(this.map.scene.screenSpaceCameraController.minimumZoomDistance=E(r),this.map.scene.screenSpaceCameraController.maximumZoomDistance=E(a)),this.map}},{key:"removeMapLayer",value:function(){var t=this;return this._mapLayers.forEach((function(e){return t.map.imageryLayers.remove(e)})),this._mapLayers.length=0,this}},{key:"useTianDiTu",value:function(t){var e=this,r=t||{},n=r.url,i=r.type,o=void 0===i?["img","cia"]:i,a=r.proj,u=void 0===a?"WEB":a,l=r.key,c=void 0===l?"99bc0b8df065eb27b289330adfe75fd8":l,f=r.maxZoom,p=la(r,oa),h=n?[n]:o.map((function(t){var e=s(t,u),r=e.split("_");return"https://{s}.tianditu.gov.cn/".concat(e,"/wmts?service=wmts&request=gettile&version=1.0.0&layer=").concat(r[0],"&style=default&tilematrixset=").concat(r[1],"&tilematrix={z}&tilerow={y}&tilecol={x}&format=tiles&tk=").concat(c)}));h.forEach((function(t){var r=new Cesium.UrlTemplateImageryProvider(fa({url:t,subdomains:["t0","t1","t2","t3","t4","t5","t6","t7"],maximumLevel:f||e._options.maxZoom||18},p));e._mapLayers.push(e.map.imageryLayers.addImageryProvider(r))}))}},{key:"useMapboxVT",value:function(t){var e=this;t.url,!1===t.cesiumToTianDiTu?fetch(t.url).then((function(t){return t.json()})).then((function(t){var r=new na({style:t});r.readyPromise.then((function(){e._mapLayers.push(e.map.imageryLayers.addImageryProvider(r))}))})):(t.url=void 0,this.useTianDiTu(t))}},{key:"useXYZ",value:function(t){var e=this,r=t||{},n=r.url,i=(r.maxZoom,la(r,aa));(n?[null==t?void 0:t.url]:!0===(null==t?void 0:t.dark)?["https://webst02.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}","https://webst02.is.autonavi.com/appmaptile?style=8&x={x}&y={y}&z={z}"]:["https://webrd01.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}"]).forEach((function(r){var n,o=new Cesium.UrlTemplateImageryProvider(fa({url:r,maximumLevel:(null==t?void 0:t.maxZoom)||(null===(n=e._options)||void 0===n?void 0:n.maxZoom)||13},i));e._mapLayers.push(e.map.imageryLayers.addImageryProvider(o))}))}},{key:"useWMTS",value:function(t){var e=t.url,r=(t.type,t.format,t.maxZoom),n=(t.minZoom,la(t,sa)),i=new Cesium.WebMapTileServiceImageryProvider(fa({url:e||window.location.origin+"/services/newtianditudomdlg/wmts",tileMatrixSetID:"GetTileMatrix",layer:"defaultLayer",style:"default",format:"image/jpeg",tileMatrixLabels:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18],tilingScheme:new Cesium.GeographicTilingScheme,maximumLevel:r||this._options.maxZoom||18},n)),o=this._mapLayers.push(this.map.imageryLayers.addImageryProvider(i)),a=this;return{setVisible:function(t){a._mapLayers[o].show=t},remove:function(){a.map.imageryLayers.remove(a._mapLayers[o]),a._mapLayers.splice(o,1)}}}},{key:"useWMS",value:function(t){var e,r=t.url,n=t.params,i=t.token,o=n.BBOX.split(",").map((function(t){return Number(t)}));Reflect.deleteProperty(n,"BBOX");var a,s=new Cesium.WebMapServiceImageryProvider({url:r,layers:n.layers,tilingScheme:new Cesium.GeographicTilingScheme({rectangle:(e=Cesium.Rectangle).fromDegrees.apply(e,(a=o,function(t){if(Array.isArray(t))return ua(t)}(a)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(a)||function(t,e){if(t){if("string"==typeof t)return ua(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ua(t,e):void 0}}(a)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()))}),parameters:fa({service:"WMS",layers:"0,1",format:"image/png",transparent:!0,styles:"",version:"1.3.0",access_token:i},n)}),u=this._mapLayers.push(this.map.imageryLayers.addImageryProvider(s)),l=this;return{setVisible:function(t){l._mapLayers[u].show=t},remove:function(){l.map.imageryLayers.remove(l._mapLayers[u]),l._mapLayers.splice(u,1)}}}},{key:"GridPolygon",value:function(t){return this._instance.add(new An(this.map,t),!0)}},{key:"LayerGroupAdmin",value:function(t){return this._instance.add(new zt(this.map,t))}},{key:"AreaMapStyle",value:function(t){return this._instance.add(new Er(this.map,t),!0)}},{key:"ClusterPoint",value:function(t){return this._instance.add(new qr(this.map,t),!0)}},{key:"IconMarker",value:function(t){return this._instance.add(new $r(this.map,t),!0)}},{key:"DomMarker",value:function(t){return this._instance.add(new yn(this.map,t))}},{key:"Text",value:function(t){return this._instance.add(new bn(this.map,t),!0)}},{key:"Line",value:function(t){return this._instance.add(new Pn(this.map,t),!0)}},{key:"Trajectory",value:function(t){return this._instance.add(new Vn(this.map,t),!0)}},{key:"DrawLine",value:function(t){return this._instance.add(new Yn(this.map,t),!0)}},{key:"HeatMap",value:function(t){return this._instance.add(new ri(this.map,t),!0)}},{key:"Kml",value:function(t){return this._instance.add(new gi(this.map,t),!0)}},{key:"TileLayerAdmin",value:function(t){return this._instance.add(new Bo(this.map,t),!0)}},{key:"LoadGeojson",value:function(t){return this._instance.add(new ui(this.map,t),!0)}},{key:"Measure",value:function(t){return this._instance.add(new $o(this.map,t),!0)}},{key:"addOverlay",value:function(t){var e,r,n=t.id?this._domMarker.find((function(e){return e.get("id")===t.id})):null;return n?null===(e=this._domMarker)||void 0===e||e.update(n,t):null===(r=this._domMarker)||void 0===r||r.create(t),this}},{key:"removeOverlay",value:function(t){return t?this._domMarker.removeOverlay(t):this._domMarker.clearOverlays(),this}},{key:"removeInstance",value:function(t){return this._instance.remove(t),this}},{key:"getLonLat",value:function(t){var e=t instanceof MouseEvent?{x:t.pageX,y:t.pageY}:t,r=Cesium.Cartographic.fromCartesian(this.map.camera.pickEllipsoid(new Cesium.Cartesian2(e.x,e.y)));return[Cesium.Math.toDegrees(r.longitude),Cesium.Math.toDegrees(r.latitude),this.map.getHeight()]}},{key:"setCenter",value:function(t,e){return this.map._cameraService.flyTo({destination:Cesium.Cartesian3.fromDegrees(t[0],t[1],this.map.getHeight()),duration:lt(e)}),this}},{key:"setZoom",value:function(t,e){var r=Cesium.Cartographic.fromCartesian(this.map.camera.pickEllipsoid(new Cesium.Cartesian2(this.map.canvas.clientWidth/2,this.map.canvas.clientHeight/2)));return this.map._cameraService.flyTo({destination:Cesium.Cartesian3.fromDegrees(Cesium.Math.toDegrees(r.longitude),Cesium.Math.toDegrees(r.latitude),E(t)),duration:lt(e)}),this}},{key:"zoomTo",value:function(t){return!t.zoom||t.zoom<this.map.getMinZoom()||t.zoom>this.map.getMaxZoom()?this.setCenter(t.point,t.duration):this.map._cameraService.flyTo({destination:Cesium.Cartesian3.fromDegrees(t.point[0],t.point[1],E(t.zoom)),duration:lt(t.duration)}),this}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"flyTo",value:function(t,e){return this.map._cameraService.mapFlyTo(t,e),this}},{key:"getEntityCenterCoordinate",value:function(t){return A(Array.isArray(t)?t.map((function(t){return t.getGeometry()})):t.getGeometry())}},{key:"getCoordinatesCenter",value:function(t){return I(t)}},{key:"getCoordinateFromFeature",value:function(t){if(Array.isArray(t)){var e=[];return t.forEach((function(t){e.push(A(t))})),e}return A(t)}},{key:"hasFeatureInView",value:function(t,e){var r=Cesium.JulianDate.now(),n=this.map.camera.computeViewRectangle();if(!e&&!Array.isArray(t))return Cesium.Rectangle.contains(n,Cesium.Cartographic.fromCartesian(t.position.getValue(r)));e&&(Array.isArray(t)?t:[t]).forEach((function(t){e(t,Cesium.Rectangle.contains(n,Cesium.Cartographic.fromCartesian(t.position.getValue(r))))}))}},{key:"clear",value:function(){return this.clearLayers(),this}},{key:"resize",value:function(){return this.map.scene.camera.setView({destination:this.map.scene.camera.positionWC,orientation:{heading:this.map.scene.camera.heading,pitch:this.map.scene.camera.pitch}}),this.map.scene.requestRender(),this}},{key:"render",value:function(){return this.map.scene.requestRender(),this}},{key:"on",value:function(t,e){return this.map._cameraService.on(li(t),e),this}},{key:"off",value:function(t,e){return this.map._cameraService.off(e,li(t)),this}},{key:"zoomChange",value:function(t){return this.map._cameraService.onZoom(t),this}},{key:"removeZoomChange",value:function(t){return this.map._cameraService.offZoom(t),this}},{key:"dispose",value:function(){var t;this._dispose||(this._map._cameraService.dispose(),this._instance.dispose(),this.clear(),null===(t=this._domMarker)||void 0===t||t.dispose(),this._map.destroy(),this._map=null)}},{key:"removeMap",value:function(){this.removeMapLayer(),console.warn("函数 => removeMap : 将在下一版本移除，请使用removeMapLayer！")}},{key:"unon",value:function(t){console.warn("函数 => unon : 将在下一版本移除，请使用off！")}},{key:"removeInteraction",value:function(t){}},{key:"addInteraction",value:function(t){}},{key:"searchInteractions",value:function(t){}},{key:"searchInteraction",value:function(t){}},{key:"clearSelection",value:function(){}}],r&&pa(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(kt),va=r(8633),_a={};_a.styleTagTransform=_(),_a.setAttributes=d(),_a.insert=h().bind(null,"head"),_a.domAPI=f(),_a.insertStyleElement=m(),l()(va.Z,_a),va.Z&&va.Z.locals&&va.Z.locals;var ba="bimmap-marker_text",wa="bimmap-marker_img",Sa="bimmap-marker_badge";function Oa(t){if(!t)return[0,0];if(Array.isArray(t)){var e=L.latLngBounds([]);return t.forEach((function(t){e.extend(Oa(t))})),e.getCenter()}return t instanceof L.Point?[t.x,t.y]:t instanceof L.Marker||t instanceof L.CircleMarker?t.getLatLng():t instanceof L.Polygon||t instanceof L.Polyline?t.getCenter():t instanceof L.FeatureGroup||t instanceof L.Circle?t.getBounds().getCenter():t.getLatLng()}function xa(t){return t?L.toLonLat(Oa(t)):[0,0]}function Ca(t){var e=document.createElement("span");return e.innerText=t.label,L.marker(L.fromLonLat(t.point),{item:t,label:t.label,icon:L.divIcon({html:e,className:ba,iconSize:null,iconAnchor:null})})}function Ea(t,e,r){var n,i,o,a,s,u,l,c;return L.divIcon({iconAnchor:null===(n=t.icon)||void 0===n?void 0:n.iconAnchor,iconSize:null===(i=t.icon)||void 0===i?void 0:i.iconSize,html:(null!==(o=t.icon)&&void 0!==o&&o._diffuses?null===(a=t.icon)||void 0===a?void 0:a._diffuses.map((function(t){return'<div class="'.concat(t.className.join(" "),'"></div>')})).join(""):"")+(null!==(s=t.icon)&&void 0!==s&&s.iconUrl?'<img src="'.concat(t.icon.iconUrl,"\" style='").concat(Pa(null===(u=t.css)||void 0===u?void 0:u.cssText,["transform","width","height","opacity"]),"' />"):"")+(!1!==r&&t.tip&&t.tip.content?"<span style='".concat(Pa(null===(l=t.css)||void 0===l?void 0:l.cssText),"' >").concat(t.tip.content,"</span>"):""),className:[wa,ba,e||"",(null===(c=t.icon)||void 0===c?void 0:c.className)||""].join(" ")})}function Pa(t,e,r){return(t||"").split(";").map((function(t){return t.split(":").map((function(t,e){return 0===e?t.replace(/^[\s]*([^\s]+)[\s]*$/g,"$1"):t}))})).filter((function(t){return(e||["color","font","text-","top","left","border","padding"]).some((function(e){return!0===r?t[0]===e:t[0].indexOf(e)>=0}))})).map((function(t){return t.join(":")})).join(";")+";"}var ka=["path"],Ta=["path"];function ja(t,e){if(null==t)return{};var r,n,i=function(t,e){if(null==t)return{};var r,n,i={},o=Object.keys(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||(i[r]=t[r]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function Ra(t){return Ra="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ra(t)}function La(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Ia(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ma(n.key),n)}}function Ma(t){var e=function(t,e){if("object"!=Ra(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Ra(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ra(e)?e:String(e)}function Aa(){return Aa="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Na(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},Aa.apply(this,arguments)}function Da(t,e){return Da=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Da(t,e)}function Na(t){return Na=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Na(t)}var Fa=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Da(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Na(n);if(i){var r=Na(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Ra(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(t=o.call.apply(o,[this].concat(r)))._layers=[],t._map=void 0,t}return e=a,r=[{key:"layers",get:function(){return this._layers}},{key:"addLayer",value:function(t){var e=this;return Array.isArray(t)?t.forEach((function(t){e.addLayer(t)})):this._layers.includes(t)||(this._layers.push(t),this._map.addLayer(t)),this}},{key:"hasLayer",value:function(t){return this._layers.includes(t)}},{key:"removeLayer",value:function(t){var e=this;if(!t)return this._layers.forEach((function(t){return t.remove()})),void(this._layers.length=0);if(Array.isArray(t))t.forEach((function(t){e.removeLayer(t)}));else{var r=this.findIndexLayer((function(e){return e===t}));if(r<0)return;this._layers.splice(r,1),t.remove()}}},{key:"clearLayers",value:function(){return this._layers.forEach((function(t){return t.remove()})),this._layers.length=0,this}},{key:"getLayers",value:function(t,e){var r=[];if("string"==typeof t)this._layers.forEach((function(n){var i;(null===(i=n.options)||void 0===i?void 0:i[t])===e&&r.push(n)}));else{var n=Object.keys(t);this._layers.forEach((function(e){n.some((function(r){var n;return(null===(n=e.options)||void 0===n?void 0:n[r])===t[r]}))&&r.push(e)}))}return r}},{key:"searchLayers",value:function(t){var e=this,r=[];return Array.isArray(t)?t.forEach((function(t){var n,i=e.searchLayers(t);r.push.apply(r,function(t){if(Array.isArray(t))return La(t)}(n=i)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||function(t,e){if(t){if("string"==typeof t)return La(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?La(t,e):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())})):this._layers.forEach((function(e){var n;(null===(n=e.options)||void 0===n?void 0:n.name)===t&&r.push(e)})),r}},{key:"filterLayer",value:function(t){for(var e=[],r=0,n=this._layers.length;r<n;r++)!0===t(this._layers[r],r)&&e.push(this._layers[r]);return e}},{key:"findLayer",value:function(t){for(var e=0,r=this._layers.length;e<r;e++)if(!0===t(this._layers[e],e))return this._layers[e]}},{key:"findIndexLayer",value:function(t){for(var e=0,r=this._layers.length;e<r;e++)if(!0===t(this._layers[e],e))return e;return-1}},{key:"forEachLayer",value:function(t){for(var e=0,r=this._layers.length;e<r;e++)t(this._layers[e],e);return this}},{key:"filterVisibleLayer",value:function(t,e){var r=this,n=!1!==e;return this._layers.forEach((function(e){!0===t(e.get("item"),e)&&(n?r._map.hasLayer(e)||r._map.addLayer(e):r._map.hasLayer(e)&&r._map.removeLayer(e))})),this}},{key:"filterRemoveLayer",value:function(t){for(var e=0,r=this._layers.length;e<r;e++)t(this._layers[e].get("item"),this._layers[e])&&(this._layers.splice(e,1),this._map.removeLayer(this._layers[e]),e--);return this}},{key:"visibleLayers",value:function(t,e){var r=this;if(Array.isArray(t))this._layers.filter((function(e){return t.includes(e.get("name"))})).forEach((function(t){e?r._map.hasLayer(t)||r._map.addLayer(t):r._map.hasLayer(t)&&r._map.removeLayer(t)}));else{var n=this.findLayer((function(e){return e.get("name")===t}));n&&(e?this._map.hasLayer(n)||this._map.addLayer(n):this._map.hasLayer(n)&&this._map.removeLayer(n))}return this}},{key:"zoomByLayers",value:function(t,e){if(Array.isArray(t)){var r=this._layers.filter((function(e){return t.includes(e.get("name"))}));r.length>0&&this._map.flyToBounds(r[r.length-1].getBounds(),{duration:null==e?void 0:e.duration,padding:null==e?void 0:e.padding})}else{var n=this.findLayer((function(e){return e.get("name")===t}));n&&this._map.flyToBounds(n.getBounds(),{duration:null==e?void 0:e.duration,padding:null==e?void 0:e.padding})}return this}},{key:"dispose",value:function(){Aa(Na(a.prototype),"dispose",this).call(this),this.clearLayers()}}],r&&Ia(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t);const za=Fa;function Ga(t){return Ga="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ga(t)}var Ba=["maxZoom","padding","duration"];function Va(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Ua(t){return function(t){if(Array.isArray(t))return qa(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return qa(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?qa(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function qa(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Wa(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Xa(n.key),n)}}function Xa(t){var e=function(t,e){if("object"!=Ga(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Ga(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ga(e)?e:String(e)}function Za(){return Za="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ya(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},Za.apply(this,arguments)}function Ha(t,e){return Ha=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ha(t,e)}function Ya(t){return Ya=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ya(t)}var Ka=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ha(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ya(n);if(i){var r=Ya(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Ga(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this))._options=void 0,r._layerGroup=new Map,r._map=void 0,r._map=t,r._options=e,null!=e&&e.group&&e.group.forEach((function(t){r.addLayerGroup(t.name,t.layers)})),r}return e=a,r=[{key:"map",get:function(){return this._map}},{key:"addLayerGroup",value:function(t,e){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!1===(!(arguments.length>2&&void 0!==arguments[2])||arguments[2])&&this.removeLayerGroup(t),this._layerGroup.has(t)){var n=this._layerGroup.get(t);n&&(Array.isArray(e)?n.push.apply(n,Ua(e)):n.push(e))}else this._layerGroup.set(t,Array.isArray(e)?Ua(e):[e]);return!0===r&&this.toMap(t),this}},{key:"addLayerGroups",value:function(t){var e=this;t.forEach((function(t){e.addLayerGroup(t.groupName,t.layer,t.isAppend,t.isToMap)}))}},{key:"removeLayerGroup",value:function(t){var e=this;return Array.isArray(t)?t.forEach((function(t){e.removeLayerGroup(t)})):this._layerGroup.has(t)&&this._layerGroup.delete(t),this}},{key:"visibleLayerGroup",value:function(t,e){var r=Array.isArray(t)?t:[t],n=this._layerGroup,i=[],o=this.map;return r.forEach((function(t){if(n.has(t)){var r=n.get(t);if(r)for(var a=0;a<r.length;a++){var s=r[a];e?(o.hasLayer(s)||s.addTo(o),i.push(s)):o.hasLayer(s)&&s.removeFrom(o)}}})),this}},{key:"getLayerExtent",value:function(t){if(Array.isArray(t)){var e=L.latLngBounds([]);return t.forEach((function(t){e.extend(t.getBounds())})),e}return t.getBounds()}},{key:"toMap",value:function(t){var e=this,r=Array.isArray(t)?t:[t],n=this._layerGroup,i=[];return r.forEach((function(t){if(n.has(t)){var e=n.get(t);e&&i.push.apply(i,Ua(e))}})),i.length>0&&i.forEach((function(t){var r;t.values_.map||null===(r=e.map)||void 0===r||r.addLayer(t)})),this}},{key:"zoomToCenter",value:function(t,e,r){if(this.map){var n=this.getLayerExtent(t),i=this._map;if(i)if(e&&e>=i.getMinZoom()&&e<=i.getMaxZoom())i.setZoom(e),i.setView(n.getCenter());else{var o=r||{},a=o.maxZoom,s=o.padding,u=void 0===s?[0,0]:s,l=o.duration,c=function(t,e){if(null==t)return{};var r,n,i=function(t,e){if(null==t)return{};var r,n,i={},o=Object.keys(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||(i[r]=t[r]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}(o,Ba);i.fitBounds(n,function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Va(Object(r),!0).forEach((function(e){var n,i,o;n=t,i=e,o=r[e],(i=Xa(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Va(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({duration:lt(l,!0,1),padding:u,maxZoom:a||i.getZoom()},c||{}))}}}},{key:"groupToZoomToCenter",value:function(t,e,r){if(this._layerGroup.has(t)){var n=this._layerGroup.get(t);n&&this.zoomToCenter(n,e,r)}}},{key:"dispose",value:function(){Za(Ya(a.prototype),"dispose",this).call(this),this._layerGroup.clear()}}],r&&Wa(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t);const Ja=Ka;function $a(t){return $a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$a(t)}function Qa(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ts(n.key),n)}}function ts(t){var e=function(t,e){if("object"!=$a(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=$a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==$a(e)?e:String(e)}function es(){return es="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ns(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},es.apply(this,arguments)}function rs(t,e){return rs=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},rs(t,e)}function ns(t){return ns=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ns(t)}var is=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&rs(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ns(n);if(i){var r=ns(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===$a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(t=o.call.apply(o,[this].concat(r)))._bounceMap=new Map,t._flickerMap=new Map,t._diffuseMap=new Map,t}return e=a,r=[{key:"_createStyle",value:function(t,e,r){document.getElementById(t)&&document.removeChild(document.getElementById(t));var n=document.createElement("style");n.setAttribute("id",t);var i=t.replace(/-/g,"");return n.innerHTML=".".concat(t," {animation: ").concat(i," ").concat(e.duration,"s 0s infinite forwards;}").concat(r?".".concat(t,":hover {animation-play-state: paused;}"):"","@keyframes ").concat(i," {0% {top: 0px;}50% {top: ").concat(e._options.offset,"px;}100% {top: 0px;}}"),document.head.appendChild(n),n}},{key:"loadBounce",value:function(t,e,r){if(!this._bounceMap.has(t)){var n,i=!1!==(null==r?void 0:r.hoverStop),o=(null===(n=e.icon)||void 0===n?void 0:n.iconAnchor)||[0,0],a=new Xt((function(e){var r=t.getIcon();r&&(r.options.iconAnchor=[o[0],o[1]+e],t.setIcon(r))}),r,(function(){return!i||!0!==t.get("_hover",!0)})),s="bimsdk-bounce_".concat(tt().replace(/-/g,""));return this._bounceMap.set(t,this._createStyle(s,a,i)),a.dispose(),s}}},{key:"removeBounce",value:function(t){this._bounceMap.has(t)&&(document.head.removeChild(this._bounceMap.get(t)),this._bounceMap.delete(t))}},{key:"_createFlickerStyle",value:function(t,e,r){document.getElementById(t)&&document.removeChild(document.getElementById(t));var n=document.createElement("style");n.setAttribute("id",t);var i=t.replace(/-/g,"");return n.innerHTML=".".concat(t," img {animation: ").concat(i," ").concat(e.duration,"s 0s infinite forwards;}").concat(r?".".concat(t,":hover {animation-play-state: paused;}"):"","@keyframes ").concat(i," {0% {opacity: 0;}100% {opacity: ").concat(e._options.max,";}}"),document.head.appendChild(n),n}},{key:"loadFlicker",value:function(t,e){if(!this._flickerMap.has(t)){var r=!1!==(null==e?void 0:e.hoverStop),n=new ae((function(t){}),e,(function(){return!r||!0!==t.get("_hover",!0)})),i="bimsdk-flicker_".concat(tt().replace(/-/g,""));return this._flickerMap.set(t,this._createFlickerStyle(i,n,r)),n.dispose(),i}}},{key:"removeFlicker",value:function(t){this._flickerMap.has(t)&&(document.head.removeChild(this._flickerMap.get(t)),this._flickerMap.delete(t))}},{key:"_createDiffuseStyle",value:function(t,e,r){var n="ripple"===r.type;document.getElementById(t)&&document.removeChild(document.getElementById(t));var i=document.createElement("style");i.setAttribute("id",t);var o=t.replace(/-/g,"");return i.innerHTML=".".concat(t," .").concat(t,"_child {position:absolute;transform: translate(-50%, -50%);border-radius:50%;left: 50%;top: 50%;border: solid ").concat(r.width,"px ").concat(r.color,";").concat(n?"background-color:".concat(r.fillColor,";"):"","}").concat(e.map((function(t){return".".concat(t.className[1],"{animation: ").concat(o," ").concat(r.duration,"s ").concat(t.delay,"s infinite forwards;}")})).join(""),"@keyframes ").concat(o," {0% {width: 0;height: 0;opacity:1;}100% {width: ").concat(r.radius,"px;height: ").concat(r.radius,"px;opacity: 0;}}"),document.head.appendChild(i),i}},{key:"loadDiffuse",value:function(t,e){if(!this._diffuseMap.has(t)){var r="bimsdk-diffuse_".concat(tt().replace(/-/g,"")),n=e.duration/e.count,i=Array.from({length:e.count}).map((function(t,e){return{className:["".concat(r,"_child"),"".concat(r,"_").concat(e)],delay:n*e}}));return Object.defineProperty(t,"_diffuse_elements",{value:i}),this._diffuseMap.set(t,this._createDiffuseStyle(r,i,e)),{className:r,div:i}}}},{key:"removeDiffuse",value:function(t){this._diffuseMap.has(t)&&(document.head.removeChild(this._diffuseMap.get(t)),this._diffuseMap.delete(t))}},{key:"dispose",value:function(){es(ns(a.prototype),"dispose",this).call(this),this._bounceMap.forEach((function(t){return document.head.removeChild(t)})),this._bounceMap.clear(),this._flickerMap.forEach((function(t){return document.head.removeChild(t)})),this._flickerMap.clear(),this._diffuseMap.forEach((function(t){return document.head.removeChild(t)})),this._diffuseMap.clear()}}],r&&Qa(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t),os=new is;function as(t){return as="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},as(t)}var ss=["_rules"];function us(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function ls(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,cs(n.key),n)}}function cs(t){var e=function(t,e){if("object"!=as(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=as(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==as(e)?e:String(e)}function fs(){return fs="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=hs(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},fs.apply(this,arguments)}function ps(t,e){return ps=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ps(t,e)}function hs(t){return hs=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},hs(t)}var ys=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ps(t,e)}(s,e);var r,n,i,o,a=(i=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=hs(i);if(o){var r=hs(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===as(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(e=a.call(this))._cacheStyle=new Map,e._cacheRuleStyle=new Map,e._excludeCacheEventNames=[],e._defaultOptions=null,e._cacheDefaultStyleOptions=null,e._options={},e.currentDefaultEventName="default",t&&nt(e._options,t),e}return r=s,n=[{key:"options",get:function(){return this._options}},{key:"_getStyleOptions",value:function(t){var e,r,n,i,o,a,s,u=document.createElement("div").style;if(t.fill&&(u.backgroundColor=t.fill),null!==(e=t.background)&&void 0!==e&&e.fill&&(u.backgroundColor=null===(n=t.background)||void 0===n?void 0:n.fill),null!==(r=t.background)&&void 0!==r&&r.url&&(u.backgroundImage="url('".concat(null===(i=t.background)||void 0===i?void 0:i.url,"')")),t.strokeColor&&(!t.strokeWidth||t.strokeWidth&&t.strokeWidth>0)&&(u.borderColor=t.strokeColor||"rgba(255,255,255,0.6)",u.borderWidth="".concat(t.strokeWidth||1,"px"),u.borderStyle=t.lineDash?"dotted":"solid"),t.radius&&(u.borderRadius="".concat(t.radius,"px"),null!==(o=t.background)&&void 0!==o&&o.strokeWidth&&(u.borderColor=(null===(a=t.background)||void 0===a?void 0:a.strokeColor)||"rgba(255, 255, 255, 1)",u.borderWidth="".concat((null===(s=t.background)||void 0===s?void 0:s.strokeWidth)||2,"px")),u.backgroundColor||(u.backgroundColor="rgba(0, 0, 255, 0.5)")),t.scale){var l=st(t.scale);u.transform="scale(".concat(l[0],",").concat(l[1],") translate(").concat(-50,"%, -50%)")}return t.offset&&t.offset.length>1&&(u.left="calc(50% + ".concat(t.offset[0],"px)"),u.top="calc(50% + ".concat(t.offset[1],"px)")),t.imgSize&&t.imgSize.length>1&&(u.width="".concat(t.imgSize[0],"px"),u.height="".concat(t.imgSize[1],"px")),t.padding&&(u.padding=t.padding.map((function(t){return"".concat(t,"px")})).join(" ")),Reflect.has(t,"opacity")&&(u.opacity="".concat(t.opacity)),t.text&&(u.font=t.fontStyle||"15px Microsoft YaHei",u.color=t.fontColor||"#333",(t.strokeWidth||t.strokeColor)&&(u.webkitTextStrokeColor=t.strokeColor,u.webkitTextStrokeWidth="".concat(t.strokeWidth||1,"px"))),t._zIndex&&(u.zIndex="".concat(t._zIndex)),u}},{key:"_getConvertStyles",value:function(t){var e={kind:"bimmap",css:this._getStyleOptions(t)};if(t.fill||t.strokeColor||t.strokeWidth){var r,n="dash"===t.lineType;e.path={kind:"leaflet",fill:!!t.fill,fillColor:t.fill||"rgba(0,0,0,0.2)",stroke:!!t.strokeWidth,weight:t.strokeWidth||1,color:t.strokeColor||"rgba(14,78,142,0.6)",radius:t.radius,dashArray:n?t.lineDash?t.lineDash:[16,16]:[],lineCap:n?"butt":"round",lineJoin:n?"bevel":"round"},n&&null!==(r=t.background)&&void 0!==r&&r.fill&&Object.defineProperty(e,"_lineDash",{value:t.background.fill,configurable:!1})}if((t.iconUrl||t.img)&&(e.icon={iconUrl:t.iconUrl||(t.img instanceof HTMLImageElement?t.img.src:t.img?t.img.toDataURL():void 0)}),e.icon){var i=st(t.scale);e.icon.iconSize=t.imgSize?[t.imgSize[0]*i[0],t.imgSize[1]*i[1]]:[12*i[0],12*i[1]],e.icon.iconAnchor=t.imgOffset||[e.icon.iconSize[0]/2,e.icon.iconSize[1]]}return(t.text||t.html)&&(e.tip={content:at(t.text,t.html),offset:t.offset||[0,0],direction:"bottom",permanent:!0},!e.icon||e.icon.tooltipAnchor||"top"!==e.tip.direction&&"bottom"!==e.tip.direction||(e.icon.tooltipAnchor=[e.icon.iconSize[0]/2,0])),t._zIndex&&(e.zIndex=t._zIndex),t._bounce&&Object.defineProperty(e,"_bounce",{value:t._bounce,configurable:!1}),t._opacity&&(t.opacity&&(t._opacity.max||(t._opacity.max=t.opacity),e.css.opacity=null),Object.defineProperty(e,"_opacity",{value:t._opacity,configurable:!1})),t._diffuse&&(e.icon||(e.icon={iconUrl:""}),Object.defineProperty(e,"_diffuse",{value:Qt.getDefaultOptions(t._diffuse),configurable:!1})),e}},{key:"_getOptionsToStyle",value:function(t,e){var r=this._getConvertStyles(e);return Object.defineProperty(r,"_options",{value:e,configurable:!1}),Object.defineProperty(r,"_eventName",{value:t,configurable:!1}),r}},{key:"_styleIntercept",value:function(t,e){if(e&&Reflect.has(e,"_lineDash")?t.get("_lineDash",!0)||t.set("_lineDash",Reflect.get(e,"_lineDash"),!0):t.get("_lineDash",!0)&&t.unset("_lineDash",!0),t instanceof L.Marker){if(e&&Reflect.has(e,"_bounce")){if(!t.get("_bounce",!0)){var r=os.loadBounce(t,e,Reflect.get(e,"_bounce"));e.icon&&(e.icon.className=r),t.set("_bounce",!0,!0)}}else t.get("_bounce",!0)&&(t.unset("_bounce",!0),os.removeBounce(t));if(e&&Reflect.has(e,"_opacity")){if(!t.get("_opacity",!0)){var n=os.loadFlicker(t,Reflect.get(e,"_opacity"));e.icon&&(e.icon.className=n),t.set("_opacity",!0,!0)}}else t.get("_opacity",!0)&&(t.unset("_opacity",!0),os.removeFlicker(t));if(e&&Reflect.has(e,"_diffuse")){if(!t.get("_diffuse",!0)){var i=os.loadDiffuse(t,Reflect.get(e,"_diffuse")),o=i.className,a=i.div;e.icon&&(e.icon._diffuses=a,e.icon.className=o),t.set("_diffuse",!0,!0)}}else t.get("_diffuse",!0)&&(t.unset("_diffuse",!0),os.removeDiffuse(t))}}},{key:"_convertStyles",value:function(t){var e=this;if(!t)return{};var r=ot(t),n=(r._rules,function(t,e){if(null==t)return{};var r,n,i=function(t,e){if(null==t)return{};var r,n,i={},o=Object.keys(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||(i[r]=t[r]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}(r,ss)),i={};return i[this.currentDefaultEventName]=this._getOptionsToStyle(this.currentDefaultEventName,n),Object.keys(n).forEach((function(t){t.startsWith("_")&&t.endsWith("Style")&&(i[t]=e._getOptionsToStyle(t,it(n[t],n)))})),i}},{key:"_getFeatureDefaultStyle",value:function(t){if(this._cacheStyle.has(t)){var e=this._cacheStyle.get(t)[this.currentDefaultEventName];if(e&&Reflect.has(e,"_options"))return Reflect.get(e,"_options")}}},{key:"_getFeatureStyle",value:function(t,e,r){var n;if(this._cacheStyle.has(t)?n=this._cacheStyle.get(t)[e]:this._cacheStyle.set(t,{}),n){if(r&&!1!==(null==r?void 0:r.isMergeStyle))if(e===this.currentDefaultEventName)n=this._getOptionsToStyle(e,this.getMergeStyleOptions(t,r));else{var i=this._getFeatureDefaultStyle(t),o=i?this.getMergeStyleOptions(t,r,i):this.getMergeStyleOptions(t,r);n=this._getOptionsToStyle(e,o[e]?this.getMergeStyleOptions(t,o[e],o):o)}}else{if(e===this.currentDefaultEventName)n=this._getOptionsToStyle(e,this.getMergeStyleOptions(t,r));else{var a=this._getFeatureDefaultStyle(t),s=a?this.getMergeStyleOptions(t,r,a):this.getMergeStyleOptions(t,r);n=this._getOptionsToStyle(e,s[e]?this.getMergeStyleOptions(t,s[e],s):s)}e!==this.currentDefaultEventName&&this._excludeCacheEventNames.includes(e)||(this._cacheStyle.get(t)[e]=n)}return n}},{key:"getMergeStyleOptions",value:function(e,r,n){var i=ot(n||this._defaultOptions);if(i._rules){var o=xe(e,i._rules);o&&(i=nt(i,o,t))}return r?nt(i,r):i}},{key:"addExcludeCacheEventName",value:function(t){var e,r;(e=this._excludeCacheEventNames).push.apply(e,function(t){if(Array.isArray(t))return us(t)}(r=Array.isArray(t)?t:[t])||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(r)||function(t,e){if(t){if("string"==typeof t)return us(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?us(t,e):void 0}}(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}},{key:"removeExcludeCacheEventName",value:function(t){var e=Array.isArray(t)?t:[t];this._excludeCacheEventNames=this._excludeCacheEventNames.filter((function(t){return!e.includes(t)}))}},{key:"setOptions",value:function(t){t&&nt(this._options,t)}},{key:"setDefaultOptions",value:function(t){return this._defaultOptions=t,this._cacheDefaultStyleOptions=this._convertStyles(t),this}},{key:"removeStyle",value:function(t){this._cacheStyle.has(t)&&this._cacheStyle.delete(t)}},{key:"removeFeatureStyle",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";if(this._cacheStyle.has(t)){var r=this._cacheStyle.get(t);r[e]||Reflect.deleteProperty(r,e)}}},{key:"addStyle",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",r=arguments.length>2?arguments[2]:void 0;return this._getFeatureStyle(t,e,r)}},{key:"getStyle",value:function(t){var e,r,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",o=arguments.length>2?arguments[2]:void 0;if(!o&&("_hoverStyle"===i||"_clickStyle"===i)){var a=t.getStyle();a&&Reflect.get(a,"_eventName")!==this.currentDefaultEventName&&Reflect.has(a,"_options")&&(e={},r=i,n=Reflect.get(a,"_options")[i],(r=cs(r))in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,o=e)}var s=this._getFeatureStyle(t,i,o);if(s||this._cacheDefaultStyleOptions){var u=s||this._cacheDefaultStyleOptions[i];return this._styleIntercept(t,u),u}}},{key:"dispose",value:function(){fs(hs(s.prototype),"dispose",this).call(this),this._cacheStyle.clear(),this._defaultOptions=null,this._cacheDefaultStyleOptions=null}}],n&&ls(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),s}(_t);function ds(t){return ds="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ds(t)}function gs(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ms(n.key),n)}}function ms(t){var e=function(t,e){if("object"!=ds(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=ds(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ds(e)?e:String(e)}function vs(){return vs="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=bs(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},vs.apply(this,arguments)}function _s(t,e){return _s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},_s(t,e)}function bs(t){return bs=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},bs(t)}var ws=new(function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_s(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=bs(n);if(i){var r=bs(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===ds(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(t=o.call.apply(o,[this].concat(r)))._map=void 0,t._appHandler=new nr,t._events=[],t._registeredRoot=new Map,t._eventsZoom=[],t._zoomCallback=null,t}return e=a,r=[{key:"_useEvents",get:function(){var t=this;return function(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;return t._events.filter((function(i){return i.type===e&&(!r||t._appHandler.judgeOpl(e,i.params))&&(!n||n===i.layer)}))}}},{key:"map",get:function(){if(!this._map)throw Error("未注册 map 实例，无法注册地图事件！");return this._map}},{key:"_registered",get:function(){var t=this;return function(e){return t._registeredRoot.has(e)||t._registeredRoot.set(e,new Map),t._registeredRoot.get(e)}}},{key:"setMap",value:function(t){this._map=t}},{key:"_registryEvent",value:function(t,e){var r=this;if(!this._registered(e).has(t)){var n=function(n){r._useEvents(t,!0,e).forEach((function(t){return t.fun(n)}))};this._registered(e).set(t,n),e.addEventListener(t,n)}}},{key:"on",value:function(t,e,r,n,i){return this._registryEvent(t,i||this.map),this._events.push({type:t,fun:e,key:r,params:n,layer:i||this.map}),this}},{key:"off",value:function(t,e,r){for(var n=r||this.map,i="function"==typeof t,o=(e?this._useEvents(e,!1,n):this._events).filter((function(e){return i?e.fun===t:e.key===t})),a=0;a<this._events.length;a++)if(o.includes(this._events[a])){var s=this._events[a].type,u=this._events[a].layer;this._events.splice(a,1),0===this._useEvents(s,!1,n).length&&this._registered(u).has(s)&&(this.map.removeEventListener(s,this._registered(u).get(s)),this._registered(u).delete(s)),a--}return this}},{key:"onZoom",value:function(t,e){var r=this;return this._zoomCallback||(this._zoomCallback=function(t){r._eventsZoom.filter((function(t){return r._appHandler.judgeOpl("zoomend",t.params)})).forEach((function(e){return e.fun(r.map.getZoom(),t)}))},this.map.addEventListener("zoomend",this._zoomCallback)),this._eventsZoom.push({fun:t,params:e}),this}},{key:"offZoom",value:function(t){if(t){var e=this._eventsZoom.findIndex((function(e){return e.fun===t}));e>=0&&this._eventsZoom.splice(e,1)}else this._eventsZoom.length=0;return 0===this._eventsZoom.length&&(this.map.removeEventListener("zoomend",this._zoomCallback),this._zoomCallback=null),this}},{key:"clear",value:function(){this._events.length=0,this._registeredRoot.forEach((function(t,e){t.forEach((function(t,r){e.removeEventListener(r,t)}))})),this._registeredRoot.clear(),this.offZoom()}},{key:"dispose",value:function(){vs(bs(a.prototype),"dispose",this).call(this),this.clear(),this._map=null}}],r&&gs(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t));function Ss(t){return Ss="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ss(t)}function Os(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function xs(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Os(Object(r),!0).forEach((function(e){var n,i,o;n=t,i=e,o=r[e],(i=Es(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Os(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Cs(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Es(n.key),n)}}function Es(t){var e=function(t,e){if("object"!=Ss(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Ss(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ss(e)?e:String(e)}function Ps(){return Ps="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=js(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},Ps.apply(this,arguments)}function ks(t,e){return ks=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ks(t,e)}function Ts(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function js(t){return js=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},js(t)}var Rs=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ks(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=js(n);if(i){var r=js(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Ss(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Ts(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,e))._zoomChangeHandler=null,r._zoomMoveChangeHandler=null,r.parent=void 0,r._selected=null,r._hoverSelected=null,r._events=[],r._layerClick=r.layerClick.bind(Ts(r)),r._layerMove=r.layerMove.bind(Ts(r)),r._layerOut=r.layerOut.bind(Ts(r)),r._initEvent={click:!1,hover:!1},r.parent=t,r.setDefaultOptions(e),r._initStyleEvent(e),r}return e=a,r=[{key:"map",get:function(){return this.parent.map}},{key:"selected",get:function(){return this._selected}},{key:"hoverSelected",get:function(){return this._hoverSelected}},{key:"hoverEvent",get:function(){return this._events.filter((function(t){return"hover"===t.type}))}},{key:"clickEvent",get:function(){return this._events.filter((function(t){return"click"===t.type}))}},{key:"_initStyleEvent",value:function(t){var e=this;t._clickStyle&&(this._onDefaultEvent("click"),this.on({type:"click",change:function(t,r,n){r&&r!==t&&(r.setStyle(r.get("__oldStyle",!0)),r.unset("__oldStyle",!0)),t&&r!==t&&(t.has("__oldStyle",!0)||t.set("__oldStyle",t.getStyle(),!0),t.setStyle(e.getStyle(t,"_clickStyle")))}})),t._hoverStyle&&(this._onDefaultEvent("hover"),this.on({type:"hover",change:function(t,r,n){r&&r!==t&&(e.parent.options._clickStyle&&e._selected===r||(r.setStyle(r.get("__oldStyle",!0)),r.unset("__oldStyle",!0))),t&&r!==t&&e._selected!==t&&(t.has("__oldStyle",!0)||t.set("__oldStyle",t.getStyle(),!0),t.setStyle(e.getStyle(t,"_hoverStyle")))}}))}},{key:"_onDefaultEvent",value:function(t){"click"!==t||this._initEvent.click?"hover"!==t||this._initEvent.hover||(this._initEvent.hover=!0,ws.on("mousemove",this._layerMove,void 0,void 0,this.parent.layer),ws.on("mouseout",this._layerOut,void 0,void 0,this.parent.layer)):(this._initEvent.click=!0,ws.on("click",this._layerClick),ws.on("click",this._layerClick,void 0,void 0,this.parent.layer))}},{key:"__zoomChange",value:function(t,e){if(Array.isArray(t)?e>=t[0]&&e<=t[1]:e>=t){var r=this.map.getBounds();this.parent.forEach((function(t){t instanceof L.Marker&&r.contains(t.getLatLng())?!1===t.get("_visibleText",!0)&&(t.unset("_visibleText",!0),t.setStyle(t.getStyle())):!1!==t.get("_visibleText",!0)&&(t.set("_visibleText",!1,!0),t.setStyle(t.getStyle()))}))}else this.parent.forEach((function(t){t instanceof L.Marker&&!1!==t.get("_visibleText",!0)&&(t.set("_visibleText",!1,!0),t.setStyle(t.getStyle()))}))}},{key:"_zoomChangeShowLabel",value:function(t,e){var r=this;this._zoomChangeHandler&&(ws.off(this._zoomMoveChangeHandler,"moveend"),ws.offZoom(this._zoomChangeHandler),this._zoomChangeHandler=null,this._zoomMoveChangeHandler=null),t&&(this._zoomChangeHandler=this.__zoomChange.bind(this,t),this._zoomMoveChangeHandler=function(){r.__zoomChange(t,r.map.getZoom())},ws.on("moveend",this._zoomMoveChangeHandler),ws.onZoom(this._zoomChangeHandler),!0===e&&this.__zoomChange(t,this.map.getZoom()))}},{key:"layerClick",value:function(t){var e=this;L.DomEvent.stopPropagation(t);var r=this.parent,n=t.layer;this.clickEvent.forEach((function(i){return i.change.call(r.layer,n,e._selected,t)})),this._selected=n}},{key:"layerMove",value:function(t){var e=this;L.DomEvent.stopPropagation(t),t.layer!==this._hoverSelected&&(this.hoverEvent.forEach((function(r){return r.change.call(e.parent.layer,t.layer,e._hoverSelected,t)})),this._hoverSelected=t.layer)}},{key:"layerOut",value:function(t){var e=this;L.DomEvent.stopPropagation(t),null!==this._hoverSelected&&(this.hoverEvent.forEach((function(r){return r.change.call(e.parent.layer,null,e._hoverSelected,t)})),this._hoverSelected=null)}},{key:"setSelected",value:function(t,e){return t?this.parent.hasFeature(t)&&(e&&(this.map.stop(),this.map.flyTo(Oa(t),null==e?void 0:e.zoom,xs(xs({},e),{},{duration:lt(null==e?void 0:e.duration,!0,1)}))),this._selected!==t&&(this._selected&&this.setSelected(),t.has("__oldStyle",!0)||t.set("__oldStyle",t.getStyle(),!0),t.setStyle(this.getStyle(t,"_clickStyle")),this._selected=t)):this._selected&&(this._selected.has("__oldStyle",!0)?(this._selected.setStyle(this._selected.get("__oldStyle",!0)),this._selected.unset("__oldStyle",!0)):this._selected.setStyle(this.getStyle(this._selected)),this._selected=null),this}},{key:"setStyle",value:function(t,e,r){var n=this,i=e?r||"_temp":void 0;return Array.isArray(t)?t.forEach((function(t){return t.setStyle(n.getStyle(t,i,e))})):t.setStyle(this.getStyle(t,i,e)),this}},{key:"resetState",value:function(){return this._selected&&(this._selected.setStyle(this.getStyle(this._selected)),this._selected=null),this._hoverSelected&&(this._hoverSelected.setStyle(this.getStyle(this._hoverSelected)),this._hoverSelected=null),this}},{key:"on",value:function(t){return"click"!==t.type||this._initEvent.click?"hover"!==t.type||this._initEvent.hover||this._onDefaultEvent("hover"):this._onDefaultEvent("click"),this._events.push(t),this}},{key:"off",value:function(t){for(var e=0;e<this._events.length;e++)this._events[e].id!==t&&this._events[e].change!==t||(this._events.splice(e,1),e--);return this}},{key:"dispose",value:function(){Ps(js(a.prototype),"dispose",this).call(this),this._zoomChangeShowLabel(),this._selected=null,this._hoverSelected=null,ws.off(this._layerClick,"click"),ws.off(this._layerClick,"click",this.parent.layer),ws.off(this._layerMove,"mousemove",this.parent.layer),ws.off(this._layerOut,"mouseout",this.parent.layer),this._events.length=0}}],r&&Cs(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(ys);function Ls(t){return Ls="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ls(t)}function Is(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ms(n.key),n)}}function Ms(t){var e=function(t,e){if("object"!=Ls(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Ls(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ls(e)?e:String(e)}function As(){return As="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ns(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},As.apply(this,arguments)}function Ds(t,e){return Ds=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ds(t,e)}function Ns(t){return Ns=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ns(t)}var Fs=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ds(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ns(n);if(i){var r=Ns(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Ls(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(t=o.call.apply(o,[this].concat(r)))._stateService=void 0,t._map=void 0,t}return e=a,r=[{key:"initState",value:function(t,e){return this._stateService&&this._stateService.dispose(),this._stateService=new Rs(t,e),this}},{key:"zoomChangeShowLabel",value:function(t,e){return this._stateService._zoomChangeShowLabel(t,e),this}},{key:"selected",get:function(){return this._stateService.selected}},{key:"setSelected",value:function(t,e){return this._stateService.setSelected(t,e),this}},{key:"setStyle",value:function(t,e,r){return this._stateService.setStyle(t,e,r),this}},{key:"getStyle",value:function(t,e,r){return this._stateService.getStyle(t,e,r)}},{key:"addHover",value:function(t,e){var r=this;return this._stateService.on({id:e,type:"hover",change:function(e,n,i){var o=!!e,a=o?e:n;a.set("_hover",o,!0),t&&t({zoom:Math.ceil(r._map.getZoom()),item:a.get("item"),hover:o,position:L.toLonLat(i.latlng),featurePosition:xa(a),feature:a,e:i})}}),this}},{key:"removeHover",value:function(t){return this._stateService.off(t),this}},{key:"addClick",value:function(t,e,r){var n=this;return this._stateService.on({id:e,type:"click",change:function(e,i,o){e?t&&t({zoom:Math.ceil(n._map.getZoom()),item:e.get("item"),position:L.toLonLat(o.latlng),featurePosition:xa(e),feature:e}):i&&r&&r.cancelCallback&&r.cancelCallback({zoom:Math.ceil(n._map.getZoom()),item:i.get("item"),position:L.toLonLat(o.latlng),featurePosition:xa(i),feature:i})}}),this}},{key:"removeClick",value:function(t){return this._stateService.off(t),this}},{key:"dispose",value:function(){As(Ns(a.prototype),"dispose",this).call(this),this._stateService.dispose()}}],r&&Is(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(rr);function zs(t){return zs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zs(t)}function Gs(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Bs(n.key),n)}}function Bs(t){var e=function(t,e){if("object"!=zs(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=zs(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==zs(e)?e:String(e)}function Vs(t,e){return Vs=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Vs(t,e)}function Us(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function qs(t){return qs=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},qs(t)}var Ws=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Vs(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=qs(n);if(i){var r=qs(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===zs(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Us(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this))._options=void 0,r._features=[],r._layer=new L.FeatureGroup,r._map=t,r._options=e,r.initState(Us(r),e),r}return e=a,(r=[{key:"map",get:function(){return this._map}},{key:"features",get:function(){return this._features}},{key:"layer",get:function(){return this._layer}},{key:"show",get:function(){return this._map.hasLayer(this._layer)},set:function(t){t?this._map.hasLayer(this._layer)||this._map.addLayer(this._layer):this._map.hasLayer(this._layer)&&this._map.removeLayer(this._layer)}},{key:"addFeature",value:function(t){var e=this,r=this._layer.getStyle(),n="function"==typeof r;return Array.isArray(t)?t.filter((function(t){return!e.hasFeature(t)})).forEach((function(t){e._features.push(t),e._layer.addLayer(t),r&&!t.getStyle()&&t.setStyle(n?r(t):r)})):this.hasFeature(t)||(this._features.push(t),this._layer.addLayer(t),r&&!t.getStyle()&&t.setStyle(n?r(t):r)),this}},{key:"hasFeature",value:function(t){return this._features.includes(t)}},{key:"removeFeature",value:function(t){var e=this;if(Array.isArray(t))t.forEach((function(t){e.removeFeature(t)}));else{var r=this._features.findIndex((function(e){return e===t}));r>=0&&(this._features[r].remove(),this._features.splice(r,1))}return this}},{key:"clearFeatures",value:function(){return this._features.forEach((function(t){return t.remove()})),this._features.length=0,this}},{key:"getFeatures",value:function(t,e){var r=[];if("string"==typeof t)this._features.forEach((function(n){var i;(null===(i=n.options)||void 0===i?void 0:i[t])===e&&r.push(n)}));else{var n=Object.keys(t);this._features.forEach((function(e){n.some((function(r){var n;return(null===(n=e.options)||void 0===n?void 0:n[r])===t[r]}))&&r.push(e)}))}return r}},{key:"filter",value:function(t){for(var e=[],r=0,n=this._features.length;r<n;r++)!0===t(this._features[r],r)&&e.push(this._features[r]);return e}},{key:"find",value:function(t){for(var e=0,r=this._features.length;e<r;e++)if(!0===t(this._features[e],e))return this._features[e]}},{key:"findLast",value:function(t){for(var e=this._features.length-1;e>=0;e--)if(!0===t(this._features[e],e))return this._features[e]}},{key:"findIndex",value:function(t){for(var e=0,r=this._features.length;e<r;e++)if(!0===t(this._features[e],e))return e;return-1}},{key:"findLastIndex",value:function(t){for(var e=this._features.length-1;e>=0;e--)if(!0===t(this._features[e],e))return e;return-1}},{key:"forEach",value:function(t){for(var e=0,r=this._features.length;e<r;e++)t(this._features[e],e);return this}},{key:"filterVisible",value:function(t){for(var e=this,r=[],n=0,i=this._features.length;n<i;n++){var o=this._features[n];!0===t(o.get("item"),o)&&r.push(o)}return r.length!==this._features.length&&(this._layer.clearLayers(),r.forEach((function(t){return e._layer.addLayer(t)}))),this}},{key:"filterRemove",value:function(t){for(var e=this,r=[],n=0;n<this._features.length;n++){var i=this._features[n];!0===t(i.get("item"),i)?(this._features.splice(n,1),n--):r.push(i)}return r.length!==this._features.length&&(this._layer.clearLayers(),r.forEach((function(t){return e._layer.addLayer(t)}))),this}},{key:"options",get:function(){return this._options}},{key:"dispose",value:function(){this.clearFeatures()}}])&&Gs(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(Fs);const Xs=Ws;function Zs(t){return Zs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Zs(t)}function Hs(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ys(n.key),n)}}function Ys(t){var e=function(t,e){if("object"!=Zs(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Zs(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Zs(e)?e:String(e)}function Ks(){return Ks="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=$s(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},Ks.apply(this,arguments)}function Js(t,e){return Js=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Js(t,e)}function $s(t){return $s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},$s(t)}function Qs(t,e){var r,n,i,o,a;return t?(!t.strokeColor&&null!==(r=t.stroke)&&void 0!==r&&r.color&&(t.strokeColor=null===(i=t.stroke)||void 0===i?void 0:i.color),!t.strokeWidth&&null!==(n=t.stroke)&&void 0!==n&&n.width&&(t.strokeWidth=null===(o=t.stroke)||void 0===o?void 0:o.width),t.fill&&"string"!=typeof t.fill&&(t.fill=null===(a=t.fill)||void 0===a?void 0:a.color),e&&(t.strokeColor||(t.strokeColor="rgba(14,78,142,.6)"),et(t.strokeWidth)&&(t.strokeWidth=1),t.fill||(t.fill="rgba(0,0,0,0.2)")),t):t}var tu=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Js(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=$s(n);if(i){var r=$s(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Zs(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,Qs(e)))._mapLayerUN=null,r._layer.set("name",e.name||"areaMapStyle"),r._layer.setZIndex(e.zIndex||0),r}return e=a,r=[{key:"setOptions",value:function(t){for(var e in t)this._options[e]=t[e]}},{key:"register",value:function(t){this.addFeature(t),this.setAreaStyle(this._options)}},{key:"initAreaMapStyle",value:function(t,e){var r=this;return t?("string"==typeof t?fetch(t||"四川.json").then((function(t){return t.json()})):Promise.resolve(t)).then((function(t){return r.register(L.geoJSON(t,e).getLayers()),!0})).catch((function(){return Promise.resolve(!1)})):Promise.resolve(!1)}},{key:"setAreaStyle",value:function(t){this._layer.setStyle(this._stateService.getStyle(this._layer,void 0,Qs(t,!0)))}},{key:"setChildAreaStyle",value:function(t,e){var r=this;Array.isArray(t)?t.forEach((function(t){return r.setChildAreaStyle(t,e)})):t.setStyle(e?this._stateService.getStyle(t,void 0,e):this._stateService.getStyle(this._layer))}},{key:"dispose",value:function(){Ks($s(a.prototype),"dispose",this).call(this),this._mapLayerUN&&this._mapLayerUN()}}],r&&Hs(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(Xs);function eu(t){return eu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},eu(t)}var ru=["padding","duration"];function nu(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function iu(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?nu(Object(r),!0).forEach((function(e){var n,i,o;n=t,i=e,o=r[e],(i=au(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):nu(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function ou(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,au(n.key),n)}}function au(t){var e=function(t,e){if("object"!=eu(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=eu(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==eu(e)?e:String(e)}function su(){return su="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=cu(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},su.apply(this,arguments)}function uu(t,e){return uu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},uu(t,e)}function lu(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function cu(t){return cu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},cu(t)}var fu=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&uu(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=cu(n);if(i){var r=cu(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===eu(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return lu(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),e.badge&&(e._badgeStyle=e.badge),(r=o.call(this,t,e))._styleCache={},r._cluster=void 0,r._zIndex=0,r._selected=null,r._cacheBadgeImages=new Map,L.markerClusterGroup?(r._layer=L.markerClusterGroup({maxClusterRadius:e.distance||80,zoomToBoundsOnClick:!1,iconCreateFunction:e.badge?r._clusterStyle.bind(lu(r)):null}),ws.on("clusterclick",r._clusterEvent.bind(lu(r)),"clusterclick",void 0,r._layer),ws.on("clustermouseover",r._clusterEvent.bind(lu(r)),"clustermouseover",void 0,r._layer),ws.on("clustermouseout",r._clusterEvent.bind(lu(r)),"clustermouseout",void 0,r._layer)):rt("使用点聚合必须引用插件[leaflet.markercluster.js]！"),r._layer.set("name",e.name||"clusterPoint"),r._layer.setZIndex(e.zIndex||1),r._layer.setStyle((function(t){return r._stateService.getStyle(t,"default",{text:t.get("label")})})),r}return e=a,r=[{key:"_clusterStyle",value:function(t){var e=t.getChildCount();if(this._cacheBadgeImages.has(e))return this._cacheBadgeImages.get(e);var r,n,i,o,a,s,u,l,c,f,p,h=st(this._options.badge?this._options.badge.scale:1),y=this._createBadge(t.getChildCount(),this._options,h),d=(this._options.offset?this._options.offset[0]:0)+y.width/2,g=(this._options.offset?this._options.offset[1]:0)+y.height,m='background-image:url("'.concat(y.toDataURL(),'");width:').concat(y.width,"px;height:").concat(y.height,"px;top:").concat(-g,"px;left:").concat(d,"px;font-size:").concat(10*Math.max(h[0],h[1]),"px;"),v=(r=this._stateService.getStyle(t,"default",{text:t.getChildCount()}),n=m,L.divIcon({iconAnchor:null===(i=r.icon)||void 0===i?void 0:i.iconAnchor,iconSize:null===(o=r.icon)||void 0===o?void 0:o.iconSize,html:(null!==(a=r.icon)&&void 0!==a&&a._diffuses?null===(s=r.icon)||void 0===s?void 0:s._diffuses.map((function(t){return'<div class="'.concat(t.className.join(" "),'"></div>')})).join(""):"")+(null!==(u=r.icon)&&void 0!==u&&u.iconUrl?'<img src="'.concat(null===(l=r.icon)||void 0===l?void 0:l.iconUrl,"\" style='").concat(Pa(null===(c=r.css)||void 0===c?void 0:c.cssText,["transform","width","height","opacity"]),"' />"):"")+"<span style='".concat(Pa(null===(f=r.css)||void 0===f?void 0:f.cssText,["color","font","text"])+(n||""),"' ></span>"),className:[wa,ba,Sa,(null===(p=r.icon)||void 0===p?void 0:p.className)||""].join(" ")}));return this._cacheBadgeImages.set(e,v),v}},{key:"_clusterEvent",value:function(t){L.DomEvent.stopPropagation(t),"clusterclick"===t.type?this._stateService.layerClick(t):"clustermouseover"===t.type?this._stateService.layerMove(t):"clustermouseout"===t.type&&this._stateService.layerOut(t)}},{key:"create",value:function(t,e){var r=this;if(!L.markerClusterGroup)return rt("使用点聚合必须引用插件[leaflet.markercluster.js]！"),this;if(Array.isArray(t)){var n=t.map((function(t){var n=L.marker(L.fromLonLat(t.point),{item:t,label:t.label});return e&&n.setStyle(r._stateService.getStyle(n,"default",iu(iu({},e),{},{text:t.label}))),n}));this.addFeature(n)}else{var i=L.marker(L.fromLonLat(t.point),{item:t,label:t.label});e&&i.setStyle(this._stateService.getStyle(i,"default",iu(iu({},e),{},{text:t.label}))),this.addFeature(i)}return this}},{key:"addClick",value:function(t,e,r){var n=this;return this._stateService.on({id:e,type:"click",change:function(e,i,o){if("clusterclick"===o.type){var a=o.layer.getAllChildMarkers();if(!0!==(null==r?void 0:r.disableZoom)){var s=L.latLngBounds([]);a.forEach((function(t){s.extend(t.getLatLng())}));var u=r||{},l=u.padding,c=void 0===l?[0,0]:l,f=u.duration,p=function(t,e){if(null==t)return{};var r,n,i=function(t,e){if(null==t)return{};var r,n,i={},o=Object.keys(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||(i[r]=t[r]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}(u,ru);n._map.fitBounds(s,iu({duration:lt(f,!0,1),padding:c},p||{}))}t&&t({zoom:Math.ceil(n._map.getZoom()),item:a.map((function(t){return t.get("item")})),position:L.toLonLat(o.latlng),featurePosition:L.toLonLat(e.getLatLng()),limited:1===a.length||n._map.getZoom()>=n._map.getMaxZoom(),features:a,isCluster:!0,e:o})}else e?t&&t({zoom:Math.ceil(n._map.getZoom()),item:e.get("item"),position:L.toLonLat(o.latlng),featurePosition:L.toLonLat(e.getLatLng()),limited:!0,features:[e],isCluster:!1,e:o}):i&&r&&r.cancelCallback&&r.cancelCallback({zoom:Math.ceil(n._map.getZoom()),item:i.get("item"),position:L.toLonLat(o.latlng),featurePosition:L.toLonLat(i.getLatLng()),limited:!0,features:[i],isCluster:!1,e:o})}}),this}},{key:"addHover",value:function(t,e){var r=this;return this._stateService.on({id:e,type:"hover",change:function(e,n,i){if("clustermouseover"===i.type||"clustermouseout"===i.type){var o=i.layer.getAllChildMarkers();t&&t({zoom:Math.ceil(r._map.getZoom()),position:L.toLonLat(i.latlng),featurePosition:L.toLonLat(i.layer.latlng),item:o.map((function(t){return t.get("item")})),hover:!!e,isCluster:!0,features:o,e:i})}else if(e||n){var a=e||n;t&&t({zoom:Math.ceil(r._map.getZoom()),position:L.toLonLat(i.latlng),featurePosition:L.toLonLat(a.getLatLng()),item:a.get("item"),hover:!!e,isCluster:!1,features:[a],e:i})}}}),this}},{key:"_createBadge",value:function(t,e,r){var n,i,o,a,s,u=(null==e||null===(n=e.badge)||void 0===n?void 0:n.rectRadius)||10,l=document.createElement("canvas"),c=l.getContext("2d");if(!c)return l;c.font=(null==e?void 0:e.fontStyle)||"12px Microsoft YaHei";var f=c.measureText(t),p=((null==e||null===(i=e.badge)||void 0===i?void 0:i.rectWidth)||f.width)+10;l.width=(p<f.width?f.width:p<38?38:p)*r[0];var h=(null==e||null===(o=e.badge)||void 0===o?void 0:o.rectHeight)||26;l.height=(h<26?26:h)*r[1];var y=l.width,d=l.height,g=d/2;u&&u>0&&u<g&&(g=u),c.beginPath(),c.fillStyle=(null==e||null===(a=e.badge)||void 0===a?void 0:a.strokeColor)||"#fff",c.moveTo(0+g,0),c.arcTo(0+y,0,0+y,0+d,g),c.arcTo(0+y,0+d,0,0+d,g),c.arcTo(0,0+d,0,0,g),c.arcTo(0,0,0+y,0,g),c.closePath(),c.fill(),c.beginPath();var m=(null==e||null===(s=e.badge)||void 0===s?void 0:s.fill)||["#0e4e8e","#1786f4"];if(Array.isArray(m))if(0===m.length)m="#0e4e8e";else{for(var v=c.createLinearGradient(0+g+1.5,2.5,0+g+1.5,2.5+d),_=1/(m.length-1),b=0,w=m.length;b<w;b++)v.addColorStop(b===w-1?1:b*_,m[b]);m=v}return c.fillStyle=m,c.moveTo(0+g+1.5,2.5),c.arcTo(0+y-1.5,2.5,0+y-1.5,0+d-.5,g),c.arcTo(0+y-1.5,0+d-.5,1.5,0+d-.5,g),c.arcTo(1.5,0+d-.5,1.5,2.5,g),c.arcTo(1.5,2.5,0+y-1.5,2.5,g),c.closePath(),c.fill(),c.translate(y/2,d/2+2),c.textAlign="center",c.textBaseline="middle",c.fillStyle=e.fontColor||"#ffffff",c.fillText(t,0,0),l}},{key:"dispose",value:function(){su(cu(a.prototype),"dispose",this).call(this),ws.off("clusterclick","clusterclick",this._layer),ws.off("clustermouseover","clustermouseover",this._layer),ws.off("clustermouseout","clustermouseout",this._layer),this._cacheBadgeImages.clear()}}],r&&ou(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(Xs);const pu=fu;function hu(t){return hu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},hu(t)}function yu(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function du(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?yu(Object(r),!0).forEach((function(e){var n,i,o;n=t,i=e,o=r[e],(i=mu(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):yu(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function gu(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,mu(n.key),n)}}function mu(t){var e=function(t,e){if("object"!=hu(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=hu(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==hu(e)?e:String(e)}function vu(t,e){return vu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},vu(t,e)}function _u(t){return _u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_u(t)}var bu=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&vu(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=_u(n);if(i){var r=_u(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===hu(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,e))._zIndex=0,r._layer.set("name",e.name||"iconPoint"),r._layer.setZIndex(e.zIndex||1),r._layer.setStyle((function(t){return r._stateService.getStyle(t,"default",{text:t.get("label")})})),r}return e=a,r=[{key:"create",value:function(t,e){var r=this;if(Array.isArray(t)){var n=t.map((function(t){var n=L.marker(L.fromLonLat(t.point),{item:t,label:t.label});return e&&n.setStyle(r._stateService.getStyle(n,"default",du(du({},e),{},{text:t.label}))),n}));this.addFeature(n)}else{var i=L.marker(L.fromLonLat(t.point),{item:t,label:t.label});e&&i.setStyle(this._stateService.getStyle(i,"default",du(du({},e),{},{text:t.label}))),this.addFeature(i)}return this}}],r&&gu(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(Xs);function wu(t){return wu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wu(t)}function Su(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Ou(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,xu(n.key),n)}}function xu(t){var e=function(t,e){if("object"!=wu(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=wu(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==wu(e)?e:String(e)}function Cu(){return Cu="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Pu(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},Cu.apply(this,arguments)}function Eu(t,e){return Eu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Eu(t,e)}function Pu(t){return Pu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Pu(t)}var ku=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Eu(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Pu(n);if(i){var r=Pu(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===wu(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=o.call(this))._overlays=[],e._map=void 0,e._map=t,e}return e=a,r=[{key:"map",get:function(){return this._map}},{key:"overlays",get:function(){return this._overlays}},{key:"addOverlay",value:function(t){var e=this;return Array.isArray(t)?t.forEach((function(t){e.addOverlay(t)})):this._overlays.includes(t)||(this._overlays.push(t),this._map.addLayer(t)),this}},{key:"searchOverlays",value:function(t){var e=this,r=[];return Array.isArray(t)?t.forEach((function(t){var n,i=e.searchOverlays(t);r.push.apply(r,function(t){if(Array.isArray(t))return Su(t)}(n=i)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||function(t,e){if(t){if("string"==typeof t)return Su(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Su(t,e):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())})):this._overlays.forEach((function(e){e.get("name")===t&&r.push(e)})),r}},{key:"getOverlays",value:function(t,e){var r=[];if("string"==typeof t)this._overlays.forEach((function(n){n.get(t)===e&&r.push(n)}));else{var n=Object.keys(t);this._overlays.forEach((function(e){n.some((function(r){return e.get(r)===t[r]}))&&r.push(e)}))}return r}},{key:"filter",value:function(t){for(var e=[],r=0,n=this._overlays.length;r<n;r++)!0===t(this._overlays[r],r)&&e.push(this._overlays[r]);return e}},{key:"find",value:function(t){for(var e=0,r=this._overlays.length;e<r;e++)if(!0===t(this._overlays[e],e))return this._overlays[e]}},{key:"findIndex",value:function(t){for(var e=0,r=this._overlays.length;e<r;e++)if(!0===t(this._overlays[e],e))return e;return-1}},{key:"forEach",value:function(t){for(var e=0,r=this._overlays.length;e<r;e++)t(this._overlays[e],e);return this}},{key:"filterVisible",value:function(t){throw new Error("Method not implemented.")}},{key:"filterRemove",value:function(t){throw new Error("Method not implemented.")}},{key:"removeOverlay",value:function(t){var e=this;if(!t)return this._overlays.forEach((function(t){return e._map.removeLayer(t)})),void(this._overlays.length=0);if(Array.isArray(t))t.forEach((function(t){e.removeOverlay(t)}));else{var r=this.findIndex((function(e){return e.get("id")===t||e===t}));if(r<0)return;this._map.removeLayer(this._overlays[r]),this._overlays.splice(r,1)}}},{key:"clearOverlays",value:function(){return this.removeOverlay(),this}},{key:"dispose",value:function(){Cu(Pu(a.prototype),"dispose",this).call(this),this.clearOverlays()}}],r&&Ou(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t);function Tu(t){return Tu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Tu(t)}var ju=["element","position","point"];function Ru(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Lu(n.key),n)}}function Lu(t){var e=function(t,e){if("object"!=Tu(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Tu(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Tu(e)?e:String(e)}function Iu(t,e){return Iu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Iu(t,e)}function Mu(t){return Mu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Mu(t)}var Au=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Iu(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Mu(n);if(i){var r=Mu(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Tu(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t))._options=void 0,r._options=e,r}return e=a,r=[{key:"_createMarkElement",value:function(t){var e=document.createElement("div");return e.classList.add("bimmap-popup-content"),t instanceof HTMLElement?e.insertAdjacentElement("afterbegin",t):e.innerHTML=t,e.setAttribute("target","popup"),document.body.appendChild(e),e}},{key:"_getOverlayElement",value:function(t){var e=this._createMarkElement(t.element);return t.useTitle&&(e.title=t.label),e}},{key:"_createOneOverlay",value:function(t){var e=this._options?Object.assign({},this._options,t):t,r=this._getOverlayElement(e);delete e.innerHTML;var n=e.offset||[0,0],i=L.popup({id:e.id,name:e.name||"overlay",item:e,autoElement:!(e.element instanceof Element),className:"bimmap-popup bimmap-popup_".concat(e.positioning||"bottom-center"," ").concat(e.className||""),autoClose:!1,closeButton:!1,closeOnEscapeKey:!1,closeOnClick:!1,offset:n,bubblingMouseEvents:!1});return i.setLatLng(L.fromLonLat(e.position||e.point)),i.setContent(r),i}},{key:"_addClickCallback",value:function(t,e,r){r.stopPropagation(),t&&t({zoom:Math.ceil(this._map.getZoom()),item:e.get("item"),position:L.toLonLat(e.getLatLng()),featurePosition:L.toLonLat(e.getLatLng()),overlay:e})}},{key:"addClick",value:function(t){var e=this;return this.overlays.forEach((function(r){var n=r.getElement();Reflect.has(n,"_overlay_click_")&&n.removeEventListener("click",Reflect.get(n,"_overlay_click_"));var i=e._addClickCallback.bind(e,t,r);Object.defineProperty(n,"_overlay_click_",{value:i}),n.addEventListener("click",i)})),this}},{key:"create",value:function(t){var e=this;if(Array.isArray(t)){var r=t.map((function(t){return e._createOneOverlay(t)}));this.addOverlay(r)}else{var n=this._createOneOverlay(t);this.addOverlay(n)}return this}},{key:"update",value:function(t,e){var r=e.element,n=e.position,i=e.point,o=function(t,e){if(null==t)return{};var r,n,i=function(t,e){if(null==t)return{};var r,n,i={},o=Object.keys(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||(i[r]=t[r]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}(e,ju);return r&&t.setContent(this._getOverlayElement(e)),(n||i)&&t.setLatLng(L.fromLonLat(n||i)),t.setProperties(o),this}}],r&&Ru(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(ku);function Du(t){return Du="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Du(t)}function Nu(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Fu(n.key),n)}}function Fu(t){var e=function(t,e){if("object"!=Du(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Du(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Du(e)?e:String(e)}function zu(t,e){return zu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},zu(t,e)}function Gu(t){return Gu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Gu(t)}var Bu=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&zu(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Gu(n);if(i){var r=Gu(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Du(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,e))._layer.set("name",e.name||"fontLayer"),r._layer.setZIndex(e.zIndex||1),r._layer.setStyle((function(t){return r._stateService.getStyle(t,"default",{text:t.get("label")})})),r}return e=a,r=[{key:"create",value:function(t){var e=this;return Array.isArray(t)?t.forEach((function(t){e.addFeature(Ca(t))})):this.addFeature(Ca(t)),this}},{key:"addSelect",value:function(t,e){return this.addHover(e,t),this}}],r&&Nu(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(Xs);function Vu(t){return Vu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vu(t)}function Uu(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,qu(n.key),n)}}function qu(t){var e=function(t,e){if("object"!=Vu(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Vu(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Vu(e)?e:String(e)}function Wu(t,e){return Wu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Wu(t,e)}function Xu(t){return Xu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Xu(t)}var Zu=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Wu(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Xu(n);if(i){var r=Xu(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Vu(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,e))._layer.set("name",e.name||"lineString"),r._layer.setZIndex(e.zIndex||1),r._layer.setStyle((function(t){return r._stateService.getStyle(t,"default")})),r}return e=a,r=[{key:"create",value:function(t,e){var r=L.polyline((t.points||t.coords).map((function(t){return L.fromLonLat(t)})),{item:t,label:t.label});return e&&r.setStyle(this._stateService.getStyle(r,"default",e)),this.addFeature(r),this}}],r&&Uu(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(Xs);function Hu(t){return Hu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Hu(t)}function Yu(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ku(n.key),n)}}function Ku(t){var e=function(t,e){if("object"!=Hu(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Hu(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Hu(e)?e:String(e)}function Ju(){return Ju="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=tl(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},Ju.apply(this,arguments)}function $u(t,e){return $u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},$u(t,e)}function Qu(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tl(t){return tl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tl(t)}var el=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&$u(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=tl(n);if(i){var r=tl(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Hu(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Qu(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,nt({strokeColor:"rgba(0, 0, 255, 0.8)",strokeWidth:0},e)))._useRight=!0,r.__zoomEvent=r._bindEvent.bind(Qu(r)),r._timer=void 0,r._layer.set("name",e.name||"gridPolygon"),r._layer.setZIndex(e.zIndex||1),r._layer.setStyle((function(t){return r._returnStyle(t)})),r._stateService.addExcludeCacheEventName(["_clickStyle","_hoverStyle"]),ws.on("zoomend",r.__zoomEvent),r}return e=a,r=[{key:"_bindEvent",value:function(t){var e=this;console.log("🚀 ~ file: index.ts:32 ~ _bindEvent ~ e:",t),this._timer&&(clearTimeout(this._timer),this._timer=null),this._timer=setTimeout((function(){var t=e._layer.getStyle(),r="function"==typeof t;e.features.forEach((function(e){e.setStyle(r?t(e):t)})),e._timer=null}),400)}},{key:"create",value:function(t){if(Array.isArray(t)){var e=t.map((function(t){return L.polygon([t.points.map((function(t){return L.fromLonLat(t)}))],{item:t,name:t.name,label:t.label})}));this.addFeature(e)}else{var r=L.polygon([t.points.map((function(t){return L.fromLonLat(t)}))],{item:t,name:t.name,label:t.label});this.addFeature(r)}return this}},{key:"addRightClick",value:function(t,e){return this}},{key:"getCenterCoordinates",value:function(t){return L.toLonLat(t.getCenter())}},{key:"addSelect",value:function(t,e){return this.addClick(t,e),this}},{key:"_returnStyle",value:function(t){return this._map.getZoom()<(this._options.minZoomShow||0)?(this._stateService.currentDefaultEventName="_defaultFeatureStyle",this._stateService.getStyle(t,"_defaultFeatureStyle")):(this._stateService.currentDefaultEventName="default",this._stateService.getStyle(t,"default",{text:t.get("label")}))}},{key:"dispose",value:function(){Ju(tl(a.prototype),"dispose",this).call(this),ws.off(this.__zoomEvent,"zoomend"),this._timer&&(clearTimeout(this._timer),this._timer=null)}}],r&&Yu(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(Xs),rl=6371008.8,nl={centimeters:637100880,centimetres:637100880,degrees:57.22891354143274,feet:20902260.511392,inches:250826616.45599997,kilometers:6371.0088,kilometres:6371.0088,meters:rl,metres:rl,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:3440.069546436285,radians:1,yards:6967335.223679999};function il(t,e,r){void 0===r&&(r={});var n={type:"Feature"};return(0===r.id||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=e||{},n.geometry=t,n}function ol(t,e,r){if(void 0===r&&(r={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!cl(t[0])||!cl(t[1]))throw new Error("coordinates must contain numbers");return il({type:"Point",coordinates:t},e,r)}function al(t,e,r){void 0===r&&(r={});for(var n=0,i=t;n<i.length;n++){var o=i[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<o[o.length-1].length;a++)if(o[o.length-1][a]!==o[0][a])throw new Error("First and last Position are not equivalent.")}return il({type:"Polygon",coordinates:t},e,r)}function sl(t,e,r){if(void 0===r&&(r={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return il({type:"LineString",coordinates:t},e,r)}function ul(t){return t%(2*Math.PI)*180/Math.PI}function ll(t){return t%360*Math.PI/180}function cl(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function fl(t,e,r){if(null!==t)for(var n,i,o,a,s,u,l,c,f=0,p=0,h=t.type,y="FeatureCollection"===h,d="Feature"===h,g=y?t.features.length:1,m=0;m<g;m++){s=(c=!!(l=y?t.features[m].geometry:d?t.geometry:t)&&"GeometryCollection"===l.type)?l.geometries.length:1;for(var v=0;v<s;v++){var _=0,b=0;if(null!==(a=c?l.geometries[v]:l)){u=a.coordinates;var w=a.type;switch(f=!r||"Polygon"!==w&&"MultiPolygon"!==w?0:1,w){case null:break;case"Point":if(!1===e(u,p,m,_,b))return!1;p++,_++;break;case"LineString":case"MultiPoint":for(n=0;n<u.length;n++){if(!1===e(u[n],p,m,_,b))return!1;p++,"MultiPoint"===w&&_++}"LineString"===w&&_++;break;case"Polygon":case"MultiLineString":for(n=0;n<u.length;n++){for(i=0;i<u[n].length-f;i++){if(!1===e(u[n][i],p,m,_,b))return!1;p++}"MultiLineString"===w&&_++,"Polygon"===w&&b++}"Polygon"===w&&_++;break;case"MultiPolygon":for(n=0;n<u.length;n++){for(b=0,i=0;i<u[n].length;i++){for(o=0;o<u[n][i].length-f;o++){if(!1===e(u[n][i][o],p,m,_,b))return!1;p++}b++}_++}break;case"GeometryCollection":for(n=0;n<a.geometries.length;n++)if(!1===fl(a.geometries[n],e,r))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function pl(t,e){var r,n,i,o,a,s,u,l,c,f,p=0,h="FeatureCollection"===t.type,y="Feature"===t.type,d=h?t.features.length:1;for(r=0;r<d;r++){for(s=h?t.features[r].geometry:y?t.geometry:t,l=h?t.features[r].properties:y?t.properties:{},c=h?t.features[r].bbox:y?t.bbox:void 0,f=h?t.features[r].id:y?t.id:void 0,a=(u=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,i=0;i<a;i++)if(null!==(o=u?s.geometries[i]:s))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(o,p,l,c,f))return!1;break;case"GeometryCollection":for(n=0;n<o.geometries.length;n++)if(!1===e(o.geometries[n],p,l,c,f))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,p,l,c,f))return!1;p++}}function hl(t,e){pl(t,(function(t,r,n,i,o){var a,s=null===t?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return!1!==e(il(t,n,{bbox:i,id:o}),r,0)&&void 0}switch(s){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon"}for(var u=0;u<t.coordinates.length;u++){var l=t.coordinates[u];if(!1===e(il({type:a,coordinates:l},n),r,u))return!1}}))}function yl(t){var e=[1/0,1/0,-1/0,-1/0];return fl(t,(function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])})),e}yl.default=yl;const dl=yl;function gl(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return t.geometry.coordinates;if("Point"===t.type)return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function ml(t){return"Feature"===t.type?t.geometry:t}function vl(t,e,r){if(void 0===r&&(r={}),!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");var n=gl(t),i=ml(e),o=i.type,a=e.bbox,s=i.coordinates;if(a&&!1===function(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}(n,a))return!1;"Polygon"===o&&(s=[s]);for(var u=!1,l=0;l<s.length&&!u;l++)if(_l(n,s[l][0],r.ignoreBoundary)){for(var c=!1,f=1;f<s[l].length&&!c;)_l(n,s[l][f],!r.ignoreBoundary)&&(c=!0),f++;c||(u=!0)}return u}function _l(t,e,r){var n=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var i=0,o=e.length-1;i<e.length;o=i++){var a=e[i][0],s=e[i][1],u=e[o][0],l=e[o][1];if(t[1]*(a-u)+s*(u-t[0])+l*(t[0]-a)==0&&(a-t[0])*(u-t[0])<=0&&(s-t[1])*(l-t[1])<=0)return!r;s>t[1]!=l>t[1]&&t[0]<(u-a)*(t[1]-s)/(l-s)+a&&(n=!n)}return n}r(7418),r(2273);const bl=function(t,e,r){void 0===r&&(r={});var n=gl(t),i=gl(e),o=ll(i[1]-n[1]),a=ll(i[0]-n[0]),s=ll(n[1]),u=ll(i[1]),l=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(s)*Math.cos(u);return function(t,e){void 0===e&&(e="kilometers");var r=nl[e];if(!r)throw new Error(e+" units is invalid");return t*r}(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),r.units)};Object.prototype.hasOwnProperty;var wl=new ArrayBuffer(16);new Float64Array(wl),new Uint32Array(wl),r(67),function(){function t(t){this.points=t.points||[],this.duration=t.duration||1e4,this.sharpness=t.sharpness||.85,this.centers=[],this.controls=[],this.stepLength=t.stepLength||60,this.length=this.points.length,this.delay=0;for(var e=0;e<this.length;e++)this.points[e].z=this.points[e].z||0;for(e=0;e<this.length-1;e++){var r=this.points[e],n=this.points[e+1];this.centers.push({x:(r.x+n.x)/2,y:(r.y+n.y)/2,z:(r.z+n.z)/2})}for(this.controls.push([this.points[0],this.points[0]]),e=0;e<this.centers.length-1;e++){var i=this.points[e+1].x-(this.centers[e].x+this.centers[e+1].x)/2,o=this.points[e+1].y-(this.centers[e].y+this.centers[e+1].y)/2,a=this.points[e+1].z-(this.centers[e].y+this.centers[e+1].z)/2;this.controls.push([{x:(1-this.sharpness)*this.points[e+1].x+this.sharpness*(this.centers[e].x+i),y:(1-this.sharpness)*this.points[e+1].y+this.sharpness*(this.centers[e].y+o),z:(1-this.sharpness)*this.points[e+1].z+this.sharpness*(this.centers[e].z+a)},{x:(1-this.sharpness)*this.points[e+1].x+this.sharpness*(this.centers[e+1].x+i),y:(1-this.sharpness)*this.points[e+1].y+this.sharpness*(this.centers[e+1].y+o),z:(1-this.sharpness)*this.points[e+1].z+this.sharpness*(this.centers[e+1].z+a)}])}return this.controls.push([this.points[this.length-1],this.points[this.length-1]]),this.steps=this.cacheSteps(this.stepLength),this}t.prototype.cacheSteps=function(t){var e=[],r=this.pos(0);e.push(0);for(var n=0;n<this.duration;n+=10){var i=this.pos(n);Math.sqrt((i.x-r.x)*(i.x-r.x)+(i.y-r.y)*(i.y-r.y)+(i.z-r.z)*(i.z-r.z))>t&&(e.push(n),r=i)}return e},t.prototype.vector=function(t){var e=this.pos(t+10),r=this.pos(t-10);return{angle:180*Math.atan2(e.y-r.y,e.x-r.x)/3.14,speed:Math.sqrt((r.x-e.x)*(r.x-e.x)+(r.y-e.y)*(r.y-e.y)+(r.z-e.z)*(r.z-e.z))}},t.prototype.pos=function(t){var e=t-this.delay;e<0&&(e=0),e>this.duration&&(e=this.duration-1);var r=e/this.duration;if(r>=1)return this.points[this.length-1];var n=Math.floor((this.points.length-1)*r);return function(t,e,r,n,i){var o=function(t){var e=t*t;return[e*t,3*e*(1-t),3*t*(1-t)*(1-t),(1-t)*(1-t)*(1-t)]}(t);return{x:i.x*o[0]+n.x*o[1]+r.x*o[2]+e.x*o[3],y:i.y*o[0]+n.y*o[1]+r.y*o[2]+e.y*o[3],z:i.z*o[0]+n.z*o[1]+r.z*o[2]+e.z*o[3]}}((this.length-1)*r-n,this.points[n],this.controls[n][1],this.controls[n+1][0],this.points[n+1])}}();function Sl(t,e,r,n){void 0===n&&(n={});var i=gl(t),o=ll(i[0]),a=ll(i[1]),s=ll(r),u=function(t,e){void 0===e&&(e="kilometers");var r=nl[e];if(!r)throw new Error(e+" units is invalid");return t/r}(e,n.units),l=Math.asin(Math.sin(a)*Math.cos(u)+Math.cos(a)*Math.sin(u)*Math.cos(s));return ol([ul(o+Math.atan2(Math.sin(s)*Math.sin(u)*Math.cos(a),Math.cos(u)-Math.sin(a)*Math.sin(l))),ul(l)],n.properties)}function Ol(t,e,r){if(void 0===r&&(r={}),!0===r.final)return function(t,e){var r=Ol(e,t);return(r+180)%360}(t,e);var n=gl(t),i=gl(e),o=ll(n[0]),a=ll(i[0]),s=ll(n[1]),u=ll(i[1]),l=Math.sin(a-o)*Math.cos(u),c=Math.cos(s)*Math.sin(u)-Math.sin(s)*Math.cos(u)*Math.cos(a-o);return ul(Math.atan2(l,c))}r(9187),r(1787);var xl=6378137;function Cl(t){return function(t,e,r){var n=0;return pl(t,(function(t,e,r,i,o){n=n+function(t){var e,r=0;switch(t.type){case"Polygon":return El(t.coordinates);case"MultiPolygon":for(e=0;e<t.coordinates.length;e++)r+=El(t.coordinates[e]);return r;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}(t)})),n}(t)}function El(t){var e=0;if(t&&t.length>0){e+=Math.abs(Pl(t[0]));for(var r=1;r<t.length;r++)e-=Math.abs(Pl(t[r]))}return e}function Pl(t){var e,r,n,i,o,a,s=0,u=t.length;if(u>2){for(a=0;a<u;a++)a===u-2?(n=u-2,i=u-1,o=0):a===u-1?(n=u-1,i=0,o=1):(n=a,i=a+1,o=a+2),e=t[n],r=t[i],s+=(kl(t[o][0])-kl(e[0]))*Math.sin(kl(r[1]));s=s*xl*xl/2}return s}function kl(t){return t*Math.PI/180}function Tl(t,e,r){void 0===r&&(r={});for(var n=ml(t).coordinates,i=0,o=0;o<n.length&&!(e>=i&&o===n.length-1);o++){if(i>=e){var a=e-i;if(a){var s=Ol(n[o],n[o-1])-180;return Sl(n[o],a,s,r)}return ol(n[o])}i+=bl(n[o],n[o+1],r)}return ol(n[n.length-1])}r(4860);var jl=Math.PI/180,Rl=180/Math.PI,Ll=function(t,e){this.lon=t,this.lat=e,this.x=jl*t,this.y=jl*e};Ll.prototype.view=function(){return String(this.lon).slice(0,4)+","+String(this.lat).slice(0,4)},Ll.prototype.antipode=function(){var t=-1*this.lat,e=this.lon<0?180+this.lon:-1*(180-this.lon);return new Ll(e,t)};var Il=function(){this.coords=[],this.length=0};Il.prototype.move_to=function(t){this.length++,this.coords.push(t)};var Ml=function(t){this.properties=t||{},this.geometries=[]};Ml.prototype.json=function(){if(this.geometries.length<=0)return{geometry:{type:"LineString",coordinates:null},type:"Feature",properties:this.properties};if(1===this.geometries.length)return{geometry:{type:"LineString",coordinates:this.geometries[0].coords},type:"Feature",properties:this.properties};for(var t=[],e=0;e<this.geometries.length;e++)t.push(this.geometries[e].coords);return{geometry:{type:"MultiLineString",coordinates:t},type:"Feature",properties:this.properties}},Ml.prototype.wkt=function(){for(var t="",e="LINESTRING(",r=function(t){e+=t[0]+" "+t[1]+","},n=0;n<this.geometries.length;n++){if(0===this.geometries[n].coords.length)return"LINESTRING(empty)";this.geometries[n].coords.forEach(r),t+=e.substring(0,e.length-1)+")"}return t};var Al=function(t,e,r){if(!t||void 0===t.x||void 0===t.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");if(!e||void 0===e.x||void 0===e.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");this.start=new Ll(t.x,t.y),this.end=new Ll(e.x,e.y),this.properties=r||{};var n=this.start.x-this.end.x,i=this.start.y-this.end.y,o=Math.pow(Math.sin(i/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin(n/2),2);if(this.g=2*Math.asin(Math.sqrt(o)),this.g===Math.PI)throw new Error("it appears "+t.view()+" and "+e.view()+" are 'antipodal', e.g diametrically opposite, thus there is no single route but rather infinite");if(isNaN(this.g))throw new Error("could not calculate great circle between "+t+" and "+e)};Al.prototype.interpolate=function(t){var e=Math.sin((1-t)*this.g)/Math.sin(this.g),r=Math.sin(t*this.g)/Math.sin(this.g),n=e*Math.cos(this.start.y)*Math.cos(this.start.x)+r*Math.cos(this.end.y)*Math.cos(this.end.x),i=e*Math.cos(this.start.y)*Math.sin(this.start.x)+r*Math.cos(this.end.y)*Math.sin(this.end.x),o=e*Math.sin(this.start.y)+r*Math.sin(this.end.y),a=Rl*Math.atan2(o,Math.sqrt(Math.pow(n,2)+Math.pow(i,2)));return[Rl*Math.atan2(i,n),a]},Al.prototype.Arc=function(t,e){var r=[];if(!t||t<=2)r.push([this.start.lon,this.start.lat]),r.push([this.end.lon,this.end.lat]);else for(var n=1/(t-1),i=0;i<t;++i){var o=n*i,a=this.interpolate(o);r.push(a)}for(var s=!1,u=0,l=e&&e.offset?e.offset:10,c=180-l,f=-180+l,p=360-l,h=1;h<r.length;++h){var y=r[h-1][0],d=r[h][0],g=Math.abs(d-y);g>p&&(d>c&&y<f||y>c&&d<f)?s=!0:g>u&&(u=g)}var m=[];if(s&&u<l){var v=[];m.push(v);for(var _=0;_<r.length;++_){var b=parseFloat(r[_][0]);if(_>0&&Math.abs(b-r[_-1][0])>p){var w=parseFloat(r[_-1][0]),S=parseFloat(r[_-1][1]),O=parseFloat(r[_][0]),x=parseFloat(r[_][1]);if(w>-180&&w<f&&180===O&&_+1<r.length&&r[_-1][0]>-180&&r[_-1][0]<f){v.push([-180,r[_][1]]),_++,v.push([r[_][0],r[_][1]]);continue}if(w>c&&w<180&&-180===O&&_+1<r.length&&r[_-1][0]>c&&r[_-1][0]<180){v.push([180,r[_][1]]),_++,v.push([r[_][0],r[_][1]]);continue}if(w<f&&O>c){var C=w;w=O,O=C;var E=S;S=x,x=E}if(w>c&&O<f&&(O+=360),w<=180&&O>=180&&w<O){var P=(180-w)/(O-w),k=P*x+(1-P)*S;v.push([r[_-1][0]>c?180:-180,k]),(v=[]).push([r[_-1][0]>c?-180:180,k]),m.push(v)}else v=[],m.push(v);v.push([b,r[_][1]])}else v.push([r[_][0],r[_][1]])}}else{var T=[];m.push(T);for(var j=0;j<r.length;++j)T.push([r[j][0],r[j][1]])}for(var R=new Ml(this.properties),L=0;L<m.length;++L){var I=new Il;R.geometries.push(I);for(var M=m[L],A=0;A<M.length;++A)I.move_to(M[A])}return R},r(251);var Dl=[],Nl=[],Fl=[],zl=[],Gl=[],Bl=[],Vl=[],Ul=[],ql=[],Wl=[],Xl=[],Zl=[],Hl=[],Yl=[],Kl=[],Jl=[],$l=[],Ql=[],tc=[],ec=[],rc=[],nc=[],ic=[],oc=[];Vl[85]=Wl[85]=-1,Ul[85]=Xl[85]=0,ql[85]=Zl[85]=1,tc[85]=nc[85]=1,ec[85]=ic[85]=0,rc[85]=oc[85]=1,Dl[85]=zl[85]=0,Nl[85]=Gl[85]=-1,Fl[85]=Kl[85]=0,Jl[85]=Hl[85]=0,$l[85]=Yl[85]=1,Bl[85]=Ql[85]=1,nc[1]=nc[169]=0,ic[1]=ic[169]=-1,oc[1]=oc[169]=0,Hl[1]=Hl[169]=-1,Yl[1]=Yl[169]=0,Kl[1]=Kl[169]=0,Wl[4]=Wl[166]=0,Xl[4]=Xl[166]=-1,Zl[4]=Zl[166]=1,Jl[4]=Jl[166]=1,$l[4]=$l[166]=0,Ql[4]=Ql[166]=0,Vl[16]=Vl[154]=0,Ul[16]=Ul[154]=1,ql[16]=ql[154]=1,zl[16]=zl[154]=1,Gl[16]=Gl[154]=0,Bl[16]=Bl[154]=1,tc[64]=tc[106]=0,ec[64]=ec[106]=1,rc[64]=rc[106]=0,Dl[64]=Dl[106]=-1,Nl[64]=Nl[106]=0,Fl[64]=Fl[106]=1,tc[2]=tc[168]=0,ec[2]=ec[168]=-1,rc[2]=rc[168]=1,nc[2]=nc[168]=0,ic[2]=ic[168]=-1,oc[2]=oc[168]=0,Hl[2]=Hl[168]=-1,Yl[2]=Yl[168]=0,Kl[2]=Kl[168]=0,Jl[2]=Jl[168]=-1,$l[2]=$l[168]=0,Ql[2]=Ql[168]=1,Vl[8]=Vl[162]=0,Ul[8]=Ul[162]=-1,ql[8]=ql[162]=0,Wl[8]=Wl[162]=0,Xl[8]=Xl[162]=-1,Zl[8]=Zl[162]=1,Hl[8]=Hl[162]=1,Yl[8]=Yl[162]=0,Kl[8]=Kl[162]=1,Jl[8]=Jl[162]=1,$l[8]=$l[162]=0,Ql[8]=Ql[162]=0,Vl[32]=Vl[138]=0,Ul[32]=Ul[138]=1,ql[32]=ql[138]=1,Wl[32]=Wl[138]=0,Xl[32]=Xl[138]=1,Zl[32]=Zl[138]=0,Dl[32]=Dl[138]=1,Nl[32]=Nl[138]=0,Fl[32]=Fl[138]=0,zl[32]=zl[138]=1,Gl[32]=Gl[138]=0,Bl[32]=Bl[138]=1,nc[128]=nc[42]=0,ic[128]=ic[42]=1,oc[128]=oc[42]=1,tc[128]=tc[42]=0,ec[128]=ec[42]=1,rc[128]=rc[42]=0,Dl[128]=Dl[42]=-1,Nl[128]=Nl[42]=0,Fl[128]=Fl[42]=1,zl[128]=zl[42]=-1,Gl[128]=Gl[42]=0,Bl[128]=Bl[42]=0,Wl[5]=Wl[165]=-1,Xl[5]=Xl[165]=0,Zl[5]=Zl[165]=0,nc[5]=nc[165]=1,ic[5]=ic[165]=0,oc[5]=oc[165]=0,Jl[20]=Jl[150]=0,$l[20]=$l[150]=1,Ql[20]=Ql[150]=1,zl[20]=zl[150]=0,Gl[20]=Gl[150]=-1,Bl[20]=Bl[150]=1,Vl[80]=Vl[90]=-1,Ul[80]=Ul[90]=0,ql[80]=ql[90]=1,tc[80]=tc[90]=1,ec[80]=ec[90]=0,rc[80]=rc[90]=1,Hl[65]=Hl[105]=0,Yl[65]=Yl[105]=1,Kl[65]=Kl[105]=0,Dl[65]=Dl[105]=0,Nl[65]=Nl[105]=-1,Fl[65]=Fl[105]=0,Vl[160]=Vl[10]=-1,Ul[160]=Ul[10]=0,ql[160]=ql[10]=1,Wl[160]=Wl[10]=-1,Xl[160]=Xl[10]=0,Zl[160]=Zl[10]=0,nc[160]=nc[10]=1,ic[160]=ic[10]=0,oc[160]=oc[10]=0,tc[160]=tc[10]=1,ec[160]=ec[10]=0,rc[160]=rc[10]=1,Jl[130]=Jl[40]=0,$l[130]=$l[40]=1,Ql[130]=Ql[40]=1,Hl[130]=Hl[40]=0,Yl[130]=Yl[40]=1,Kl[130]=Kl[40]=0,Dl[130]=Dl[40]=0,Nl[130]=Nl[40]=-1,Fl[130]=Fl[40]=0,zl[130]=zl[40]=0,Gl[130]=Gl[40]=-1,Bl[130]=Bl[40]=1,Wl[37]=Wl[133]=0,Xl[37]=Xl[133]=1,Zl[37]=Zl[133]=1,nc[37]=nc[133]=0,ic[37]=ic[133]=1,oc[37]=oc[133]=0,Dl[37]=Dl[133]=-1,Nl[37]=Nl[133]=0,Fl[37]=Fl[133]=0,zl[37]=zl[133]=1,Gl[37]=Gl[133]=0,Bl[37]=Bl[133]=0,Jl[148]=Jl[22]=-1,$l[148]=$l[22]=0,Ql[148]=Ql[22]=0,nc[148]=nc[22]=0,ic[148]=ic[22]=-1,oc[148]=oc[22]=1,tc[148]=tc[22]=0,ec[148]=ec[22]=1,rc[148]=rc[22]=1,zl[148]=zl[22]=-1,Gl[148]=Gl[22]=0,Bl[148]=Bl[22]=1,Vl[82]=Vl[88]=0,Ul[82]=Ul[88]=-1,ql[82]=ql[88]=1,Jl[82]=Jl[88]=1,$l[82]=$l[88]=0,Ql[82]=Ql[88]=1,Hl[82]=Hl[88]=-1,Yl[82]=Yl[88]=0,Kl[82]=Kl[88]=1,tc[82]=tc[88]=0,ec[82]=ec[88]=-1,rc[82]=rc[88]=0,Vl[73]=Vl[97]=0,Ul[73]=Ul[97]=1,ql[73]=ql[97]=0,Wl[73]=Wl[97]=0,Xl[73]=Xl[97]=-1,Zl[73]=Zl[97]=0,Hl[73]=Hl[97]=1,Yl[73]=Yl[97]=0,Kl[73]=Kl[97]=0,Dl[73]=Dl[97]=1,Nl[73]=Nl[97]=0,Fl[73]=Fl[97]=1,Vl[145]=Vl[25]=0,Ul[145]=Ul[25]=-1,ql[145]=ql[25]=0,Hl[145]=Hl[25]=1,Yl[145]=Yl[25]=0,Kl[145]=Kl[25]=1,nc[145]=nc[25]=0,ic[145]=ic[25]=1,oc[145]=oc[25]=1,zl[145]=zl[25]=-1,Gl[145]=Gl[25]=0,Bl[145]=Bl[25]=0,Wl[70]=Wl[100]=0,Xl[70]=Xl[100]=1,Zl[70]=Zl[100]=0,Jl[70]=Jl[100]=-1,$l[70]=$l[100]=0,Ql[70]=Ql[100]=1,tc[70]=tc[100]=0,ec[70]=ec[100]=-1,rc[70]=rc[100]=1,Dl[70]=Dl[100]=1,Nl[70]=Nl[100]=0,Fl[70]=Fl[100]=0,Wl[101]=Wl[69]=0,Xl[101]=Xl[69]=1,Zl[101]=Zl[69]=0,Dl[101]=Dl[69]=1,Nl[101]=Nl[69]=0,Fl[101]=Fl[69]=0,nc[149]=nc[21]=0,ic[149]=ic[21]=1,oc[149]=oc[21]=1,zl[149]=zl[21]=-1,Gl[149]=Gl[21]=0,Bl[149]=Bl[21]=0,Jl[86]=Jl[84]=-1,$l[86]=$l[84]=0,Ql[86]=Ql[84]=1,tc[86]=tc[84]=0,ec[86]=ec[84]=-1,rc[86]=rc[84]=1,Vl[89]=Vl[81]=0,Ul[89]=Ul[81]=-1,ql[89]=ql[81]=0,Hl[89]=Hl[81]=1,Yl[89]=Yl[81]=0,Kl[89]=Kl[81]=1,Vl[96]=Vl[74]=0,Ul[96]=Ul[74]=1,ql[96]=ql[74]=0,Wl[96]=Wl[74]=-1,Xl[96]=Xl[74]=0,Zl[96]=Zl[74]=1,tc[96]=tc[74]=1,ec[96]=ec[74]=0,rc[96]=rc[74]=0,Dl[96]=Dl[74]=1,Nl[96]=Nl[74]=0,Fl[96]=Fl[74]=1,Vl[24]=Vl[146]=0,Ul[24]=Ul[146]=-1,ql[24]=ql[146]=1,Jl[24]=Jl[146]=1,$l[24]=$l[146]=0,Ql[24]=Ql[146]=1,Hl[24]=Hl[146]=0,Yl[24]=Yl[146]=1,Kl[24]=Kl[146]=1,zl[24]=zl[146]=0,Gl[24]=Gl[146]=-1,Bl[24]=Bl[146]=0,Wl[6]=Wl[164]=-1,Xl[6]=Xl[164]=0,Zl[6]=Zl[164]=1,Jl[6]=Jl[164]=-1,$l[6]=$l[164]=0,Ql[6]=Ql[164]=0,nc[6]=nc[164]=0,ic[6]=ic[164]=-1,oc[6]=oc[164]=1,tc[6]=tc[164]=1,ec[6]=ec[164]=0,rc[6]=rc[164]=0,Hl[129]=Hl[41]=0,Yl[129]=Yl[41]=1,Kl[129]=Kl[41]=1,nc[129]=nc[41]=0,ic[129]=ic[41]=1,oc[129]=oc[41]=0,Dl[129]=Dl[41]=-1,Nl[129]=Nl[41]=0,Fl[129]=Fl[41]=0,zl[129]=zl[41]=0,Gl[129]=Gl[41]=-1,Bl[129]=Bl[41]=0,Jl[66]=Jl[104]=0,$l[66]=$l[104]=1,Ql[66]=Ql[104]=0,Hl[66]=Hl[104]=-1,Yl[66]=Yl[104]=0,Kl[66]=Kl[104]=1,tc[66]=tc[104]=0,ec[66]=ec[104]=-1,rc[66]=rc[104]=0,Dl[66]=Dl[104]=0,Nl[66]=Nl[104]=-1,Fl[66]=Fl[104]=1,Vl[144]=Vl[26]=-1,Ul[144]=Ul[26]=0,ql[144]=ql[26]=0,nc[144]=nc[26]=1,ic[144]=ic[26]=0,oc[144]=oc[26]=1,tc[144]=tc[26]=0,ec[144]=ec[26]=1,rc[144]=rc[26]=1,zl[144]=zl[26]=-1,Gl[144]=Gl[26]=0,Bl[144]=Bl[26]=1,Wl[36]=Wl[134]=0,Xl[36]=Xl[134]=1,Zl[36]=Zl[134]=1,Jl[36]=Jl[134]=0,$l[36]=$l[134]=1,Ql[36]=Ql[134]=0,Dl[36]=Dl[134]=0,Nl[36]=Nl[134]=-1,Fl[36]=Fl[134]=1,zl[36]=zl[134]=1,Gl[36]=Gl[134]=0,Bl[36]=Bl[134]=0,Vl[9]=Vl[161]=-1,Ul[9]=Ul[161]=0,ql[9]=ql[161]=0,Wl[9]=Wl[161]=0,Xl[9]=Xl[161]=-1,Zl[9]=Zl[161]=0,Hl[9]=Hl[161]=1,Yl[9]=Yl[161]=0,Kl[9]=Kl[161]=0,nc[9]=nc[161]=1,ic[9]=ic[161]=0,oc[9]=oc[161]=1,Vl[136]=0,Ul[136]=1,ql[136]=1,Wl[136]=0,Xl[136]=1,Zl[136]=0,Jl[136]=-1,$l[136]=0,Ql[136]=1,Hl[136]=-1,Yl[136]=0,Kl[136]=0,nc[136]=0,ic[136]=-1,oc[136]=0,tc[136]=0,ec[136]=-1,rc[136]=1,Dl[136]=1,Nl[136]=0,Fl[136]=0,zl[136]=1,Gl[136]=0,Bl[136]=1,Vl[34]=0,Ul[34]=-1,ql[34]=0,Wl[34]=0,Xl[34]=-1,Zl[34]=1,Jl[34]=1,$l[34]=0,Ql[34]=0,Hl[34]=1,Yl[34]=0,Kl[34]=1,nc[34]=0,ic[34]=1,oc[34]=1,tc[34]=0,ec[34]=1,rc[34]=0,Dl[34]=-1,Nl[34]=0,Fl[34]=1,zl[34]=-1,Gl[34]=0,Bl[34]=0,Vl[35]=0,Ul[35]=1,ql[35]=1,Wl[35]=0,Xl[35]=-1,Zl[35]=1,Jl[35]=1,$l[35]=0,Ql[35]=0,Hl[35]=-1,Yl[35]=0,Kl[35]=0,nc[35]=0,ic[35]=-1,oc[35]=0,tc[35]=0,ec[35]=1,rc[35]=0,Dl[35]=-1,Nl[35]=0,Fl[35]=1,zl[35]=1,Gl[35]=0,Bl[35]=1,Vl[153]=0,Ul[153]=1,ql[153]=1,Hl[153]=-1,Yl[153]=0,Kl[153]=0,nc[153]=0,ic[153]=-1,oc[153]=0,zl[153]=1,Gl[153]=0,Bl[153]=1,Wl[102]=0,Xl[102]=-1,Zl[102]=1,Jl[102]=1,$l[102]=0,Ql[102]=0,tc[102]=0,ec[102]=1,rc[102]=0,Dl[102]=-1,Nl[102]=0,Fl[102]=1,Vl[155]=0,Ul[155]=-1,ql[155]=0,Hl[155]=1,Yl[155]=0,Kl[155]=1,nc[155]=0,ic[155]=1,oc[155]=1,zl[155]=-1,Gl[155]=0,Bl[155]=0,Wl[103]=0,Xl[103]=1,Zl[103]=0,Jl[103]=-1,$l[103]=0,Ql[103]=1,tc[103]=0,ec[103]=-1,rc[103]=1,Dl[103]=1,Nl[103]=0,Fl[103]=0,Vl[152]=0,Ul[152]=1,ql[152]=1,Jl[152]=-1,$l[152]=0,Ql[152]=1,Hl[152]=-1,Yl[152]=0,Kl[152]=0,nc[152]=0,ic[152]=-1,oc[152]=0,tc[152]=0,ec[152]=-1,rc[152]=1,zl[152]=1,Gl[152]=0,Bl[152]=1,Vl[156]=0,Ul[156]=-1,ql[156]=1,Jl[156]=1,$l[156]=0,Ql[156]=1,Hl[156]=-1,Yl[156]=0,Kl[156]=0,nc[156]=0,ic[156]=-1,oc[156]=0,tc[156]=0,ec[156]=1,rc[156]=1,zl[156]=-1,Gl[156]=0,Bl[156]=1,Vl[137]=0,Ul[137]=1,ql[137]=1,Wl[137]=0,Xl[137]=1,Zl[137]=0,Hl[137]=-1,Yl[137]=0,Kl[137]=0,nc[137]=0,ic[137]=-1,oc[137]=0,Dl[137]=1,Nl[137]=0,Fl[137]=0,zl[137]=1,Gl[137]=0,Bl[137]=1,Vl[139]=0,Ul[139]=1,ql[139]=1,Wl[139]=0,Xl[139]=-1,Zl[139]=0,Hl[139]=1,Yl[139]=0,Kl[139]=0,nc[139]=0,ic[139]=1,oc[139]=0,Dl[139]=-1,Nl[139]=0,Fl[139]=0,zl[139]=1,Gl[139]=0,Bl[139]=1,Vl[98]=0,Ul[98]=-1,ql[98]=0,Wl[98]=0,Xl[98]=-1,Zl[98]=1,Jl[98]=1,$l[98]=0,Ql[98]=0,Hl[98]=1,Yl[98]=0,Kl[98]=1,tc[98]=0,ec[98]=1,rc[98]=0,Dl[98]=-1,Nl[98]=0,Fl[98]=1,Vl[99]=0,Ul[99]=1,ql[99]=0,Wl[99]=0,Xl[99]=-1,Zl[99]=1,Jl[99]=1,$l[99]=0,Ql[99]=0,Hl[99]=-1,Yl[99]=0,Kl[99]=1,tc[99]=0,ec[99]=-1,rc[99]=0,Dl[99]=1,Nl[99]=0,Fl[99]=1,Wl[38]=0,Xl[38]=-1,Zl[38]=1,Jl[38]=1,$l[38]=0,Ql[38]=0,nc[38]=0,ic[38]=1,oc[38]=1,tc[38]=0,ec[38]=1,rc[38]=0,Dl[38]=-1,Nl[38]=0,Fl[38]=1,zl[38]=-1,Gl[38]=0,Bl[38]=0,Wl[39]=0,Xl[39]=1,Zl[39]=1,Jl[39]=-1,$l[39]=0,Ql[39]=0,nc[39]=0,ic[39]=-1,oc[39]=1,tc[39]=0,ec[39]=1,rc[39]=0,Dl[39]=-1,Nl[39]=0,Fl[39]=1,zl[39]=1,Gl[39]=0,Bl[39]=0;var ac=function(t){return[[t.bottomleft,0],[0,0],[0,t.leftbottom]]},sc=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0]]},uc=function(t){return[[t.topright,1],[1,1],[1,t.righttop]]},lc=function(t){return[[0,t.lefttop],[0,1],[t.topleft,1]]},cc=function(t){return[[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop]]},fc=function(t){return[[t.bottomright,0],[t.bottomleft,0],[1,t.righttop],[1,t.rightbottom]]},pc=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.topleft,1],[t.topright,1]]},hc=function(t){return[[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]},yc=[],dc=[],gc=[],mc=[],vc=[],_c=[],bc=[],wc=[];mc[1]=vc[1]=18,mc[169]=vc[169]=18,gc[4]=dc[4]=12,gc[166]=dc[166]=12,yc[16]=wc[16]=4,yc[154]=wc[154]=4,_c[64]=bc[64]=22,_c[106]=bc[106]=22,gc[2]=_c[2]=17,mc[2]=vc[2]=18,gc[168]=_c[168]=17,mc[168]=vc[168]=18,yc[8]=mc[8]=9,dc[8]=gc[8]=12,yc[162]=mc[162]=9,dc[162]=gc[162]=12,yc[32]=wc[32]=4,dc[32]=bc[32]=1,yc[138]=wc[138]=4,dc[138]=bc[138]=1,vc[128]=wc[128]=21,_c[128]=bc[128]=22,vc[42]=wc[42]=21,_c[42]=bc[42]=22,dc[5]=vc[5]=14,dc[165]=vc[165]=14,gc[20]=wc[20]=6,gc[150]=wc[150]=6,yc[80]=_c[80]=11,yc[90]=_c[90]=11,mc[65]=bc[65]=3,mc[105]=bc[105]=3,yc[160]=_c[160]=11,dc[160]=vc[160]=14,yc[10]=_c[10]=11,dc[10]=vc[10]=14,gc[130]=wc[130]=6,mc[130]=bc[130]=3,gc[40]=wc[40]=6,mc[40]=bc[40]=3,dc[101]=bc[101]=1,dc[69]=bc[69]=1,vc[149]=wc[149]=21,vc[21]=wc[21]=21,gc[86]=_c[86]=17,gc[84]=_c[84]=17,yc[89]=mc[89]=9,yc[81]=mc[81]=9,yc[96]=bc[96]=0,dc[96]=_c[96]=15,yc[74]=bc[74]=0,dc[74]=_c[74]=15,yc[24]=gc[24]=8,mc[24]=wc[24]=7,yc[146]=gc[146]=8,mc[146]=wc[146]=7,dc[6]=_c[6]=15,gc[6]=vc[6]=16,dc[164]=_c[164]=15,gc[164]=vc[164]=16,mc[129]=wc[129]=7,vc[129]=bc[129]=20,mc[41]=wc[41]=7,vc[41]=bc[41]=20,gc[66]=bc[66]=2,mc[66]=_c[66]=19,gc[104]=bc[104]=2,mc[104]=_c[104]=19,yc[144]=vc[144]=10,_c[144]=wc[144]=23,yc[26]=vc[26]=10,_c[26]=wc[26]=23,dc[36]=wc[36]=5,gc[36]=bc[36]=2,dc[134]=wc[134]=5,gc[134]=bc[134]=2,yc[9]=vc[9]=10,dc[9]=mc[9]=13,yc[161]=vc[161]=10,dc[161]=mc[161]=13,dc[37]=wc[37]=5,vc[37]=bc[37]=20,dc[133]=wc[133]=5,vc[133]=bc[133]=20,gc[148]=vc[148]=16,_c[148]=wc[148]=23,gc[22]=vc[22]=16,_c[22]=wc[22]=23,yc[82]=gc[82]=8,mc[82]=_c[82]=19,yc[88]=gc[88]=8,mc[88]=_c[88]=19,yc[73]=bc[73]=0,dc[73]=mc[73]=13,yc[97]=bc[97]=0,dc[97]=mc[97]=13,yc[145]=mc[145]=9,vc[145]=wc[145]=21,yc[25]=mc[25]=9,vc[25]=wc[25]=21,dc[70]=bc[70]=1,gc[70]=_c[70]=17,dc[100]=bc[100]=1,gc[100]=_c[100]=17,yc[34]=mc[34]=9,dc[34]=gc[34]=12,vc[34]=wc[34]=21,_c[34]=bc[34]=22,yc[136]=wc[136]=4,dc[136]=bc[136]=1,gc[136]=_c[136]=17,mc[136]=vc[136]=18,yc[35]=wc[35]=4,dc[35]=gc[35]=12,mc[35]=vc[35]=18,_c[35]=bc[35]=22,yc[153]=wc[153]=4,mc[153]=vc[153]=18,dc[102]=gc[102]=12,_c[102]=bc[102]=22,yc[155]=mc[155]=9,vc[155]=wc[155]=23,dc[103]=bc[103]=1,gc[103]=_c[103]=17,yc[152]=wc[152]=4,gc[152]=_c[152]=17,mc[152]=vc[152]=18,yc[156]=gc[156]=8,mc[156]=vc[156]=18,_c[156]=wc[156]=23,yc[137]=wc[137]=4,dc[137]=bc[137]=1,mc[137]=vc[137]=18,yc[139]=wc[139]=4,dc[139]=mc[139]=13,vc[139]=bc[139]=20,yc[98]=mc[98]=9,dc[98]=gc[98]=12,_c[98]=bc[98]=22,yc[99]=bc[99]=0,dc[99]=gc[99]=12,mc[99]=_c[99]=19,dc[38]=gc[38]=12,vc[38]=wc[38]=21,_c[38]=bc[38]=22,dc[39]=wc[39]=5,gc[39]=vc[39]=16,_c[39]=bc[39]=22;var Sc=[];function Oc(t,e,r){var n,i=e[0]-t[0],o=e[1]-t[1],a=r[0]-e[0];return((n=i*(r[1]-e[1])-a*o)>0)-(n<0)||+n}function xc(t,e){return e.geometry.coordinates[0].every((function(e){return vl(ol(e),t)}))}Sc[1]=Sc[169]=ac,Sc[4]=Sc[166]=sc,Sc[16]=Sc[154]=uc,Sc[64]=Sc[106]=lc,Sc[168]=Sc[2]=cc,Sc[162]=Sc[8]=fc,Sc[138]=Sc[32]=pc,Sc[42]=Sc[128]=hc,Sc[5]=Sc[165]=function(t){return[[0,0],[0,t.leftbottom],[1,t.rightbottom],[1,0]]},Sc[20]=Sc[150]=function(t){return[[1,0],[t.bottomright,0],[t.topright,1],[1,1]]},Sc[80]=Sc[90]=function(t){return[[1,1],[1,t.righttop],[0,t.lefttop],[0,1]]},Sc[65]=Sc[105]=function(t){return[[t.bottomleft,0],[0,0],[0,1],[t.topleft,1]]},Sc[160]=Sc[10]=function(t){return[[1,t.righttop],[1,t.rightbottom],[0,t.leftbottom],[0,t.lefttop]]},Sc[130]=Sc[40]=function(t){return[[t.topleft,1],[t.topright,1],[t.bottomright,0],[t.bottomleft,0]]},Sc[85]=function(){return[[0,0],[0,1],[1,1],[1,0]]},Sc[101]=Sc[69]=function(t){return[[1,t.rightbottom],[1,0],[0,0],[0,1],[t.topleft,1]]},Sc[149]=Sc[21]=function(t){return[[t.topright,1],[1,1],[1,0],[0,0],[0,t.leftbottom]]},Sc[86]=Sc[84]=function(t){return[[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[1,1]]},Sc[89]=Sc[81]=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,1]]},Sc[96]=Sc[74]=function(t){return[[1,t.righttop],[1,t.rightbottom],[0,t.lefttop],[0,1],[t.topleft,1]]},Sc[24]=Sc[146]=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[t.topright,1]]},Sc[6]=Sc[164]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop]]},Sc[129]=Sc[41]=function(t){return[[t.topright,1],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topleft,1]]},Sc[66]=Sc[104]=function(t){return[[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1],[t.topleft,1]]},Sc[144]=Sc[26]=function(t){return[[1,1],[1,t.righttop],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},Sc[36]=Sc[134]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[t.topleft,1],[t.topright,1]]},Sc[9]=Sc[161]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,t.leftbottom]]},Sc[37]=Sc[133]=function(t){return[[1,t.rightbottom],[1,0],[0,0],[0,t.leftbottom],[t.topleft,1],[t.topright,1]]},Sc[148]=Sc[22]=function(t){return[[1,1],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},Sc[82]=Sc[88]=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1]]},Sc[73]=Sc[97]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,1],[t.topleft,1]]},Sc[145]=Sc[25]=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topright,1]]},Sc[70]=Sc[100]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[t.topleft,1]]},Sc[34]=function(t){return[hc(t),fc(t)]},Sc[35]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]},Sc[136]=function(t){return[pc(t),cc(t)]},Sc[153]=function(t){return[uc(t),ac(t)]},Sc[102]=function(t){return[sc(t),lc(t)]},Sc[155]=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topright,1]]},Sc[103]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[t.topleft,1]]},Sc[152]=function(t){return[uc(t),cc(t)]},Sc[156]=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},Sc[137]=function(t){return[pc(t),ac(t)]},Sc[139]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topleft,1],[t.topright,1]]},Sc[98]=function(t){return[fc(t),lc(t)]},Sc[99]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1],[t.topleft,1]]},Sc[38]=function(t){return[sc(t),hc(t)]},Sc[39]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]};const Cc=function(){function t(e){this.id=t.buildId(e),this.coordinates=e,this.innerEdges=[],this.outerEdges=[],this.outerEdgesSorted=!1}return t.buildId=function(t){return t.join(",")},t.prototype.removeInnerEdge=function(t){this.innerEdges=this.innerEdges.filter((function(e){return e.from.id!==t.from.id}))},t.prototype.removeOuterEdge=function(t){this.outerEdges=this.outerEdges.filter((function(e){return e.to.id!==t.to.id}))},t.prototype.addOuterEdge=function(t){this.outerEdges.push(t),this.outerEdgesSorted=!1},t.prototype.sortOuterEdges=function(){var t=this;this.outerEdgesSorted||(this.outerEdges.sort((function(e,r){var n=e.to,i=r.to;if(n.coordinates[0]-t.coordinates[0]>=0&&i.coordinates[0]-t.coordinates[0]<0)return 1;if(n.coordinates[0]-t.coordinates[0]<0&&i.coordinates[0]-t.coordinates[0]>=0)return-1;if(n.coordinates[0]-t.coordinates[0]==0&&i.coordinates[0]-t.coordinates[0]==0)return n.coordinates[1]-t.coordinates[1]>=0||i.coordinates[1]-t.coordinates[1]>=0?n.coordinates[1]-i.coordinates[1]:i.coordinates[1]-n.coordinates[1];var o=Oc(t.coordinates,n.coordinates,i.coordinates);return o<0?1:o>0?-1:Math.pow(n.coordinates[0]-t.coordinates[0],2)+Math.pow(n.coordinates[1]-t.coordinates[1],2)-(Math.pow(i.coordinates[0]-t.coordinates[0],2)+Math.pow(i.coordinates[1]-t.coordinates[1],2))})),this.outerEdgesSorted=!0)},t.prototype.getOuterEdges=function(){return this.sortOuterEdges(),this.outerEdges},t.prototype.getOuterEdge=function(t){return this.sortOuterEdges(),this.outerEdges[t]},t.prototype.addInnerEdge=function(t){this.innerEdges.push(t)},t}(),Ec=function(){function t(t,e){this.from=t,this.to=e,this.next=void 0,this.label=void 0,this.symetric=void 0,this.ring=void 0,this.from.addOuterEdge(this),this.to.addInnerEdge(this)}return t.prototype.getSymetric=function(){return this.symetric||(this.symetric=new t(this.to,this.from),this.symetric.symetric=this),this.symetric},t.prototype.deleteEdge=function(){this.from.removeOuterEdge(this),this.to.removeInnerEdge(this)},t.prototype.isEqual=function(t){return this.from.id===t.from.id&&this.to.id===t.to.id},t.prototype.toString=function(){return"Edge { "+this.from.id+" -> "+this.to.id+" }"},t.prototype.toLineString=function(){return sl([this.from.coordinates,this.to.coordinates])},t.prototype.compareTo=function(t){return Oc(t.from.coordinates,t.to.coordinates,this.to.coordinates)},t}();var Pc=function(){function t(){this.edges=[],this.polygon=void 0,this.envelope=void 0}return t.prototype.push=function(t){this.edges.push(t),this.polygon=this.envelope=void 0},t.prototype.get=function(t){return this.edges[t]},Object.defineProperty(t.prototype,"length",{get:function(){return this.edges.length},enumerable:!0,configurable:!0}),t.prototype.forEach=function(t){this.edges.forEach(t)},t.prototype.map=function(t){return this.edges.map(t)},t.prototype.some=function(t){return this.edges.some(t)},t.prototype.isValid=function(){return!0},t.prototype.isHole=function(){var t=this,e=this.edges.reduce((function(e,r,n){return r.from.coordinates[1]>t.edges[e].from.coordinates[1]&&(e=n),e}),0),r=(0===e?this.length:e)-1,n=(e+1)%this.length,i=Oc(this.edges[r].from.coordinates,this.edges[e].from.coordinates,this.edges[n].from.coordinates);return 0===i?this.edges[r].from.coordinates[0]>this.edges[n].from.coordinates[0]:i>0},t.prototype.toMultiPoint=function(){return function(t,e,r){return void 0===r&&(r={}),il({type:"MultiPoint",coordinates:t},e,r)}(this.edges.map((function(t){return t.from.coordinates})))},t.prototype.toPolygon=function(){if(this.polygon)return this.polygon;var t=this.edges.map((function(t){return t.from.coordinates}));return t.push(this.edges[0].from.coordinates),this.polygon=al([t])},t.prototype.getEnvelope=function(){return this.envelope?this.envelope:this.envelope=(t=this.toPolygon(),function(t,e){void 0===e&&(e={});var r=Number(t[0]),n=Number(t[1]),i=Number(t[2]),o=Number(t[3]);if(6===t.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var a=[r,n];return al([[a,[i,n],[i,o],[r,o],a]],e.properties,{bbox:t,id:e.id})}(dl(t)));var t},t.findEdgeRingContaining=function(t,e){var r,n,i=t.getEnvelope();return e.forEach((function(e){var o,a,s,u,l,c,f=e.getEnvelope();if(n&&(r=n.getEnvelope()),a=i,s=(o=f).geometry.coordinates[0].map((function(t){return t[0]})),u=o.geometry.coordinates[0].map((function(t){return t[1]})),l=a.geometry.coordinates[0].map((function(t){return t[0]})),c=a.geometry.coordinates[0].map((function(t){return t[1]})),(Math.max.apply(null,s)!==Math.max.apply(null,l)||Math.max.apply(null,u)!==Math.max.apply(null,c)||Math.min.apply(null,s)!==Math.min.apply(null,l)||Math.min.apply(null,u)!==Math.min.apply(null,c))&&xc(f,i)){for(var p=t.map((function(t){return t.from.coordinates})),h=void 0,y=function(t){e.some((function(e){return r=t,n=e.from.coordinates,r[0]===n[0]&&r[1]===n[1];var r,n}))||(h=t)},d=0,g=p;d<g.length;d++)y(g[d]);h&&e.inside(ol(h))&&(n&&!xc(r,f)||(n=e))}})),n},t.prototype.inside=function(t){return vl(t,this.toPolygon())},t}();const kc=Pc;function Tc(t){for(var e=t,r=[];e.parent;)r.unshift(e),e=e.parent;return r}!function(){function t(){this.edges=[],this.nodes={}}t.fromGeoJson=function(e){!function(t){if(!t)throw new Error("No geojson passed");if("FeatureCollection"!==t.type&&"GeometryCollection"!==t.type&&"MultiLineString"!==t.type&&"LineString"!==t.type&&"Feature"!==t.type)throw new Error("Invalid input type '"+t.type+"'. Geojson must be FeatureCollection, GeometryCollection, LineString, MultiLineString or Feature")}(e);var r=new t;return hl(e,(function(t){var e,n,i;!function(t,e,r){if(!t)throw new Error("No feature passed");if(!t||"Feature"!==t.type||!t.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.geometry.type)}(t,"LineString","Graph::fromGeoJson"),e=function(t,e){if(t){var n=r.getNode(t),i=r.getNode(e);r.addEdge(n,i)}return e},i=n,fl(t,(function(t,r,n,o,a){i=0===r?t:e(i,t)}),undefined)})),r},t.prototype.getNode=function(t){var e=Cc.buildId(t),r=this.nodes[e];return r||(r=this.nodes[e]=new Cc(t)),r},t.prototype.addEdge=function(t,e){var r=new Ec(t,e),n=r.getSymetric();this.edges.push(r),this.edges.push(n)},t.prototype.deleteDangles=function(){var t=this;Object.keys(this.nodes).map((function(e){return t.nodes[e]})).forEach((function(e){return t._removeIfDangle(e)}))},t.prototype._removeIfDangle=function(t){var e=this;if(t.innerEdges.length<=1){var r=t.getOuterEdges().map((function(t){return t.to}));this.removeNode(t),r.forEach((function(t){return e._removeIfDangle(t)}))}},t.prototype.deleteCutEdges=function(){var t=this;this._computeNextCWEdges(),this._findLabeledEdgeRings(),this.edges.forEach((function(e){e.label===e.symetric.label&&(t.removeEdge(e.symetric),t.removeEdge(e))}))},t.prototype._computeNextCWEdges=function(t){var e=this;void 0===t?Object.keys(this.nodes).forEach((function(t){return e._computeNextCWEdges(e.nodes[t])})):t.getOuterEdges().forEach((function(e,r){t.getOuterEdge((0===r?t.getOuterEdges().length:r)-1).symetric.next=e}))},t.prototype._computeNextCCWEdges=function(t,e){for(var r,n,i=t.getOuterEdges(),o=i.length-1;o>=0;--o){var a=i[o],s=a.symetric,u=void 0,l=void 0;a.label===e&&(u=a),s.label===e&&(l=s),u&&l&&(l&&(n=l),u&&(n&&(n.next=u,n=void 0),r||(r=u)))}n&&(n.next=r)},t.prototype._findLabeledEdgeRings=function(){var t=[],e=0;return this.edges.forEach((function(r){if(!(r.label>=0)){t.push(r);var n=r;do{n.label=e,n=n.next}while(!r.isEqual(n));e++}})),t},t.prototype.getEdgeRings=function(){var t=this;this._computeNextCWEdges(),this.edges.forEach((function(t){t.label=void 0})),this._findLabeledEdgeRings().forEach((function(e){t._findIntersectionNodes(e).forEach((function(r){t._computeNextCCWEdges(r,e.label)}))}));var e=[];return this.edges.forEach((function(r){r.ring||e.push(t._findEdgeRing(r))})),e},t.prototype._findIntersectionNodes=function(t){var e=[],r=t,n=function(){var n=0;r.from.getOuterEdges().forEach((function(e){e.label===t.label&&++n})),n>1&&e.push(r.from),r=r.next};do{n()}while(!t.isEqual(r));return e},t.prototype._findEdgeRing=function(t){var e=t,r=new kc;do{r.push(e),e.ring=r,e=e.next}while(!t.isEqual(e));return r},t.prototype.removeNode=function(t){var e=this;t.getOuterEdges().forEach((function(t){return e.removeEdge(t)})),t.innerEdges.forEach((function(t){return e.removeEdge(t)})),delete this.nodes[t.id]},t.prototype.removeEdge=function(t){this.edges=this.edges.filter((function(e){return!e.isEqual(t)})),t.deleteEdge()}}(),r(9657),r(2606),r(1160);var jc={search:function(t,e,r,n){t.cleanDirty();var i=(n=n||{}).heuristic||jc.heuristics.manhattan,o=n.closest||!1,a=new Ic((function(t){return t.f})),s=e;for(e.h=i(e,r),a.push(e);a.size()>0;){var u=a.pop();if(u===r)return Tc(u);u.closed=!0;for(var l=t.neighbors(u),c=0,f=l.length;c<f;++c){var p=l[c];if(!p.closed&&!p.isWall()){var h=u.g+p.getCost(u),y=p.visited;(!y||h<p.g)&&(p.visited=!0,p.parent=u,p.h=p.h||i(p,r),p.g=h,p.f=p.g+p.h,t.markDirty(p),o&&(p.h<s.h||p.h===s.h&&p.g<s.g)&&(s=p),y?a.rescoreElement(p):a.push(p))}}}return o?Tc(s):[]},heuristics:{manhattan:function(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)},diagonal:function(t,e){var r=Math.sqrt(2),n=Math.abs(e.x-t.x),i=Math.abs(e.y-t.y);return 1*(n+i)+(r-2)*Math.min(n,i)}},cleanNode:function(t){t.f=0,t.g=0,t.h=0,t.visited=!1,t.closed=!1,t.parent=null}};function Rc(t,e){e=e||{},this.nodes=[],this.diagonal=!!e.diagonal,this.grid=[];for(var r=0;r<t.length;r++){this.grid[r]=[];for(var n=0,i=t[r];n<i.length;n++){var o=new Lc(r,n,i[n]);this.grid[r][n]=o,this.nodes.push(o)}}this.init()}function Lc(t,e,r){this.x=t,this.y=e,this.weight=r}function Ic(t){this.content=[],this.scoreFunction=t}function Mc(){this._=null}function Ac(t){t.U=t.C=t.L=t.R=t.P=t.N=null}function Dc(t,e){var r=e,n=e.R,i=r.U;i?i.L===r?i.L=n:i.R=n:t._=n,n.U=i,r.U=n,r.R=n.L,r.R&&(r.R.U=r),n.L=r}function Nc(t,e){var r=e,n=e.L,i=r.U;i?i.L===r?i.L=n:i.R=n:t._=n,n.U=i,r.U=n,r.L=n.R,r.L&&(r.L.U=r),n.R=r}function Fc(t){for(;t.L;)t=t.L;return t}Rc.prototype.init=function(){this.dirtyNodes=[];for(var t=0;t<this.nodes.length;t++)jc.cleanNode(this.nodes[t])},Rc.prototype.cleanDirty=function(){for(var t=0;t<this.dirtyNodes.length;t++)jc.cleanNode(this.dirtyNodes[t]);this.dirtyNodes=[]},Rc.prototype.markDirty=function(t){this.dirtyNodes.push(t)},Rc.prototype.neighbors=function(t){var e=[],r=t.x,n=t.y,i=this.grid;return i[r-1]&&i[r-1][n]&&e.push(i[r-1][n]),i[r+1]&&i[r+1][n]&&e.push(i[r+1][n]),i[r]&&i[r][n-1]&&e.push(i[r][n-1]),i[r]&&i[r][n+1]&&e.push(i[r][n+1]),this.diagonal&&(i[r-1]&&i[r-1][n-1]&&e.push(i[r-1][n-1]),i[r+1]&&i[r+1][n-1]&&e.push(i[r+1][n-1]),i[r-1]&&i[r-1][n+1]&&e.push(i[r-1][n+1]),i[r+1]&&i[r+1][n+1]&&e.push(i[r+1][n+1])),e},Rc.prototype.toString=function(){for(var t,e,r,n,i=[],o=this.grid,a=0,s=o.length;a<s;a++){for(t=[],r=0,n=(e=o[a]).length;r<n;r++)t.push(e[r].weight);i.push(t.join(" "))}return i.join("\n")},Lc.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},Lc.prototype.getCost=function(t){return t&&t.x!==this.x&&t.y!==this.y?1.41421*this.weight:this.weight},Lc.prototype.isWall=function(){return 0===this.weight},Ic.prototype={push:function(t){this.content.push(t),this.sinkDown(this.content.length-1)},pop:function(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.bubbleUp(0)),t},remove:function(t){var e=this.content.indexOf(t),r=this.content.pop();e!==this.content.length-1&&(this.content[e]=r,this.scoreFunction(r)<this.scoreFunction(t)?this.sinkDown(e):this.bubbleUp(e))},size:function(){return this.content.length},rescoreElement:function(t){this.sinkDown(this.content.indexOf(t))},sinkDown:function(t){for(var e=this.content[t];t>0;){var r=(t+1>>1)-1,n=this.content[r];if(!(this.scoreFunction(e)<this.scoreFunction(n)))break;this.content[r]=e,this.content[t]=n,t=r}},bubbleUp:function(t){for(var e=this.content.length,r=this.content[t],n=this.scoreFunction(r);;){var i,o=t+1<<1,a=o-1,s=null;if(a<e){var u=this.content[a];(i=this.scoreFunction(u))<n&&(s=a)}if(o<e){var l=this.content[o];this.scoreFunction(l)<(null===s?n:i)&&(s=o)}if(null===s)break;this.content[t]=this.content[s],this.content[s]=r,t=s}}},Mc.prototype={constructor:Mc,insert:function(t,e){var r,n,i;if(t){if(e.P=t,e.N=t.N,t.N&&(t.N.P=e),t.N=e,t.R){for(t=t.R;t.L;)t=t.L;t.L=e}else t.R=e;r=t}else this._?(t=Fc(this._),e.P=null,e.N=t,t.P=t.L=e,r=t):(e.P=e.N=null,this._=e,r=null);for(e.L=e.R=null,e.U=r,e.C=!0,t=e;r&&r.C;)r===(n=r.U).L?(i=n.R)&&i.C?(r.C=i.C=!1,n.C=!0,t=n):(t===r.R&&(Dc(this,r),r=(t=r).U),r.C=!1,n.C=!0,Nc(this,n)):(i=n.L)&&i.C?(r.C=i.C=!1,n.C=!0,t=n):(t===r.L&&(Nc(this,r),r=(t=r).U),r.C=!1,n.C=!0,Dc(this,n)),r=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var e,r,n,i=t.U,o=t.L,a=t.R;if(r=o?a?Fc(a):o:a,i?i.L===t?i.L=r:i.R=r:this._=r,o&&a?(n=r.C,r.C=t.C,r.L=o,o.U=r,r!==a?(i=r.U,r.U=t.U,t=r.R,i.L=t,r.R=a,a.U=r):(r.U=i,i=r,t=r.R)):(n=t.C,t=r),t&&(t.U=i),!n)if(t&&t.C)t.C=!1;else{do{if(t===this._)break;if(t===i.L){if((e=i.R).C&&(e.C=!1,i.C=!0,Dc(this,i),e=i.R),e.L&&e.L.C||e.R&&e.R.C){e.R&&e.R.C||(e.L.C=!1,e.C=!0,Nc(this,e),e=i.R),e.C=i.C,i.C=e.R.C=!1,Dc(this,i),t=this._;break}}else if((e=i.L).C&&(e.C=!1,i.C=!0,Nc(this,i),e=i.L),e.L&&e.L.C||e.R&&e.R.C){e.L&&e.L.C||(e.R.C=!1,e.C=!0,Dc(this,e),e=i.L),e.C=i.C,i.C=e.L.C=!1,Nc(this,i),t=this._;break}e.C=!0,t=i,i=i.U}while(!t.C);t&&(t.C=!1)}}};const zc=Mc;function Gc(t,e,r,n){var i=[null,null],o=ff.push(i)-1;return i.left=t,i.right=e,r&&Vc(i,t,e,r),n&&Vc(i,e,t,n),lf[t.index].halfedges.push(o),lf[e.index].halfedges.push(o),i}function Bc(t,e,r){var n=[e,r];return n.left=t,n}function Vc(t,e,r,n){t[0]||t[1]?t.left===r?t[1]=n:t[0]=n:(t[0]=n,t.left=e,t.right=r)}function Uc(t,e,r,n,i){var o,a=t[0],s=t[1],u=a[0],l=a[1],c=0,f=1,p=s[0]-u,h=s[1]-l;if(o=e-u,p||!(o>0)){if(o/=p,p<0){if(o<c)return;o<f&&(f=o)}else if(p>0){if(o>f)return;o>c&&(c=o)}if(o=n-u,p||!(o<0)){if(o/=p,p<0){if(o>f)return;o>c&&(c=o)}else if(p>0){if(o<c)return;o<f&&(f=o)}if(o=r-l,h||!(o>0)){if(o/=h,h<0){if(o<c)return;o<f&&(f=o)}else if(h>0){if(o>f)return;o>c&&(c=o)}if(o=i-l,h||!(o<0)){if(o/=h,h<0){if(o>f)return;o>c&&(c=o)}else if(h>0){if(o<c)return;o<f&&(f=o)}return!(c>0||f<1)||(c>0&&(t[0]=[u+c*p,l+c*h]),f<1&&(t[1]=[u+f*p,l+f*h]),!0)}}}}}function qc(t,e,r,n,i){var o=t[1];if(o)return!0;var a,s,u=t[0],l=t.left,c=t.right,f=l[0],p=l[1],h=c[0],y=c[1],d=(f+h)/2,g=(p+y)/2;if(y===p){if(d<e||d>=n)return;if(f>h){if(u){if(u[1]>=i)return}else u=[d,r];o=[d,i]}else{if(u){if(u[1]<r)return}else u=[d,i];o=[d,r]}}else if(s=g-(a=(f-h)/(y-p))*d,a<-1||a>1)if(f>h){if(u){if(u[1]>=i)return}else u=[(r-s)/a,r];o=[(i-s)/a,i]}else{if(u){if(u[1]<r)return}else u=[(i-s)/a,i];o=[(r-s)/a,r]}else if(p<y){if(u){if(u[0]>=n)return}else u=[e,a*e+s];o=[n,a*n+s]}else{if(u){if(u[0]<e)return}else u=[n,a*n+s];o=[e,a*e+s]}return t[0]=u,t[1]=o,!0}function Wc(t,e){var r=t.site,n=e.left,i=e.right;return r===i&&(i=n,n=r),i?Math.atan2(i[1]-n[1],i[0]-n[0]):(r===n?(n=e[1],i=e[0]):(n=e[0],i=e[1]),Math.atan2(n[0]-i[0],i[1]-n[1]))}function Xc(t,e){return e[+(e.left!==t.site)]}function Zc(t,e){return e[+(e.left===t.site)]}var Hc,Yc=[];function Kc(){Ac(this),this.x=this.y=this.arc=this.site=this.cy=null}function Jc(t){var e=t.P,r=t.N;if(e&&r){var n=e.site,i=t.site,o=r.site;if(n!==o){var a=i[0],s=i[1],u=n[0]-a,l=n[1]-s,c=o[0]-a,f=o[1]-s,p=2*(u*f-l*c);if(!(p>=-hf)){var h=u*u+l*l,y=c*c+f*f,d=(f*h-l*y)/p,g=(u*y-c*h)/p,m=Yc.pop()||new Kc;m.arc=t,m.site=i,m.x=d+a,m.y=(m.cy=g+s)+Math.sqrt(d*d+g*g),t.circle=m;for(var v=null,_=cf._;_;)if(m.y<_.y||m.y===_.y&&m.x<=_.x){if(!_.L){v=_.P;break}_=_.L}else{if(!_.R){v=_;break}_=_.R}cf.insert(v,m),v||(Hc=m)}}}}function $c(t){var e=t.circle;e&&(e.P||(Hc=e.N),cf.remove(e),Yc.push(e),Ac(e),t.circle=null)}var Qc=[];function tf(){Ac(this),this.edge=this.site=this.circle=null}function ef(t){var e=Qc.pop()||new tf;return e.site=t,e}function rf(t){$c(t),uf.remove(t),Qc.push(t),Ac(t)}function nf(t){var e=t.circle,r=e.x,n=e.cy,i=[r,n],o=t.P,a=t.N,s=[t];rf(t);for(var u=o;u.circle&&Math.abs(r-u.circle.x)<pf&&Math.abs(n-u.circle.cy)<pf;)o=u.P,s.unshift(u),rf(u),u=o;s.unshift(u),$c(u);for(var l=a;l.circle&&Math.abs(r-l.circle.x)<pf&&Math.abs(n-l.circle.cy)<pf;)a=l.N,s.push(l),rf(l),l=a;s.push(l),$c(l);var c,f=s.length;for(c=1;c<f;++c)l=s[c],u=s[c-1],Vc(l.edge,u.site,l.site,i);u=s[0],(l=s[f-1]).edge=Gc(u.site,l.site,null,i),Jc(u),Jc(l)}function of(t){for(var e,r,n,i,o=t[0],a=t[1],s=uf._;s;)if((n=af(s,a)-o)>pf)s=s.L;else{if(!((i=o-sf(s,a))>pf)){n>-pf?(e=s.P,r=s):i>-pf?(e=s,r=s.N):e=r=s;break}if(!s.R){e=s;break}s=s.R}!function(t){lf[t.index]={site:t,halfedges:[]}}(t);var u=ef(t);if(uf.insert(e,u),e||r){if(e===r)return $c(e),r=ef(e.site),uf.insert(u,r),u.edge=r.edge=Gc(e.site,u.site),Jc(e),void Jc(r);if(r){$c(e),$c(r);var l=e.site,c=l[0],f=l[1],p=t[0]-c,h=t[1]-f,y=r.site,d=y[0]-c,g=y[1]-f,m=2*(p*g-h*d),v=p*p+h*h,_=d*d+g*g,b=[(g*v-h*_)/m+c,(p*_-d*v)/m+f];Vc(r.edge,l,y,b),u.edge=Gc(l,t,null,b),r.edge=Gc(t,y,null,b),Jc(e),Jc(r)}else u.edge=Gc(e.site,u.site)}}function af(t,e){var r=t.site,n=r[0],i=r[1],o=i-e;if(!o)return n;var a=t.P;if(!a)return-1/0;var s=(r=a.site)[0],u=r[1],l=u-e;if(!l)return s;var c=s-n,f=1/o-1/l,p=c/l;return f?(-p+Math.sqrt(p*p-2*f*(c*c/(-2*l)-u+l/2+i-o/2)))/f+n:(n+s)/2}function sf(t,e){var r=t.N;if(r)return af(r,e);var n=t.site;return n[1]===e?n[0]:1/0}var uf,lf,cf,ff,pf=1e-6,hf=1e-12;function yf(t,e){return e[1]-t[1]||e[0]-t[0]}function df(t,e){var r,n,i,o=t.sort(yf).pop();for(ff=[],lf=new Array(t.length),uf=new zc,cf=new zc;;)if(i=Hc,o&&(!i||o[1]<i.y||o[1]===i.y&&o[0]<i.x))o[0]===r&&o[1]===n||(of(o),r=o[0],n=o[1]),o=t.pop();else{if(!i)break;nf(i.arc)}if(function(){for(var t,e,r,n,i=0,o=lf.length;i<o;++i)if((t=lf[i])&&(n=(e=t.halfedges).length)){var a=new Array(n),s=new Array(n);for(r=0;r<n;++r)a[r]=r,s[r]=Wc(t,ff[e[r]]);for(a.sort((function(t,e){return s[e]-s[t]})),r=0;r<n;++r)s[r]=e[a[r]];for(r=0;r<n;++r)e[r]=s[r]}}(),e){var a=+e[0][0],s=+e[0][1],u=+e[1][0],l=+e[1][1];!function(t,e,r,n){for(var i,o=ff.length;o--;)qc(i=ff[o],t,e,r,n)&&Uc(i,t,e,r,n)&&(Math.abs(i[0][0]-i[1][0])>pf||Math.abs(i[0][1]-i[1][1])>pf)||delete ff[o]}(a,s,u,l),function(t,e,r,n){var i,o,a,s,u,l,c,f,p,h,y,d,g=lf.length,m=!0;for(i=0;i<g;++i)if(o=lf[i]){for(a=o.site,s=(u=o.halfedges).length;s--;)ff[u[s]]||u.splice(s,1);for(s=0,l=u.length;s<l;)y=(h=Zc(o,ff[u[s]]))[0],d=h[1],f=(c=Xc(o,ff[u[++s%l]]))[0],p=c[1],(Math.abs(y-f)>pf||Math.abs(d-p)>pf)&&(u.splice(s,0,ff.push(Bc(a,h,Math.abs(y-t)<pf&&n-d>pf?[t,Math.abs(f-t)<pf?p:n]:Math.abs(d-n)<pf&&r-y>pf?[Math.abs(p-n)<pf?f:r,n]:Math.abs(y-r)<pf&&d-e>pf?[r,Math.abs(f-r)<pf?p:e]:Math.abs(d-e)<pf&&y-t>pf?[Math.abs(p-e)<pf?f:t,e]:null))-1),++l);l&&(m=!1)}if(m){var v,_,b,w=1/0;for(i=0,m=null;i<g;++i)(o=lf[i])&&(b=(v=(a=o.site)[0]-t)*v+(_=a[1]-e)*_)<w&&(w=b,m=o);if(m){var S=[t,e],O=[t,n],x=[r,n],C=[r,e];m.halfedges.push(ff.push(Bc(a=m.site,S,O))-1,ff.push(Bc(a,O,x))-1,ff.push(Bc(a,x,C))-1,ff.push(Bc(a,C,S))-1)}}for(i=0;i<g;++i)(o=lf[i])&&(o.halfedges.length||delete lf[i])}(a,s,u,l)}this.edges=ff,this.cells=lf,uf=cf=ff=lf=null}function gf(){return new mf}function mf(){this.reset()}df.prototype={constructor:df,polygons:function(){var t=this.edges;return this.cells.map((function(e){var r=e.halfedges.map((function(r){return Xc(e,t[r])}));return r.data=e.site.data,r}))},triangles:function(){var t=[],e=this.edges;return this.cells.forEach((function(r,n){if(o=(i=r.halfedges).length)for(var i,o,a,s,u,l,c=r.site,f=-1,p=e[i[o-1]],h=p.left===c?p.right:p.left;++f<o;)a=h,h=(p=e[i[f]]).left===c?p.right:p.left,a&&h&&n<a.index&&n<h.index&&(u=a,l=h,((s=c)[0]-l[0])*(u[1]-s[1])-(s[0]-u[0])*(l[1]-s[1])<0)&&t.push([c.data,a.data,h.data])})),t},links:function(){return this.edges.filter((function(t){return t.right})).map((function(t){return{source:t.left.data,target:t.right.data}}))},find:function(t,e,r){for(var n,i,o=this,a=o._found||0,s=o.cells.length;!(i=o.cells[a]);)if(++a>=s)return null;var u=t-i.site[0],l=e-i.site[1],c=u*u+l*l;do{i=o.cells[n=a],a=null,i.halfedges.forEach((function(r){var n=o.edges[r],s=n.left;if(s!==i.site&&s||(s=n.right)){var u=t-s[0],l=e-s[1],f=u*u+l*l;f<c&&(c=f,a=s.index)}}))}while(null!==a);return o._found=n,null==r||c<=r*r?i.site:null}},r(2676),r(675),mf.prototype={constructor:mf,reset:function(){this.s=this.t=0},add:function(t){_f(vf,t,this.t),_f(this,vf.s,this.s),this.s?this.t+=vf.t:this.s=vf.t},valueOf:function(){return this.s}};var vf=new mf;function _f(t,e,r){var n=t.s=e+r,i=n-e,o=n-i;t.t=e-o+(r-i)}var bf=Math.PI,wf=bf/2,Sf=2*bf,Of=bf/180,xf=(Math.abs,Math.atan),Cf=Math.atan2,Ef=Math.cos,Pf=(Math.ceil,Math.exp,Math.floor,Math.log,Math.pow,Math.sin),kf=(Math.sign,Math.sqrt);Math.tan;function Tf(t){return t>1?wf:t<-1?-wf:Math.asin(t)}function jf(t,e){return[t>bf?t-Sf:t<-bf?t+Sf:t,e]}function Rf(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}gf(),gf(),gf(),jf.invert=jf;var Lf=function(t){var e;return 1===t.length&&(e=t,t=function(t,r){return Rf(e(t),r)}),{left:function(e,r,n,i){for(null==n&&(n=0),null==i&&(i=e.length);n<i;){var o=n+i>>>1;t(e[o],r)<0?n=o+1:i=o}return n},right:function(e,r,n,i){for(null==n&&(n=0),null==i&&(i=e.length);n<i;){var o=n+i>>>1;t(e[o],r)>0?i=o:n=o+1}return n}}}(Rf);Lf.right,Lf.left;var If=Array.prototype;If.slice,If.map,Math.sqrt(50),Math.sqrt(10),Math.sqrt(2);gf();function Mf(){}function Af(t){return function(e,r){var n=Ef(e),i=Ef(r),o=t(n*i);return[o*i*Pf(e),o*Pf(r)]}}function Df(t){return function(e,r){var n=kf(e*e+r*r),i=t(n),o=Pf(i),a=Ef(i);return[Cf(e*o,n*a),Tf(n&&r*o/n)]}}function Nf(t,e){return[t,e]}function Ff(t){return Ff="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ff(t)}function zf(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Gf(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Bf(n.key),n)}}function Bf(t){var e=function(t,e){if("object"!=Ff(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Ff(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ff(e)?e:String(e)}function Vf(){return Vf="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=qf(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},Vf.apply(this,arguments)}function Uf(t,e){return Uf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Uf(t,e)}function qf(t){return qf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},qf(t)}gf(),gf(),gf(),gf(),Mf.prototype={constructor:Mf,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},Ef(30*Of),Af((function(t){return kf(2/(1+t))})).invert=Df((function(t){return 2*Tf(t/2)})),Af((function(t){return(t=(e=t)>1?0:e<-1?bf:Math.acos(e))&&t/Pf(t);var e})).invert=Df((function(t){return t})),Nf.invert=Nf,Df(xf),Df(Tf),Df((function(t){return 2*xf(t)}));var Wf=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Uf(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=qf(n);if(i){var r=qf(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Ff(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,e))._animating=!1,r._speed=void 0,r._distance=300,r._index=0,r._segmentsLatlng=[],r._polyline=L.polyline([]),r._animatedMarker=void 0,r._historyPolyline=L.polyline([]),r._historyLatlngs=[],r._speed=e.speed||.1,r._layer.set("name",e.name||"trajectory"),r._layer.setZIndex(e.zIndex||1),r}return e=a,r=[{key:"_setDefaultStyle",value:function(){this._speed=this._options.speed||.1,this._polyline.setStyle({stroke:!0,color:this._options.strokeColor||"rgba(255,255,255,0.8)",weight:this._options.strokeWidth||5}),this._historyPolyline.setStyle({stroke:!0,color:this._options.fill||"rgba(0,0,0,0.9)",dashArray:this._options.lineDash||[5,5]})}},{key:"_getAngle",value:function(t,e){return Math.atan2(e.lat-t.lat,e.lng-t.lng)*(180/Math.PI)}},{key:"_getSegments",value:function(t){for(var e=[],r=0,n=1;n<t.length-1;n++){var i,o,a,s,u=t[n-1],l=t[n],c=t[n+1];0!=(l[1]-u[1])*(c[0]-l[0])-(c[1]-l[1])*(l[0]-u[0])?(null!==(o=e[i=r])&&void 0!==o||(e[i]=[]),e[r].push(L.fromLonLat(u)),e[r].push(L.fromLonLat(l)),r++):(null!==(s=e[a=r])&&void 0!==s||(e[a]=[]),e[r].push(L.fromLonLat(u)))}var f=this._distance/1e3;e.forEach((function(t){for(var e=sl(t.map((function(t){return[t.lng,t.lat]}))),r=function(t,e){return void 0===e&&(e={}),function(t,e,r){var n=r,i=!1;return function(t,e){hl(t,(function(t,r,n){var i=0;if(t.geometry){var o=t.geometry.type;if("Point"!==o&&"MultiPoint"!==o){var a,s=0,u=0,l=0;return!1!==fl(t,(function(o,c,f,p,h){if(void 0===a||r>s||p>u||h>l)return a=o,s=r,u=p,l=h,void(i=0);var y=sl([a,o],t.properties);if(!1===e(y,r,n,h,i))return!1;i++,a=o}))&&void 0}}}))}(t,(function(t,o,a,s,u){n=!1===i&&void 0===r?t:e(n,t,o,a,s,u),i=!0})),n}(t,(function(t,r){var n=r.geometry.coordinates;return t+bl(n[0],n[1],e)}),0)}(e,{units:"kilometers"}),n=t.pop(),i=0;i<r;)t.push(L.fromLonLat(Tl(e,i+=f,{units:"kilometers"}).geometry.coordinates));t.push(n)})),this._segmentsLatlng=e}},{key:"_getCoordinates",value:function(){var t=[],e=this._segmentsLatlng.length;return this._segmentsLatlng.forEach((function(r,n){var i;t.push.apply(t,function(t){if(Array.isArray(t))return zf(t)}(i=r)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(i)||function(t,e){if(t){if("string"==typeof t)return zf(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?zf(t,e):void 0}}(i)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),n!==e-1&&t.pop()})),t}},{key:"_reset",value:function(){this._index=0,this._animating=!0,this._historyLatlngs.length=0,this._historyPolyline.setLatLngs([]),this._setDefaultStyle(),requestAnimationFrame(this._animation.bind(this))}},{key:"_animation",value:function(){var t=this;if(this._animating){if(this._index>=this._segmentsLatlng.length)return void(this._animating=!1);var e=this._segmentsLatlng[this._index],r=this._getAngle(e[0],e[e.length-1]);r>0?r=90-r:r<0&&(r=Math.abs(r)+90),this._animatedMarker?(this._animatedMarker.setRotationAngle(r),this._animatedMarker.setLine(e),this._animatedMarker.start()):(this._animatedMarker=L.animatedMarker(e,{distance:this._distance,interval:this._speed,icon:L.icon({iconUrl:this._options.iconUrl,iconAnchor:this._options.imgOffset||[12,24],iconSize:this._options.imgSize||[24,48]}),autoStart:!1,onEnd:function(e){t._animation()},onAnimate:function(e,r){0===r?t._historyLatlngs.push(e):t._historyPolyline.setLatLngs(t._historyLatlngs.concat(e))}}),this._animatedMarker.setRotationAngle(r),this._animatedMarker.start(),this.addFeature(this._animatedMarker)),this._index++}}},{key:"create",value:function(t){var e=t.points||t.route||[];return this._getSegments(e),this._polyline.setLatLngs(e.map((function(t){return L.fromLonLat(t)}))),this.addFeature(this._polyline),this.addFeature(this._historyPolyline),this}},{key:"start",value:function(){this._reset()}},{key:"stop",value:function(){this._animatedMarker.stop()}},{key:"getCenterCoordinates",value:function(t){var e=L.latLngBounds([]);return t.forEach((function(t){e.extend(L.fromLonLat(t))})),L.toLonLat(e.getCenter())}},{key:"dispose",value:function(){Vf(qf(a.prototype),"dispose",this).call(this),this.stop(),this._historyLatlngs.length=0}}],r&&Gf(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(Xs);function Xf(t){return Xf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Xf(t)}function Zf(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Hf(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Yf(n.key),n)}}function Yf(t){var e=function(t,e){if("object"!=Xf(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Xf(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Xf(e)?e:String(e)}function Kf(){return Kf="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Qf(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},Kf.apply(this,arguments)}function Jf(t,e){return Jf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Jf(t,e)}function $f(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Qf(t){return Qf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Qf(t)}var tp=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Jf(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Qf(n);if(i){var r=Qf(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Xf(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return $f(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,e))._draw=void 0,r._style=void 0,r._defaultStyleOptions={radius:6,strokeColor:"rgba(255, 0, 255, 0.5)",strokeWidth:6,background:{strokeColor:"rgba(255, 255, 255, 1)",strokeWidth:2},fill:"rgba(255, 255, 255, 0.5)",interactive:!1},r._startMarker=L.circleMarker([0,0]),r._polyline=L.polyline([],{fill:!0}),r._start=!1,r._move=!1,r._latlngs=[],r.___mapEvent=r._mapEvent.bind($f(r)),r._completeCallback=void 0,r._polylinePoint=[],r._movePoint=void 0,nt(r._defaultStyleOptions,e),r._layer.set("name",e.name||"drawLine"),r._layer.setZIndex(e.zIndex||1e3),r._layer.setStyle((function(t){return r._stateService.getStyle(t,"default",r._defaultStyleOptions)})),r._initEvent(),r}return e=a,(r=[{key:"drawType",get:function(){return this.options.type||"LineString"}},{key:"_initEvent",value:function(){ws.on("moveend",this.___mapEvent,void 0,{uncontrolled:!0}),ws.on("mousemove",this.___mapEvent,void 0,{uncontrolled:!0},this._map.getContainer()),ws.on("click",this.___mapEvent,void 0,{uncontrolled:!0},this._map.getContainer()),ws.on("dblclick",this.___mapEvent,void 0,{uncontrolled:!0},this._map.getContainer()),ws.on("contextmenu",this.___mapEvent,void 0,{uncontrolled:!0},this._map.getContainer())}},{key:"_createPolylinePoint",value:function(t){var e;0===this._latlngs.length?this.fire("drawstart"):this.fire("drawchange",this._latlngs.map((function(t){return L.toLonLat(t)})),L.toLonLat(t)),this._latlngs.push(t),this._polyline.setLatLngs(function(t){if(Array.isArray(t))return Zf(t)}(e=this._latlngs)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||function(t,e){if(t){if("string"==typeof t)return Zf(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Zf(t,e):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());var r=L.circleMarker(t);r.setRadius(this._defaultStyleOptions.radius),this._polylinePoint.push(r),this.addFeature(r)}},{key:"_mapEvent",value:function(t){if("moveend"!==t.type){if("contextmenu"===t.type)return t.preventDefault(),t.stopPropagation(),this._start&&this.rmLastPoint(),!1;var e=this._map.containerPointToLatLng(L.point(t.pageX,t.pageY));if("mousemove"===t.type)this._movePoint=e,this._startMarker.setLatLng(e),this._start&&this._latlngs.length>0&&this._polyline.setLatLngs(this._latlngs.concat(this._movePoint));else{if(this._move)return void(this._move=!1);if(!this._start)return;"dblclick"===t.type?(this._latlngs.pop(),this._start=!1,this._completeCallback&&(this._completeCallback(this.getValue()),this.fire("drawend"),this._reset())):this._createPolylinePoint(e)}}else this._move=!0}},{key:"_reset",value:function(){this._startMarker.setRadius(this._defaultStyleOptions.radius),this._latlngs.length=0,this._polyline.setLatLngs([]),this._polyline.setStyle({path:{fill:"Polygon"===this.drawType},kind:"bimmap"}),this.removeFeature(this._polylinePoint),this._start=!0}},{key:"draw",value:function(t){return ws._appHandler.setOptions({disabled:!0}),this._completeCallback=t,this.addFeature(this._startMarker),this.addFeature(this._polyline),this._reset(),this}},{key:"getValue",value:function(){return this._latlngs.map((function(t){return L.toLonLat(t)}))}},{key:"rmLastPoint",value:function(){return this._polylinePoint.length>0&&(this.removeFeature(this._polylinePoint.pop()),this._latlngs.pop(),0===this._latlngs.length&&this._polyline.setLatLngs([])),this}},{key:"dispose",value:function(){Kf(Qf(a.prototype),"dispose",this).call(this),this._reset(),this._start=!1,ws.off(this.___mapEvent,"moveend"),ws.off(this.___mapEvent,"moveend",this._map.getContainer()),ws.off(this.___mapEvent,"click",this._map.getContainer()),ws.off(this.___mapEvent,"dblclick",this._map.getContainer()),ws.off(this.___mapEvent,"contextmenu",this._map.getContainer()),ws._appHandler.setOptions({disabled:!1})}}])&&Hf(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(Xs);function ep(t){return ep="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ep(t)}function rp(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,np(n.key),n)}}function np(t){var e=function(t,e){if("object"!=ep(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=ep(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ep(e)?e:String(e)}function ip(t,e){return ip=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ip(t,e)}function op(t){return op=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},op(t)}var ap=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ip(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=op(n);if(i){var r=op(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===ep(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),r=o.call(this,t,e),L.heatLayer?r._layer=L.heatLayer([],{blur:e.blur||20,radius:e.radius||20,maxZoom:r._map.getMaxZoom(),minOpacity:1,max:1,gradient:{0:"rgba(0, 0, 255, 0)",.3:"cyan",.4:"lime",.7:"#ffff00",.8:"orange",1:"#ff0000"}}):rt("使用热力图必须引用插件[leaflet-heat.js]！"),r._layer.set("name",e.name||"heatMap"),r}return e=a,r=[{key:"_convertLonlat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return[t[1],t[0],e]}},{key:"create",value:function(t){var e=this;return L.heatLayer?(Array.isArray(t)?this._layer.addLatLng(t.map((function(t){return e._convertLonlat(t.point)}))):this._layer.addLatLng(this._convertLonlat(t.point)),this):(rt("使用热力图必须引用插件[leaflet-heat.js]！"),this)}}],r&&rp(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(Xs);function sp(t){return sp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sp(t)}function up(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,lp(n.key),n)}}function lp(t){var e=function(t,e){if("object"!=sp(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=sp(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==sp(e)?e:String(e)}function cp(t,e){return cp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},cp(t,e)}function fp(t){return fp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},fp(t)}var pp=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&cp(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=fp(n);if(i){var r=fp(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===sp(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,e))._layer.set("name",e.name||"loadGeojson"),r._layer.setZIndex(e.zIndex||1),r._layer.setStyle((function(t){return r._stateService.getStyle(t,"default",{text:t.get("name")})})),r}return e=a,r=[{key:"loadUrl",value:function(t){var e=this;return new Promise((function(r,n){fetch(t).then((function(t){return t.json()})).then((function(t){e.load(t,r)})).catch((function(){r(!1)}))}))}},{key:"load",value:function(t,e){var r=L.geoJSON(t,{pointToLayer:function(t,e){return L.marker(e)}}).getLayers();return this.addFeature(r),e&&e(!0),this}}],r&&up(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(Xs);function hp(t){return hp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},hp(t)}function yp(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,dp(n.key),n)}}function dp(t){var e=function(t,e){if("object"!=hp(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=hp(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==hp(e)?e:String(e)}function gp(t,e){return gp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},gp(t,e)}function mp(t){return mp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},mp(t)}var vp=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&gp(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=mp(n);if(i){var r=mp(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===hp(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,e))._layer.set("name",e.name||"kml"),r._layer.setZIndex(e.zIndex||1),r._layer.setStyle((function(t){return r._stateService.getStyle(t,"default")})),r}return e=a,r=[{key:"load",value:function(t,e){var r=this;return fetch(t).then((function(t){return t.text()})).then((function(t){var n=new L.KML(t);if(r.addFeature(n),null!=e&&e.flyTo){var i=n.getBounds();r._map.fitBounds(i)}})).catch((function(e){console.error("加载 kml 失败：",t,e)})),this}}],r&&yp(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(Xs);function _p(t){return _p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_p(t)}var bp=["name","flyTo","bounds","zoom"];function wp(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Sp(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Op(n.key),n)}}function Op(t){var e=function(t,e){if("object"!=_p(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=_p(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==_p(e)?e:String(e)}function xp(){return xp="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ep(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},xp.apply(this,arguments)}function Cp(t,e){return Cp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Cp(t,e)}function Ep(t){return Ep=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ep(t)}var Pp=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Cp(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ep(n);if(i){var r=Ep(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===_p(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this))._layer=L.featureGroup(),r._layers=[],r.map=void 0,r.map=t,r._layer.set("name",e.name||"tileLayerAdmin"),r._layer.setZIndex(e.zIndex||1),r.map.addLayer(r._layer),r}return e=a,r=[{key:"_addLayer",value:function(t){this._layers.includes(t)||(this._layers.push(t),this._layer.addLayer(t))}},{key:"load",value:function(t,e){var r=e||{},n=r.name,i=(r.flyTo,r.bounds),o=r.zoom,a=function(t,e){if(null==t)return{};var r,n,i=function(t,e){if(null==t)return{};var r,n,i={},o=Object.keys(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||(i[r]=t[r]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}(r,bp),s=i?L.latLngBounds(L.fromLonLat(i[0]),L.fromLonLat(i[1])):void 0,u=L.tileLayer(t,function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?wp(Object(r),!0).forEach((function(e){var n,i,o;n=t,i=e,o=r[e],(i=Op(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):wp(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({tms:!0,opacity:.9,attribution:"",minZoom:this.map.getZoom(),maxZoom:this.map.getMaxZoom(),bounds:s},a));return n&&u.set("name",n,!0),this._addLayer(u),s&&this.map.flyTo(s.getCenter(),o,{duration:1}),this}},{key:"find",value:function(t){return this._layers.find((function(e){return e.get("name",!0)===t}))}},{key:"remove",value:function(t){if(t){var e=this._layers.findIndex((function(e){return e.get("name",!0)===t}));e>=0&&(this._layer.removeLayer(this._layers[e]),this._layers.slice(e,1))}else this._layers.length=0,this._layer.clearLayers();return this}},{key:"setVisible",value:function(t,e){var r=this.find(t);return r&&(e?this._layer.hasLayer(r)||this._layer.addLayer(r):this._layer.hasLayer(r)&&this._layer.removeLayer(r)),this}},{key:"dispose",value:function(){xp(Ep(a.prototype),"dispose",this).call(this),this._layers.length=0,this.map.removeLayer(this._layer)}}],r&&Sp(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t);function kp(t){return kp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kp(t)}function Tp(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function jp(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Tp(Object(r),!0).forEach((function(e){var n,i,o;n=t,i=e,o=r[e],(i=Lp(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Tp(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Rp(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Lp(n.key),n)}}function Lp(t){var e=function(t,e){if("object"!=kp(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=kp(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==kp(e)?e:String(e)}function Ip(){return Ip="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ap(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},Ip.apply(this,arguments)}function Mp(t,e){return Mp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Mp(t,e)}function Ap(t){return Ap=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ap(t)}var Dp=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Mp(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ap(n);if(i){var r=Ap(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===kp(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this)).map=void 0,r._options=void 0,r._drawInstance=null,r._layer=L.featureGroup(),r.map=t,r._options=e,r._layer.set("name",e.name||"measure"),r._layer.setZIndex(e.zIndex||1),t.addLayer(r._layer),r}return e=a,r=[{key:"_setStyle",value:function(t,e,r){e.setStyle(t.layer.getStyle()),e.bindTooltip(L.tooltip({content:r}),{permanent:!0}),this._layer.addLayer(e)}},{key:"distance",value:function(t,e){var r=this;this._drawInstance&&this.clear(!0);var n=new tp(this.map,jp(jp({name:"distance",strokeColor:"rgba(81, 255,0,1)",radius:6,strokeWidth:2,fill:"rgba(225, 229,0,0.2)",background:{strokeColor:"rgba(225, 229,0,1)",strokeWidth:2}},e),{},{type:"LineString"}));this.map.addLayer(n.layer);var i=[];this._drawInstance={draw:n,features:i},n.addEventListener("drawstart",(function(t){if(!0===r._options.drawClear)for(;i.length>0;)r._layer.removeLayer(i.pop())})),n.draw((function(e){var o=0;if(e.length>1)for(var a=1;a<e.length;a++)o+=L.fromLonLat(e[a-1]).distanceTo(L.fromLonLat(e[a]))/1e3;t(o);var s=L.polyline(L.fromLonLat(e));r._setStyle(n,s,"".concat(o.toFixed(3)," km")),i.push(s)}))}},{key:"area",value:function(t,e){var r=this;this._drawInstance&&this.clear(!0);var n=new tp(this.map,jp(jp({name:"area",strokeColor:"rgba(81, 255,0,1)",radius:6,strokeWidth:2,fill:"rgba(225, 229,0,0.2)",background:{strokeColor:"rgba(225, 229,0,1)",strokeWidth:2}},e),{},{type:"Polygon"}));this.map.addLayer(n.layer);var i=[];this._drawInstance={draw:n,features:i},n.addEventListener("drawstart",(function(){if(!0===r._options.drawClear)for(;i.length>0;)r._layer.removeLayer(i.pop())})),n.draw((function(e){var o=ft(Cl(al([e.length>1&&e[0][0]!==e[e.length-1][0]&&e[0][1]!==e[e.length-1][1]?e.concat([e[0]]):e])));t(o);var a=L.polygon(L.fromLonLat(e));r._setStyle(n,a,"".concat(o.toFixed(3)," km²")),i.push(a)}))}},{key:"clear",value:function(t){var e=this;this._drawInstance&&(this._drawInstance.features.forEach((function(t,r){t.unbindTooltip(),e._layer.removeLayer(t)})),this._drawInstance.features.length=0,t&&(this._drawInstance.draw.dispose(),this.map.addLayer(this._drawInstance.draw.layer),this._drawInstance=null))}},{key:"dispose",value:function(){Ip(Ap(a.prototype),"dispose",this).call(this),this.clear(!0),this._layer.clearLayers(),this.map.removeLayer(this._layer)}}],r&&Rp(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t);function Np(t){return Np="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Np(t)}var Fp=["url","type","maxZoom","key"],zp=["url","maxZoom"],Gp=["url","type","format","maxZoom"],Bp=["url","params","token"],Vp=["duration","zoom"];function Up(t,e){if(null==t)return{};var r,n,i=function(t,e){if(null==t)return{};var r,n,i={},o=Object.keys(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||(i[r]=t[r]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function qp(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Wp(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?qp(Object(r),!0).forEach((function(e){var n,i,o;n=t,i=e,o=r[e],(i=Zp(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):qp(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Xp(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Zp(n.key),n)}}function Zp(t){var e=function(t,e){if("object"!=Np(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Np(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Np(e)?e:String(e)}function Hp(t,e){return Hp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Hp(t,e)}function Yp(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Kp(t){return Kp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Kp(t)}var Jp=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Hp(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Kp(n);if(i){var r=Kp(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Np(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Yp(t)}(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=o.call(this))._instance=new Lr(Yp(e)),e._mapLayers=[],e._options=void 0,e._domMarker=void 0,e._options=t,e}return e=a,r=[{key:"L",get:function(){return window.L}},{key:"map",get:function(){if(this._dispose)throw Error("BimMap(leaflet)资源已被释放，请重新实例化后使用！");return this._map}},{key:"instances",get:function(){return this._instance.instances}},{key:"instancesToName",get:function(){return this._instance.instancesToName}},{key:"interactions",get:function(){return[]}},{key:"overlays",get:function(){return this._domMarker.overlays}},{key:"options",get:function(){return this._options}},{key:"_init",value:function(t){var e,r;return this._map=L.map(t.target,Wp({preferCanvas:!0,center:L.fromLonLat([103.11767578125001,30.72294882477251]),zoom:7,maxZoom:14,minZoom:5,zoomControl:!1,zoomAnimation:!0,attributionControl:!1,crs:L.CRS.EPSG3857,doubleClickZoom:!1,renderer:(e=L.canvas(),r=e._updatePoly,e._updatePoly=function(t){if(t.has("_lineDash",!0)){var e=t.options,n=e._dashArray,i=e.color;e._dashArray=[],e.color=t.get("_lineDash",!0),r.call(this,t),e._dashArray=n,e.color=i}r.call(this,t)},e._renderPath=function(){this._updatePoly(this._poly)},e)},t)),ws.setMap(this._map),this._map._appHandler=ws,t.useControl&&L.control.zoom({position:"bottomright"}).addTo(this._map),this._domMarker=new Au(this._map),this._map}},{key:"addView",value:function(t){var e=t.maxZoom,r=void 0===e?18:e,n=t.proj,i=void 0===n?"EPSG:3857":n,o=t.center,a=t.zoom,s=t.minZoom,u=this._options;return"EPSG:3857"!==i&&(u.crs=L.CRS.EPSG4326),s&&(u.minZoom=s),r&&(u.maxZoom=r),a&&(u.zoom=a),o&&o.length>1&&(u.center=L.fromLonLat(o)),this._init(this._options),this.map}},{key:"removeMapLayer",value:function(){var t=this;return this._mapLayers.forEach((function(e){return t.map.removeLayer(e)})),this}},{key:"useTianDiTu",value:function(t){var e=this,r=t||{},n=r.url,i=r.type,o=void 0===i?["img","cia"]:i,a=r.maxZoom,u=r.key,l=void 0===u?"99bc0b8df065eb27b289330adfe75fd8":u,c=Up(r,Fp),f=n?[n]:o.map((function(t){var e=s(t,c.proj),r=e.split("_");return"https://{s}.tianditu.gov.cn/".concat(e,"/wmts?service=wmts&request=gettile&version=1.0.0&layer=").concat(r[0],"&style=default&tilematrixset=").concat(r[1],"&tilematrix={z}&tilerow={y}&tilecol={x}&format=tiles&tk=").concat(l)}));f.forEach((function(t){var r=L.tileLayer(t,Wp({subdomains:["t0","t1","t2","t3","t4","t5","t6","t7"],attribution:"© 天地图",minZoom:e.map.getMinZoom()||3,maxZoom:a||e.map.getMaxZoom()||13,zoomOffset:1},c));e._mapLayers.push(r),e.map.addLayer(r)}))}},{key:"useMapboxVT",value:function(t){var e=L.mapboxGL({style:t.url});this._mapLayers.push(e),e.addTo(this.map)}},{key:"useXYZ",value:function(t){var e=this,r=t||{},n=(r.url,r.maxZoom),i=Up(r,zp);(null!=t&&t.url?[null==t?void 0:t.url]:!0===(null==t?void 0:t.dark)?["https://webst02.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}","https://webst02.is.autonavi.com/appmaptile?style=8&x={x}&y={y}&z={z}"]:["https://webrd01.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}"]).forEach((function(t){var r=L.tileLayer(t,Wp({minZoom:e.map.getMinZoom()||3,maxZoom:n||e.map.getMaxZoom()||13,attribution:"© 高德地图",crossOrigin:"anonymous"},i));e._mapLayers.push(r),e.map.addLayer(r)}))}},{key:"useWMTS",value:function(t){var e=t.url,r=t.type,n=t.format,i=t.maxZoom,o=Up(t,Gp),a=L.tileLayer.wms(e,Wp({crs:this.map.options.crs,layers:r,format:n,minZoom:this.map.getMinZoom()||3,maxZoom:i||this.map.getMaxZoom()||13},o)),s=this._mapLayers.push(a);this.map.addLayer(a);var u=this;return{setVisible:function(t){t?u.map.hasLayer(a)||u.map.addLayer(a):u.map.hasLayer(a)&&u.map.removeLayer(a)},remove:function(){u._mapLayers.splice(s,1),u.map.removeLayer(a)}}}},{key:"useWMS",value:function(t){var e=t.url,r=t.params,n=t.token,i=Up(t,Bp),o=r.BBOX.split(",").map((function(t){return Number(t)}));Reflect.deleteProperty(r,"BBOX");var a=L.tileLayer.wms(e,Wp({accessToken:n,uppercase:!0,transparent:!0,bounds:L.latLngBounds(L.fromLonLat([o[0],o[1]]),L.fromLonLat([o[2],o[3]]))},i));a.setParams(Wp({service:"WMS",layers:"0,1",format:"image/png",transparent:!0,styles:"",version:"1.1.0"},r));var s=this._mapLayers.push(a);this.map.addLayer(a);var u=this;return{setVisible:function(t){t?u.map.hasLayer(a)||u.map.addLayer(a):u.map.hasLayer(a)&&u.map.removeLayer(a)},remove:function(){u._mapLayers.splice(s,1),u.map.removeLayer(a)}}}},{key:"GridPolygon",value:function(t){return this._instance.add(new el(this.map,t),!0)}},{key:"LayerGroupAdmin",value:function(t){return this._instance.add(new Ja(this.map,t))}},{key:"AreaMapStyle",value:function(t){return this._instance.add(new tu(this.map,t),!0)}},{key:"ClusterPoint",value:function(t){return this._instance.add(new pu(this.map,t),!0)}},{key:"IconMarker",value:function(t){return this._instance.add(new bu(this.map,t),!0)}},{key:"DomMarker",value:function(t){return this._instance.add(new Au(this.map,t))}},{key:"Text",value:function(t){return this._instance.add(new Bu(this.map,t),!0)}},{key:"Line",value:function(t){return this._instance.add(new Zu(this.map,t),!0)}},{key:"Trajectory",value:function(t){return this._instance.add(new Wf(this.map,t),!0)}},{key:"DrawLine",value:function(t){return this._instance.add(new tp(this.map,t),!0)}},{key:"HeatMap",value:function(t){return this._instance.add(new ap(this.map,t),!0)}},{key:"Kml",value:function(t){return this._instance.add(new vp(this.map,t),!0)}},{key:"TileLayerAdmin",value:function(t){return this._instance.add(new Pp(this.map,t),!0)}},{key:"LoadGeojson",value:function(t){return this._instance.add(new pp(this.map,t),!0)}},{key:"Measure",value:function(t){return this._instance.add(new Dp(this.map,t),!0)}},{key:"addOverlay",value:function(t){var e,r,n=t.id?this._domMarker.find((function(e){return e.get("id")===t.id})):null;return n?null===(e=this._domMarker)||void 0===e||e.update(n,t):null===(r=this._domMarker)||void 0===r||r.create(t),this}},{key:"removeOverlay",value:function(t){return t?this._domMarker.removeOverlay(t):this._domMarker.clearOverlays(),this}},{key:"removeInstance",value:function(t){return this._instance.remove(t),this}},{key:"getLonLat",value:function(t){if(t instanceof MouseEvent){var e=this.map.containerPointToLatLng(L.point(t.pageX,t.pageY));return[e.lng,e.lat]}var r=this.map.containerPointToLatLng(L.point(t.x,t.y));return[r.lng,r.lat]}},{key:"setCenter",value:function(t,e){return this.map.stop(),this.map.flyTo(L.fromLonLat(t),void 0,{duration:lt(e)}),this}},{key:"setZoom",value:function(t,e){var r=this.map.getCenter();return this.map.stop(),this.map.flyTo(r,t,{duration:lt(e)}),this}},{key:"zoomTo",value:function(t){return!t.zoom||t.zoom<this.map.getMinZoom()||t.zoom>this.map.getMaxZoom()?this.setCenter(t.point,t.duration):(this.map.stop(),this.map.flyTo(L.fromLonLat(t.point),t.zoom,{duration:lt(t.duration)})),this}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"flyTo",value:function(t,e){var r=e||{},n=r.duration,i=r.zoom,o=Up(r,Vp);return this.map.stop(),this.map.flyTo(Oa(t),i||this.map.getZoom(),Wp({duration:lt(n,!0,1)},o||{})),this}},{key:"getEntityCenterCoordinate",value:function(t){return xa(Array.isArray(t)?t.map((function(t){return t.getGeometry()})):t.getGeometry())}},{key:"getCoordinatesCenter",value:function(t){return r=e=t,Array.isArray(r)?L.latLngBounds(e).getCenter():r;var e,r}},{key:"getCoordinateFromFeature",value:function(t){if(Array.isArray(t)){var e=[];return t.forEach((function(t){e.push(xa(t))})),e}return xa(t)}},{key:"hasFeatureInView",value:function(t,e){var r=this.map.getBounds();if(!e&&!Array.isArray(t))return t.getLatLng?r.contains(t.getLatLng()):!!t.getBounds&&r.contains(t.getBounds());e&&(Array.isArray(t)?t:[t]).forEach((function(t){t.getLatLng?e(t,r.contains(t.getLatLng())):t.getBounds?e(t,r.contains(t.getBounds())):e(t,!1)}))}},{key:"clear",value:function(){return this.clearLayers(),this}},{key:"resize",value:function(){return this.map.invalidateSize({debounceMoveend:!0}),this}},{key:"render",value:function(){return this.map.fireEvent("viewreset"),this}},{key:"on",value:function(t,e){return ws.on(t,e),this}},{key:"off",value:function(t,e){return ws.off(e,t),this}},{key:"zoomChange",value:function(t){return ws.onZoom(t),this}},{key:"removeZoomChange",value:function(t){return ws.offZoom(t),this}},{key:"dispose",value:function(){this._dispose||(this._instance.dispose(),this.clear(),ws.clear(),this._map.remove(),this._map=null)}},{key:"removeMap",value:function(){this.removeMapLayer(),console.warn("函数 => removeMap : 将在下一版本移除，请使用removeMapLayer！")}},{key:"unon",value:function(t){console.warn("函数 => unon : 将在下一版本移除，请使用off！")}},{key:"removeInteraction",value:function(t){}},{key:"addInteraction",value:function(t){}},{key:"searchInteractions",value:function(t){}},{key:"searchInteraction",value:function(t){}},{key:"clearSelection",value:function(){}}],r&&Xp(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(za);function $p(){return function(){throw new Error("Unimplemented abstract method.")}()}var Qp=0;function th(t){return t.ol_uid||(t.ol_uid=String(++Qp))}function eh(t){return t[0]>0&&t[1]>0}function rh(t,e){return Array.isArray(t)?t:(void 0===e?e=[t,t]:(e[0]=t,e[1]=t),e)}var nh=function(){function t(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=rh(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}return t.prototype.clone=function(){var e=this.getScale();return new t({opacity:this.getOpacity(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})},t.prototype.getOpacity=function(){return this.opacity_},t.prototype.getRotateWithView=function(){return this.rotateWithView_},t.prototype.getRotation=function(){return this.rotation_},t.prototype.getScale=function(){return this.scale_},t.prototype.getScaleArray=function(){return this.scaleArray_},t.prototype.getDisplacement=function(){return this.displacement_},t.prototype.getDeclutterMode=function(){return this.declutterMode_},t.prototype.getAnchor=function(){return $p()},t.prototype.getImage=function(t){return $p()},t.prototype.getHitDetectionImage=function(){return $p()},t.prototype.getPixelRatio=function(t){return 1},t.prototype.getImageState=function(){return $p()},t.prototype.getImageSize=function(){return $p()},t.prototype.getOrigin=function(){return $p()},t.prototype.getSize=function(){return $p()},t.prototype.setDisplacement=function(t){this.displacement_=t},t.prototype.setOpacity=function(t){this.opacity_=t},t.prototype.setRotateWithView=function(t){this.rotateWithView_=t},t.prototype.setRotation=function(t){this.rotation_=t},t.prototype.setScale=function(t){this.scale_=t,this.scaleArray_=rh(t)},t.prototype.listenImageChange=function(t){$p()},t.prototype.load=function(){$p()},t.prototype.unlistenImageChange=function(t){$p()},t}();const ih=nh;var oh,ah=(oh=function(t,e){return oh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},oh(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}oh(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});const sh=function(t){function e(e){var r=this,n="Assertion failed. See https://openlayers.org/en/v"+"6.15.1".split("-")[0]+"/doc/errors/#"+e+" for details.";return(r=t.call(this,n)||this).code=e,r.name="AssertionError",r.message=n,r}return ah(e,t),e}(Error);function uh(t,e){if(!t)throw new sh(e)}function lh(t,e,r){return Math.min(Math.max(t,e),r)}var ch="cosh"in Math?Math.cosh:function(t){var e=Math.exp(t);return(e+1/e)/2},fh="log2"in Math?Math.log2:function(t){return Math.log(t)*Math.LOG2E};function ph(t,e,r,n,i,o){var a=i-r,s=o-n;if(0!==a||0!==s){var u=((t-r)*a+(e-n)*s)/(a*a+s*s);u>1?(r=i,n=o):u>0&&(r+=a*u,n+=s*u)}return hh(t,e,r,n)}function hh(t,e,r,n){var i=r-t,o=n-e;return i*i+o*o}function yh(t){return t*Math.PI/180}function dh(t,e){var r=t%e;return r*e<0?r+e:r}function gh(t,e,r){return t+r*(e-t)}function mh(t,e){var r=Math.pow(10,e);return Math.round(t*r)/r}function vh(t,e){return Math.floor(mh(t,e))}function _h(t,e){return Math.ceil(mh(t,e))}var bh=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,wh=/^([a-z]*)$|^hsla?\(.*\)$/i;function Sh(t){return"string"==typeof t?t:Eh(t)}var Oh=function(){var t={},e=0;return function(r){var n;if(t.hasOwnProperty(r))n=t[r];else{if(e>=1024){var i=0;for(var o in t)0==(3&i++)&&(delete t[o],--e)}n=function(t){var e,r,n,i,o;if(wh.exec(t)&&(t=function(t){var e=document.createElement("div");if(e.style.color=t,""!==e.style.color){document.body.appendChild(e);var r=getComputedStyle(e).color;return document.body.removeChild(e),r}return""}(t)),bh.exec(t)){var a,s=t.length-1;a=s<=4?1:2;var u=4===s||8===s;e=parseInt(t.substr(1+0*a,a),16),r=parseInt(t.substr(1+1*a,a),16),n=parseInt(t.substr(1+2*a,a),16),i=u?parseInt(t.substr(1+3*a,a),16):255,1==a&&(e=(e<<4)+e,r=(r<<4)+r,n=(n<<4)+n,u&&(i=(i<<4)+i)),o=[e,r,n,i/255]}else 0==t.indexOf("rgba(")?Ch(o=t.slice(5,-1).split(",").map(Number)):0==t.indexOf("rgb(")?((o=t.slice(4,-1).split(",").map(Number)).push(1),Ch(o)):uh(!1,14);return o}(r),t[r]=n,++e}return n}}();function xh(t){return Array.isArray(t)?t:Oh(t)}function Ch(t){return t[0]=lh(t[0]+.5|0,0,255),t[1]=lh(t[1]+.5|0,0,255),t[2]=lh(t[2]+.5|0,0,255),t[3]=lh(t[3],0,1),t}function Eh(t){var e=t[0];e!=(0|e)&&(e=e+.5|0);var r=t[1];r!=(0|r)&&(r=r+.5|0);var n=t[2];return n!=(0|n)&&(n=n+.5|0),"rgba("+e+","+r+","+n+","+(void 0===t[3]?1:Math.round(100*t[3])/100)+")"}function Ph(t){return Array.isArray(t)?Eh(t):t}var kh="undefined"!=typeof navigator&&void 0!==navigator.userAgent?navigator.userAgent.toLowerCase():"",Th=-1!==kh.indexOf("firefox"),jh=(-1!==kh.indexOf("safari")&&-1==kh.indexOf("chrom")&&(kh.indexOf("version/15.4")>=0||kh.match(/cpu (os|iphone os) 15_4 like mac os x/)),-1!==kh.indexOf("webkit")&&-1==kh.indexOf("edge")),Rh=-1!==kh.indexOf("macintosh"),Lh="undefined"!=typeof devicePixelRatio?devicePixelRatio:1,Ih="undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof OffscreenCanvas&&self instanceof WorkerGlobalScope,Mh="undefined"!=typeof Image&&Image.prototype.decode,Ah=function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch(t){}return t}();function Dh(t,e,r,n){var i;return i=r&&r.length?r.shift():Ih?new OffscreenCanvas(t||300,e||300):document.createElement("canvas"),t&&(i.width=t),e&&(i.height=e),i.getContext("2d",n)}function Nh(t){var e=t.canvas;e.width=1,e.height=1,t.clearRect(0,0,1,1)}function Fh(t,e){var r=e.parentNode;r&&r.replaceChild(t,e)}function zh(t){return t&&t.parentNode?t.parentNode.removeChild(t):null}const Gh=function(){function t(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}return t.prototype.preventDefault=function(){this.defaultPrevented=!0},t.prototype.stopPropagation=function(){this.propagationStopped=!0},t}(),Bh="propertychange",Vh=function(){function t(){this.disposed=!1}return t.prototype.dispose=function(){this.disposed||(this.disposed=!0,this.disposeInternal())},t.prototype.disposeInternal=function(){},t}();function Uh(t,e){return t>e?1:t<e?-1:0}function qh(t,e,r){var n=t.length;if(t[0]<=e)return 0;if(e<=t[n-1])return n-1;var i=void 0;if(r>0){for(i=1;i<n;++i)if(t[i]<e)return i-1}else if(r<0){for(i=1;i<n;++i)if(t[i]<=e)return i}else for(i=1;i<n;++i){if(t[i]==e)return i;if(t[i]<e)return"function"==typeof r?r(e,t[i-1],t[i])>0?i-1:i:t[i-1]-e<e-t[i]?i-1:i}return n-1}function Wh(t,e,r){for(;e<r;){var n=t[e];t[e]=t[r],t[r]=n,++e,--r}}function Xh(t,e){for(var r=Array.isArray(e)?e:[e],n=r.length,i=0;i<n;i++)t[t.length]=r[i]}function Zh(t,e){var r=t.length;if(r!==e.length)return!1;for(var n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}function Hh(){return!0}function Yh(){return!1}function Kh(){}var Jh="function"==typeof Object.assign?Object.assign:function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(t),n=1,i=arguments.length;n<i;++n){var o=arguments[n];if(null!=o)for(var a in o)o.hasOwnProperty(a)&&(r[a]=o[a])}return r};function $h(t){for(var e in t)delete t[e]}var Qh="function"==typeof Object.values?Object.values:function(t){var e=[];for(var r in t)e.push(t[r]);return e};function ty(t){var e;for(e in t)return!1;return!e}var ey=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const ry=function(t){function e(e){var r=t.call(this)||this;return r.eventTarget_=e,r.pendingRemovals_=null,r.dispatching_=null,r.listeners_=null,r}return ey(e,t),e.prototype.addEventListener=function(t,e){if(t&&e){var r=this.listeners_||(this.listeners_={}),n=r[t]||(r[t]=[]);-1===n.indexOf(e)&&n.push(e)}},e.prototype.dispatchEvent=function(t){var e="string"==typeof t,r=e?t:t.type,n=this.listeners_&&this.listeners_[r];if(n){var i=e?new Gh(t):t;i.target||(i.target=this.eventTarget_||this);var o,a=this.dispatching_||(this.dispatching_={}),s=this.pendingRemovals_||(this.pendingRemovals_={});r in a||(a[r]=0,s[r]=0),++a[r];for(var u=0,l=n.length;u<l;++u)if(!1===(o="handleEvent"in n[u]?n[u].handleEvent(i):n[u].call(this,i))||i.propagationStopped){o=!1;break}if(0==--a[r]){var c=s[r];for(delete s[r];c--;)this.removeEventListener(r,Kh);delete a[r]}return o}},e.prototype.disposeInternal=function(){this.listeners_&&$h(this.listeners_)},e.prototype.getListeners=function(t){return this.listeners_&&this.listeners_[t]||void 0},e.prototype.hasListener=function(t){return!!this.listeners_&&(t?t in this.listeners_:Object.keys(this.listeners_).length>0)},e.prototype.removeEventListener=function(t,e){var r=this.listeners_&&this.listeners_[t];if(r){var n=r.indexOf(e);-1!==n&&(this.pendingRemovals_&&t in this.pendingRemovals_?(r[n]=Kh,++this.pendingRemovals_[t]):(r.splice(n,1),0===r.length&&delete this.listeners_[t]))}},e}(Vh),ny="change",iy="contextmenu",oy="click",ay="keydown",sy="keypress",uy="touchmove",ly="wheel";function cy(t,e,r,n,i){if(n&&n!==t&&(r=r.bind(n)),i){var o=r;r=function(){t.removeEventListener(e,r),o.apply(this,arguments)}}var a={target:t,type:e,listener:r};return t.addEventListener(e,r),a}function fy(t,e,r,n){return cy(t,e,r,n,!0)}function py(t){t&&t.target&&(t.target.removeEventListener(t.type,t.listener),$h(t))}var hy=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),yy=function(t){function e(){var e=t.call(this)||this;return e.on=e.onInternal,e.once=e.onceInternal,e.un=e.unInternal,e.revision_=0,e}return hy(e,t),e.prototype.changed=function(){++this.revision_,this.dispatchEvent(ny)},e.prototype.getRevision=function(){return this.revision_},e.prototype.onInternal=function(t,e){if(Array.isArray(t)){for(var r=t.length,n=new Array(r),i=0;i<r;++i)n[i]=cy(this,t[i],e);return n}return cy(this,t,e)},e.prototype.onceInternal=function(t,e){var r;if(Array.isArray(t)){var n=t.length;r=new Array(n);for(var i=0;i<n;++i)r[i]=fy(this,t[i],e)}else r=fy(this,t,e);return e.ol_key=r,r},e.prototype.unInternal=function(t,e){var r=e.ol_key;if(r)!function(t){if(Array.isArray(t))for(var e=0,r=t.length;e<r;++e)py(t[e]);else py(t)}(r);else if(Array.isArray(t))for(var n=0,i=t.length;n<i;++n)this.removeEventListener(t[n],e);else this.removeEventListener(t,e)},e}(ry);yy.prototype.on,yy.prototype.once,yy.prototype.un;const dy=yy;var gy=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),my=function(t){function e(e,r,n){var i=t.call(this,e)||this;return i.key=r,i.oldValue=n,i}return gy(e,t),e}(Gh);const vy=function(t){function e(e){var r=t.call(this)||this;return r.on,r.once,r.un,th(r),r.values_=null,void 0!==e&&r.setProperties(e),r}return gy(e,t),e.prototype.get=function(t){var e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e},e.prototype.getKeys=function(){return this.values_&&Object.keys(this.values_)||[]},e.prototype.getProperties=function(){return this.values_&&Jh({},this.values_)||{}},e.prototype.hasProperties=function(){return!!this.values_},e.prototype.notify=function(t,e){var r;r="change:".concat(t),this.hasListener(r)&&this.dispatchEvent(new my(r,t,e)),r=Bh,this.hasListener(r)&&this.dispatchEvent(new my(r,t,e))},e.prototype.addChangeListener=function(t,e){this.addEventListener("change:".concat(t),e)},e.prototype.removeChangeListener=function(t,e){this.removeEventListener("change:".concat(t),e)},e.prototype.set=function(t,e,r){var n=this.values_||(this.values_={});if(r)n[t]=e;else{var i=n[t];n[t]=e,i!==e&&this.notify(t,i)}},e.prototype.setProperties=function(t,e){for(var r in t)this.set(r,t[r],e)},e.prototype.applyProperties=function(t){t.values_&&Jh(this.values_||(this.values_={}),t.values_)},e.prototype.unset=function(t,e){if(this.values_&&t in this.values_){var r=this.values_[t];delete this.values_[t],ty(this.values_)&&(this.values_=null),e||this.notify(t,r)}},e}(dy);var _y="ol-hidden",by="ol-unselectable",wy="ol-control",Sy="ol-collapsed",Oy=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))","?\\s*([-,\\\"\\'\\sa-z]+?)\\s*$"].join(""),"i"),xy=["style","variant","weight","size","lineHeight","family"],Cy=function(t){var e=t.match(Oy);if(!e)return null;for(var r={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"},n=0,i=xy.length;n<i;++n){var o=e[n+1];void 0!==o&&(r[xy[n]]=o)}return r.families=r.family.split(/,\s?/),r},Ey="10px sans-serif",Py="#000",ky="round",Ty=[],jy="round",Ry="#000",Ly="center",Iy="middle",My=[0,0,0,0],Ay=new vy;(new ry).setSize=function(){console.warn("labelCache is deprecated.")};var Dy,Ny,Fy=null,zy={},Gy=function(){var t,e,r="32px ",n=["monospace","serif"],i=n.length,o="wmytzilWMYTZIL@#/&?$%10";function a(t,a,s){for(var u=!0,l=0;l<i;++l){var c=n[l];if(e=Uy(t+" "+a+" "+r+c,o),s!=c){var f=Uy(t+" "+a+" "+r+s+","+c,o);u=u&&f!=e}}return!!u}function s(){for(var e=!0,r=Ay.getKeys(),n=0,i=r.length;n<i;++n){var o=r[n];Ay.get(o)<100&&(a.apply(this,o.split("\n"))?($h(zy),Fy=null,Dy=void 0,Ay.set(o,100)):(Ay.set(o,Ay.get(o)+1,!0),e=!1))}e&&(clearInterval(t),t=void 0)}return function(e){var r=Cy(e);if(r)for(var n=r.families,i=0,o=n.length;i<o;++i){var u=n[i],l=r.style+"\n"+r.weight+"\n"+u;void 0===Ay.get(l)&&(Ay.set(l,100,!0),a(r.style,r.weight,u)||(Ay.set(l,0,!0),void 0===t&&(t=setInterval(s,32))))}}}(),By=function(t){var e=zy[t];if(null==e){if(Ih){var r=Cy(t),n=Vy(t,"Žg");e=(isNaN(Number(r.lineHeight))?1.2:Number(r.lineHeight))*(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)}else Ny||((Ny=document.createElement("div")).innerHTML="M",Ny.style.minHeight="0",Ny.style.maxHeight="none",Ny.style.height="auto",Ny.style.padding="0",Ny.style.border="none",Ny.style.position="absolute",Ny.style.display="block",Ny.style.left="-99999px"),Ny.style.font=t,document.body.appendChild(Ny),e=Ny.offsetHeight,document.body.removeChild(Ny);zy[t]=e}return e};function Vy(t,e){return Fy||(Fy=Dh(1,1)),t!=Dy&&(Fy.font=t,Dy=Fy.font),Fy.measureText(e)}function Uy(t,e){return Vy(t,e).width}function qy(t,e,r){if(e in r)return r[e];var n=e.split("\n").reduce((function(e,r){return Math.max(e,Uy(t,r))}),0);return r[e]=n,n}var Wy=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Xy=function(t){function e(e){var r=this,n=void 0!==e.rotateWithView&&e.rotateWithView;return(r=t.call(this,{opacity:1,rotateWithView:n,rotation:void 0!==e.rotation?e.rotation:0,scale:void 0!==e.scale?e.scale:1,displacement:void 0!==e.displacement?e.displacement:[0,0],declutterMode:e.declutterMode})||this).canvas_=void 0,r.hitDetectionCanvas_=null,r.fill_=void 0!==e.fill?e.fill:null,r.origin_=[0,0],r.points_=e.points,r.radius_=void 0!==e.radius?e.radius:e.radius1,r.radius2_=e.radius2,r.angle_=void 0!==e.angle?e.angle:0,r.stroke_=void 0!==e.stroke?e.stroke:null,r.size_=null,r.renderOptions_=null,r.render(),r}return Wy(e,t),e.prototype.clone=function(){var t=this.getScale(),r=new e({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return r.setOpacity(this.getOpacity()),r},e.prototype.getAnchor=function(){var t=this.size_;if(!t)return null;var e=this.getDisplacement();return[t[0]/2-e[0],t[1]/2+e[1]]},e.prototype.getAngle=function(){return this.angle_},e.prototype.getFill=function(){return this.fill_},e.prototype.setFill=function(t){this.fill_=t,this.render()},e.prototype.getHitDetectionImage=function(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_},e.prototype.getImage=function(t){var e=this.canvas_[t];if(!e){var r=this.renderOptions_,n=Dh(r.size*t,r.size*t);this.draw_(r,n,t),e=n.canvas,this.canvas_[t]=e}return e},e.prototype.getPixelRatio=function(t){return t},e.prototype.getImageSize=function(){return this.size_},e.prototype.getImageState=function(){return 2},e.prototype.getOrigin=function(){return this.origin_},e.prototype.getPoints=function(){return this.points_},e.prototype.getRadius=function(){return this.radius_},e.prototype.getRadius2=function(){return this.radius2_},e.prototype.getSize=function(){return this.size_},e.prototype.getStroke=function(){return this.stroke_},e.prototype.setStroke=function(t){this.stroke_=t,this.render()},e.prototype.listenImageChange=function(t){},e.prototype.load=function(){},e.prototype.unlistenImageChange=function(t){},e.prototype.calculateLineJoinSize_=function(t,e,r){if(0===e||this.points_===1/0||"bevel"!==t&&"miter"!==t)return e;var n=this.radius_,i=void 0===this.radius2_?n:this.radius2_;if(n<i){var o=n;n=i,i=o}var a=void 0===this.radius2_?this.points_:2*this.points_,s=2*Math.PI/a,u=i*Math.sin(s),l=n-Math.sqrt(i*i-u*u),c=Math.sqrt(u*u+l*l),f=c/u;if("miter"===t&&f<=r)return f*e;var p=e/2/f,h=e/2*(l/c),y=Math.sqrt((n+p)*(n+p)+h*h)-n;if(void 0===this.radius2_||"bevel"===t)return 2*y;var d=n*Math.sin(s),g=i-Math.sqrt(n*n-d*d),m=Math.sqrt(d*d+g*g)/d;if(m<=r){var v=m*e/2-i-n;return 2*Math.max(y,v)}return 2*y},e.prototype.createRenderOptions=function(){var t,e=jy,r=0,n=null,i=0,o=0;this.stroke_&&(null===(t=this.stroke_.getColor())&&(t=Ry),t=Ph(t),void 0===(o=this.stroke_.getWidth())&&(o=1),n=this.stroke_.getLineDash(),i=this.stroke_.getLineDashOffset(),void 0===(e=this.stroke_.getLineJoin())&&(e=jy),void 0===(r=this.stroke_.getMiterLimit())&&(r=10));var a=this.calculateLineJoinSize_(e,o,r),s=Math.max(this.radius_,this.radius2_||0);return{strokeStyle:t,strokeWidth:o,size:Math.ceil(2*s+a),lineDash:n,lineDashOffset:i,lineJoin:e,miterLimit:r}},e.prototype.render=function(){this.renderOptions_=this.createRenderOptions();var t=this.renderOptions_.size;this.canvas_={},this.size_=[t,t]},e.prototype.draw_=function(t,e,r){if(e.scale(r,r),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){var n=this.fill_.getColor();null===n&&(n=Py),e.fillStyle=Ph(n),e.fill()}this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,e.setLineDash&&t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())},e.prototype.createHitDetectionCanvas_=function(t){if(this.fill_){var e=this.fill_.getColor(),r=0;if("string"==typeof e&&(e=xh(e)),null===e?r=1:Array.isArray(e)&&(r=4===e.length?e[3]:1),0===r){var n=Dh(t.size,t.size);this.hitDetectionCanvas_=n.canvas,this.drawHitDetectionCanvas_(t,n)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))},e.prototype.createPath_=function(t){var e=this.points_,r=this.radius_;if(e===1/0)t.arc(0,0,r,0,2*Math.PI);else{var n=void 0===this.radius2_?r:this.radius2_;void 0!==this.radius2_&&(e*=2);for(var i=this.angle_-Math.PI/2,o=2*Math.PI/e,a=0;a<e;a++){var s=i+a*o,u=a%2==0?r:n;t.lineTo(u*Math.cos(s),u*Math.sin(s))}t.closePath()}},e.prototype.drawHitDetectionCanvas_=function(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=Py,e.fill(),this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())},e}(ih);const Zy=Xy;var Hy=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Yy=function(t){function e(e){var r=e||{};return t.call(this,{points:1/0,fill:r.fill,radius:r.radius,stroke:r.stroke,scale:void 0!==r.scale?r.scale:1,rotation:void 0!==r.rotation?r.rotation:0,rotateWithView:void 0!==r.rotateWithView&&r.rotateWithView,displacement:void 0!==r.displacement?r.displacement:[0,0],declutterMode:r.declutterMode})||this}return Hy(e,t),e.prototype.clone=function(){var t=this.getScale(),r=new e({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return r.setOpacity(this.getOpacity()),r},e.prototype.setRadius=function(t){this.radius_=t,this.render()},e}(Zy);const Ky=Yy;var Jy=function(){function t(t){var e=t||{};this.color_=void 0!==e.color?e.color:null}return t.prototype.clone=function(){var e=this.getColor();return new t({color:Array.isArray(e)?e.slice():e||void 0})},t.prototype.getColor=function(){return this.color_},t.prototype.setColor=function(t){this.color_=t},t}();const $y=Jy,Qy="fraction",td="pixels",ed="bottom-left",rd="bottom-right",nd="top-left",id="top-right";function od(t,e,r){return e+":"+t+":"+(r?Sh(r):"null")}var ad=new(function(){function t(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}return t.prototype.clear=function(){this.cache_={},this.cacheSize_=0},t.prototype.canExpireCache=function(){return this.cacheSize_>this.maxCacheSize_},t.prototype.expire=function(){if(this.canExpireCache()){var t=0;for(var e in this.cache_){var r=this.cache_[e];0!=(3&t++)||r.hasListener()||(delete this.cache_[e],--this.cacheSize_)}}},t.prototype.get=function(t,e,r){var n=od(t,e,r);return n in this.cache_?this.cache_[n]:null},t.prototype.set=function(t,e,r,n){var i=od(t,e,r);this.cache_[i]=n,++this.cacheSize_},t.prototype.setSize=function(t){this.maxCacheSize_=t,this.expire()},t}()),sd=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const ud=function(t){function e(e,r,n,i){var o=t.call(this)||this;return o.extent=e,o.pixelRatio_=n,o.resolution=r,o.state=i,o}return sd(e,t),e.prototype.changed=function(){this.dispatchEvent(ny)},e.prototype.getExtent=function(){return this.extent},e.prototype.getImage=function(){return $p()},e.prototype.getPixelRatio=function(){return this.pixelRatio_},e.prototype.getResolution=function(){return this.resolution},e.prototype.getState=function(){return this.state},e.prototype.load=function(){$p()},e}(ry),ld={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function cd(t){for(var e=[1/0,1/0,-1/0,-1/0],r=0,n=t.length;r<n;++r)xd(e,t[r]);return e}function fd(t,e,r){return r?(r[0]=t[0]-e,r[1]=t[1]-e,r[2]=t[2]+e,r[3]=t[3]+e,r):[t[0]-e,t[1]-e,t[2]+e,t[3]+e]}function pd(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t.slice()}function hd(t,e,r){var n,i;return(n=e<t[0]?t[0]-e:t[2]<e?e-t[2]:0)*n+(i=r<t[1]?t[1]-r:t[3]<r?r-t[3]:0)*i}function yd(t,e){return gd(t,e[0],e[1])}function dd(t,e){return t[0]<=e[0]&&e[2]<=t[2]&&t[1]<=e[1]&&e[3]<=t[3]}function gd(t,e,r){return t[0]<=e&&e<=t[2]&&t[1]<=r&&r<=t[3]}function md(t,e){var r=t[0],n=t[1],i=t[2],o=t[3],a=e[0],s=e[1],u=ld.UNKNOWN;return a<r?u|=ld.LEFT:a>i&&(u|=ld.RIGHT),s<n?u|=ld.BELOW:s>o&&(u|=ld.ABOVE),u===ld.UNKNOWN&&(u=ld.INTERSECTING),u}function vd(t,e,r,n,i){return i?(i[0]=t,i[1]=e,i[2]=r,i[3]=n,i):[t,e,r,n]}function _d(t){return vd(1/0,1/0,-1/0,-1/0,t)}function bd(t,e){var r=t[0],n=t[1];return vd(r,n,r,n,e)}function wd(t,e,r,n,i){return Cd(_d(i),t,e,r,n)}function Sd(t,e){return t[0]==e[0]&&t[2]==e[2]&&t[1]==e[1]&&t[3]==e[3]}function Od(t,e){return e[0]<t[0]&&(t[0]=e[0]),e[2]>t[2]&&(t[2]=e[2]),e[1]<t[1]&&(t[1]=e[1]),e[3]>t[3]&&(t[3]=e[3]),t}function xd(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function Cd(t,e,r,n,i){for(;r<n;r+=i)Ed(t,e[r],e[r+1]);return t}function Ed(t,e,r){t[0]=Math.min(t[0],e),t[1]=Math.min(t[1],r),t[2]=Math.max(t[2],e),t[3]=Math.max(t[3],r)}function Pd(t,e){var r;return(r=e(Td(t)))||(r=e(jd(t)))||(r=e(Fd(t)))?r:(r=e(Nd(t)))||!1}function kd(t){var e=0;return Bd(t)||(e=zd(t)*Ad(t)),e}function Td(t){return[t[0],t[1]]}function jd(t){return[t[2],t[1]]}function Rd(t){return[(t[0]+t[2])/2,(t[1]+t[3])/2]}function Ld(t,e){var r;return"bottom-left"===e?r=Td(t):"bottom-right"===e?r=jd(t):"top-left"===e?r=Nd(t):"top-right"===e?r=Fd(t):uh(!1,13),r}function Id(t,e,r,n,i){var o=Md(t,e,r,n),a=o[0],s=o[1],u=o[2],l=o[3],c=o[4],f=o[5],p=o[6],h=o[7];return vd(Math.min(a,u,c,p),Math.min(s,l,f,h),Math.max(a,u,c,p),Math.max(s,l,f,h),i)}function Md(t,e,r,n){var i=e*n[0]/2,o=e*n[1]/2,a=Math.cos(r),s=Math.sin(r),u=i*a,l=i*s,c=o*a,f=o*s,p=t[0],h=t[1];return[p-u+f,h-l-c,p-u-f,h-l+c,p+u-f,h+l+c,p+u+f,h+l-c,p-u+f,h-l-c]}function Ad(t){return t[3]-t[1]}function Dd(t,e,r){var n=r||[1/0,1/0,-1/0,-1/0];return Gd(t,e)?(t[0]>e[0]?n[0]=t[0]:n[0]=e[0],t[1]>e[1]?n[1]=t[1]:n[1]=e[1],t[2]<e[2]?n[2]=t[2]:n[2]=e[2],t[3]<e[3]?n[3]=t[3]:n[3]=e[3]):_d(n),n}function Nd(t){return[t[0],t[3]]}function Fd(t){return[t[2],t[3]]}function zd(t){return t[2]-t[0]}function Gd(t,e){return t[0]<=e[2]&&t[2]>=e[0]&&t[1]<=e[3]&&t[3]>=e[1]}function Bd(t){return t[2]<t[0]||t[3]<t[1]}function Vd(t,e,r,n){var i=[];if(n>1)for(var o=t[2]-t[0],a=t[3]-t[1],s=0;s<n;++s)i.push(t[0]+o*s/n,t[1],t[2],t[1]+a*s/n,t[2]-o*s/n,t[3],t[0],t[3]-a*s/n);else i=[t[0],t[1],t[2],t[1],t[2],t[3],t[0],t[3]];e(i,i,2);for(var u=[],l=[],c=(s=0,i.length);s<c;s+=2)u.push(i[s]),l.push(i[s+1]);return function(t,e,r){return vd(Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e),r)}(u,l,r)}function Ud(t,e){var r=e.getExtent(),n=Rd(t);if(e.canWrapX()&&(n[0]<r[0]||n[0]>=r[2])){var i=zd(r),o=Math.floor((n[0]-r[0])/i)*i;t[0]-=o,t[2]-=o}return t}var qd=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function Wd(t,e,r){var n=t,i=!0,o=!1,a=!1,s=[fy(n,"load",(function(){a=!0,o||e()}))];return n.src&&Mh?(o=!0,n.decode().then((function(){i&&e()})).catch((function(t){i&&(a?e():r())}))):s.push(fy(n,"error",r)),function(){i=!1,s.forEach(py)}}!function(t){function e(e,r,n,i,o,a){var s=t.call(this,e,r,n,0)||this;return s.src_=i,s.image_=new Image,null!==o&&(s.image_.crossOrigin=o),s.unlisten_=null,s.state=0,s.imageLoadFunction_=a,s}qd(e,t),e.prototype.getImage=function(){return this.image_},e.prototype.handleImageError_=function(){this.state=3,this.unlistenImage_(),this.changed()},e.prototype.handleImageLoad_=function(){void 0===this.resolution&&(this.resolution=Ad(this.extent)/this.image_.height),this.state=2,this.unlistenImage_(),this.changed()},e.prototype.load=function(){0!=this.state&&3!=this.state||(this.state=1,this.changed(),this.imageLoadFunction_(this,this.src_),this.unlisten_=Wd(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},e.prototype.setImage=function(t){this.image_=t,this.resolution=Ad(this.extent)/this.image_.height},e.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}(ud);var Xd=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Zd=null,Hd=function(t){function e(e,r,n,i,o,a){var s=t.call(this)||this;return s.hitDetectionImage_=null,s.image_=e||new Image,null!==i&&(s.image_.crossOrigin=i),s.canvas_={},s.color_=a,s.unlisten_=null,s.imageState_=o,s.size_=n,s.src_=r,s.tainted_,s}return Xd(e,t),e.prototype.isTainted_=function(){if(void 0===this.tainted_&&2===this.imageState_){Zd||(Zd=Dh(1,1)),Zd.drawImage(this.image_,0,0);try{Zd.getImageData(0,0,1,1),this.tainted_=!1}catch(t){Zd=null,this.tainted_=!0}}return!0===this.tainted_},e.prototype.dispatchChangeEvent_=function(){this.dispatchEvent(ny)},e.prototype.handleImageError_=function(){this.imageState_=3,this.unlistenImage_(),this.dispatchChangeEvent_()},e.prototype.handleImageLoad_=function(){this.imageState_=2,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()},e.prototype.getImage=function(t){return this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_},e.prototype.getPixelRatio=function(t){return this.replaceColor_(t),this.canvas_[t]?t:1},e.prototype.getImageState=function(){return this.imageState_},e.prototype.getHitDetectionImage=function(){if(!this.hitDetectionImage_)if(this.isTainted_()){var t=this.size_[0],e=this.size_[1],r=Dh(t,e);r.fillRect(0,0,t,e),this.hitDetectionImage_=r.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_},e.prototype.getSize=function(){return this.size_},e.prototype.getSrc=function(){return this.src_},e.prototype.load=function(){if(0==this.imageState_){this.imageState_=1;try{this.image_.src=this.src_}catch(t){this.handleImageError_()}this.unlisten_=Wd(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}},e.prototype.replaceColor_=function(t){if(this.color_&&!this.canvas_[t]&&2===this.imageState_){var e=document.createElement("canvas");this.canvas_[t]=e,e.width=Math.ceil(this.image_.width*t),e.height=Math.ceil(this.image_.height*t);var r=e.getContext("2d");if(r.scale(t,t),r.drawImage(this.image_,0,0),r.globalCompositeOperation="multiply","multiply"===r.globalCompositeOperation||this.isTainted_())r.fillStyle=Sh(this.color_),r.fillRect(0,0,e.width/t,e.height/t),r.globalCompositeOperation="destination-in",r.drawImage(this.image_,0,0);else{for(var n=r.getImageData(0,0,e.width,e.height),i=n.data,o=this.color_[0]/255,a=this.color_[1]/255,s=this.color_[2]/255,u=this.color_[3],l=0,c=i.length;l<c;l+=4)i[l]*=o,i[l+1]*=a,i[l+2]*=s,i[l+3]*=u;r.putImageData(n,0,0)}}},e.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},e}(ry),Yd=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Kd=function(t){function e(e){var r=this,n=e||{},i=void 0!==n.opacity?n.opacity:1,o=void 0!==n.rotation?n.rotation:0,a=void 0!==n.scale?n.scale:1,s=void 0!==n.rotateWithView&&n.rotateWithView;(r=t.call(this,{opacity:i,rotation:o,scale:a,displacement:void 0!==n.displacement?n.displacement:[0,0],rotateWithView:s,declutterMode:n.declutterMode})||this).anchor_=void 0!==n.anchor?n.anchor:[.5,.5],r.normalizedAnchor_=null,r.anchorOrigin_=void 0!==n.anchorOrigin?n.anchorOrigin:nd,r.anchorXUnits_=void 0!==n.anchorXUnits?n.anchorXUnits:Qy,r.anchorYUnits_=void 0!==n.anchorYUnits?n.anchorYUnits:Qy,r.crossOrigin_=void 0!==n.crossOrigin?n.crossOrigin:null;var u=void 0!==n.img?n.img:null;r.imgSize_=n.imgSize;var l=n.src;uh(!(void 0!==l&&u),4),uh(!u||u&&r.imgSize_,5),void 0!==l&&0!==l.length||!u||(l=u.src||th(u)),uh(void 0!==l&&l.length>0,6);var c=void 0!==n.src?0:2;return r.color_=void 0!==n.color?xh(n.color):null,r.iconImage_=function(t,e,r,n,i,o){var a=ad.get(e,n,o);return a||(a=new Hd(t,e,r,n,i,o),ad.set(e,n,o,a)),a}(u,l,void 0!==r.imgSize_?r.imgSize_:null,r.crossOrigin_,c,r.color_),r.offset_=void 0!==n.offset?n.offset:[0,0],r.offsetOrigin_=void 0!==n.offsetOrigin?n.offsetOrigin:nd,r.origin_=null,r.size_=void 0!==n.size?n.size:null,r}return Yd(e,t),e.prototype.clone=function(){var t=this.getScale();return new e({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,imgSize:this.imgSize_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:Array.isArray(t)?t.slice():t,size:null!==this.size_?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})},e.prototype.getAnchor=function(){var t=this.normalizedAnchor_;if(!t){t=this.anchor_;var e=this.getSize();if(this.anchorXUnits_==Qy||this.anchorYUnits_==Qy){if(!e)return null;t=this.anchor_.slice(),this.anchorXUnits_==Qy&&(t[0]*=e[0]),this.anchorYUnits_==Qy&&(t[1]*=e[1])}if(this.anchorOrigin_!=nd){if(!e)return null;t===this.anchor_&&(t=this.anchor_.slice()),this.anchorOrigin_!=id&&this.anchorOrigin_!=rd||(t[0]=-t[0]+e[0]),this.anchorOrigin_!=ed&&this.anchorOrigin_!=rd||(t[1]=-t[1]+e[1])}this.normalizedAnchor_=t}var r=this.getDisplacement();return[t[0]-r[0],t[1]+r[1]]},e.prototype.setAnchor=function(t){this.anchor_=t,this.normalizedAnchor_=null},e.prototype.getColor=function(){return this.color_},e.prototype.getImage=function(t){return this.iconImage_.getImage(t)},e.prototype.getPixelRatio=function(t){return this.iconImage_.getPixelRatio(t)},e.prototype.getImageSize=function(){return this.iconImage_.getSize()},e.prototype.getImageState=function(){return this.iconImage_.getImageState()},e.prototype.getHitDetectionImage=function(){return this.iconImage_.getHitDetectionImage()},e.prototype.getOrigin=function(){if(this.origin_)return this.origin_;var t=this.offset_;if(this.offsetOrigin_!=nd){var e=this.getSize(),r=this.iconImage_.getSize();if(!e||!r)return null;t=t.slice(),this.offsetOrigin_!=id&&this.offsetOrigin_!=rd||(t[0]=r[0]-e[0]-t[0]),this.offsetOrigin_!=ed&&this.offsetOrigin_!=rd||(t[1]=r[1]-e[1]-t[1])}return this.origin_=t,this.origin_},e.prototype.getSrc=function(){return this.iconImage_.getSrc()},e.prototype.getSize=function(){return this.size_?this.size_:this.iconImage_.getSize()},e.prototype.listenImageChange=function(t){this.iconImage_.addEventListener(ny,t)},e.prototype.load=function(){this.iconImage_.load()},e.prototype.unlistenImageChange=function(t){this.iconImage_.removeEventListener(ny,t)},e}(ih);const Jd=Kd;var $d,Qd=new Array(6);function tg(t){return rg(t,1,0,0,1,0,0)}function eg(t,e){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=e[0],l=e[1],c=e[2],f=e[3],p=e[4],h=e[5];return t[0]=r*u+i*l,t[1]=n*u+o*l,t[2]=r*c+i*f,t[3]=n*c+o*f,t[4]=r*p+i*h+a,t[5]=n*p+o*h+s,t}function rg(t,e,r,n,i,o,a){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=o,t[5]=a,t}function ng(t,e){var r=e[0],n=e[1];return e[0]=t[0]*r+t[2]*n+t[4],e[1]=t[1]*r+t[3]*n+t[5],e}function ig(t,e,r){return eg(t,rg(Qd,e,0,0,r,0,0))}function og(t,e,r,n,i,o,a,s){var u=Math.sin(o),l=Math.cos(o);return t[0]=n*l,t[1]=i*u,t[2]=-n*u,t[3]=i*l,t[4]=a*n*l-s*n*u+e,t[5]=a*i*u+s*i*l+r,t}function ag(t,e){var r,n=(r=e)[0]*r[3]-r[1]*r[2];uh(0!==n,32);var i=e[0],o=e[1],a=e[2],s=e[3],u=e[4],l=e[5];return t[0]=s/n,t[1]=-o/n,t[2]=-a/n,t[3]=i/n,t[4]=(a*l-s*u)/n,t[5]=-(i*l-o*u)/n,t}function sg(t){var e="matrix("+t.join(", ")+")";if(Ih)return e;var r=$d||($d=document.createElement("div"));return r.style.transform=e,r.style.transform}function ug(t,e,r,n,i){return!Pd(i,(function(i){return!lg(t,e,r,n,i[0],i[1])}))}function lg(t,e,r,n,i,o){for(var a=0,s=t[r-n],u=t[r-n+1];e<r;e+=n){var l=t[e],c=t[e+1];u<=o?c>o&&(l-s)*(o-u)-(i-s)*(c-u)>0&&a++:c<=o&&(l-s)*(o-u)-(i-s)*(c-u)<0&&a--,s=l,u=c}return 0!==a}function cg(t,e,r,n,i,o){if(0===r.length)return!1;if(!lg(t,e,r[0],n,i,o))return!1;for(var a=1,s=r.length;a<s;++a)if(lg(t,r[a-1],r[a],n,i,o))return!1;return!0}function fg(t,e,r,n,i,o,a){for(var s,u,l,c,f,p,h,y=i[o+1],d=[],g=0,m=r.length;g<m;++g){var v=r[g];for(c=t[v-n],p=t[v-n+1],s=e;s<v;s+=n)f=t[s],h=t[s+1],(y<=p&&h<=y||p<=y&&y<=h)&&(l=(y-p)/(h-p)*(f-c)+c,d.push(l)),c=f,p=h}var _=NaN,b=-1/0;for(d.sort(Uh),c=d[0],s=1,u=d.length;s<u;++s){f=d[s];var w=Math.abs(f-c);w>b&&cg(t,e,r,n,l=(c+f)/2,y)&&(_=l,b=w),c=f}return isNaN(_)&&(_=i[o]),a?(a.push(_,y,b),a):[_,y,b]}function pg(t,e,r,n,i){for(var o=[],a=0,s=r.length;a<s;++a){var u=r[a];o=fg(t,e,u,n,i,2*a,o),e=u[u.length-1]}return o}var hg={RADIANS:"radians",DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"},yg={};yg[hg.RADIANS]=6370997/(2*Math.PI),yg[hg.DEGREES]=2*Math.PI*6370997/360,yg[hg.FEET]=.3048,yg[hg.METERS]=1,yg[hg.USFEET]=1200/3937;const dg=hg;var gg=function(){function t(t){this.code_=t.code,this.units_=t.units,this.extent_=void 0!==t.extent?t.extent:null,this.worldExtent_=void 0!==t.worldExtent?t.worldExtent:null,this.axisOrientation_=void 0!==t.axisOrientation?t.axisOrientation:"enu",this.global_=void 0!==t.global&&t.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}return t.prototype.canWrapX=function(){return this.canWrapX_},t.prototype.getCode=function(){return this.code_},t.prototype.getExtent=function(){return this.extent_},t.prototype.getUnits=function(){return this.units_},t.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||yg[this.units_]},t.prototype.getWorldExtent=function(){return this.worldExtent_},t.prototype.getAxisOrientation=function(){return this.axisOrientation_},t.prototype.isGlobal=function(){return this.global_},t.prototype.setGlobal=function(t){this.global_=t,this.canWrapX_=!(!t||!this.extent_)},t.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},t.prototype.setDefaultTileGrid=function(t){this.defaultTileGrid_=t},t.prototype.setExtent=function(t){this.extent_=t,this.canWrapX_=!(!this.global_||!t)},t.prototype.setWorldExtent=function(t){this.worldExtent_=t},t.prototype.setGetPointResolution=function(t){this.getPointResolutionFunc_=t},t.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_},t}();const mg=gg;var vg=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),_g=6378137,bg=Math.PI*_g,wg=[-bg,-bg,bg,bg],Sg=[-180,-85,180,85],Og=_g*Math.log(Math.tan(Math.PI/2)),xg=function(t){function e(e){return t.call(this,{code:e,units:dg.METERS,extent:wg,global:!0,worldExtent:Sg,getPointResolution:function(t,e){return t/ch(e[1]/_g)}})||this}return vg(e,t),e}(mg),Cg=[new xg("EPSG:3857"),new xg("EPSG:102100"),new xg("EPSG:102113"),new xg("EPSG:900913"),new xg("http://www.opengis.net/def/crs/EPSG/0/3857"),new xg("http://www.opengis.net/gml/srs/epsg.xml#3857")];var Eg=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Pg=[-180,-90,180,90],kg=6378137*Math.PI/180,Tg=function(t){function e(e,r){return t.call(this,{code:e,units:dg.DEGREES,extent:Pg,axisOrientation:r,global:!0,metersPerUnit:kg,worldExtent:Pg})||this}return Eg(e,t),e}(mg),jg=[new Tg("CRS:84"),new Tg("EPSG:4326","neu"),new Tg("urn:ogc:def:crs:OGC:1.3:CRS84"),new Tg("urn:ogc:def:crs:OGC:2:84"),new Tg("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Tg("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Tg("http://www.opengis.net/def/crs/EPSG/0/4326","neu")],Rg={},Lg={};function Ig(t,e,r){var n=t.getCode(),i=e.getCode();n in Lg||(Lg[n]={}),Lg[n][i]=r}function Mg(t,e){for(var r=!0,n=t.length-1;n>=0;--n)if(t[n]!=e[n]){r=!1;break}return r}function Ag(t,e){var r=Math.cos(e),n=Math.sin(e),i=t[0]*r-t[1]*n,o=t[1]*r+t[0]*n;return t[0]=i,t[1]=o,t}function Dg(t,e){if(e.canWrapX()){var r=zd(e.getExtent()),n=function(t,e,r){var n=e.getExtent(),i=0;if(e.canWrapX()&&(t[0]<n[0]||t[0]>n[2])){var o=r||zd(n);i=Math.floor((t[0]-n[0])/o)}return i}(t,e,r);n&&(t[0]-=n*r)}return t}var Ng=6371008.8;function Fg(t,e,r){var n=r||Ng,i=yh(t[1]),o=yh(e[1]),a=(o-i)/2,s=yh(e[0]-t[0])/2,u=Math.sin(a)*Math.sin(a)+Math.sin(s)*Math.sin(s)*Math.cos(i)*Math.cos(o);return 2*n*Math.atan2(Math.sqrt(u),Math.sqrt(1-u))}var zg=!0;function Gg(t){zg=!(void 0===t||t)}function Bg(t,e,r){var n;if(void 0!==e){for(var i=0,o=t.length;i<o;++i)e[i]=t[i];n=e}else n=t.slice();return n}function Vg(t,e,r){if(void 0!==e&&t!==e){for(var n=0,i=t.length;n<i;++n)e[n]=t[n];t=e}return t}function Ug(t){!function(t,e){Rg[t]=e}(t.getCode(),t),Ig(t,t,Bg)}function qg(t){return"string"==typeof t?Rg[e=t]||Rg[e.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null:t||null;var e}function Wg(t,e,r,n){var i,o=(t=qg(t)).getPointResolutionFunc();if(o)i=o(e,r),n&&n!==t.getUnits()&&(s=t.getMetersPerUnit())&&(i=i*s/yg[n]);else{var a=t.getUnits();if(a==dg.DEGREES&&!n||n==dg.DEGREES)i=e;else{var s,u=Kg(t,qg("EPSG:4326"));if(u===Vg&&a!==dg.DEGREES)i=e*t.getMetersPerUnit();else{var l=[r[0]-e/2,r[1],r[0]+e/2,r[1],r[0],r[1]-e/2,r[0],r[1]+e/2];i=(Fg((l=u(l,l,2)).slice(0,2),l.slice(2,4))+Fg(l.slice(4,6),l.slice(6,8)))/2}void 0!==(s=n?yg[n]:t.getMetersPerUnit())&&(i/=s)}}return i}function Xg(t){!function(t){t.forEach(Ug)}(t),t.forEach((function(e){t.forEach((function(t){e!==t&&Ig(e,t,Bg)}))}))}function Zg(t,e){return t?"string"==typeof t?qg(t):t:qg(e)}function Hg(t,e){return Gg(),$g(t,"EPSG:4326",void 0!==e?e:"EPSG:3857")}function Yg(t,e){if(t===e)return!0;var r=t.getUnits()===e.getUnits();return(t.getCode()===e.getCode()||Kg(t,e)===Bg)&&r}function Kg(t,e){var r,n,i,o=(r=t.getCode(),n=e.getCode(),r in Lg&&n in Lg[r]&&(i=Lg[r][n]),i);return o||(o=Vg),o}function Jg(t,e){return Kg(qg(t),qg(e))}function $g(t,e,r){return Jg(e,r)(t,void 0,t.length)}function Qg(t,e,r,n){return Vd(t,Jg(e,r),void 0,n)}var tm,em,rm,nm=null;function im(){return nm}function om(t,e){return nm?$g(t,e,nm):t}function am(t,e){return nm?$g(t,nm,e):(zg&&!Mg(t,[0,0])&&t[0]>=-180&&t[0]<=180&&t[1]>=-90&&t[1]<=90&&(zg=!1,console.warn("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),t)}function sm(t,e){return nm?Qg(t,e,nm):t}function um(t,e){return nm?Qg(t,nm,e):t}function lm(t,e){if(!nm)return t;var r=qg(e).getUnits(),n=nm.getUnits();return r&&n?t*yg[r]/yg[n]:t}function cm(t,e,r,n,i,o,a){var s,u,l=(r-e)/n;if(1===l)s=e;else if(2===l)s=e,u=i;else if(0!==l){for(var c=t[e],f=t[e+1],p=0,h=[0],y=e+n;y<r;y+=n){var d=t[y],g=t[y+1];p+=Math.sqrt((d-c)*(d-c)+(g-f)*(g-f)),h.push(p),c=d,f=g}var m=i*p,v=function(t,e,r){for(var n,i,o=Uh,a=0,s=t.length,u=!1;a<s;)(i=+o(t[n=a+(s-a>>1)],e))<0?a=n+1:(s=n,u=!i);return u?a:~a}(h,m);v<0?(u=(m-h[-v-2])/(h[-v-1]-h[-v-2]),s=e+(-v-2)*n):s=e+v*n}var _=a>1?a:2,b=o||new Array(_);for(y=0;y<_;++y)b[y]=void 0===s?NaN:void 0===u?t[s+y]:gh(t[s+y],t[s+n+y],u);return b}function fm(t,e,r,n,i,o){if(r==e)return null;var a;if(i<t[e+n-1])return o?((a=t.slice(e,e+n))[n-1]=i,a):null;if(t[r-1]<i)return o?((a=t.slice(r-n,r))[n-1]=i,a):null;if(i==t[e+n-1])return t.slice(e,e+n);for(var s=e/n,u=r/n;s<u;){var l=s+u>>1;i<t[(l+1)*n-1]?u=l:s=l+1}var c=t[s*n-1];if(i==c)return t.slice((s-1)*n,(s-1)*n+n);var f=(i-c)/(t[(s+1)*n-1]-c);a=[];for(var p=0;p<n-1;++p)a.push(gh(t[(s-1)*n+p],t[s*n+p],f));return a.push(i),a}function pm(t,e,r,n){for(var i=[],o=[1/0,1/0,-1/0,-1/0],a=0,s=r.length;a<s;++a){var u=r[a];o=wd(t,e,u[0],n),i.push((o[0]+o[2])/2,(o[1]+o[3])/2),e=u[u.length-1]}return i}function hm(t,e,r,n,i,o){for(var a=o||[],s=0,u=e;u<r;u+=n){var l=t[u],c=t[u+1];a[s++]=i[0]*l+i[2]*c+i[4],a[s++]=i[1]*l+i[3]*c+i[5]}return o&&a.length!=s&&(a.length=s),a}function ym(t,e,r,n,i,o,a){for(var s=a||[],u=Math.cos(i),l=Math.sin(i),c=o[0],f=o[1],p=0,h=e;h<r;h+=n){var y=t[h]-c,d=t[h+1]-f;s[p++]=c+y*u-d*l,s[p++]=f+y*l+d*u;for(var g=h+2;g<h+n;++g)s[p++]=t[g]}return a&&s.length!=p&&(s.length=p),s}Xg(Cg),Xg(jg),tm=Cg,em=function(t,e,r){var n=t.length,i=r>1?r:2,o=e;void 0===o&&(o=i>2?t.slice():new Array(n));for(var a=0;a<n;a+=i){o[a]=bg*t[a]/180;var s=_g*Math.log(Math.tan(Math.PI*(+t[a+1]+90)/360));s>Og?s=Og:s<-Og&&(s=-Og),o[a+1]=s}return o},rm=function(t,e,r){var n=t.length,i=r>1?r:2,o=e;void 0===o&&(o=i>2?t.slice():new Array(n));for(var a=0;a<n;a+=i)o[a]=180*t[a]/bg,o[a+1]=360*Math.atan(Math.exp(t[a+1]/_g))/Math.PI-90;return o},jg.forEach((function(t){tm.forEach((function(e){Ig(t,e,em),Ig(e,t,rm)}))}));var dm=[1,0,0,1,0,0],gm=function(){function t(t,e,r,n,i){this.styleFunction,this.extent_,this.id_=i,this.type_=t,this.flatCoordinates_=e,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=r,this.properties_=n}return t.prototype.get=function(t){return this.properties_[t]},t.prototype.getExtent=function(){return this.extent_||(this.extent_="Point"===this.type_?bd(this.flatCoordinates_):wd(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_},t.prototype.getFlatInteriorPoint=function(){if(!this.flatInteriorPoints_){var t=Rd(this.getExtent());this.flatInteriorPoints_=fg(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_},t.prototype.getFlatInteriorPoints=function(){if(!this.flatInteriorPoints_){var t=pm(this.flatCoordinates_,0,this.ends_,2);this.flatInteriorPoints_=pg(this.flatCoordinates_,0,this.ends_,2,t)}return this.flatInteriorPoints_},t.prototype.getFlatMidpoint=function(){return this.flatMidpoints_||(this.flatMidpoints_=cm(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_},t.prototype.getFlatMidpoints=function(){if(!this.flatMidpoints_){this.flatMidpoints_=[];for(var t=this.flatCoordinates_,e=0,r=this.ends_,n=0,i=r.length;n<i;++n){var o=r[n],a=cm(t,e,o,2,.5);Xh(this.flatMidpoints_,a),e=o}}return this.flatMidpoints_},t.prototype.getId=function(){return this.id_},t.prototype.getOrientedFlatCoordinates=function(){return this.flatCoordinates_},t.prototype.getGeometry=function(){return this},t.prototype.getSimplifiedGeometry=function(t){return this},t.prototype.simplifyTransformed=function(t,e){return this},t.prototype.getProperties=function(){return this.properties_},t.prototype.getStride=function(){return 2},t.prototype.getStyleFunction=function(){return this.styleFunction},t.prototype.getType=function(){return this.type_},t.prototype.transform=function(t){var e=(t=qg(t)).getExtent(),r=t.getWorldExtent();if(e&&r){var n=Ad(r)/Ad(e);og(dm,r[0],r[3],n,-n,0,0,0),hm(this.flatCoordinates_,0,this.flatCoordinates_.length,2,dm,this.flatCoordinates_)}},t.prototype.getEnds=function(){return this.ends_},t}();gm.prototype.getEndss=gm.prototype.getEnds,gm.prototype.getFlatCoordinates=gm.prototype.getOrientedFlatCoordinates;const mm=gm;var vm=function(){function t(t){var e=t||{};this.color_=void 0!==e.color?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=void 0!==e.lineDash?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width}return t.prototype.clone=function(){var e=this.getColor();return new t({color:Array.isArray(e)?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})},t.prototype.getColor=function(){return this.color_},t.prototype.getLineCap=function(){return this.lineCap_},t.prototype.getLineDash=function(){return this.lineDash_},t.prototype.getLineDashOffset=function(){return this.lineDashOffset_},t.prototype.getLineJoin=function(){return this.lineJoin_},t.prototype.getMiterLimit=function(){return this.miterLimit_},t.prototype.getWidth=function(){return this.width_},t.prototype.setColor=function(t){this.color_=t},t.prototype.setLineCap=function(t){this.lineCap_=t},t.prototype.setLineDash=function(t){this.lineDash_=t},t.prototype.setLineDashOffset=function(t){this.lineDashOffset_=t},t.prototype.setLineJoin=function(t){this.lineJoin_=t},t.prototype.setMiterLimit=function(t){this.miterLimit_=t},t.prototype.setWidth=function(t){this.width_=t},t}();const _m=vm;var bm=function(){function t(t){var e=t||{};this.geometry_=null,this.geometryFunction_=Om,void 0!==e.geometry&&this.setGeometry(e.geometry),this.fill_=void 0!==e.fill?e.fill:null,this.image_=void 0!==e.image?e.image:null,this.renderer_=void 0!==e.renderer?e.renderer:null,this.hitDetectionRenderer_=void 0!==e.hitDetectionRenderer?e.hitDetectionRenderer:null,this.stroke_=void 0!==e.stroke?e.stroke:null,this.text_=void 0!==e.text?e.text:null,this.zIndex_=e.zIndex}return t.prototype.clone=function(){var e=this.getGeometry();return e&&"object"==typeof e&&(e=e.clone()),new t({geometry:e,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})},t.prototype.getRenderer=function(){return this.renderer_},t.prototype.setRenderer=function(t){this.renderer_=t},t.prototype.setHitDetectionRenderer=function(t){this.hitDetectionRenderer_=t},t.prototype.getHitDetectionRenderer=function(){return this.hitDetectionRenderer_},t.prototype.getGeometry=function(){return this.geometry_},t.prototype.getGeometryFunction=function(){return this.geometryFunction_},t.prototype.getFill=function(){return this.fill_},t.prototype.setFill=function(t){this.fill_=t},t.prototype.getImage=function(){return this.image_},t.prototype.setImage=function(t){this.image_=t},t.prototype.getStroke=function(){return this.stroke_},t.prototype.setStroke=function(t){this.stroke_=t},t.prototype.getText=function(){return this.text_},t.prototype.setText=function(t){this.text_=t},t.prototype.getZIndex=function(){return this.zIndex_},t.prototype.setGeometry=function(t){"function"==typeof t?this.geometryFunction_=t:"string"==typeof t?this.geometryFunction_=function(e){return e.get(t)}:t?void 0!==t&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=Om,this.geometry_=t},t.prototype.setZIndex=function(t){this.zIndex_=t},t}(),wm=null;function Sm(t,e){if(!wm){var r=new $y({color:"rgba(255,255,255,0.4)"}),n=new _m({color:"#3399CC",width:1.25});wm=[new bm({image:new Ky({fill:r,stroke:n,radius:5}),fill:r,stroke:n})]}return wm}function Om(t){return t.getGeometry()}const xm=bm;var Cm=function(){function t(t){var e=t||{};this.font_=e.font,this.rotation_=e.rotation,this.rotateWithView_=e.rotateWithView,this.scale_=e.scale,this.scaleArray_=rh(void 0!==e.scale?e.scale:1),this.text_=e.text,this.textAlign_=e.textAlign,this.justify_=e.justify,this.textBaseline_=e.textBaseline,this.fill_=void 0!==e.fill?e.fill:new $y({color:"#333"}),this.maxAngle_=void 0!==e.maxAngle?e.maxAngle:Math.PI/4,this.placement_=void 0!==e.placement?e.placement:"point",this.overflow_=!!e.overflow,this.stroke_=void 0!==e.stroke?e.stroke:null,this.offsetX_=void 0!==e.offsetX?e.offsetX:0,this.offsetY_=void 0!==e.offsetY?e.offsetY:0,this.backgroundFill_=e.backgroundFill?e.backgroundFill:null,this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null,this.padding_=void 0===e.padding?null:e.padding}return t.prototype.clone=function(){var e=this.getScale();return new t({font:this.getFont(),placement:this.getPlacement(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0})},t.prototype.getOverflow=function(){return this.overflow_},t.prototype.getFont=function(){return this.font_},t.prototype.getMaxAngle=function(){return this.maxAngle_},t.prototype.getPlacement=function(){return this.placement_},t.prototype.getOffsetX=function(){return this.offsetX_},t.prototype.getOffsetY=function(){return this.offsetY_},t.prototype.getFill=function(){return this.fill_},t.prototype.getRotateWithView=function(){return this.rotateWithView_},t.prototype.getRotation=function(){return this.rotation_},t.prototype.getScale=function(){return this.scale_},t.prototype.getScaleArray=function(){return this.scaleArray_},t.prototype.getStroke=function(){return this.stroke_},t.prototype.getText=function(){return this.text_},t.prototype.getTextAlign=function(){return this.textAlign_},t.prototype.getJustify=function(){return this.justify_},t.prototype.getTextBaseline=function(){return this.textBaseline_},t.prototype.getBackgroundFill=function(){return this.backgroundFill_},t.prototype.getBackgroundStroke=function(){return this.backgroundStroke_},t.prototype.getPadding=function(){return this.padding_},t.prototype.setOverflow=function(t){this.overflow_=t},t.prototype.setFont=function(t){this.font_=t},t.prototype.setMaxAngle=function(t){this.maxAngle_=t},t.prototype.setOffsetX=function(t){this.offsetX_=t},t.prototype.setOffsetY=function(t){this.offsetY_=t},t.prototype.setPlacement=function(t){this.placement_=t},t.prototype.setRotateWithView=function(t){this.rotateWithView_=t},t.prototype.setFill=function(t){this.fill_=t},t.prototype.setRotation=function(t){this.rotation_=t},t.prototype.setScale=function(t){this.scale_=t,this.scaleArray_=rh(void 0!==t?t:1)},t.prototype.setStroke=function(t){this.stroke_=t},t.prototype.setText=function(t){this.text_=t},t.prototype.setTextAlign=function(t){this.textAlign_=t},t.prototype.setJustify=function(t){this.justify_=t},t.prototype.setTextBaseline=function(t){this.textBaseline_=t},t.prototype.setBackgroundFill=function(t){this.backgroundFill_=t},t.prototype.setBackgroundStroke=function(t){this.backgroundStroke_=t},t.prototype.setPadding=function(t){this.padding_=t},t}();const Em=Cm;function Pm(t,e,r,n){return void 0!==n?(n[0]=t,n[1]=e,n[2]=r,n):[t,e,r]}function km(t,e,r){return t+"/"+e+"/"+r}function Tm(t){return km(t[0],t[1],t[2])}function jm(t){return t.split("/").map(Number)}function Rm(t,e){var r=/\{z\}/g,n=/\{x\}/g,i=/\{y\}/g,o=/\{-y\}/g;return function(a,s,u){return a?t.replace(r,a[0].toString()).replace(n,a[1].toString()).replace(i,a[2].toString()).replace(o,(function(){var t=a[0],r=e.getFullTileRange(t);return uh(r,55),(r.getHeight()-a[2]-1).toString()})):void 0}}function Lm(t,e){for(var r=t.length,n=new Array(r),i=0;i<r;++i)n[i]=Rm(t[i],e);return function(t){return 1===t.length?t[0]:function(e,r,n){if(e){var i=function(t){return(t[1]<<t[0])+t[2]}(e),o=dh(i,t.length);return t[o](e,r,n)}}}(n)}function Im(t){var e=[],r=/\{([a-z])-([a-z])\}/.exec(t);if(r){var n=r[1].charCodeAt(0),i=r[2].charCodeAt(0),o=void 0;for(o=n;o<=i;++o)e.push(t.replace(r[0],String.fromCharCode(o)));return e}if(r=/\{(\d+)-(\d+)\}/.exec(t)){for(var a=parseInt(r[2],10),s=parseInt(r[1],10);s<=a;s++)e.push(t.replace(r[0],s.toString()));return e}return e.push(t),e}var Mm=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const Am=function(t){function e(e){var r=t.call(this)||this;if(r.on,r.once,r.un,r.id_=void 0,r.geometryName_="geometry",r.style_=null,r.styleFunction_=void 0,r.geometryChangeKey_=null,r.addChangeListener(r.geometryName_,r.handleGeometryChanged_),e)if("function"==typeof e.getSimplifiedGeometry){var n=e;r.setGeometry(n)}else{var i=e;r.setProperties(i)}return r}return Mm(e,t),e.prototype.clone=function(){var t=new e(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());var r=this.getGeometry();r&&t.setGeometry(r.clone());var n=this.getStyle();return n&&t.setStyle(n),t},e.prototype.getGeometry=function(){return this.get(this.geometryName_)},e.prototype.getId=function(){return this.id_},e.prototype.getGeometryName=function(){return this.geometryName_},e.prototype.getStyle=function(){return this.style_},e.prototype.getStyleFunction=function(){return this.styleFunction_},e.prototype.handleGeometryChange_=function(){this.changed()},e.prototype.handleGeometryChanged_=function(){this.geometryChangeKey_&&(py(this.geometryChangeKey_),this.geometryChangeKey_=null);var t=this.getGeometry();t&&(this.geometryChangeKey_=cy(t,ny,this.handleGeometryChange_,this)),this.changed()},e.prototype.setGeometry=function(t){this.set(this.geometryName_,t)},e.prototype.setStyle=function(t){var e,r;this.style_=t,this.styleFunction_=t?"function"==typeof(e=t)?e:(Array.isArray(e)?r=e:(uh("function"==typeof e.getZIndex,41),r=[e]),function(){return r}):void 0,this.changed()},e.prototype.setId=function(t){this.id_=t,this.changed()},e.prototype.setGeometryName=function(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()},e}(vy);var Dm=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Nm=[1,0,0,1,0,0];const Fm=function(t){function e(){var e,r,n,i,o,a=t.call(this)||this;return a.extent_=[1/0,1/0,-1/0,-1/0],a.extentRevision_=-1,a.simplifiedGeometryMaxMinSquaredTolerance=0,a.simplifiedGeometryRevision=0,a.simplifyTransformedInternal=(e=function(t,e,r){if(!r)return this.getSimplifiedGeometry(e);var n=this.clone();return n.applyTransform(r),n.getSimplifiedGeometry(e)},o=!1,function(){var t=Array.prototype.slice.call(arguments);return o&&this===i&&Zh(t,n)||(o=!0,i=this,n=t,r=e.apply(this,arguments)),r}),a}return Dm(e,t),e.prototype.simplifyTransformed=function(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)},e.prototype.clone=function(){return $p()},e.prototype.closestPointXY=function(t,e,r,n){return $p()},e.prototype.containsXY=function(t,e){var r=this.getClosestPoint([t,e]);return r[0]===t&&r[1]===e},e.prototype.getClosestPoint=function(t,e){var r=e||[NaN,NaN];return this.closestPointXY(t[0],t[1],r,1/0),r},e.prototype.intersectsCoordinate=function(t){return this.containsXY(t[0],t[1])},e.prototype.computeExtent=function(t){return $p()},e.prototype.getExtent=function(t){if(this.extentRevision_!=this.getRevision()){var e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&_d(e),this.extentRevision_=this.getRevision()}return function(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t}(this.extent_,t)},e.prototype.rotate=function(t,e){$p()},e.prototype.scale=function(t,e,r){$p()},e.prototype.simplify=function(t){return this.getSimplifiedGeometry(t*t)},e.prototype.getSimplifiedGeometry=function(t){return $p()},e.prototype.getType=function(){return $p()},e.prototype.applyTransform=function(t){$p()},e.prototype.intersectsExtent=function(t){return $p()},e.prototype.translate=function(t,e){$p()},e.prototype.transform=function(t,e){var r=qg(t),n=r.getUnits()==dg.TILE_PIXELS?function(t,n,i){var o=r.getExtent(),a=r.getWorldExtent(),s=Ad(a)/Ad(o);return og(Nm,a[0],a[3],s,-s,0,0,0),hm(t,0,t.length,i,Nm,n),Jg(r,e)(t,n,i)}:Jg(r,e);return this.applyTransform(n),this},e}(vy);var zm=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Gm=function(t){function e(e){var r=t.call(this)||this;return r.geometries_=e||null,r.changeEventsKeys_=[],r.listenGeometriesChange_(),r}return zm(e,t),e.prototype.unlistenGeometriesChange_=function(){this.changeEventsKeys_.forEach(py),this.changeEventsKeys_.length=0},e.prototype.listenGeometriesChange_=function(){if(this.geometries_)for(var t=0,e=this.geometries_.length;t<e;++t)this.changeEventsKeys_.push(cy(this.geometries_[t],ny,this.changed,this))},e.prototype.clone=function(){var t=new e(null);return t.setGeometries(this.geometries_),t.applyProperties(this),t},e.prototype.closestPointXY=function(t,e,r,n){if(n<hd(this.getExtent(),t,e))return n;for(var i=this.geometries_,o=0,a=i.length;o<a;++o)n=i[o].closestPointXY(t,e,r,n);return n},e.prototype.containsXY=function(t,e){for(var r=this.geometries_,n=0,i=r.length;n<i;++n)if(r[n].containsXY(t,e))return!0;return!1},e.prototype.computeExtent=function(t){_d(t);for(var e=this.geometries_,r=0,n=e.length;r<n;++r)Od(t,e[r].getExtent());return t},e.prototype.getGeometries=function(){return Bm(this.geometries_)},e.prototype.getGeometriesArray=function(){return this.geometries_},e.prototype.getGeometriesArrayRecursive=function(){for(var t=[],e=this.geometries_,r=0,n=e.length;r<n;++r)e[r].getType()===this.getType()?t=t.concat(e[r].getGeometriesArrayRecursive()):t.push(e[r]);return t},e.prototype.getSimplifiedGeometry=function(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;for(var r=[],n=this.geometries_,i=!1,o=0,a=n.length;o<a;++o){var s=n[o],u=s.getSimplifiedGeometry(t);r.push(u),u!==s&&(i=!0)}if(i){var l=new e(null);return l.setGeometriesArray(r),l}return this.simplifiedGeometryMaxMinSquaredTolerance=t,this},e.prototype.getType=function(){return"GeometryCollection"},e.prototype.intersectsExtent=function(t){for(var e=this.geometries_,r=0,n=e.length;r<n;++r)if(e[r].intersectsExtent(t))return!0;return!1},e.prototype.isEmpty=function(){return 0===this.geometries_.length},e.prototype.rotate=function(t,e){for(var r=this.geometries_,n=0,i=r.length;n<i;++n)r[n].rotate(t,e);this.changed()},e.prototype.scale=function(t,e,r){var n=r;n||(n=Rd(this.getExtent()));for(var i=this.geometries_,o=0,a=i.length;o<a;++o)i[o].scale(t,e,n);this.changed()},e.prototype.setGeometries=function(t){this.setGeometriesArray(Bm(t))},e.prototype.setGeometriesArray=function(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()},e.prototype.applyTransform=function(t){for(var e=this.geometries_,r=0,n=e.length;r<n;++r)e[r].applyTransform(t);this.changed()},e.prototype.translate=function(t,e){for(var r=this.geometries_,n=0,i=r.length;n<i;++n)r[n].translate(t,e);this.changed()},e.prototype.disposeInternal=function(){this.unlistenGeometriesChange_(),t.prototype.disposeInternal.call(this)},e}(Fm);function Bm(t){for(var e=[],r=0,n=t.length;r<n;++r)e.push(t[r].clone());return e}const Vm=Gm;var Um=function(){function t(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.supportedMediaTypes=null}return t.prototype.getReadOptions=function(t,e){var r;if(e){var n=e.dataProjection?qg(e.dataProjection):this.readProjection(t);e.extent&&n&&n.getUnits()===dg.TILE_PIXELS&&(n=qg(n)).setWorldExtent(e.extent),r={dataProjection:n,featureProjection:e.featureProjection}}return this.adaptOptions(r)},t.prototype.adaptOptions=function(t){return Jh({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},t)},t.prototype.getType=function(){return $p()},t.prototype.readFeature=function(t,e){return $p()},t.prototype.readFeatures=function(t,e){return $p()},t.prototype.readGeometry=function(t,e){return $p()},t.prototype.readProjection=function(t){return $p()},t.prototype.writeFeature=function(t,e){return $p()},t.prototype.writeFeatures=function(t,e){return $p()},t.prototype.writeGeometry=function(t,e){return $p()},t}();const qm=Um;function Wm(t,e,r){var n,i=r?qg(r.featureProjection):null,o=r?qg(r.dataProjection):null;if(n=i&&o&&!Yg(i,o)?(e?t.clone():t).transform(e?i:o,e?o:i):t,e&&r&&void 0!==r.decimals){var a=Math.pow(10,r.decimals);n===t&&(n=t.clone()),n.applyTransform((function(t){for(var e=0,r=t.length;e<r;++e)t[e]=Math.round(t[e]*a)/a;return t}))}return n}var Xm=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function Zm(t){return"string"==typeof t?JSON.parse(t)||null:null!==t?t:null}const Hm=function(t){function e(){return t.call(this)||this}return Xm(e,t),e.prototype.getType=function(){return"json"},e.prototype.readFeature=function(t,e){return this.readFeatureFromObject(Zm(t),this.getReadOptions(t,e))},e.prototype.readFeatures=function(t,e){return this.readFeaturesFromObject(Zm(t),this.getReadOptions(t,e))},e.prototype.readFeatureFromObject=function(t,e){return $p()},e.prototype.readFeaturesFromObject=function(t,e){return $p()},e.prototype.readGeometry=function(t,e){return this.readGeometryFromObject(Zm(t),this.getReadOptions(t,e))},e.prototype.readGeometryFromObject=function(t,e){return $p()},e.prototype.readProjection=function(t){return this.readProjectionFromObject(Zm(t))},e.prototype.readProjectionFromObject=function(t){return $p()},e.prototype.writeFeature=function(t,e){return JSON.stringify(this.writeFeatureObject(t,e))},e.prototype.writeFeatureObject=function(t,e){return $p()},e.prototype.writeFeatures=function(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))},e.prototype.writeFeaturesObject=function(t,e){return $p()},e.prototype.writeGeometry=function(t,e){return JSON.stringify(this.writeGeometryObject(t,e))},e.prototype.writeGeometryObject=function(t,e){return $p()},e}(qm),Ym="XY",Km="XYM",Jm="XYZM";var $m=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Qm=function(t){function e(){var e=t.call(this)||this;return e.layout=Ym,e.stride=2,e.flatCoordinates=null,e}return $m(e,t),e.prototype.computeExtent=function(t){return wd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.getCoordinates=function(){return $p()},e.prototype.getFirstCoordinate=function(){return this.flatCoordinates.slice(0,this.stride)},e.prototype.getFlatCoordinates=function(){return this.flatCoordinates},e.prototype.getLastCoordinate=function(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)},e.prototype.getLayout=function(){return this.layout},e.prototype.getSimplifiedGeometry=function(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;var e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)},e.prototype.getSimplifiedGeometryInternal=function(t){return this},e.prototype.getStride=function(){return this.stride},e.prototype.setFlatCoordinates=function(t,e){this.stride=tv(t),this.layout=t,this.flatCoordinates=e},e.prototype.setCoordinates=function(t,e){$p()},e.prototype.setLayout=function(t,e,r){var n;if(t)n=tv(t);else{for(var i=0;i<r;++i){if(0===e.length)return this.layout=Ym,void(this.stride=2);e=e[0]}t=function(t){var e;return 2==t?e=Ym:3==t?e="XYZ":4==t&&(e=Jm),e}(n=e.length)}this.layout=t,this.stride=n},e.prototype.applyTransform=function(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())},e.prototype.rotate=function(t,e){var r=this.getFlatCoordinates();if(r){var n=this.getStride();ym(r,0,r.length,n,t,e,r),this.changed()}},e.prototype.scale=function(t,e,r){var n=e;void 0===n&&(n=t);var i=r;i||(i=Rd(this.getExtent()));var o=this.getFlatCoordinates();if(o){var a=this.getStride();!function(t,e,r,n,i,o,a,s){for(var u=s||[],l=a[0],c=a[1],f=0,p=0;p<r;p+=n){var h=t[p]-l,y=t[p+1]-c;u[f++]=l+i*h,u[f++]=c+o*y;for(var d=p+2;d<p+n;++d)u[f++]=t[d]}s&&u.length!=f&&(u.length=f)}(o,0,o.length,a,t,n,i,o),this.changed()}},e.prototype.translate=function(t,e){var r=this.getFlatCoordinates();if(r){var n=this.getStride();!function(t,e,r,n,i,o,a){for(var s=a||[],u=0,l=0;l<r;l+=n){s[u++]=t[l]+i,s[u++]=t[l+1]+o;for(var c=l+2;c<l+n;++c)s[u++]=t[c]}a&&s.length!=u&&(s.length=u)}(r,0,r.length,n,t,e,r),this.changed()}},e}(Fm);function tv(t){var e;return t==Ym?e=2:"XYZ"==t||t==Km?e=3:t==Jm&&(e=4),e}const ev=Qm;function rv(t,e,r,n,i,o,a){var s,u=t[e],l=t[e+1],c=t[r]-u,f=t[r+1]-l;if(0===c&&0===f)s=e;else{var p=((i-u)*c+(o-l)*f)/(c*c+f*f);if(p>1)s=r;else{if(p>0){for(var h=0;h<n;++h)a[h]=gh(t[e+h],t[r+h],p);return void(a.length=n)}s=e}}for(h=0;h<n;++h)a[h]=t[s+h];a.length=n}function nv(t,e,r,n,i){var o=t[e],a=t[e+1];for(e+=n;e<r;e+=n){var s=t[e],u=t[e+1],l=hh(o,a,s,u);l>i&&(i=l),o=s,a=u}return i}function iv(t,e,r,n,i){for(var o=0,a=r.length;o<a;++o){var s=r[o];i=nv(t,e,s,n,i),e=s}return i}function ov(t,e,r,n,i,o,a,s,u,l,c){if(e==r)return l;var f,p;if(0===i){if((p=hh(a,s,t[e],t[e+1]))<l){for(f=0;f<n;++f)u[f]=t[e+f];return u.length=n,p}return l}for(var h=c||[NaN,NaN],y=e+n;y<r;)if(rv(t,y-n,y,n,a,s,h),(p=hh(a,s,h[0],h[1]))<l){for(l=p,f=0;f<n;++f)u[f]=h[f];u.length=n,y+=n}else y+=n*Math.max((Math.sqrt(p)-Math.sqrt(l))/i|0,1);if(o&&(rv(t,r-n,e,n,a,s,h),(p=hh(a,s,h[0],h[1]))<l)){for(l=p,f=0;f<n;++f)u[f]=h[f];u.length=n}return l}function av(t,e,r,n,i,o,a,s,u,l,c){for(var f=c||[NaN,NaN],p=0,h=r.length;p<h;++p){var y=r[p];l=ov(t,e,y,n,i,o,a,s,u,l,f),e=y}return l}function sv(t,e,r,n){for(var i=0,o=r.length;i<o;++i)for(var a=r[i],s=0;s<n;++s)t[e++]=a[s];return e}function uv(t,e,r,n,i){for(var o=i||[],a=0,s=0,u=r.length;s<u;++s){var l=sv(t,e,r[s],n);o[a++]=l,e=l}return o.length=a,o}function lv(t,e,r,n,i,o,a){var s=(r-e)/n;if(s<3){for(;e<r;e+=n)o[a++]=t[e],o[a++]=t[e+1];return a}var u=new Array(s);u[0]=1,u[s-1]=1;for(var l=[e,r-n],c=0;l.length>0;){for(var f=l.pop(),p=l.pop(),h=0,y=t[p],d=t[p+1],g=t[f],m=t[f+1],v=p+n;v<f;v+=n){var _=ph(t[v],t[v+1],y,d,g,m);_>h&&(c=v,h=_)}h>i&&(u[(c-e)/n]=1,p+n<c&&l.push(p,c),c+n<f&&l.push(c,f))}for(v=0;v<s;++v)u[v]&&(o[a++]=t[e+v*n],o[a++]=t[e+v*n+1]);return a}function cv(t,e){return e*Math.round(t/e)}function fv(t,e,r,n,i,o,a){if(e==r)return a;var s,u,l=cv(t[e],i),c=cv(t[e+1],i);e+=n,o[a++]=l,o[a++]=c;do{if(s=cv(t[e],i),u=cv(t[e+1],i),(e+=n)==r)return o[a++]=s,o[a++]=u,a}while(s==l&&u==c);for(;e<r;){var f=cv(t[e],i),p=cv(t[e+1],i);if(e+=n,f!=s||p!=u){var h=s-l,y=u-c,d=f-l,g=p-c;h*g==y*d&&(h<0&&d<h||h==d||h>0&&d>h)&&(y<0&&g<y||y==g||y>0&&g>y)?(s=f,u=p):(o[a++]=s,o[a++]=u,l=s,c=u,s=f,u=p)}}return o[a++]=s,o[a++]=u,a}function pv(t,e,r,n,i,o,a,s){for(var u=0,l=r.length;u<l;++u){var c=r[u];a=fv(t,e,c,n,i,o,a),s.push(a),e=c}return a}function hv(t,e,r,n,i){var o;for(e+=n;e<r;e+=n)if(o=i(t.slice(e-n,e),t.slice(e,e+n)))return o;return!1}function yv(t,e,r,n,i){for(var o=void 0!==i?i:[],a=0,s=e;s<r;s+=n)o[a++]=t.slice(s,s+n);return o.length=a,o}function dv(t,e,r,n,i){for(var o=void 0!==i?i:[],a=0,s=0,u=r.length;s<u;++s){var l=r[s];o[a++]=yv(t,e,l,n,o[a]),e=l}return o.length=a,o}function gv(t,e,r,n,i){for(var o=void 0!==i?i:[],a=0,s=0,u=r.length;s<u;++s){var l=r[s];o[a++]=dv(t,e,l,n,o[a]),e=l[l.length-1]}return o.length=a,o}function mv(t,e,r,n,i){var o=Cd([1/0,1/0,-1/0,-1/0],t,e,r,n);return!!Gd(i,o)&&(!!dd(i,o)||o[0]>=i[0]&&o[2]<=i[2]||o[1]>=i[1]&&o[3]<=i[3]||hv(t,e,r,n,(function(t,e){return function(t,e,r){var n=!1,i=md(t,e),o=md(t,r);if(i===ld.INTERSECTING||o===ld.INTERSECTING)n=!0;else{var a=t[0],s=t[1],u=t[2],l=t[3],c=e[0],f=e[1],p=r[0],h=r[1],y=(h-f)/(p-c),d=void 0,g=void 0;o&ld.ABOVE&&!(i&ld.ABOVE)&&(n=(d=p-(h-l)/y)>=a&&d<=u),n||!(o&ld.RIGHT)||i&ld.RIGHT||(n=(g=h-(p-u)*y)>=s&&g<=l),n||!(o&ld.BELOW)||i&ld.BELOW||(n=(d=p-(h-s)/y)>=a&&d<=u),n||!(o&ld.LEFT)||i&ld.LEFT||(n=(g=h-(p-a)*y)>=s&&g<=l)}return n}(i,t,e)})))}function vv(t,e,r,n,i){return!!(mv(t,e,r,n,i)||lg(t,e,r,n,i[0],i[1])||lg(t,e,r,n,i[0],i[3])||lg(t,e,r,n,i[2],i[1])||lg(t,e,r,n,i[2],i[3]))}function _v(t,e,r,n,i){if(!vv(t,e,r[0],n,i))return!1;if(1===r.length)return!0;for(var o=1,a=r.length;o<a;++o)if(ug(t,r[o-1],r[o],n,i)&&!mv(t,r[o-1],r[o],n,i))return!1;return!0}function bv(t,e,r,n){for(var i=t[e],o=t[e+1],a=0,s=e+n;s<r;s+=n){var u=t[s],l=t[s+1];a+=Math.sqrt((u-i)*(u-i)+(l-o)*(l-o)),i=u,o=l}return a}var wv=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Sv=function(t){function e(e,r){var n=t.call(this)||this;return n.flatMidpoint_=null,n.flatMidpointRevision_=-1,n.maxDelta_=-1,n.maxDeltaRevision_=-1,void 0===r||Array.isArray(e[0])?n.setCoordinates(e,r):n.setFlatCoordinates(r,e),n}return wv(e,t),e.prototype.appendCoordinate=function(t){this.flatCoordinates?Xh(this.flatCoordinates,t):this.flatCoordinates=t.slice(),this.changed()},e.prototype.clone=function(){var t=new e(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t},e.prototype.closestPointXY=function(t,e,r,n){return n<hd(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(nv(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),ov(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,r,n))},e.prototype.forEachSegment=function(t){return hv(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.getCoordinateAtM=function(t,e){if(this.layout!=Km&&this.layout!=Jm)return null;var r=void 0!==e&&e;return fm(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,r)},e.prototype.getCoordinates=function(){return yv(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getCoordinateAt=function(t,e){return cm(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)},e.prototype.getLength=function(){return bv(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getFlatMidpoint=function(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_},e.prototype.getSimplifiedGeometryInternal=function(t){var r=[];return r.length=lv(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,r,0),new e(r,Ym)},e.prototype.getType=function(){return"LineString"},e.prototype.intersectsExtent=function(t){return mv(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=sv(this.flatCoordinates,0,t,this.stride),this.changed()},e}(ev);const Ov=Sv;var xv=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Cv=function(t){function e(e,r,n){var i=t.call(this)||this;if(i.ends_=[],i.maxDelta_=-1,i.maxDeltaRevision_=-1,Array.isArray(e[0]))i.setCoordinates(e,r);else if(void 0!==r&&n)i.setFlatCoordinates(r,e),i.ends_=n;else{for(var o=i.getLayout(),a=e,s=[],u=[],l=0,c=a.length;l<c;++l){var f=a[l];0===l&&(o=f.getLayout()),Xh(s,f.getFlatCoordinates()),u.push(s.length)}i.setFlatCoordinates(o,s),i.ends_=u}return i}return xv(e,t),e.prototype.appendLineString=function(t){this.flatCoordinates?Xh(this.flatCoordinates,t.getFlatCoordinates().slice()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},e.prototype.clone=function(){var t=new e(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t},e.prototype.closestPointXY=function(t,e,r,n){return n<hd(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(iv(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),av(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,r,n))},e.prototype.getCoordinateAtM=function(t,e,r){if(this.layout!=Km&&this.layout!=Jm||0===this.flatCoordinates.length)return null;var n=void 0!==e&&e,i=void 0!==r&&r;return function(t,e,r,n,i,o,a){if(a)return fm(t,e,r[r.length-1],n,i,o);var s;if(i<t[n-1])return o?((s=t.slice(0,n))[n-1]=i,s):null;if(t[t.length-1]<i)return o?((s=t.slice(t.length-n))[n-1]=i,s):null;for(var u=0,l=r.length;u<l;++u){var c=r[u];if(e!=c){if(i<t[e+n-1])return null;if(i<=t[c-1])return fm(t,e,c,n,i,!1);e=c}}return null}(this.flatCoordinates,0,this.ends_,this.stride,t,n,i)},e.prototype.getCoordinates=function(){return dv(this.flatCoordinates,0,this.ends_,this.stride)},e.prototype.getEnds=function(){return this.ends_},e.prototype.getLineString=function(t){return t<0||this.ends_.length<=t?null:new Ov(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)},e.prototype.getLineStrings=function(){for(var t=this.flatCoordinates,e=this.ends_,r=this.layout,n=[],i=0,o=0,a=e.length;o<a;++o){var s=e[o],u=new Ov(t.slice(i,s),r);n.push(u),i=s}return n},e.prototype.getFlatMidpoints=function(){for(var t=[],e=this.flatCoordinates,r=0,n=this.ends_,i=this.stride,o=0,a=n.length;o<a;++o){var s=n[o];Xh(t,cm(e,r,s,i,.5)),r=s}return t},e.prototype.getSimplifiedGeometryInternal=function(t){var r=[],n=[];return r.length=function(t,e,r,n,i,o,a,s){for(var u=0,l=r.length;u<l;++u){var c=r[u];a=lv(t,e,c,n,i,o,a),s.push(a),e=c}return a}(this.flatCoordinates,0,this.ends_,this.stride,t,r,0,n),new e(r,Ym,n)},e.prototype.getType=function(){return"MultiLineString"},e.prototype.intersectsExtent=function(t){return function(t,e,r,n,i){for(var o=0,a=r.length;o<a;++o){if(mv(t,e,r[o],n,i))return!0;e=r[o]}return!1}(this.flatCoordinates,0,this.ends_,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);var r=uv(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===r.length?0:r[r.length-1],this.changed()},e}(ev);const Ev=Cv;var Pv=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),kv=function(t){function e(e,r){var n=t.call(this)||this;return n.setCoordinates(e,r),n}return Pv(e,t),e.prototype.clone=function(){var t=new e(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t},e.prototype.closestPointXY=function(t,e,r,n){var i=this.flatCoordinates,o=hh(t,e,i[0],i[1]);if(o<n){for(var a=this.stride,s=0;s<a;++s)r[s]=i[s];return r.length=a,o}return n},e.prototype.getCoordinates=function(){return this.flatCoordinates?this.flatCoordinates.slice():[]},e.prototype.computeExtent=function(t){return bd(this.flatCoordinates,t)},e.prototype.getType=function(){return"Point"},e.prototype.intersectsExtent=function(t){return gd(t,this.flatCoordinates[0],this.flatCoordinates[1])},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=function(t,e,r,n){for(var i=0,o=r.length;i<o;++i)t[e++]=r[i];return e}(this.flatCoordinates,0,t,this.stride),this.changed()},e}(ev);const Tv=kv;var jv=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Rv=function(t){function e(e,r){var n=t.call(this)||this;return r&&!Array.isArray(e[0])?n.setFlatCoordinates(r,e):n.setCoordinates(e,r),n}return jv(e,t),e.prototype.appendPoint=function(t){this.flatCoordinates?Xh(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.changed()},e.prototype.clone=function(){var t=new e(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t},e.prototype.closestPointXY=function(t,e,r,n){if(n<hd(this.getExtent(),t,e))return n;for(var i=this.flatCoordinates,o=this.stride,a=0,s=i.length;a<s;a+=o){var u=hh(t,e,i[a],i[a+1]);if(u<n){n=u;for(var l=0;l<o;++l)r[l]=i[a+l];r.length=o}}return n},e.prototype.getCoordinates=function(){return yv(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getPoint=function(t){var e=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return t<0||e<=t?null:new Tv(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)},e.prototype.getPoints=function(){for(var t=this.flatCoordinates,e=this.layout,r=this.stride,n=[],i=0,o=t.length;i<o;i+=r){var a=new Tv(t.slice(i,i+r),e);n.push(a)}return n},e.prototype.getType=function(){return"MultiPoint"},e.prototype.intersectsExtent=function(t){for(var e=this.flatCoordinates,r=this.stride,n=0,i=e.length;n<i;n+=r)if(gd(t,e[n],e[n+1]))return!0;return!1},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=sv(this.flatCoordinates,0,t,this.stride),this.changed()},e}(ev);const Lv=Rv;function Iv(t,e,r,n){for(var i=0,o=t[r-n],a=t[r-n+1];e<r;e+=n){var s=t[e],u=t[e+1];i+=a*s-o*u,o=s,a=u}return i/2}function Mv(t,e,r,n){for(var i=0,o=0,a=r.length;o<a;++o){var s=r[o];i+=Iv(t,e,s,n),e=s}return i}var Av=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Dv=function(t){function e(e,r){var n=t.call(this)||this;return n.maxDelta_=-1,n.maxDeltaRevision_=-1,void 0===r||Array.isArray(e[0])?n.setCoordinates(e,r):n.setFlatCoordinates(r,e),n}return Av(e,t),e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout)},e.prototype.closestPointXY=function(t,e,r,n){return n<hd(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(nv(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),ov(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,r,n))},e.prototype.getArea=function(){return Iv(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getCoordinates=function(){return yv(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getSimplifiedGeometryInternal=function(t){var r=[];return r.length=lv(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,r,0),new e(r,Ym)},e.prototype.getType=function(){return"LinearRing"},e.prototype.intersectsExtent=function(t){return!1},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=sv(this.flatCoordinates,0,t,this.stride),this.changed()},e}(ev);const Nv=Dv;function Fv(t,e,r,n){for(;e<r-n;){for(var i=0;i<n;++i){var o=t[e+i];t[e+i]=t[r-n+i],t[r-n+i]=o}e+=n,r-=n}}function zv(t,e,r,n){for(var i=0,o=t[r-n],a=t[r-n+1];e<r;e+=n){var s=t[e],u=t[e+1];i+=(s-o)*(u+a),o=s,a=u}return 0===i?void 0:i>0}function Gv(t,e,r,n,i){for(var o=void 0!==i&&i,a=0,s=r.length;a<s;++a){var u=r[a],l=zv(t,e,u,n);if(0===a){if(o&&l||!o&&!l)return!1}else if(o&&!l||!o&&l)return!1;e=u}return!0}function Bv(t,e,r,n,i){for(var o=void 0!==i&&i,a=0,s=r.length;a<s;++a){var u=r[a],l=zv(t,e,u,n);(0===a?o&&l||!o&&!l:o&&!l||!o&&l)&&Fv(t,e,u,n),e=u}return e}function Vv(t,e,r,n,i){for(var o=0,a=r.length;o<a;++o)e=Bv(t,e,r[o],n,i);return e}var Uv=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),qv=function(t){function e(e,r,n){var i=t.call(this)||this;return i.ends_=[],i.flatInteriorPointRevision_=-1,i.flatInteriorPoint_=null,i.maxDelta_=-1,i.maxDeltaRevision_=-1,i.orientedRevision_=-1,i.orientedFlatCoordinates_=null,void 0!==r&&n?(i.setFlatCoordinates(r,e),i.ends_=n):i.setCoordinates(e,r),i}return Uv(e,t),e.prototype.appendLinearRing=function(t){this.flatCoordinates?Xh(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},e.prototype.clone=function(){var t=new e(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t},e.prototype.closestPointXY=function(t,e,r,n){return n<hd(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(iv(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),av(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,r,n))},e.prototype.containsXY=function(t,e){return cg(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)},e.prototype.getArea=function(){return Mv(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)},e.prototype.getCoordinates=function(t){var e;return void 0!==t?Bv(e=this.getOrientedFlatCoordinates().slice(),0,this.ends_,this.stride,t):e=this.flatCoordinates,dv(e,0,this.ends_,this.stride)},e.prototype.getEnds=function(){return this.ends_},e.prototype.getFlatInteriorPoint=function(){if(this.flatInteriorPointRevision_!=this.getRevision()){var t=Rd(this.getExtent());this.flatInteriorPoint_=fg(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_},e.prototype.getInteriorPoint=function(){return new Tv(this.getFlatInteriorPoint(),Km)},e.prototype.getLinearRingCount=function(){return this.ends_.length},e.prototype.getLinearRing=function(t){return t<0||this.ends_.length<=t?null:new Nv(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)},e.prototype.getLinearRings=function(){for(var t=this.layout,e=this.flatCoordinates,r=this.ends_,n=[],i=0,o=0,a=r.length;o<a;++o){var s=r[o],u=new Nv(e.slice(i,s),t);n.push(u),i=s}return n},e.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;Gv(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Bv(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},e.prototype.getSimplifiedGeometryInternal=function(t){var r=[],n=[];return r.length=pv(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),r,0,n),new e(r,Ym,n)},e.prototype.getType=function(){return"Polygon"},e.prototype.intersectsExtent=function(t){return _v(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);var r=uv(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===r.length?0:r[r.length-1],this.changed()},e}(ev);const Wv=qv;function Xv(t){var e=t[0],r=t[1],n=t[2],i=t[3],o=[e,r,e,i,n,i,n,r,e,r];return new qv(o,Ym,[o.length])}var Zv=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Hv=function(t){function e(e,r,n){var i=t.call(this)||this;if(i.endss_=[],i.flatInteriorPointsRevision_=-1,i.flatInteriorPoints_=null,i.maxDelta_=-1,i.maxDeltaRevision_=-1,i.orientedRevision_=-1,i.orientedFlatCoordinates_=null,!n&&!Array.isArray(e[0])){for(var o=i.getLayout(),a=e,s=[],u=[],l=0,c=a.length;l<c;++l){var f=a[l];0===l&&(o=f.getLayout());for(var p=s.length,h=f.getEnds(),y=0,d=h.length;y<d;++y)h[y]+=p;Xh(s,f.getFlatCoordinates()),u.push(h)}r=o,e=s,n=u}return void 0!==r&&n?(i.setFlatCoordinates(r,e),i.endss_=n):i.setCoordinates(e,r),i}return Zv(e,t),e.prototype.appendPolygon=function(t){var e;if(this.flatCoordinates){var r=this.flatCoordinates.length;Xh(this.flatCoordinates,t.getFlatCoordinates());for(var n=0,i=(e=t.getEnds().slice()).length;n<i;++n)e[n]+=r}else this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();this.endss_.push(e),this.changed()},e.prototype.clone=function(){for(var t=this.endss_.length,r=new Array(t),n=0;n<t;++n)r[n]=this.endss_[n].slice();var i=new e(this.flatCoordinates.slice(),this.layout,r);return i.applyProperties(this),i},e.prototype.closestPointXY=function(t,e,r,n){return n<hd(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(function(t,e,r,n,i){for(var o=0,a=r.length;o<a;++o){var s=r[o];i=iv(t,e,s,n,i),e=s[s.length-1]}return i}(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),function(t,e,r,n,i,o,a,s,u,l,c){for(var f=[NaN,NaN],p=0,h=r.length;p<h;++p){var y=r[p];l=av(t,e,y,n,i,true,a,s,u,l,f),e=y[y.length-1]}return l}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,0,t,e,r,n))},e.prototype.containsXY=function(t,e){return function(t,e,r,n,i,o){if(0===r.length)return!1;for(var a=0,s=r.length;a<s;++a){var u=r[a];if(cg(t,e,u,n,i,o))return!0;e=u[u.length-1]}return!1}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)},e.prototype.getArea=function(){return function(t,e,r,n){for(var i=0,o=0,a=r.length;o<a;++o){var s=r[o];i+=Mv(t,e,s,n),e=s[s.length-1]}return i}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)},e.prototype.getCoordinates=function(t){var e;return void 0!==t?Vv(e=this.getOrientedFlatCoordinates().slice(),0,this.endss_,this.stride,t):e=this.flatCoordinates,gv(e,0,this.endss_,this.stride)},e.prototype.getEndss=function(){return this.endss_},e.prototype.getFlatInteriorPoints=function(){if(this.flatInteriorPointsRevision_!=this.getRevision()){var t=pm(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=pg(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_},e.prototype.getInteriorPoints=function(){return new Lv(this.getFlatInteriorPoints().slice(),Km)},e.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;!function(t,e,r,n,i){for(var o=0,a=r.length;o<a;++o){var s=r[o];if(!Gv(t,e,s,n,undefined))return!1;s.length&&(e=s[s.length-1])}return!0}(t,0,this.endss_,this.stride)?(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Vv(this.orientedFlatCoordinates_,0,this.endss_,this.stride)):this.orientedFlatCoordinates_=t,this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},e.prototype.getSimplifiedGeometryInternal=function(t){var r=[],n=[];return r.length=function(t,e,r,n,i,o,a,s){for(var u=0,l=r.length;u<l;++u){var c=r[u],f=[];a=pv(t,e,c,n,i,o,a,f),s.push(f),e=c[c.length-1]}return a}(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),r,0,n),new e(r,Ym,n)},e.prototype.getPolygon=function(t){if(t<0||this.endss_.length<=t)return null;var e;if(0===t)e=0;else{var r=this.endss_[t-1];e=r[r.length-1]}var n=this.endss_[t].slice(),i=n[n.length-1];if(0!==e)for(var o=0,a=n.length;o<a;++o)n[o]-=e;return new Wv(this.flatCoordinates.slice(e,i),this.layout,n)},e.prototype.getPolygons=function(){for(var t=this.layout,e=this.flatCoordinates,r=this.endss_,n=[],i=0,o=0,a=r.length;o<a;++o){var s=r[o].slice(),u=s[s.length-1];if(0!==i)for(var l=0,c=s.length;l<c;++l)s[l]-=i;var f=new Wv(e.slice(i,u),t,s);n.push(f),i=u}return n},e.prototype.getType=function(){return"MultiPolygon"},e.prototype.intersectsExtent=function(t){return function(t,e,r,n,i){for(var o=0,a=r.length;o<a;++o){var s=r[o];if(_v(t,e,s,n,i))return!0;e=s[s.length-1]}return!1}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);var r=function(t,e,r,n,i){for(var o=i||[],a=0,s=0,u=r.length;s<u;++s){var l=uv(t,e,r[s],n,o[a]);o[a++]=l,e=l[l.length-1]}return o.length=a,o}(this.flatCoordinates,0,t,this.stride,this.endss_);if(0===r.length)this.flatCoordinates.length=0;else{var n=r[r.length-1];this.flatCoordinates.length=0===n.length?0:n[n.length-1]}this.changed()},e}(ev);const Yv=Hv;var Kv=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Jv=function(t){function e(e){var r=this,n=e||{};return(r=t.call(this)||this).dataProjection=qg(n.dataProjection?n.dataProjection:"EPSG:4326"),n.featureProjection&&(r.defaultFeatureProjection=qg(n.featureProjection)),r.geometryName_=n.geometryName,r.extractGeometryName_=n.extractGeometryName,r.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"],r}return Kv(e,t),e.prototype.readFeatureFromObject=function(t,e){var r,n=$v((r="Feature"===t.type?t:{type:"Feature",geometry:t,properties:null}).geometry,e),i=new Am;return this.geometryName_?i.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in r!==void 0&&i.setGeometryName(r.geometry_name),i.setGeometry(n),"id"in r&&i.setId(r.id),r.properties&&i.setProperties(r.properties,!0),i},e.prototype.readFeaturesFromObject=function(t,e){var r=null;if("FeatureCollection"===t.type){r=[];for(var n=t.features,i=0,o=n.length;i<o;++i)r.push(this.readFeatureFromObject(n[i],e))}else r=[this.readFeatureFromObject(t,e)];return r},e.prototype.readGeometryFromObject=function(t,e){return $v(t,e)},e.prototype.readProjectionFromObject=function(t){var e,r=t.crs;return r?"name"==r.type?e=qg(r.properties.name):"EPSG"===r.type?e=qg("EPSG:"+r.properties.code):uh(!1,36):e=this.dataProjection,e},e.prototype.writeFeatureObject=function(t,e){e=this.adaptOptions(e);var r={type:"Feature",geometry:null,properties:null},n=t.getId();if(void 0!==n&&(r.id=n),!t.hasProperties())return r;var i=t.getProperties(),o=t.getGeometry();return o&&(r.geometry=Qv(o,e),delete i[t.getGeometryName()]),ty(i)||(r.properties=i),r},e.prototype.writeFeaturesObject=function(t,e){e=this.adaptOptions(e);for(var r=[],n=0,i=t.length;n<i;++n)r.push(this.writeFeatureObject(t[n],e));return{type:"FeatureCollection",features:r}},e.prototype.writeGeometryObject=function(t,e){return Qv(t,this.adaptOptions(e))},e}(Hm);function $v(t,e){if(!t)return null;var r;switch(t.type){case"Point":r=function(t){return new Tv(t.coordinates)}(t);break;case"LineString":r=function(t){return new Ov(t.coordinates)}(t);break;case"Polygon":r=function(t){return new Wv(t.coordinates)}(t);break;case"MultiPoint":r=function(t){return new Lv(t.coordinates)}(t);break;case"MultiLineString":r=function(t){return new Ev(t.coordinates)}(t);break;case"MultiPolygon":r=function(t){return new Yv(t.coordinates)}(t);break;case"GeometryCollection":r=function(t,e){var r=t.geometries.map((function(t){return $v(t,undefined)}));return new Vm(r)}(t);break;default:throw new Error("Unsupported GeoJSON type: "+t.type)}return Wm(r,!1,e)}function Qv(t,e){var r,n=(t=Wm(t,!0,e)).getType();switch(n){case"Point":r=function(t,e){return{type:"Point",coordinates:t.getCoordinates()}}(t);break;case"LineString":r=function(t,e){return{type:"LineString",coordinates:t.getCoordinates()}}(t);break;case"Polygon":r=function(t,e){var r;return e&&(r=e.rightHanded),{type:"Polygon",coordinates:t.getCoordinates(r)}}(t,e);break;case"MultiPoint":r=function(t,e){return{type:"MultiPoint",coordinates:t.getCoordinates()}}(t);break;case"MultiLineString":r=function(t,e){return{type:"MultiLineString",coordinates:t.getCoordinates()}}(t);break;case"MultiPolygon":r=function(t,e){var r;return e&&(r=e.rightHanded),{type:"MultiPolygon",coordinates:t.getCoordinates(r)}}(t,e);break;case"GeometryCollection":r=function(t,e){var r=t.getGeometriesArray().map((function(t){var r=Jh({},e);return delete r.featureProjection,Qv(t,r)}));return{type:"GeometryCollection",geometries:r}}(t,e);break;case"Circle":r={type:"GeometryCollection",geometries:[]};break;default:throw new Error("Unsupported geometry type: "+n)}return r}const t_=Jv,e_="opacity",r_="visible",n_="extent",i_="zIndex",o_="maxResolution",a_="minResolution",s_="maxZoom",u_="minZoom",l_="source";var c_=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),f_=function(t){function e(e){var r=t.call(this)||this;r.on,r.once,r.un,r.background_=e.background;var n=Jh({},e);return"object"==typeof e.properties&&(delete n.properties,Jh(n,e.properties)),n[e_]=void 0!==e.opacity?e.opacity:1,uh("number"==typeof n[e_],64),n[r_]=void 0===e.visible||e.visible,n[i_]=e.zIndex,n[o_]=void 0!==e.maxResolution?e.maxResolution:1/0,n[a_]=void 0!==e.minResolution?e.minResolution:0,n[u_]=void 0!==e.minZoom?e.minZoom:-1/0,n[s_]=void 0!==e.maxZoom?e.maxZoom:1/0,r.className_=void 0!==n.className?n.className:"ol-layer",delete n.className,r.setProperties(n),r.state_=null,r}return c_(e,t),e.prototype.getBackground=function(){return this.background_},e.prototype.getClassName=function(){return this.className_},e.prototype.getLayerState=function(t){var e=this.state_||{layer:this,managed:void 0===t||t},r=this.getZIndex();return e.opacity=lh(Math.round(100*this.getOpacity())/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=void 0!==r||e.managed?r:1/0,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e},e.prototype.getLayersArray=function(t){return $p()},e.prototype.getLayerStatesArray=function(t){return $p()},e.prototype.getExtent=function(){return this.get(n_)},e.prototype.getMaxResolution=function(){return this.get(o_)},e.prototype.getMinResolution=function(){return this.get(a_)},e.prototype.getMinZoom=function(){return this.get(u_)},e.prototype.getMaxZoom=function(){return this.get(s_)},e.prototype.getOpacity=function(){return this.get(e_)},e.prototype.getSourceState=function(){return $p()},e.prototype.getVisible=function(){return this.get(r_)},e.prototype.getZIndex=function(){return this.get(i_)},e.prototype.setBackground=function(t){this.background_=t,this.changed()},e.prototype.setExtent=function(t){this.set(n_,t)},e.prototype.setMaxResolution=function(t){this.set(o_,t)},e.prototype.setMinResolution=function(t){this.set(a_,t)},e.prototype.setMaxZoom=function(t){this.set(s_,t)},e.prototype.setMinZoom=function(t){this.set(u_,t)},e.prototype.setOpacity=function(t){uh("number"==typeof t,64),this.set(e_,t)},e.prototype.setVisible=function(t){this.set(r_,t)},e.prototype.setZIndex=function(t){this.set(i_,t)},e.prototype.disposeInternal=function(){this.state_&&(this.state_.layer=null,this.state_=null),t.prototype.disposeInternal.call(this)},e}(vy);const p_=f_,h_="precompose",y_="rendercomplete";var d_=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),g_=function(t){function e(e){var r=this,n=Jh({},e);delete n.source,(r=t.call(this,n)||this).on,r.once,r.un,r.mapPrecomposeKey_=null,r.mapRenderKey_=null,r.sourceChangeKey_=null,r.renderer_=null,r.rendered=!1,e.render&&(r.render=e.render),e.map&&r.setMap(e.map),r.addChangeListener(l_,r.handleSourcePropertyChange_);var i=e.source?e.source:null;return r.setSource(i),r}return d_(e,t),e.prototype.getLayersArray=function(t){var e=t||[];return e.push(this),e},e.prototype.getLayerStatesArray=function(t){var e=t||[];return e.push(this.getLayerState()),e},e.prototype.getSource=function(){return this.get(l_)||null},e.prototype.getRenderSource=function(){return this.getSource()},e.prototype.getSourceState=function(){var t=this.getSource();return t?t.getState():"undefined"},e.prototype.handleSourceChange_=function(){this.changed()},e.prototype.handleSourcePropertyChange_=function(){this.sourceChangeKey_&&(py(this.sourceChangeKey_),this.sourceChangeKey_=null);var t=this.getSource();t&&(this.sourceChangeKey_=cy(t,ny,this.handleSourceChange_,this)),this.changed()},e.prototype.getFeatures=function(t){return this.renderer_?this.renderer_.getFeatures(t):new Promise((function(t){return t([])}))},e.prototype.getData=function(t){return this.renderer_&&this.rendered?this.renderer_.getData(t):null},e.prototype.render=function(t,e){var r=this.getRenderer();if(r.prepareFrame(t))return this.rendered=!0,r.renderFrame(t,e)},e.prototype.unrender=function(){this.rendered=!1},e.prototype.setMapInternal=function(t){t||this.unrender(),this.set("map",t)},e.prototype.getMapInternal=function(){return this.get("map")},e.prototype.setMap=function(t){this.mapPrecomposeKey_&&(py(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(py(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=cy(t,h_,(function(t){var e=t.frameState.layerStatesArray,r=this.getLayerState(!1);uh(!e.some((function(t){return t.layer===r.layer})),67),e.push(r)}),this),this.mapRenderKey_=cy(this,ny,t.render,t),this.changed())},e.prototype.setSource=function(t){this.set(l_,t)},e.prototype.getRenderer=function(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_},e.prototype.hasRenderer=function(){return!!this.renderer_},e.prototype.createRenderer=function(){return null},e.prototype.disposeInternal=function(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),t.prototype.disposeInternal.call(this)},e}(p_);function m_(t,e){if(!t.visible)return!1;var r=e.resolution;if(r<t.minResolution||r>=t.maxResolution)return!1;var n=e.zoom;return n>t.minZoom&&n<=t.maxZoom}const v_=g_;var __=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),b_=function(t){function e(e){var r=e||{};return t.call(this,r)||this}return __(e,t),e}(v_);const w_=b_;var S_=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),O_=function(t){function e(e){var r=t.call(this)||this;return r.ready=!0,r.boundHandleImageChange_=r.handleImageChange_.bind(r),r.layer_=e,r.declutterExecutorGroup=null,r}return S_(e,t),e.prototype.getFeatures=function(t){return $p()},e.prototype.getData=function(t){return null},e.prototype.prepareFrame=function(t){return $p()},e.prototype.renderFrame=function(t,e){return $p()},e.prototype.loadedTileCallback=function(t,e,r){t[e]||(t[e]={}),t[e][r.tileCoord.toString()]=r},e.prototype.createLoadedTileFinder=function(t,e,r){return function(n,i){var o=this.loadedTileCallback.bind(this,r,n);return t.forEachLoadedTile(e,n,i,o)}.bind(this)},e.prototype.forEachFeatureAtCoordinate=function(t,e,r,n,i){},e.prototype.getDataAtPixel=function(t,e,r){return null},e.prototype.getLayer=function(){return this.layer_},e.prototype.handleFontsChanged=function(){},e.prototype.handleImageChange_=function(t){2===t.target.getState()&&this.renderIfReadyAndVisible()},e.prototype.loadImage=function(t){var e=t.getState();return 2!=e&&3!=e&&t.addEventListener(ny,this.boundHandleImageChange_),0==e&&(t.load(),e=t.getState()),2==e},e.prototype.renderIfReadyAndVisible=function(){var t=this.getLayer();t&&t.getVisible()&&"ready"===t.getSourceState()&&t.changed()},e.prototype.disposeInternal=function(){delete this.layer_,t.prototype.disposeInternal.call(this)},e}(dy);const x_=O_;var C_=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const E_=function(t){function e(e,r,n,i){var o=t.call(this,e)||this;return o.inversePixelTransform=r,o.frameState=n,o.context=i,o}return C_(e,t),e}(Gh);var P_=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),k_=[],T_=null,j_=function(t){function e(e){var r=t.call(this,e)||this;return r.container=null,r.renderedResolution,r.tempTransform=[1,0,0,1,0,0],r.pixelTransform=[1,0,0,1,0,0],r.inversePixelTransform=[1,0,0,1,0,0],r.context=null,r.containerReused=!1,r.pixelContext_=null,r.frameState=null,r}return P_(e,t),e.prototype.getImageData=function(t,e,r){var n,i;T_||((n=document.createElement("canvas")).width=1,n.height=1,T_=n.getContext("2d")),T_.clearRect(0,0,1,1);try{T_.drawImage(t,e,r,1,1,0,0,1,1),i=T_.getImageData(0,0,1,1).data}catch(t){return T_=null,null}return i},e.prototype.getBackground=function(t){var e=this.getLayer().getBackground();return"function"==typeof e&&(e=e(t.viewState.resolution)),e||void 0},e.prototype.useContainer=function(t,e,r){var n,i,o=this.getLayer().getClassName();if(t&&t.className===o&&(!r||t&&t.style.backgroundColor&&Zh(xh(t.style.backgroundColor),xh(r)))&&(s=t.firstElementChild)instanceof HTMLCanvasElement&&(i=s.getContext("2d")),i&&i.canvas.style.transform===e?(this.container=t,this.context=i,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){(n=document.createElement("div")).className=o;var a=n.style;a.position="absolute",a.width="100%",a.height="100%";var s=(i=Dh()).canvas;n.appendChild(s),(a=s.style).position="absolute",a.left="0",a.transformOrigin="top left",this.container=n,this.context=i}this.containerReused||!r||this.container.style.backgroundColor||(this.container.style.backgroundColor=r)},e.prototype.clipUnrotated=function(t,e,r){var n=Nd(r),i=Fd(r),o=jd(r),a=Td(r);ng(e.coordinateToPixelTransform,n),ng(e.coordinateToPixelTransform,i),ng(e.coordinateToPixelTransform,o),ng(e.coordinateToPixelTransform,a);var s=this.inversePixelTransform;ng(s,n),ng(s,i),ng(s,o),ng(s,a),t.save(),t.beginPath(),t.moveTo(Math.round(n[0]),Math.round(n[1])),t.lineTo(Math.round(i[0]),Math.round(i[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.clip()},e.prototype.dispatchRenderEvent_=function(t,e,r){var n=this.getLayer();if(n.hasListener(t)){var i=new E_(t,this.inversePixelTransform,r,e);n.dispatchEvent(i)}},e.prototype.preRender=function(t,e){this.frameState=e,this.dispatchRenderEvent_("prerender",t,e)},e.prototype.postRender=function(t,e){this.dispatchRenderEvent_("postrender",t,e)},e.prototype.getRenderTransform=function(t,e,r,n,i,o,a){var s=i/2,u=o/2,l=n/e,c=-l,f=-t[0]+a,p=-t[1];return og(this.tempTransform,s,u,l,c,-r,f,p)},e.prototype.getDataAtPixel=function(t,e,r){var n=ng(this.inversePixelTransform,t.slice()),i=this.context,o=this.getLayer().getExtent();if(o&&!yd(o,ng(e.pixelToCoordinateTransform,t.slice())))return null;var a,s=Math.round(n[0]),u=Math.round(n[1]),l=this.pixelContext_;if(!l){var c=document.createElement("canvas");c.width=1,c.height=1,l=c.getContext("2d"),this.pixelContext_=l}l.clearRect(0,0,1,1);try{l.drawImage(i.canvas,s,u,1,1,0,0,1,1),a=l.getImageData(0,0,1,1).data}catch(t){return"SecurityError"===t.name?(this.pixelContext_=null,new Uint8Array):a}return 0===a[3]?null:a},e.prototype.disposeInternal=function(){delete this.frameState,t.prototype.disposeInternal.call(this)},e}(x_);const R_=j_;var L_={imageSmoothingEnabled:!1,msImageSmoothingEnabled:!1},I_={imageSmoothingEnabled:!0,msImageSmoothingEnabled:!0},M_=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),A_=function(t){function e(e){var r=t.call(this,e)||this;return r.image_=null,r}return M_(e,t),e.prototype.getImage=function(){return this.image_?this.image_.getImage():null},e.prototype.prepareFrame=function(t){var e=t.layerStatesArray[t.layerIndex],r=t.pixelRatio,n=t.viewState,i=n.resolution,o=this.getLayer().getSource(),a=t.viewHints,s=t.extent;if(void 0!==e.extent&&(s=Dd(s,um(e.extent,n.projection))),!a[0]&&!a[1]&&!Bd(s))if(o){var u=n.projection,l=o.getImage(s,i,r,u);l&&(this.loadImage(l)?this.image_=l:4===l.getState()&&(this.image_=null))}else this.image_=null;return!!this.image_},e.prototype.getData=function(t){var e=this.frameState;if(!e)return null;var r=this.getLayer(),n=ng(e.pixelToCoordinateTransform,t.slice()),i=r.getExtent();if(i&&!yd(i,n))return null;var o=this.image_.getExtent(),a=this.image_.getImage(),s=zd(o),u=Math.floor(a.width*((n[0]-o[0])/s));if(u<0||u>=a.width)return null;var l=Ad(o),c=Math.floor(a.height*((o[3]-n[1])/l));return c<0||c>=a.height?null:this.getImageData(a,u,c)},e.prototype.renderFrame=function(t,e){var r=this.image_,n=r.getExtent(),i=r.getResolution(),o=r.getPixelRatio(),a=t.layerStatesArray[t.layerIndex],s=t.pixelRatio,u=t.viewState,l=u.center,c=s*i/(u.resolution*o),f=t.extent,p=u.resolution,h=u.rotation,y=Math.round(zd(f)/p*s),d=Math.round(Ad(f)/p*s);og(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/s,1/s,h,-y/2,-d/2),ag(this.inversePixelTransform,this.pixelTransform);var g=sg(this.pixelTransform);this.useContainer(e,g,this.getBackground(t));var m=this.context,v=m.canvas;v.width!=y||v.height!=d?(v.width=y,v.height=d):this.containerReused||m.clearRect(0,0,y,d);var _=!1,b=!0;if(a.extent){var w=um(a.extent,u.projection);(_=(b=Gd(w,t.extent))&&!dd(w,t.extent))&&this.clipUnrotated(m,t,w)}var S=r.getImage(),O=og(this.tempTransform,y/2,d/2,c,c,0,o*(n[0]-l[0])/i,o*(l[1]-n[3])/i);this.renderedResolution=i*s/o;var x=S.width*O[0],C=S.height*O[3];if(this.getLayer().getSource().getInterpolate()||Jh(m,L_),this.preRender(m,t),b&&x>=.5&&C>=.5){var E=O[4],P=O[5],k=a.opacity,T=void 0;1!==k&&(T=m.globalAlpha,m.globalAlpha=k),m.drawImage(S,0,0,+S.width,+S.height,E,P,x,C),1!==k&&(m.globalAlpha=T)}return this.postRender(m,t),_&&m.restore(),Jh(m,I_),g!==v.style.transform&&(v.style.transform=g),this.container},e}(R_);const D_=A_;var N_=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const F_=function(t){function e(e){return t.call(this,e)||this}return N_(e,t),e.prototype.createRenderer=function(){return new D_(this)},e.prototype.getData=function(e){return t.prototype.getData.call(this,e)},e}(w_);var z_=r(3614),G_=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),B_=function(t){function e(e){var r=t.call(this)||this,n=e||{};return r.dataProjection=new mg({code:"",units:dg.TILE_PIXELS}),r.featureClass_=n.featureClass?n.featureClass:mm,r.geometryName_=n.geometryName,r.layerName_=n.layerName?n.layerName:"layer",r.layers_=n.layers?n.layers:null,r.idProperty_=n.idProperty,r.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"],r}return G_(e,t),e.prototype.readRawGeometry_=function(t,e,r,n){t.pos=e.geometry;for(var i=t.readVarint()+t.pos,o=1,a=0,s=0,u=0,l=0,c=0;t.pos<i;){if(!a){var f=t.readVarint();o=7&f,a=f>>3}a--,1===o||2===o?(s+=t.readSVarint(),u+=t.readSVarint(),1===o&&l>c&&(n.push(l),c=l),r.push(s,u),l+=2):7===o?l>c&&(r.push(r[c],r[c+1]),l+=2):uh(!1,59)}l>c&&(n.push(l),c=l)},e.prototype.createFeature_=function(t,e,r){var n,i=e.type;if(0===i)return null;var o,a=e.properties;this.idProperty_?(o=a[this.idProperty_],delete a[this.idProperty_]):o=e.id,a[this.layerName_]=e.layer.name;var s=[],u=[];this.readRawGeometry_(t,e,s,u);var l=function(t,e){var r;return 1===t?r=1===e?"Point":"MultiPoint":2===t?r=1===e?"LineString":"MultiLineString":3===t&&(r="Polygon"),r}(i,u.length);if(this.featureClass_===mm)(n=new this.featureClass_(l,s,u,a,o)).transform(r.dataProjection);else{var c=void 0;if("Polygon"==l){var f=function(t,e){for(var r=[],n=0,i=0,o=0,a=e.length;o<a;++o){var s=e[o];if(zv(t,n,s,2)){if(0===r.length)continue;r[r.length-1].push(e[i])}else r.push(e.slice(i,o+1));i=o+1,n=s}return r}(s,u);c=f.length>1?new Yv(s,Ym,f):new Wv(s,Ym,u)}else c="Point"===l?new Tv(s,Ym):"LineString"===l?new Ov(s,Ym):"MultiPoint"===l?new Lv(s,Ym):"MultiLineString"===l?new Ev(s,Ym,u):null;n=new(0,this.featureClass_),this.geometryName_&&n.setGeometryName(this.geometryName_);var p=Wm(c,!1,r);n.setGeometry(p),void 0!==o&&n.setId(o),n.setProperties(a,!0)}return n},e.prototype.getType=function(){return"arraybuffer"},e.prototype.readFeatures=function(t,e){var r=this.layers_,n=this.adaptOptions(e),i=qg(n.dataProjection);i.setWorldExtent(n.extent),n.dataProjection=i;var o=new z_(t),a=o.readFields(V_,{}),s=[];for(var u in a)if(!r||-1!=r.indexOf(u)){var l=a[u],c=l?[0,0,l.extent,l.extent]:null;i.setExtent(c);for(var f=0,p=l.length;f<p;++f){var h=W_(o,l,f),y=this.createFeature_(o,h,n);null!==y&&s.push(y)}}return s},e.prototype.readProjection=function(t){return this.dataProjection},e.prototype.setLayers=function(t){this.layers_=t},e}(qm);function V_(t,e,r){if(3===t){var n={keys:[],values:[],features:[]},i=r.readVarint()+r.pos;r.readFields(U_,n,i),n.length=n.features.length,n.length&&(e[n.name]=n)}}function U_(t,e,r){if(15===t)e.version=r.readVarint();else if(1===t)e.name=r.readString();else if(5===t)e.extent=r.readVarint();else if(2===t)e.features.push(r.pos);else if(3===t)e.keys.push(r.readString());else if(4===t){for(var n=null,i=r.readVarint()+r.pos;r.pos<i;)n=1==(t=r.readVarint()>>3)?r.readString():2===t?r.readFloat():3===t?r.readDouble():4===t?r.readVarint64():5===t?r.readVarint():6===t?r.readSVarint():7===t?r.readBoolean():null;e.values.push(n)}}function q_(t,e,r){if(1==t)e.id=r.readVarint();else if(2==t)for(var n=r.readVarint()+r.pos;r.pos<n;){var i=e.layer.keys[r.readVarint()],o=e.layer.values[r.readVarint()];e.properties[i]=o}else 3==t?e.type=r.readVarint():4==t&&(e.geometry=r.pos)}function W_(t,e,r){t.pos=e.features[r];var n=t.readVarint()+t.pos,i={layer:e,type:0,properties:{}};return t.readFields(q_,i,n),i}const X_=B_;var Z_=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),H_=function(t){function e(e){var r=t.call(this)||this;return r.map_=e,r}return Z_(e,t),e.prototype.dispatchRenderEvent=function(t,e){$p()},e.prototype.calculateMatrices2D=function(t){var e=t.viewState,r=t.coordinateToPixelTransform,n=t.pixelToCoordinateTransform;og(r,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),ag(n,r)},e.prototype.forEachFeatureAtCoordinate=function(t,e,r,n,i,o,a,s){var u,l=e.viewState;function c(t,e,r,n){return i.call(o,e,t?r:null,n)}var f=l.projection,p=Dg(t.slice(),f),h=[[0,0]];if(f.canWrapX()&&n){var y=zd(f.getExtent());h.push([-y,0],[y,0])}for(var d=e.layerStatesArray,g=d.length,m=[],v=[],_=0;_<h.length;_++)for(var b=g-1;b>=0;--b){var w=d[b],S=w.layer;if(S.hasRenderer()&&m_(w,l)&&a.call(s,S)){var O=S.getRenderer(),x=S.getSource();if(O&&x){var C=x.getWrapX()?p:t,E=c.bind(null,w.managed);v[0]=C[0]+h[_][0],v[1]=C[1]+h[_][1],u=O.forEachFeatureAtCoordinate(v,e,r,E,m)}if(u)return u}}if(0!==m.length){var P=1/m.length;return m.forEach((function(t,e){return t.distanceSq+=e*P})),m.sort((function(t,e){return t.distanceSq-e.distanceSq})),m.some((function(t){return u=t.callback(t.feature,t.layer,t.geometry)})),u}},e.prototype.forEachLayerAtPixel=function(t,e,r,n,i){return $p()},e.prototype.hasFeatureAtCoordinate=function(t,e,r,n,i,o){return void 0!==this.forEachFeatureAtCoordinate(t,e,r,n,Hh,this,i,o)},e.prototype.getMap=function(){return this.map_},e.prototype.renderFrame=function(t){$p()},e.prototype.scheduleExpireIconCache=function(t){ad.canExpireCache()&&t.postRenderFunctions.push(Y_)},e}(Vh);function Y_(t,e){ad.expire()}const K_=H_;var J_=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const $_=function(t){function e(e){var r=t.call(this,e)||this;r.fontChangeListenerKey_=cy(Ay,Bh,e.redrawText.bind(e)),r.element_=document.createElement("div");var n=r.element_.style;n.position="absolute",n.width="100%",n.height="100%",n.zIndex="0",r.element_.className=by+" ol-layers";var i=e.getViewport();return i.insertBefore(r.element_,i.firstChild||null),r.children_=[],r.renderedVisible_=!0,r}return J_(e,t),e.prototype.dispatchRenderEvent=function(t,e){var r=this.getMap();if(r.hasListener(t)){var n=new E_(t,void 0,e);r.dispatchEvent(n)}},e.prototype.disposeInternal=function(){py(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),t.prototype.disposeInternal.call(this)},e.prototype.renderFrame=function(t){if(t){this.calculateMatrices2D(t),this.dispatchRenderEvent(h_,t);var e=t.layerStatesArray.sort((function(t,e){return t.zIndex-e.zIndex})),r=t.viewState;this.children_.length=0;for(var n=[],i=null,o=0,a=e.length;o<a;++o){var s=e[o];t.layerIndex=o;var u=s.layer,l=u.getSourceState();if(!m_(s,r)||"ready"!=l&&"undefined"!=l)u.unrender();else{var c=u.render(t,i);c&&(c!==i&&(this.children_.push(c),i=c),"getDeclutter"in u&&n.push(u))}}for(o=n.length-1;o>=0;--o)n[o].renderDeclutter(t);!function(t,e){for(var r=t.childNodes,n=0;;++n){var i=r[n],o=e[n];if(!i&&!o)break;i!==o&&(i?o?t.insertBefore(o,i):(t.removeChild(i),--n):t.appendChild(o))}}(this.element_,this.children_),this.dispatchRenderEvent("postcompose",t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}else this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1)},e.prototype.forEachLayerAtPixel=function(t,e,r,n,i){for(var o=e.viewState,a=e.layerStatesArray,s=a.length-1;s>=0;--s){var u=a[s],l=u.layer;if(l.hasRenderer()&&m_(u,o)&&i(l)){var c=l.getRenderer().getDataAtPixel(t,e,r);if(c){var f=n(l,c);if(f)return f}}}},e}(K_),Q_="add",tb="remove";var eb=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),rb="length",nb=function(t){function e(e,r,n){var i=t.call(this,e)||this;return i.element=r,i.index=n,i}return eb(e,t),e}(Gh),ib=function(t){function e(e,r){var n=t.call(this)||this;n.on,n.once,n.un;var i=r||{};if(n.unique_=!!i.unique,n.array_=e||[],n.unique_)for(var o=0,a=n.array_.length;o<a;++o)n.assertUnique_(n.array_[o],o);return n.updateLength_(),n}return eb(e,t),e.prototype.clear=function(){for(;this.getLength()>0;)this.pop()},e.prototype.extend=function(t){for(var e=0,r=t.length;e<r;++e)this.push(t[e]);return this},e.prototype.forEach=function(t){for(var e=this.array_,r=0,n=e.length;r<n;++r)t(e[r],r,e)},e.prototype.getArray=function(){return this.array_},e.prototype.item=function(t){return this.array_[t]},e.prototype.getLength=function(){return this.get(rb)},e.prototype.insertAt=function(t,e){this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new nb(Q_,e,t))},e.prototype.pop=function(){return this.removeAt(this.getLength()-1)},e.prototype.push=function(t){this.unique_&&this.assertUnique_(t);var e=this.getLength();return this.insertAt(e,t),this.getLength()},e.prototype.remove=function(t){for(var e=this.array_,r=0,n=e.length;r<n;++r)if(e[r]===t)return this.removeAt(r)},e.prototype.removeAt=function(t){var e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new nb(tb,e,t)),e},e.prototype.setAt=function(t,e){var r=this.getLength();if(t<r){this.unique_&&this.assertUnique_(e,t);var n=this.array_[t];this.array_[t]=e,this.dispatchEvent(new nb(tb,n,t)),this.dispatchEvent(new nb(Q_,e,t))}else{for(var i=r;i<t;++i)this.insertAt(i,void 0);this.insertAt(t,e)}},e.prototype.updateLength_=function(){this.set(rb,this.array_.length)},e.prototype.assertUnique_=function(t,e){for(var r=0,n=this.array_.length;r<n;++r)if(this.array_[r]===t&&r!==e)throw new sh(58)},e}(vy);const ob=ib;var ab=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),sb=function(t){function e(e,r){var n=t.call(this,e)||this;return n.layer=r,n}return ab(e,t),e}(Gh),ub="layers",lb=function(t){function e(e){var r=this,n=e||{},i=Jh({},n);delete i.layers;var o=n.layers;return(r=t.call(this,i)||this).on,r.once,r.un,r.layersListenerKeys_=[],r.listenerKeys_={},r.addChangeListener(ub,r.handleLayersChanged_),o?Array.isArray(o)?o=new ob(o.slice(),{unique:!0}):uh("function"==typeof o.getArray,43):o=new ob(void 0,{unique:!0}),r.setLayers(o),r}return ab(e,t),e.prototype.handleLayerChange_=function(){this.changed()},e.prototype.handleLayersChanged_=function(){this.layersListenerKeys_.forEach(py),this.layersListenerKeys_.length=0;var t=this.getLayers();for(var e in this.layersListenerKeys_.push(cy(t,Q_,this.handleLayersAdd_,this),cy(t,tb,this.handleLayersRemove_,this)),this.listenerKeys_)this.listenerKeys_[e].forEach(py);$h(this.listenerKeys_);for(var r=t.getArray(),n=0,i=r.length;n<i;n++){var o=r[n];this.registerLayerListeners_(o),this.dispatchEvent(new sb("addlayer",o))}this.changed()},e.prototype.registerLayerListeners_=function(t){var r=[cy(t,Bh,this.handleLayerChange_,this),cy(t,ny,this.handleLayerChange_,this)];t instanceof e&&r.push(cy(t,"addlayer",this.handleLayerGroupAdd_,this),cy(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[th(t)]=r},e.prototype.handleLayerGroupAdd_=function(t){this.dispatchEvent(new sb("addlayer",t.layer))},e.prototype.handleLayerGroupRemove_=function(t){this.dispatchEvent(new sb("removelayer",t.layer))},e.prototype.handleLayersAdd_=function(t){var e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new sb("addlayer",e)),this.changed()},e.prototype.handleLayersRemove_=function(t){var e=t.element,r=th(e);this.listenerKeys_[r].forEach(py),delete this.listenerKeys_[r],this.dispatchEvent(new sb("removelayer",e)),this.changed()},e.prototype.getLayers=function(){return this.get(ub)},e.prototype.setLayers=function(t){var e=this.getLayers();if(e)for(var r=e.getArray(),n=0,i=r.length;n<i;++n)this.dispatchEvent(new sb("removelayer",r[n]));this.set(ub,t)},e.prototype.getLayersArray=function(t){var e=void 0!==t?t:[];return this.getLayers().forEach((function(t){t.getLayersArray(e)})),e},e.prototype.getLayerStatesArray=function(t){var e=void 0!==t?t:[],r=e.length;this.getLayers().forEach((function(t){t.getLayerStatesArray(e)}));var n=this.getLayerState(),i=n.zIndex;t||void 0!==n.zIndex||(i=0);for(var o=r,a=e.length;o<a;o++){var s=e[o];s.opacity*=n.opacity,s.visible=s.visible&&n.visible,s.maxResolution=Math.min(s.maxResolution,n.maxResolution),s.minResolution=Math.max(s.minResolution,n.minResolution),s.minZoom=Math.max(s.minZoom,n.minZoom),s.maxZoom=Math.min(s.maxZoom,n.maxZoom),void 0!==n.extent&&(void 0!==s.extent?s.extent=Dd(s.extent,n.extent):s.extent=n.extent),void 0===s.zIndex&&(s.zIndex=i)}return e},e.prototype.getSourceState=function(){return"ready"},e}(p_);const cb=lb;var fb=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const pb=function(t){function e(e,r,n){var i=t.call(this,e)||this;return i.map=r,i.frameState=void 0!==n?n:null,i}return fb(e,t),e}(Gh);var hb=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const yb=function(t){function e(e,r,n,i,o,a){var s=t.call(this,e,r,o)||this;return s.originalEvent=n,s.pixel_=null,s.coordinate_=null,s.dragging=void 0!==i&&i,s.activePointers=a,s}return hb(e,t),Object.defineProperty(e.prototype,"pixel",{get:function(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_},set:function(t){this.pixel_=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"coordinate",{get:function(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_},set:function(t){this.coordinate_=t},enumerable:!1,configurable:!0}),e.prototype.preventDefault=function(){t.prototype.preventDefault.call(this),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()},e.prototype.stopPropagation=function(){t.prototype.stopPropagation.call(this),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()},e}(pb),db={SINGLECLICK:"singleclick",CLICK:oy,DBLCLICK:"dblclick",POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},gb="pointerdown";var mb=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const vb=function(t){function e(e,r){var n=t.call(this,e)||this;n.map_=e,n.clickTimeoutId_,n.emulateClicks_=!1,n.dragging_=!1,n.dragListenerKeys_=[],n.moveTolerance_=void 0===r?1:r,n.down_=null;var i=n.map_.getViewport();return n.activePointers_=[],n.trackedTouches_={},n.element_=i,n.pointerdownListenerKey_=cy(i,gb,n.handlePointerDown_,n),n.originalPointerMoveEvent_,n.relayedListenerKey_=cy(i,"pointermove",n.relayMoveEvent_,n),n.boundHandleTouchMove_=n.handleTouchMove_.bind(n),n.element_.addEventListener(uy,n.boundHandleTouchMove_,!!Ah&&{passive:!1}),n}return mb(e,t),e.prototype.emulateClick_=function(t){var e=new yb(db.CLICK,this.map_,t);this.dispatchEvent(e),void 0!==this.clickTimeoutId_?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new yb(db.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout(function(){this.clickTimeoutId_=void 0;var e=new yb(db.SINGLECLICK,this.map_,t);this.dispatchEvent(e)}.bind(this),250)},e.prototype.updateActivePointers_=function(t){var e=t,r=e.pointerId;if(e.type==db.POINTERUP||e.type==db.POINTERCANCEL){for(var n in delete this.trackedTouches_[r],this.trackedTouches_)if(this.trackedTouches_[n].target!==e.target){delete this.trackedTouches_[n];break}}else e.type!=db.POINTERDOWN&&e.type!=db.POINTERMOVE||(this.trackedTouches_[r]=e);this.activePointers_=Qh(this.trackedTouches_)},e.prototype.handlePointerUp_=function(t){this.updateActivePointers_(t);var e=new yb(db.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),0===this.activePointers_.length&&(this.dragListenerKeys_.forEach(py),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)},e.prototype.isMouseActionButton_=function(t){return 0===t.button},e.prototype.handlePointerDown_=function(t){this.emulateClicks_=0===this.activePointers_.length,this.updateActivePointers_(t);var e=new yb(db.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);for(var r in this.dispatchEvent(e),this.down_={},t){var n=t[r];this.down_[r]="function"==typeof n?Kh:n}if(0===this.dragListenerKeys_.length){var i=this.map_.getOwnerDocument();this.dragListenerKeys_.push(cy(i,db.POINTERMOVE,this.handlePointerMove_,this),cy(i,db.POINTERUP,this.handlePointerUp_,this),cy(this.element_,db.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==i&&this.dragListenerKeys_.push(cy(this.element_.getRootNode(),db.POINTERUP,this.handlePointerUp_,this))}},e.prototype.handlePointerMove_=function(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;var e=new yb(db.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(e)}},e.prototype.relayMoveEvent_=function(t){this.originalPointerMoveEvent_=t;var e=!(!this.down_||!this.isMoving_(t));this.dispatchEvent(new yb(db.POINTERMOVE,this.map_,t,e))},e.prototype.handleTouchMove_=function(t){var e=this.originalPointerMoveEvent_;e&&!e.defaultPrevented||"boolean"==typeof t.cancelable&&!0!==t.cancelable||t.preventDefault()},e.prototype.isMoving_=function(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_},e.prototype.disposeInternal=function(){this.relayedListenerKey_&&(py(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(uy,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(py(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(py),this.dragListenerKeys_.length=0,this.element_=null,t.prototype.disposeInternal.call(this)},e}(ry),_b="postrender",bb="loadstart",wb="loadend",Sb="layergroup",Ob="size",xb="target",Cb="view";var Eb=1/0;const Pb=function(){function t(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}return t.prototype.clear=function(){this.elements_.length=0,this.priorities_.length=0,$h(this.queuedElements_)},t.prototype.dequeue=function(){var t=this.elements_,e=this.priorities_,r=t[0];1==t.length?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));var n=this.keyFunction_(r);return delete this.queuedElements_[n],r},t.prototype.enqueue=function(t){uh(!(this.keyFunction_(t)in this.queuedElements_),31);var e=this.priorityFunction_(t);return e!=Eb&&(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0)},t.prototype.getCount=function(){return this.elements_.length},t.prototype.getLeftChildIndex_=function(t){return 2*t+1},t.prototype.getRightChildIndex_=function(t){return 2*t+2},t.prototype.getParentIndex_=function(t){return t-1>>1},t.prototype.heapify_=function(){var t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)},t.prototype.isEmpty=function(){return 0===this.elements_.length},t.prototype.isKeyQueued=function(t){return t in this.queuedElements_},t.prototype.isQueued=function(t){return this.isKeyQueued(this.keyFunction_(t))},t.prototype.siftUp_=function(t){for(var e=this.elements_,r=this.priorities_,n=e.length,i=e[t],o=r[t],a=t;t<n>>1;){var s=this.getLeftChildIndex_(t),u=this.getRightChildIndex_(t),l=u<n&&r[u]<r[s]?u:s;e[t]=e[l],r[t]=r[l],t=l}e[t]=i,r[t]=o,this.siftDown_(a,t)},t.prototype.siftDown_=function(t,e){for(var r=this.elements_,n=this.priorities_,i=r[e],o=n[e];e>t;){var a=this.getParentIndex_(e);if(!(n[a]>o))break;r[e]=r[a],n[e]=n[a],e=a}r[e]=i,n[e]=o},t.prototype.reprioritize=function(){var t,e,r,n=this.priorityFunction_,i=this.elements_,o=this.priorities_,a=0,s=i.length;for(e=0;e<s;++e)(r=n(t=i[e]))==Eb?delete this.queuedElements_[this.keyFunction_(t)]:(o[a]=r,i[a++]=t);i.length=a,o.length=a,this.heapify_()},t}();var kb=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Tb=function(t){function e(e,r){var n=t.call(this,(function(t){return e.apply(null,t)}),(function(t){return t[0].getKey()}))||this;return n.boundHandleTileChange_=n.handleTileChange.bind(n),n.tileChangeCallback_=r,n.tilesLoading_=0,n.tilesLoadingKeys_={},n}return kb(e,t),e.prototype.enqueue=function(e){var r=t.prototype.enqueue.call(this,e);return r&&e[0].addEventListener(ny,this.boundHandleTileChange_),r},e.prototype.getTilesLoading=function(){return this.tilesLoading_},e.prototype.handleTileChange=function(t){var e=t.target,r=e.getState();if(2===r||3===r||4===r){e.removeEventListener(ny,this.boundHandleTileChange_);var n=e.getKey();n in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[n],--this.tilesLoading_),this.tileChangeCallback_()}},e.prototype.loadMoreTiles=function(t,e){for(var r,n,i=0;this.tilesLoading_<t&&i<e&&this.getCount()>0;)n=(r=this.dequeue()[0]).getKey(),0!==r.getState()||n in this.tilesLoadingKeys_||(this.tilesLoadingKeys_[n]=!0,++this.tilesLoading_,++i,r.load())},e}(Pb);const jb=Tb,Rb={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};var Lb=42,Ib=256;function Mb(t,e,r){return function(n,i,o,a,s){if(n){if(!i&&!e)return n;var u=e?0:o[0]*i,l=e?0:o[1]*i,c=s?s[0]:0,f=s?s[1]:0,p=t[0]+u/2+c,h=t[2]-u/2+c,y=t[1]+l/2+f,d=t[3]-l/2+f;p>h&&(h=p=(h+p)/2),y>d&&(d=y=(d+y)/2);var g=lh(n[0],p,h),m=lh(n[1],y,d);if(a&&r&&i){var v=30*i;g+=-v*Math.log(1+Math.max(0,p-n[0])/v)+v*Math.log(1+Math.max(0,n[0]-h)/v),m+=-v*Math.log(1+Math.max(0,y-n[1])/v)+v*Math.log(1+Math.max(0,n[1]-d)/v)}return[g,m]}}}function Ab(t){return t}function Db(t,e,r,n){var i=zd(e)/r[0],o=Ad(e)/r[1];return n?Math.min(t,Math.max(i,o)):Math.min(t,Math.min(i,o))}function Nb(t,e,r){var n=Math.min(t,e);return n*=Math.log(1+50*Math.max(0,t/e-1))/50+1,r&&(n=Math.max(n,r),n/=Math.log(1+50*Math.max(0,r/t-1))/50+1),lh(n,r/2,2*e)}function Fb(t,e,r,n,i){return function(o,a,s,u){if(void 0!==o){var l=n?Db(t,n,s,i):t;return(void 0===r||r)&&u?Nb(o,l,e):lh(o,e,l)}}}function zb(t){return void 0!==t?0:void 0}function Gb(t){return void 0!==t?t:void 0}function Bb(t){return Math.pow(t,3)}function Vb(t){return 1-Bb(1-t)}function Ub(t){return 3*t*t-2*t*t*t}function qb(t){return t}var Wb=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Xb=function(t){function e(e){var r=t.call(this)||this;r.on,r.once,r.un;var n=Jh({},e);return r.hints_=[0,0],r.animations_=[],r.updateAnimationKey_,r.projection_=Zg(n.projection,"EPSG:3857"),r.viewportSize_=[100,100],r.targetCenter_=null,r.targetResolution_,r.targetRotation_,r.nextCenter_=null,r.nextResolution_,r.nextRotation_,r.cancelAnchor_=void 0,n.projection&&Gg(),n.center&&(n.center=am(n.center,r.projection_)),n.extent&&(n.extent=um(n.extent,r.projection_)),r.applyOptions_(n),r}return Wb(e,t),e.prototype.applyOptions_=function(t){var e=Jh({},t);for(var r in Rb)delete e[r];this.setProperties(e,!0);var n=function(t){var e,r,n,i=void 0!==t.minZoom?t.minZoom:0,o=void 0!==t.maxZoom?t.maxZoom:28,a=void 0!==t.zoomFactor?t.zoomFactor:2,s=void 0!==t.multiWorld&&t.multiWorld,u=void 0===t.smoothResolutionConstraint||t.smoothResolutionConstraint,l=void 0!==t.showFullExtent&&t.showFullExtent,c=Zg(t.projection,"EPSG:3857"),f=c.getExtent(),p=t.constrainOnlyCenter,h=t.extent;if(s||h||!c.isGlobal()||(p=!1,h=f),void 0!==t.resolutions){var y=t.resolutions;r=y[i],n=void 0!==y[o]?y[o]:y[y.length-1],e=t.constrainResolution?function(t,e,r,n){return function(i,o,a,s){if(void 0!==i){var u=t[0],l=t[t.length-1],c=r?Db(u,r,a,n):u;if(s)return void 0===e||e?Nb(i,c,l):lh(i,l,c);var f=Math.min(c,i),p=Math.floor(qh(t,f,o));return t[p]>c&&p<t.length-1?t[p+1]:t[p]}}}(y,u,!p&&h,l):Fb(r,n,u,!p&&h,l)}else{var d=(f?Math.max(zd(f),Ad(f)):360*yg[dg.DEGREES]/c.getMetersPerUnit())/Ib/Math.pow(2,0),g=d/Math.pow(2,28);void 0!==(r=t.maxResolution)?i=0:r=d/Math.pow(a,i),void 0===(n=t.minResolution)&&(n=void 0!==t.maxZoom?void 0!==t.maxResolution?r/Math.pow(a,o):d/Math.pow(a,o):g),o=i+Math.floor(Math.log(r/n)/Math.log(a)),n=r/Math.pow(a,o-i),e=t.constrainResolution?function(t,e,r,n,i,o){return function(a,s,u,l){if(void 0!==a){var c=i?Db(e,i,u,o):e,f=void 0!==r?r:0;if(l)return void 0===n||n?Nb(a,c,f):lh(a,f,c);var p=Math.ceil(Math.log(e/c)/Math.log(t)-1e-9),h=-s*(.5-1e-9)+.5,y=Math.min(c,a),d=Math.floor(Math.log(e/y)/Math.log(t)+h),g=Math.max(p,d);return lh(e/Math.pow(t,g),f,c)}}}(a,r,n,u,!p&&h,l):Fb(r,n,u,!p&&h,l)}return{constraint:e,maxResolution:r,minResolution:n,minZoom:i,zoomFactor:a}}(t);this.maxResolution_=n.maxResolution,this.minResolution_=n.minResolution,this.zoomFactor_=n.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=n.minZoom;var i=function(t){if(void 0!==t.extent){var e=void 0===t.smoothExtentConstraint||t.smoothExtentConstraint;return Mb(t.extent,t.constrainOnlyCenter,e)}var r=Zg(t.projection,"EPSG:3857");if(!0!==t.multiWorld&&r.isGlobal()){var n=r.getExtent().slice();return n[0]=-1/0,n[2]=1/0,Mb(n,!1,!1)}return Ab}(t),o=n.constraint,a=function(t){var e,r,n;if(void 0===t.enableRotation||t.enableRotation){var i=t.constrainRotation;return void 0===i||!0===i?(n=yh(5),function(t,e){return e?t:void 0!==t?Math.abs(t)<=n?0:t:void 0}):!1===i?Gb:"number"==typeof i?(e=i,r=2*Math.PI/e,function(t,e){return e?t:void 0!==t?t=Math.floor(t/r+.5)*r:void 0}):Gb}return zb}(t);this.constraints_={center:i,resolution:o,rotation:a},this.setRotation(void 0!==t.rotation?t.rotation:0),this.setCenterInternal(void 0!==t.center?t.center:null),void 0!==t.resolution?this.setResolution(t.resolution):void 0!==t.zoom&&this.setZoom(t.zoom)},Object.defineProperty(e.prototype,"padding",{get:function(){return this.padding_},set:function(t){var e=this.padding_;this.padding_=t;var r=this.getCenter();if(r){var n=t||[0,0,0,0];e=e||[0,0,0,0];var i=this.getResolution(),o=i/2*(n[3]-e[3]+e[1]-n[1]),a=i/2*(n[0]-e[0]+e[2]-n[2]);this.setCenterInternal([r[0]+o,r[1]-a])}},enumerable:!1,configurable:!0}),e.prototype.getUpdatedOptions_=function(t){var e=this.getProperties();return void 0!==e.resolution?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Jh({},e,t)},e.prototype.animate=function(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);for(var e=new Array(arguments.length),r=0;r<e.length;++r){var n=arguments[r];n.center&&((n=Jh({},n)).center=am(n.center,this.getProjection())),n.anchor&&((n=Jh({},n)).anchor=am(n.anchor,this.getProjection())),e[r]=n}this.animateInternal.apply(this,e)},e.prototype.animateInternal=function(t){var e,r=arguments.length;r>1&&"function"==typeof arguments[r-1]&&(e=arguments[r-1],--r);for(var n=0;n<r&&!this.isDef();++n){var i=arguments[n];i.center&&this.setCenterInternal(i.center),void 0!==i.zoom?this.setZoom(i.zoom):i.resolution&&this.setResolution(i.resolution),void 0!==i.rotation&&this.setRotation(i.rotation)}if(n!==r){for(var o=Date.now(),a=this.targetCenter_.slice(),s=this.targetResolution_,u=this.targetRotation_,l=[];n<r;++n){var c=arguments[n],f={start:o,complete:!1,anchor:c.anchor,duration:void 0!==c.duration?c.duration:1e3,easing:c.easing||Ub,callback:e};if(c.center&&(f.sourceCenter=a,f.targetCenter=c.center.slice(),a=f.targetCenter),void 0!==c.zoom?(f.sourceResolution=s,f.targetResolution=this.getResolutionForZoom(c.zoom),s=f.targetResolution):c.resolution&&(f.sourceResolution=s,f.targetResolution=c.resolution,s=f.targetResolution),void 0!==c.rotation){f.sourceRotation=u;var p=dh(c.rotation-u+Math.PI,2*Math.PI)-Math.PI;f.targetRotation=u+p,u=f.targetRotation}Hb(f)?f.complete=!0:o+=f.duration,l.push(f)}this.animations_.push(l),this.setHint(0,1),this.updateAnimations_()}else e&&Zb(e,!0)},e.prototype.getAnimating=function(){return this.hints_[0]>0},e.prototype.getInteracting=function(){return this.hints_[1]>0},e.prototype.cancelAnimations=function(){var t;this.setHint(0,-this.hints_[0]);for(var e=0,r=this.animations_.length;e<r;++e){var n=this.animations_[e];if(n[0].callback&&Zb(n[0].callback,!1),!t)for(var i=0,o=n.length;i<o;++i){var a=n[i];if(!a.complete){t=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN},e.prototype.updateAnimations_=function(){if(void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),this.getAnimating()){for(var t=Date.now(),e=!1,r=this.animations_.length-1;r>=0;--r){for(var n=this.animations_[r],i=!0,o=0,a=n.length;o<a;++o){var s=n[o];if(!s.complete){var u=t-s.start,l=s.duration>0?u/s.duration:1;l>=1?(s.complete=!0,l=1):i=!1;var c=s.easing(l);if(s.sourceCenter){var f=s.sourceCenter[0],p=s.sourceCenter[1],h=s.targetCenter[0],y=s.targetCenter[1];this.nextCenter_=s.targetCenter;var d=f+c*(h-f),g=p+c*(y-p);this.targetCenter_=[d,g]}if(s.sourceResolution&&s.targetResolution){var m=1===c?s.targetResolution:s.sourceResolution+c*(s.targetResolution-s.sourceResolution);if(s.anchor){var v=this.getViewportSize_(this.getRotation()),_=this.constraints_.resolution(m,0,v,!0);this.targetCenter_=this.calculateCenterZoom(_,s.anchor)}this.nextResolution_=s.targetResolution,this.targetResolution_=m,this.applyTargetState_(!0)}if(void 0!==s.sourceRotation&&void 0!==s.targetRotation){var b=1===c?dh(s.targetRotation+Math.PI,2*Math.PI)-Math.PI:s.sourceRotation+c*(s.targetRotation-s.sourceRotation);if(s.anchor){var w=this.constraints_.rotation(b,!0);this.targetCenter_=this.calculateCenterRotate(w,s.anchor)}this.nextRotation_=s.targetRotation,this.targetRotation_=b}if(this.applyTargetState_(!0),e=!0,!s.complete)break}}if(i){this.animations_[r]=null,this.setHint(0,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;var S=n[0].callback;S&&Zb(S,!0)}}this.animations_=this.animations_.filter(Boolean),e&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}},e.prototype.calculateCenterRotate=function(t,e){var r,n,i,o=this.getCenterInternal();return void 0!==o&&(Ag(r=[o[0]-e[0],o[1]-e[1]],t-this.getRotation()),i=e,(n=r)[0]+=+i[0],n[1]+=+i[1]),r},e.prototype.calculateCenterZoom=function(t,e){var r,n=this.getCenterInternal(),i=this.getResolution();return void 0!==n&&void 0!==i&&(r=[e[0]-t*(e[0]-n[0])/i,e[1]-t*(e[1]-n[1])/i]),r},e.prototype.getViewportSize_=function(t){var e=this.viewportSize_;if(t){var r=e[0],n=e[1];return[Math.abs(r*Math.cos(t))+Math.abs(n*Math.sin(t)),Math.abs(r*Math.sin(t))+Math.abs(n*Math.cos(t))]}return e},e.prototype.setViewportSize=function(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)},e.prototype.getCenter=function(){var t=this.getCenterInternal();return t?om(t,this.getProjection()):t},e.prototype.getCenterInternal=function(){return this.get(Rb.CENTER)},e.prototype.getConstraints=function(){return this.constraints_},e.prototype.getConstrainResolution=function(){return this.get("constrainResolution")},e.prototype.getHints=function(t){return void 0!==t?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()},e.prototype.calculateExtent=function(t){return sm(this.calculateExtentInternal(t),this.getProjection())},e.prototype.calculateExtentInternal=function(t){var e=t||this.getViewportSizeMinusPadding_(),r=this.getCenterInternal();uh(r,1);var n=this.getResolution();uh(void 0!==n,2);var i=this.getRotation();return uh(void 0!==i,3),Id(r,n,i,e)},e.prototype.getMaxResolution=function(){return this.maxResolution_},e.prototype.getMinResolution=function(){return this.minResolution_},e.prototype.getMaxZoom=function(){return this.getZoomForResolution(this.minResolution_)},e.prototype.setMaxZoom=function(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))},e.prototype.getMinZoom=function(){return this.getZoomForResolution(this.maxResolution_)},e.prototype.setMinZoom=function(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))},e.prototype.setConstrainResolution=function(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))},e.prototype.getProjection=function(){return this.projection_},e.prototype.getResolution=function(){return this.get(Rb.RESOLUTION)},e.prototype.getResolutions=function(){return this.resolutions_},e.prototype.getResolutionForExtent=function(t,e){return this.getResolutionForExtentInternal(um(t,this.getProjection()),e)},e.prototype.getResolutionForExtentInternal=function(t,e){var r=e||this.getViewportSizeMinusPadding_(),n=zd(t)/r[0],i=Ad(t)/r[1];return Math.max(n,i)},e.prototype.getResolutionForValueFunction=function(t){var e=t||2,r=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,i=Math.log(r/n)/Math.log(e);return function(t){return r/Math.pow(e,t*i)}},e.prototype.getRotation=function(){return this.get(Rb.ROTATION)},e.prototype.getValueForResolutionFunction=function(t){var e=Math.log(t||2),r=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,i=Math.log(r/n)/e;return function(t){return Math.log(r/t)/e/i}},e.prototype.getViewportSizeMinusPadding_=function(t){var e=this.getViewportSize_(t),r=this.padding_;return r&&(e=[e[0]-r[1]-r[3],e[1]-r[0]-r[2]]),e},e.prototype.getState=function(){var t=this.getProjection(),e=this.getResolution(),r=this.getRotation(),n=this.getCenterInternal(),i=this.padding_;if(i){var o=this.getViewportSizeMinusPadding_();n=Yb(n,this.getViewportSize_(),[o[0]/2+i[3],o[1]/2+i[0]],e,r)}return{center:n.slice(0),projection:void 0!==t?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:r,zoom:this.getZoom()}},e.prototype.getZoom=function(){var t,e=this.getResolution();return void 0!==e&&(t=this.getZoomForResolution(e)),t},e.prototype.getZoomForResolution=function(t){var e,r,n=this.minZoom_||0;if(this.resolutions_){var i=qh(this.resolutions_,t,1);n=i,e=this.resolutions_[i],r=i==this.resolutions_.length-1?2:e/this.resolutions_[i+1]}else e=this.maxResolution_,r=this.zoomFactor_;return n+Math.log(e/t)/Math.log(r)},e.prototype.getResolutionForZoom=function(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;var e=lh(Math.floor(t),0,this.resolutions_.length-2),r=this.resolutions_[e]/this.resolutions_[e+1];return this.resolutions_[e]/Math.pow(r,lh(t-e,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)},e.prototype.fit=function(t,e){var r;if(uh(Array.isArray(t)||"function"==typeof t.getSimplifiedGeometry,24),Array.isArray(t))uh(!Bd(t),25),r=Xv(n=um(t,this.getProjection()));else if("Circle"===t.getType()){var n;(r=Xv(n=um(t.getExtent(),this.getProjection()))).rotate(this.getRotation(),Rd(n))}else{var i=im();r=i?t.clone().transform(i,this.getProjection()):t}this.fitInternal(r,e)},e.prototype.rotatedExtentForGeometry=function(t){for(var e=this.getRotation(),r=Math.cos(e),n=Math.sin(-e),i=t.getFlatCoordinates(),o=t.getStride(),a=1/0,s=1/0,u=-1/0,l=-1/0,c=0,f=i.length;c<f;c+=o){var p=i[c]*r-i[c+1]*n,h=i[c]*n+i[c+1]*r;a=Math.min(a,p),s=Math.min(s,h),u=Math.max(u,p),l=Math.max(l,h)}return[a,s,u,l]},e.prototype.fitInternal=function(t,e){var r=e||{},n=r.size;n||(n=this.getViewportSizeMinusPadding_());var i,o=void 0!==r.padding?r.padding:[0,0,0,0],a=void 0!==r.nearest&&r.nearest;i=void 0!==r.minResolution?r.minResolution:void 0!==r.maxZoom?this.getResolutionForZoom(r.maxZoom):0;var s=this.rotatedExtentForGeometry(t),u=this.getResolutionForExtentInternal(s,[n[0]-o[1]-o[3],n[1]-o[0]-o[2]]);u=isNaN(u)?i:Math.max(u,i),u=this.getConstrainedResolution(u,a?0:1);var l=this.getRotation(),c=Math.sin(l),f=Math.cos(l),p=Rd(s);p[0]+=(o[1]-o[3])/2*u,p[1]+=(o[0]-o[2])/2*u;var h=p[0]*f-p[1]*c,y=p[1]*f+p[0]*c,d=this.getConstrainedCenter([h,y],u),g=r.callback?r.callback:Kh;void 0!==r.duration?this.animateInternal({resolution:u,center:d,duration:r.duration,easing:r.easing},g):(this.targetResolution_=u,this.targetCenter_=d,this.applyTargetState_(!1,!0),Zb(g,!0))},e.prototype.centerOn=function(t,e,r){this.centerOnInternal(am(t,this.getProjection()),e,r)},e.prototype.centerOnInternal=function(t,e,r){this.setCenterInternal(Yb(t,e,r,this.getResolution(),this.getRotation()))},e.prototype.calculateCenterShift=function(t,e,r,n){var i,o=this.padding_;if(o&&t){var a=this.getViewportSizeMinusPadding_(-r),s=Yb(t,n,[a[0]/2+o[3],a[1]/2+o[0]],e,r);i=[t[0]-s[0],t[1]-s[1]]}return i},e.prototype.isDef=function(){return!!this.getCenterInternal()&&void 0!==this.getResolution()},e.prototype.adjustCenter=function(t){var e=om(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])},e.prototype.adjustCenterInternal=function(t){var e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])},e.prototype.adjustResolution=function(t,e){var r=e&&am(e,this.getProjection());this.adjustResolutionInternal(t,r)},e.prototype.adjustResolutionInternal=function(t,e){var r=this.getAnimating()||this.getInteracting(),n=this.getViewportSize_(this.getRotation()),i=this.constraints_.resolution(this.targetResolution_*t,0,n,r);e&&(this.targetCenter_=this.calculateCenterZoom(i,e)),this.targetResolution_*=t,this.applyTargetState_()},e.prototype.adjustZoom=function(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)},e.prototype.adjustRotation=function(t,e){e&&(e=am(e,this.getProjection())),this.adjustRotationInternal(t,e)},e.prototype.adjustRotationInternal=function(t,e){var r=this.getAnimating()||this.getInteracting(),n=this.constraints_.rotation(this.targetRotation_+t,r);e&&(this.targetCenter_=this.calculateCenterRotate(n,e)),this.targetRotation_+=t,this.applyTargetState_()},e.prototype.setCenter=function(t){this.setCenterInternal(t?am(t,this.getProjection()):t)},e.prototype.setCenterInternal=function(t){this.targetCenter_=t,this.applyTargetState_()},e.prototype.setHint=function(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]},e.prototype.setResolution=function(t){this.targetResolution_=t,this.applyTargetState_()},e.prototype.setRotation=function(t){this.targetRotation_=t,this.applyTargetState_()},e.prototype.setZoom=function(t){this.setResolution(this.getResolutionForZoom(t))},e.prototype.applyTargetState_=function(t,e){var r=this.getAnimating()||this.getInteracting()||e,n=this.constraints_.rotation(this.targetRotation_,r),i=this.getViewportSize_(n),o=this.constraints_.resolution(this.targetResolution_,0,i,r),a=this.constraints_.center(this.targetCenter_,o,i,r,this.calculateCenterShift(this.targetCenter_,o,n,i));this.get(Rb.ROTATION)!==n&&this.set(Rb.ROTATION,n),this.get(Rb.RESOLUTION)!==o&&(this.set(Rb.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),a&&this.get(Rb.CENTER)&&Mg(this.get(Rb.CENTER),a)||this.set(Rb.CENTER,a),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0},e.prototype.resolveConstraints=function(t,e,r){var n=void 0!==t?t:200,i=e||0,o=this.constraints_.rotation(this.targetRotation_),a=this.getViewportSize_(o),s=this.constraints_.resolution(this.targetResolution_,i,a),u=this.constraints_.center(this.targetCenter_,s,a,!1,this.calculateCenterShift(this.targetCenter_,s,o,a));if(0===n&&!this.cancelAnchor_)return this.targetResolution_=s,this.targetRotation_=o,this.targetCenter_=u,void this.applyTargetState_();var l=r||(0===n?this.cancelAnchor_:void 0);this.cancelAnchor_=void 0,this.getResolution()===s&&this.getRotation()===o&&this.getCenterInternal()&&Mg(this.getCenterInternal(),u)||(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:o,center:u,resolution:s,duration:n,easing:Vb,anchor:l}))},e.prototype.beginInteraction=function(){this.resolveConstraints(0),this.setHint(1,1)},e.prototype.endInteraction=function(t,e,r){var n=r&&am(r,this.getProjection());this.endInteractionInternal(t,e,n)},e.prototype.endInteractionInternal=function(t,e,r){this.setHint(1,-1),this.resolveConstraints(t,e,r)},e.prototype.getConstrainedCenter=function(t,e){var r=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),r)},e.prototype.getConstrainedZoom=function(t,e){var r=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(r,e))},e.prototype.getConstrainedResolution=function(t,e){var r=e||0,n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,r,n)},e}(vy);function Zb(t,e){setTimeout((function(){t(e)}),0)}function Hb(t){return!(t.sourceCenter&&t.targetCenter&&!Mg(t.sourceCenter,t.targetCenter))&&t.sourceResolution===t.targetResolution&&t.sourceRotation===t.targetRotation}function Yb(t,e,r,n,i){var o=Math.cos(-i),a=Math.sin(-i),s=t[0]*o-t[1]*a,u=t[1]*o+t[0]*a;return[(s+=(e[0]/2-r[0])*n)*o-(u+=(r[1]-e[1]/2)*n)*(a=-a),u*o+s*a]}const Kb=Xb;var Jb=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function $b(t){t instanceof v_?t.setMapInternal(null):t instanceof cb&&t.getLayers().forEach($b)}function Qb(t,e){if(t instanceof v_)t.setMapInternal(e);else if(t instanceof cb)for(var r=t.getLayers().getArray(),n=0,i=r.length;n<i;++n)Qb(r[n],e)}var tw=function(t){function e(e){var r=t.call(this)||this;r.on,r.once,r.un;var n=function(t){var e=null;void 0!==t.keyboardEventTarget&&(e="string"==typeof t.keyboardEventTarget?document.getElementById(t.keyboardEventTarget):t.keyboardEventTarget);var r,n,i,o={},a=t.layers&&"function"==typeof t.layers.getLayers?t.layers:new cb({layers:t.layers});return o[Sb]=a,o[xb]=t.target,o[Cb]=t.view instanceof Kb?t.view:new Kb,void 0!==t.controls&&(Array.isArray(t.controls)?r=new ob(t.controls.slice()):(uh("function"==typeof t.controls.getArray,47),r=t.controls)),void 0!==t.interactions&&(Array.isArray(t.interactions)?n=new ob(t.interactions.slice()):(uh("function"==typeof t.interactions.getArray,48),n=t.interactions)),void 0!==t.overlays?Array.isArray(t.overlays)?i=new ob(t.overlays.slice()):(uh("function"==typeof t.overlays.getArray,49),i=t.overlays):i=new ob,{controls:r,interactions:n,keyboardEventTarget:e,overlays:i,values:o}}(e);r.renderComplete_,r.loaded_=!0,r.boundHandleBrowserEvent_=r.handleBrowserEvent.bind(r),r.maxTilesLoading_=void 0!==e.maxTilesLoading?e.maxTilesLoading:16,r.pixelRatio_=void 0!==e.pixelRatio?e.pixelRatio:Lh,r.postRenderTimeoutHandle_,r.animationDelayKey_,r.animationDelay_=function(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}.bind(r),r.coordinateToPixelTransform_=[1,0,0,1,0,0],r.pixelToCoordinateTransform_=[1,0,0,1,0,0],r.frameIndex_=0,r.frameState_=null,r.previousExtent_=null,r.viewPropertyListenerKey_=null,r.viewChangeListenerKey_=null,r.layerGroupPropertyListenerKeys_=null,r.viewport_=document.createElement("div"),r.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),r.viewport_.style.position="relative",r.viewport_.style.overflow="hidden",r.viewport_.style.width="100%",r.viewport_.style.height="100%",r.overlayContainer_=document.createElement("div"),r.overlayContainer_.style.position="absolute",r.overlayContainer_.style.zIndex="0",r.overlayContainer_.style.width="100%",r.overlayContainer_.style.height="100%",r.overlayContainer_.style.pointerEvents="none",r.overlayContainer_.className="ol-overlaycontainer",r.viewport_.appendChild(r.overlayContainer_),r.overlayContainerStopEvent_=document.createElement("div"),r.overlayContainerStopEvent_.style.position="absolute",r.overlayContainerStopEvent_.style.zIndex="0",r.overlayContainerStopEvent_.style.width="100%",r.overlayContainerStopEvent_.style.height="100%",r.overlayContainerStopEvent_.style.pointerEvents="none",r.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",r.viewport_.appendChild(r.overlayContainerStopEvent_),r.mapBrowserEventHandler_=null,r.moveTolerance_=e.moveTolerance,r.keyboardEventTarget_=n.keyboardEventTarget,r.targetChangeHandlerKeys_=null,r.controls=n.controls||new ob,r.interactions=n.interactions||new ob,r.overlays_=n.overlays,r.overlayIdIndex_={},r.renderer_=null,r.postRenderFunctions_=[],r.tileQueue_=new jb(r.getTilePriority.bind(r),r.handleTileChange_.bind(r)),r.addChangeListener(Sb,r.handleLayerGroupChanged_),r.addChangeListener(Cb,r.handleViewChanged_),r.addChangeListener(Ob,r.handleSizeChanged_),r.addChangeListener(xb,r.handleTargetChanged_),r.setProperties(n.values);var i=r;return!e.view||e.view instanceof Kb||e.view.then((function(t){i.setView(new Kb(t))})),r.controls.addEventListener(Q_,function(t){t.element.setMap(this)}.bind(r)),r.controls.addEventListener(tb,function(t){t.element.setMap(null)}.bind(r)),r.interactions.addEventListener(Q_,function(t){t.element.setMap(this)}.bind(r)),r.interactions.addEventListener(tb,function(t){t.element.setMap(null)}.bind(r)),r.overlays_.addEventListener(Q_,function(t){this.addOverlayInternal_(t.element)}.bind(r)),r.overlays_.addEventListener(tb,function(t){var e=t.element.getId();void 0!==e&&delete this.overlayIdIndex_[e.toString()],t.element.setMap(null)}.bind(r)),r.controls.forEach(function(t){t.setMap(this)}.bind(r)),r.interactions.forEach(function(t){t.setMap(this)}.bind(r)),r.overlays_.forEach(r.addOverlayInternal_.bind(r)),r}return Jb(e,t),e.prototype.createRenderer=function(){throw new Error("Use a map type that has a createRenderer method")},e.prototype.addControl=function(t){this.getControls().push(t)},e.prototype.addInteraction=function(t){this.getInteractions().push(t)},e.prototype.addLayer=function(t){this.getLayerGroup().getLayers().push(t)},e.prototype.handleLayerAdd_=function(t){Qb(t.layer,this)},e.prototype.addOverlay=function(t){this.getOverlays().push(t)},e.prototype.addOverlayInternal_=function(t){var e=t.getId();void 0!==e&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)},e.prototype.disposeInternal=function(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.setTarget(null),t.prototype.disposeInternal.call(this)},e.prototype.forEachFeatureAtPixel=function(t,e,r){if(this.frameState_&&this.renderer_){var n=this.getCoordinateFromPixelInternal(t),i=void 0!==(r=void 0!==r?r:{}).hitTolerance?r.hitTolerance:0,o=void 0!==r.layerFilter?r.layerFilter:Hh,a=!1!==r.checkWrapped;return this.renderer_.forEachFeatureAtCoordinate(n,this.frameState_,i,a,e,null,o,null)}},e.prototype.getFeaturesAtPixel=function(t,e){var r=[];return this.forEachFeatureAtPixel(t,(function(t){r.push(t)}),e),r},e.prototype.getAllLayers=function(){var t=[];return function e(r){r.forEach((function(r){r instanceof cb?e(r.getLayers()):t.push(r)}))}(this.getLayers()),t},e.prototype.forEachLayerAtPixel=function(t,e,r){if(this.frameState_&&this.renderer_){var n=r||{},i=void 0!==n.hitTolerance?n.hitTolerance:0,o=n.layerFilter||Hh;return this.renderer_.forEachLayerAtPixel(t,this.frameState_,i,e,o)}},e.prototype.hasFeatureAtPixel=function(t,e){if(!this.frameState_||!this.renderer_)return!1;var r=this.getCoordinateFromPixelInternal(t),n=void 0!==(e=void 0!==e?e:{}).layerFilter?e.layerFilter:Hh,i=void 0!==e.hitTolerance?e.hitTolerance:0,o=!1!==e.checkWrapped;return this.renderer_.hasFeatureAtCoordinate(r,this.frameState_,i,o,n,null)},e.prototype.getEventCoordinate=function(t){return this.getCoordinateFromPixel(this.getEventPixel(t))},e.prototype.getEventCoordinateInternal=function(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))},e.prototype.getEventPixel=function(t){var e=this.viewport_.getBoundingClientRect(),r="changedTouches"in t?t.changedTouches[0]:t;return[r.clientX-e.left,r.clientY-e.top]},e.prototype.getTarget=function(){return this.get(xb)},e.prototype.getTargetElement=function(){var t=this.getTarget();return void 0!==t?"string"==typeof t?document.getElementById(t):t:null},e.prototype.getCoordinateFromPixel=function(t){return om(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())},e.prototype.getCoordinateFromPixelInternal=function(t){var e=this.frameState_;return e?ng(e.pixelToCoordinateTransform,t.slice()):null},e.prototype.getControls=function(){return this.controls},e.prototype.getOverlays=function(){return this.overlays_},e.prototype.getOverlayById=function(t){var e=this.overlayIdIndex_[t.toString()];return void 0!==e?e:null},e.prototype.getInteractions=function(){return this.interactions},e.prototype.getLayerGroup=function(){return this.get(Sb)},e.prototype.setLayers=function(t){var e=this.getLayerGroup();if(t instanceof ob)e.setLayers(t);else{var r=e.getLayers();r.clear(),r.extend(t)}},e.prototype.getLayers=function(){return this.getLayerGroup().getLayers()},e.prototype.getLoadingOrNotReady=function(){for(var t=this.getLayerGroup().getLayerStatesArray(),e=0,r=t.length;e<r;++e){var n=t[e];if(n.visible){var i=n.layer.getRenderer();if(i&&!i.ready)return!0;var o=n.layer.getSource();if(o&&o.loading)return!0}}return!1},e.prototype.getPixelFromCoordinate=function(t){var e=am(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(e)},e.prototype.getPixelFromCoordinateInternal=function(t){var e=this.frameState_;return e?ng(e.coordinateToPixelTransform,t.slice(0,2)):null},e.prototype.getRenderer=function(){return this.renderer_},e.prototype.getSize=function(){return this.get(Ob)},e.prototype.getView=function(){return this.get(Cb)},e.prototype.getViewport=function(){return this.viewport_},e.prototype.getOverlayContainer=function(){return this.overlayContainer_},e.prototype.getOverlayContainerStopEvent=function(){return this.overlayContainerStopEvent_},e.prototype.getOwnerDocument=function(){var t=this.getTargetElement();return t?t.ownerDocument:document},e.prototype.getTilePriority=function(t,e,r,n){return function(t,e,r,n,i){if(!t||!(r in t.wantedTiles))return Eb;if(!t.wantedTiles[r][e.getKey()])return Eb;var o=t.viewState.center,a=n[0]-o[0],s=n[1]-o[1];return 65536*Math.log(i)+Math.sqrt(a*a+s*s)/i}(this.frameState_,t,e,r,n)},e.prototype.handleBrowserEvent=function(t,e){var r=e||t.type,n=new yb(r,this,t);this.handleMapBrowserEvent(n)},e.prototype.handleMapBrowserEvent=function(t){if(this.frameState_){var e=t.originalEvent,r=e.type;if(r===gb||r===ly||r===ay){var n=this.getOwnerDocument(),i=this.viewport_.getRootNode?this.viewport_.getRootNode():n,o=e.target;if(this.overlayContainerStopEvent_.contains(o)||!(i===n?n.documentElement:i).contains(o))return}if(t.frameState=this.frameState_,!1!==this.dispatchEvent(t))for(var a=this.getInteractions().getArray().slice(),s=a.length-1;s>=0;s--){var u=a[s];if(u.getMap()===this&&u.getActive()&&this.getTargetElement()&&(!u.handleEvent(t)||t.propagationStopped))break}}},e.prototype.handlePostRender=function(){var t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){var r=this.maxTilesLoading_,n=r;if(t){var i=t.viewHints;if(i[0]||i[1]){var o=Date.now()-t.time>8;r=o?0:8,n=o?0:2}}e.getTilesLoading()<r&&(e.reprioritize(),e.loadMoreTiles(r,n))}t&&this.renderer_&&!t.animate&&(!0===this.renderComplete_?(this.hasListener(y_)&&this.renderer_.dispatchRenderEvent(y_,t),!1===this.loaded_&&(this.loaded_=!0,this.dispatchEvent(new pb(wb,this,t)))):!0===this.loaded_&&(this.loaded_=!1,this.dispatchEvent(new pb(bb,this,t))));for(var a=this.postRenderFunctions_,s=0,u=a.length;s<u;++s)a[s](this,t);a.length=0},e.prototype.handleSizeChanged_=function(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()},e.prototype.handleTargetChanged_=function(){if(this.mapBrowserEventHandler_){for(var t=0,e=this.targetChangeHandlerKeys_.length;t<e;++t)py(this.targetChangeHandlerKeys_[t]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(iy,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(ly,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,zh(this.viewport_)}var r=this.getTargetElement();if(r){for(var n in r.appendChild(this.viewport_),this.renderer_||(this.renderer_=this.createRenderer()),this.mapBrowserEventHandler_=new vb(this,this.moveTolerance_),db)this.mapBrowserEventHandler_.addEventListener(db[n],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(iy,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(ly,this.boundHandleBrowserEvent_,!!Ah&&{passive:!1});var i=this.getOwnerDocument().defaultView,o=this.keyboardEventTarget_?this.keyboardEventTarget_:r;this.targetChangeHandlerKeys_=[cy(o,ay,this.handleBrowserEvent,this),cy(o,sy,this.handleBrowserEvent,this),cy(i,"resize",this.updateSize,this)]}else this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);this.updateSize()},e.prototype.handleTileChange_=function(){this.render()},e.prototype.handleViewPropertyChanged_=function(){this.render()},e.prototype.handleViewChanged_=function(){this.viewPropertyListenerKey_&&(py(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(py(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);var t=this.getView();t&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=cy(t,Bh,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=cy(t,ny,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()},e.prototype.handleLayerGroupChanged_=function(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(py),this.layerGroupPropertyListenerKeys_=null);var t=this.getLayerGroup();t&&(this.handleLayerAdd_(new sb("addlayer",t)),this.layerGroupPropertyListenerKeys_=[cy(t,Bh,this.render,this),cy(t,ny,this.render,this),cy(t,"addlayer",this.handleLayerAdd_,this),cy(t,"removelayer",this.handleLayerRemove_,this)]),this.render()},e.prototype.isRendered=function(){return!!this.frameState_},e.prototype.renderSync=function(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()},e.prototype.redrawText=function(){for(var t=this.getLayerGroup().getLayerStatesArray(),e=0,r=t.length;e<r;++e){var n=t[e].layer;n.hasRenderer()&&n.getRenderer().handleFontsChanged()}},e.prototype.render=function(){this.renderer_&&void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))},e.prototype.removeControl=function(t){return this.getControls().remove(t)},e.prototype.removeInteraction=function(t){return this.getInteractions().remove(t)},e.prototype.removeLayer=function(t){return this.getLayerGroup().getLayers().remove(t)},e.prototype.handleLayerRemove_=function(t){$b(t.layer)},e.prototype.removeOverlay=function(t){return this.getOverlays().remove(t)},e.prototype.renderFrame_=function(t){var e=this,r=this.getSize(),n=this.getView(),i=this.frameState_,o=null;if(void 0!==r&&eh(r)&&n&&n.isDef()){var a=n.getHints(this.frameState_?this.frameState_.viewHints:void 0),s=n.getState();if(o={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:Id(s.center,s.resolution,s.rotation,r),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:r,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:s,viewHints:a,wantedTiles:{},mapId:th(this),renderTargets:{}},s.nextCenter&&s.nextResolution){var u=isNaN(s.nextRotation)?s.rotation:s.nextRotation;o.nextExtent=Id(s.nextCenter,s.nextResolution,u,r)}}this.frameState_=o,this.renderer_.renderFrame(o),o&&(o.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,o.postRenderFunctions),i&&(!this.previousExtent_||!Bd(this.previousExtent_)&&!Sd(o.extent,this.previousExtent_))&&(this.dispatchEvent(new pb("movestart",this,i)),this.previousExtent_=_d(this.previousExtent_)),this.previousExtent_&&!o.viewHints[0]&&!o.viewHints[1]&&!Sd(o.extent,this.previousExtent_)&&(this.dispatchEvent(new pb("moveend",this,o)),pd(o.extent,this.previousExtent_))),this.dispatchEvent(new pb(_b,this,o)),this.renderComplete_=this.hasListener(bb)||this.hasListener(wb)||this.hasListener(y_)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout((function(){e.postRenderTimeoutHandle_=void 0,e.handlePostRender()}),0))},e.prototype.setLayerGroup=function(t){var e=this.getLayerGroup();e&&this.handleLayerRemove_(new sb("removelayer",e)),this.set(Sb,t)},e.prototype.setSize=function(t){this.set(Ob,t)},e.prototype.setTarget=function(t){this.set(xb,t)},e.prototype.setView=function(t){if(!t||t instanceof Kb)this.set(Cb,t);else{this.set(Cb,new Kb);var e=this;t.then((function(t){e.setView(new Kb(t))}))}},e.prototype.updateSize=function(){var t=this.getTargetElement(),e=void 0;if(t){var r=getComputedStyle(t),n=t.offsetWidth-parseFloat(r.borderLeftWidth)-parseFloat(r.paddingLeft)-parseFloat(r.paddingRight)-parseFloat(r.borderRightWidth),i=t.offsetHeight-parseFloat(r.borderTopWidth)-parseFloat(r.paddingTop)-parseFloat(r.paddingBottom)-parseFloat(r.borderBottomWidth);isNaN(n)||isNaN(i)||!eh(e=[n,i])&&(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&console.warn("No map visible because the map container's width or height are 0.")}this.setSize(e),this.updateViewportSize_()},e.prototype.updateViewportSize_=function(){var t=this.getView();if(t){var e=void 0,r=getComputedStyle(this.viewport_);r.width&&r.height&&(e=[parseInt(r.width,10),parseInt(r.height,10)]),t.setViewportSize(e)}},e}(vy);const ew=tw;var rw=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),nw=function(t){function e(e){var r=t.call(this)||this,n=e.element;return!n||e.target||n.style.pointerEvents||(n.style.pointerEvents="auto"),r.element=n||null,r.target_=null,r.map_=null,r.listenerKeys=[],e.render&&(r.render=e.render),e.target&&r.setTarget(e.target),r}return rw(e,t),e.prototype.disposeInternal=function(){zh(this.element),t.prototype.disposeInternal.call(this)},e.prototype.getMap=function(){return this.map_},e.prototype.setMap=function(t){this.map_&&zh(this.element);for(var e=0,r=this.listenerKeys.length;e<r;++e)py(this.listenerKeys[e]);this.listenerKeys.length=0,this.map_=t,t&&((this.target_?this.target_:t.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==Kh&&this.listenerKeys.push(cy(t,_b,this.render,this)),t.render())},e.prototype.render=function(t){},e.prototype.setTarget=function(t){this.target_="string"==typeof t?document.getElementById(t):t},e}(vy);const iw=nw;var ow=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),aw=function(t){function e(e){var r=this,n=e||{};(r=t.call(this,{element:document.createElement("div"),render:n.render,target:n.target})||this).ulElement_=document.createElement("ul"),r.collapsed_=void 0===n.collapsed||n.collapsed,r.userCollapsed_=r.collapsed_,r.overrideCollapsible_=void 0!==n.collapsible,r.collapsible_=void 0===n.collapsible||n.collapsible,r.collapsible_||(r.collapsed_=!1);var i=void 0!==n.className?n.className:"ol-attribution",o=void 0!==n.tipLabel?n.tipLabel:"Attributions",a=void 0!==n.expandClassName?n.expandClassName:i+"-expand",s=void 0!==n.collapseLabel?n.collapseLabel:"›",u=void 0!==n.collapseClassName?n.collapseClassName:i+"-collapse";"string"==typeof s?(r.collapseLabel_=document.createElement("span"),r.collapseLabel_.textContent=s,r.collapseLabel_.className=u):r.collapseLabel_=s;var l=void 0!==n.label?n.label:"i";"string"==typeof l?(r.label_=document.createElement("span"),r.label_.textContent=l,r.label_.className=a):r.label_=l;var c=r.collapsible_&&!r.collapsed_?r.collapseLabel_:r.label_;r.toggleButton_=document.createElement("button"),r.toggleButton_.setAttribute("type","button"),r.toggleButton_.setAttribute("aria-expanded",String(!r.collapsed_)),r.toggleButton_.title=o,r.toggleButton_.appendChild(c),r.toggleButton_.addEventListener(oy,r.handleClick_.bind(r),!1);var f=i+" "+by+" "+wy+(r.collapsed_&&r.collapsible_?" "+Sy:"")+(r.collapsible_?"":" ol-uncollapsible"),p=r.element;return p.className=f,p.appendChild(r.toggleButton_),p.appendChild(r.ulElement_),r.renderedAttributions_=[],r.renderedVisible_=!0,r}return ow(e,t),e.prototype.collectSourceAttributions_=function(t){for(var e={},r=[],n=!0,i=t.layerStatesArray,o=0,a=i.length;o<a;++o){var s=i[o];if(m_(s,t.viewState)){var u=s.layer.getSource();if(u){var l=u.getAttributions();if(l){var c=l(t);if(c)if(n=n&&!1!==u.getAttributionsCollapsible(),Array.isArray(c))for(var f=0,p=c.length;f<p;++f)c[f]in e||(r.push(c[f]),e[c[f]]=!0);else c in e||(r.push(c),e[c]=!0)}}}}return this.overrideCollapsible_||this.setCollapsible(n),r},e.prototype.updateElement_=function(t){if(t){var e=this.collectSourceAttributions_(t),r=e.length>0;if(this.renderedVisible_!=r&&(this.element.style.display=r?"":"none",this.renderedVisible_=r),!Zh(e,this.renderedAttributions_)){!function(t){for(;t.lastChild;)t.removeChild(t.lastChild)}(this.ulElement_);for(var n=0,i=e.length;n<i;++n){var o=document.createElement("li");o.innerHTML=e[n],this.ulElement_.appendChild(o)}this.renderedAttributions_=e}}else this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1)},e.prototype.handleClick_=function(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_},e.prototype.handleToggle_=function(){this.element.classList.toggle(Sy),this.collapsed_?Fh(this.collapseLabel_,this.label_):Fh(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))},e.prototype.getCollapsible=function(){return this.collapsible_},e.prototype.setCollapsible=function(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())},e.prototype.setCollapsed=function(t){this.userCollapsed_=t,this.collapsible_&&this.collapsed_!==t&&this.handleToggle_()},e.prototype.getCollapsed=function(){return this.collapsed_},e.prototype.render=function(t){this.updateElement_(t.frameState)},e}(iw);const sw=aw;var uw=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),lw=function(t){function e(e){var r=this,n=e||{};r=t.call(this,{element:document.createElement("div"),render:n.render,target:n.target})||this;var i=void 0!==n.className?n.className:"ol-rotate",o=void 0!==n.label?n.label:"⇧",a=void 0!==n.compassClassName?n.compassClassName:"ol-compass";r.label_=null,"string"==typeof o?(r.label_=document.createElement("span"),r.label_.className=a,r.label_.textContent=o):(r.label_=o,r.label_.classList.add(a));var s=n.tipLabel?n.tipLabel:"Reset rotation",u=document.createElement("button");u.className=i+"-reset",u.setAttribute("type","button"),u.title=s,u.appendChild(r.label_),u.addEventListener(oy,r.handleClick_.bind(r),!1);var l=i+" "+by+" "+wy,c=r.element;return c.className=l,c.appendChild(u),r.callResetNorth_=n.resetNorth?n.resetNorth:void 0,r.duration_=void 0!==n.duration?n.duration:250,r.autoHide_=void 0===n.autoHide||n.autoHide,r.rotation_=void 0,r.autoHide_&&r.element.classList.add(_y),r}return uw(e,t),e.prototype.handleClick_=function(t){t.preventDefault(),void 0!==this.callResetNorth_?this.callResetNorth_():this.resetNorth_()},e.prototype.resetNorth_=function(){var t=this.getMap().getView();if(t){var e=t.getRotation();void 0!==e&&(this.duration_>0&&e%(2*Math.PI)!=0?t.animate({rotation:0,duration:this.duration_,easing:Vb}):t.setRotation(0))}},e.prototype.render=function(t){var e=t.frameState;if(e){var r=e.viewState.rotation;if(r!=this.rotation_){var n="rotate("+r+"rad)";if(this.autoHide_){var i=this.element.classList.contains(_y);i||0!==r?i&&0!==r&&this.element.classList.remove(_y):this.element.classList.add(_y)}this.label_.style.transform=n}this.rotation_=r}},e}(iw);const cw=lw;var fw=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),pw=function(t){function e(e){var r=this,n=e||{};r=t.call(this,{element:document.createElement("div"),target:n.target})||this;var i=void 0!==n.className?n.className:"ol-zoom",o=void 0!==n.delta?n.delta:1,a=void 0!==n.zoomInClassName?n.zoomInClassName:i+"-in",s=void 0!==n.zoomOutClassName?n.zoomOutClassName:i+"-out",u=void 0!==n.zoomInLabel?n.zoomInLabel:"+",l=void 0!==n.zoomOutLabel?n.zoomOutLabel:"–",c=void 0!==n.zoomInTipLabel?n.zoomInTipLabel:"Zoom in",f=void 0!==n.zoomOutTipLabel?n.zoomOutTipLabel:"Zoom out",p=document.createElement("button");p.className=a,p.setAttribute("type","button"),p.title=c,p.appendChild("string"==typeof u?document.createTextNode(u):u),p.addEventListener(oy,r.handleClick_.bind(r,o),!1);var h=document.createElement("button");h.className=s,h.setAttribute("type","button"),h.title=f,h.appendChild("string"==typeof l?document.createTextNode(l):l),h.addEventListener(oy,r.handleClick_.bind(r,-o),!1);var y=i+" "+by+" "+wy,d=r.element;return d.className=y,d.appendChild(p),d.appendChild(h),r.duration_=void 0!==n.duration?n.duration:250,r}return fw(e,t),e.prototype.handleClick_=function(t,e){e.preventDefault(),this.zoomByDelta_(t)},e.prototype.zoomByDelta_=function(t){var e=this.getMap().getView();if(e){var r=e.getZoom();if(void 0!==r){var n=e.getConstrainedZoom(r+t);this.duration_>0?(e.getAnimating()&&e.cancelAnimations(),e.animate({zoom:n,duration:this.duration_,easing:Vb})):e.setZoom(n)}}},e}(iw);const hw=pw,yw="active";var dw=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function gw(t,e,r,n){var i=t.getZoom();if(void 0!==i){var o=t.getConstrainedZoom(i+e),a=t.getResolutionForZoom(o);t.getAnimating()&&t.cancelAnimations(),t.animate({resolution:a,anchor:r,duration:void 0!==n?n:250,easing:Vb})}}const mw=function(t){function e(e){var r=t.call(this)||this;return r.on,r.once,r.un,e&&e.handleEvent&&(r.handleEvent=e.handleEvent),r.map_=null,r.setActive(!0),r}return dw(e,t),e.prototype.getActive=function(){return this.get(yw)},e.prototype.getMap=function(){return this.map_},e.prototype.handleEvent=function(t){return!0},e.prototype.setActive=function(t){this.set(yw,t)},e.prototype.setMap=function(t){this.map_=t},e}(vy);var vw=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),_w=function(t){function e(e){var r=t.call(this)||this,n=e||{};return r.delta_=n.delta?n.delta:1,r.duration_=void 0!==n.duration?n.duration:250,r}return vw(e,t),e.prototype.handleEvent=function(t){var e=!1;if(t.type==db.DBLCLICK){var r=t.originalEvent,n=t.map,i=t.coordinate,o=r.shiftKey?-this.delta_:this.delta_;gw(n.getView(),o,i,this.duration_),r.preventDefault(),e=!0}return!e},e}(mw);const bw=_w;var ww=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Sw=function(t){function e(e){var r=this,n=e||{};return r=t.call(this,n)||this,n.handleDownEvent&&(r.handleDownEvent=n.handleDownEvent),n.handleDragEvent&&(r.handleDragEvent=n.handleDragEvent),n.handleMoveEvent&&(r.handleMoveEvent=n.handleMoveEvent),n.handleUpEvent&&(r.handleUpEvent=n.handleUpEvent),n.stopDown&&(r.stopDown=n.stopDown),r.handlingDownUpSequence=!1,r.targetPointers=[],r}return ww(e,t),e.prototype.getPointerCount=function(){return this.targetPointers.length},e.prototype.handleDownEvent=function(t){return!1},e.prototype.handleDragEvent=function(t){},e.prototype.handleEvent=function(t){if(!t.originalEvent)return!0;var e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==db.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==db.POINTERUP){var r=this.handleUpEvent(t);this.handlingDownUpSequence=r&&this.targetPointers.length>0}}else if(t.type==db.POINTERDOWN){var n=this.handleDownEvent(t);this.handlingDownUpSequence=n,e=this.stopDown(n)}else t.type==db.POINTERMOVE&&this.handleMoveEvent(t);return!e},e.prototype.handleMoveEvent=function(t){},e.prototype.handleUpEvent=function(t){return!1},e.prototype.stopDown=function(t){return t},e.prototype.updateTrackedPointers_=function(t){t.activePointers&&(this.targetPointers=t.activePointers)},e}(mw);function Ow(t){for(var e=t.length,r=0,n=0,i=0;i<e;i++)r+=t[i].clientX,n+=t[i].clientY;return[r/e,n/e]}const xw=Sw;function Cw(t){var e=arguments;return function(t){for(var r=!0,n=0,i=e.length;n<i&&(r=r&&e[n](t));++n);return r}}var Ew=function(t){var e=t.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},Pw=function(t){return!t.map.getTargetElement().hasAttribute("tabindex")||function(t){var e=t.map.getTargetElement(),r=t.map.getOwnerDocument().activeElement;return e.contains(r)}(t)},kw=Hh,Tw=function(t){var e=t.originalEvent;return 0==e.button&&!(jh&&Rh&&e.ctrlKey)},jw=function(t){var e=t.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},Rw=function(t){var e=t.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},Lw=function(t){var e=t.originalEvent,r=e.target.tagName;return"INPUT"!==r&&"SELECT"!==r&&"TEXTAREA"!==r&&!e.target.isContentEditable},Iw=function(t){var e=t.originalEvent;return uh(void 0!==e,56),"mouse"==e.pointerType},Mw=function(t){var e=t.originalEvent;return uh(void 0!==e,56),e.isPrimary&&0===e.button},Aw=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Dw=function(t){function e(e){var r=t.call(this,{stopDown:Yh})||this,n=e||{};r.kinetic_=n.kinetic,r.lastCentroid=null,r.lastPointersCount_,r.panning_=!1;var i=n.condition?n.condition:Cw(jw,Mw);return r.condition_=n.onFocusOnly?Cw(Pw,i):i,r.noKinetic_=!1,r}return Aw(e,t),e.prototype.handleDragEvent=function(t){this.panning_||(this.panning_=!0,this.getMap().getView().beginInteraction());var e,r,n=this.targetPointers,i=Ow(n);if(n.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(i[0],i[1]),this.lastCentroid){var o=[this.lastCentroid[0]-i[0],i[1]-this.lastCentroid[1]],a=t.map.getView();e=o,r=a.getResolution(),e[0]*=r,e[1]*=r,Ag(o,a.getRotation()),a.adjustCenterInternal(o)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=i,this.lastPointersCount_=n.length,t.originalEvent.preventDefault()},e.prototype.handleUpEvent=function(t){var e=t.map,r=e.getView();if(0===this.targetPointers.length){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){var n=this.kinetic_.getDistance(),i=this.kinetic_.getAngle(),o=r.getCenterInternal(),a=e.getPixelFromCoordinateInternal(o),s=e.getCoordinateFromPixelInternal([a[0]-n*Math.cos(i),a[1]-n*Math.sin(i)]);r.animateInternal({center:r.getConstrainedCenter(s),duration:500,easing:Vb})}return this.panning_&&(this.panning_=!1,r.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0},e.prototype.handleDownEvent=function(t){if(this.targetPointers.length>0&&this.condition_(t)){var e=t.map.getView();return this.lastCentroid=null,e.getAnimating()&&e.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1},e}(xw);const Nw=Dw;var Fw=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),zw=function(t){function e(e){var r=this,n=e||{};return(r=t.call(this,{stopDown:Yh})||this).condition_=n.condition?n.condition:Ew,r.lastAngle_=void 0,r.duration_=void 0!==n.duration?n.duration:250,r}return Fw(e,t),e.prototype.handleDragEvent=function(t){if(Iw(t)){var e=t.map,r=e.getView();if(r.getConstraints().rotation!==zb){var n=e.getSize(),i=t.pixel,o=Math.atan2(n[1]/2-i[1],i[0]-n[0]/2);if(void 0!==this.lastAngle_){var a=o-this.lastAngle_;r.adjustRotationInternal(-a)}this.lastAngle_=o}}},e.prototype.handleUpEvent=function(t){return!Iw(t)||(t.map.getView().endInteraction(this.duration_),!1)},e.prototype.handleDownEvent=function(t){return!(!Iw(t)||!Tw(t)||!this.condition_(t)||(t.map.getView().beginInteraction(),this.lastAngle_=void 0,0))},e}(xw);const Gw=zw;var Bw=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Vw=function(t){function e(e){var r=t.call(this)||this;return r.geometry_=null,r.element_=document.createElement("div"),r.element_.style.position="absolute",r.element_.style.pointerEvents="auto",r.element_.className="ol-box "+e,r.map_=null,r.startPixel_=null,r.endPixel_=null,r}return Bw(e,t),e.prototype.disposeInternal=function(){this.setMap(null)},e.prototype.render_=function(){var t=this.startPixel_,e=this.endPixel_,r="px",n=this.element_.style;n.left=Math.min(t[0],e[0])+r,n.top=Math.min(t[1],e[1])+r,n.width=Math.abs(e[0]-t[0])+r,n.height=Math.abs(e[1]-t[1])+r},e.prototype.setMap=function(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);var e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)},e.prototype.setPixels=function(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()},e.prototype.createOrUpdateGeometry=function(){var t=this.startPixel_,e=this.endPixel_,r=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);r[4]=r[0].slice(),this.geometry_?this.geometry_.setCoordinates([r]):this.geometry_=new Wv([r])},e.prototype.getGeometry=function(){return this.geometry_},e}(Vh);const Uw=Vw;var qw=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ww=function(t){function e(e,r,n){var i=t.call(this,e)||this;return i.coordinate=r,i.mapBrowserEvent=n,i}return qw(e,t),e}(Gh),Xw=function(t){function e(e){var r=t.call(this)||this;r.on,r.once,r.un;var n=e||{};return r.box_=new Uw(n.className||"ol-dragbox"),r.minArea_=void 0!==n.minArea?n.minArea:64,n.onBoxEnd&&(r.onBoxEnd=n.onBoxEnd),r.startPixel_=null,r.condition_=n.condition?n.condition:Tw,r.boxEndCondition_=n.boxEndCondition?n.boxEndCondition:r.defaultBoxEndCondition,r}return qw(e,t),e.prototype.defaultBoxEndCondition=function(t,e,r){var n=r[0]-e[0],i=r[1]-e[1];return n*n+i*i>=this.minArea_},e.prototype.getGeometry=function(){return this.box_.getGeometry()},e.prototype.handleDragEvent=function(t){this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new Ww("boxdrag",t.coordinate,t))},e.prototype.handleUpEvent=function(t){this.box_.setMap(null);var e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new Ww(e?"boxend":"boxcancel",t.coordinate,t)),!1},e.prototype.handleDownEvent=function(t){return!!this.condition_(t)&&(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new Ww("boxstart",t.coordinate,t)),!0)},e.prototype.onBoxEnd=function(t){},e}(xw);const Zw=Xw;var Hw=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Yw=function(t){function e(e){var r=this,n=e||{},i=n.condition?n.condition:Rw;return(r=t.call(this,{condition:i,className:n.className||"ol-dragzoom",minArea:n.minArea})||this).duration_=void 0!==n.duration?n.duration:200,r.out_=void 0!==n.out&&n.out,r}return Hw(e,t),e.prototype.onBoxEnd=function(t){var e=this.getMap().getView(),r=this.getGeometry();if(this.out_){var n=e.rotatedExtentForGeometry(r),i=e.getResolutionForExtentInternal(n),o=e.getResolution()/i;(r=r.clone()).scale(o*o)}e.fitInternal(r,{duration:this.duration_,easing:Vb})},e}(Zw);const Kw=Yw;var Jw=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),$w=function(t){function e(e){var r=t.call(this)||this,n=e||{};return r.defaultCondition_=function(t){return jw(t)&&Lw(t)},r.condition_=void 0!==n.condition?n.condition:r.defaultCondition_,r.duration_=void 0!==n.duration?n.duration:100,r.pixelDelta_=void 0!==n.pixelDelta?n.pixelDelta:128,r}return Jw(e,t),e.prototype.handleEvent=function(t){var e=!1;if(t.type==ay){var r=t.originalEvent,n=r.keyCode;if(this.condition_(t)&&(40==n||37==n||39==n||38==n)){var i=t.map.getView(),o=i.getResolution()*this.pixelDelta_,a=0,s=0;40==n?s=-o:37==n?a=-o:39==n?a=o:s=o;var u=[a,s];Ag(u,i.getRotation()),function(t,e,r){var n=t.getCenterInternal();if(n){var i=[n[0]+e[0],n[1]+e[1]];t.animateInternal({duration:void 0!==r?r:250,easing:qb,center:t.getConstrainedCenter(i)})}}(i,u,this.duration_),r.preventDefault(),e=!0}}return!e},e}(mw);const Qw=$w;var tS=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),eS=function(t){function e(e){var r=t.call(this)||this,n=e||{};return r.condition_=n.condition?n.condition:Lw,r.delta_=n.delta?n.delta:1,r.duration_=void 0!==n.duration?n.duration:100,r}return tS(e,t),e.prototype.handleEvent=function(t){var e=!1;if(t.type==ay||t.type==sy){var r=t.originalEvent,n=r.charCode;if(this.condition_(t)&&(n=="+".charCodeAt(0)||n=="-".charCodeAt(0))){var i=t.map,o=n=="+".charCodeAt(0)?this.delta_:-this.delta_;gw(i.getView(),o,void 0,this.duration_),r.preventDefault(),e=!0}}return!e},e}(mw);const rS=eS,nS=function(){function t(t,e,r){this.decay_=t,this.minVelocity_=e,this.delay_=r,this.points_=[],this.angle_=0,this.initialVelocity_=0}return t.prototype.begin=function(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0},t.prototype.update=function(t,e){this.points_.push(t,e,Date.now())},t.prototype.end=function(){if(this.points_.length<6)return!1;var t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;for(var r=e-3;r>0&&this.points_[r+2]>t;)r-=3;var n=this.points_[e+2]-this.points_[r+2];if(n<1e3/60)return!1;var i=this.points_[e]-this.points_[r],o=this.points_[e+1]-this.points_[r+1];return this.angle_=Math.atan2(o,i),this.initialVelocity_=Math.sqrt(i*i+o*o)/n,this.initialVelocity_>this.minVelocity_},t.prototype.getDistance=function(){return(this.minVelocity_-this.initialVelocity_)/this.decay_},t.prototype.getAngle=function(){return this.angle_},t}();var iS=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),oS="trackpad",aS=function(t){function e(e){var r=this,n=e||{};(r=t.call(this,n)||this).totalDelta_=0,r.lastDelta_=0,r.maxDelta_=void 0!==n.maxDelta?n.maxDelta:1,r.duration_=void 0!==n.duration?n.duration:250,r.timeout_=void 0!==n.timeout?n.timeout:80,r.useAnchor_=void 0===n.useAnchor||n.useAnchor,r.constrainResolution_=void 0!==n.constrainResolution&&n.constrainResolution;var i=n.condition?n.condition:kw;return r.condition_=n.onFocusOnly?Cw(Pw,i):i,r.lastAnchor_=null,r.startTime_=void 0,r.timeoutId_,r.mode_=void 0,r.trackpadEventGap_=400,r.trackpadTimeoutId_,r.deltaPerZoom_=300,r}return iS(e,t),e.prototype.endInteraction_=function(){this.trackpadTimeoutId_=void 0;var t=this.getMap();t&&t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)},e.prototype.handleEvent=function(t){if(!this.condition_(t))return!0;if(t.type!==ly)return!0;var e,r=t.map,n=t.originalEvent;if(n.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.coordinate),t.type==ly&&(e=n.deltaY,Th&&n.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(e/=Lh),n.deltaMode===WheelEvent.DOM_DELTA_LINE&&(e*=40)),0===e)return!1;this.lastDelta_=e;var i=Date.now();void 0===this.startTime_&&(this.startTime_=i),(!this.mode_||i-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(e)<4?oS:"wheel");var o=r.getView();if(this.mode_===oS&&!o.getConstrainResolution()&&!this.constrainResolution_)return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(o.getAnimating()&&o.cancelAnimations(),o.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),o.adjustZoom(-e/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=i,!1;this.totalDelta_+=e;var a=Math.max(this.timeout_-(i-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,r),a),!1},e.prototype.handleWheelZoom_=function(t){var e=t.getView();e.getAnimating()&&e.cancelAnimations();var r=-lh(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(r=r?r>0?1:-1:0),gw(e,r,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0},e.prototype.setMouseAnchor=function(t){this.useAnchor_=t,t||(this.lastAnchor_=null)},e}(mw);const sS=aS;var uS=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),lS=function(t){function e(e){var r=this,n=e||{},i=n;return i.stopDown||(i.stopDown=Yh),(r=t.call(this,i)||this).anchor_=null,r.lastAngle_=void 0,r.rotating_=!1,r.rotationDelta_=0,r.threshold_=void 0!==n.threshold?n.threshold:.3,r.duration_=void 0!==n.duration?n.duration:250,r}return uS(e,t),e.prototype.handleDragEvent=function(t){var e=0,r=this.targetPointers[0],n=this.targetPointers[1],i=Math.atan2(n.clientY-r.clientY,n.clientX-r.clientX);if(void 0!==this.lastAngle_){var o=i-this.lastAngle_;this.rotationDelta_+=o,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=o}this.lastAngle_=i;var a=t.map,s=a.getView();if(s.getConstraints().rotation!==zb){var u=a.getViewport().getBoundingClientRect(),l=Ow(this.targetPointers);l[0]-=u.left,l[1]-=u.top,this.anchor_=a.getCoordinateFromPixelInternal(l),this.rotating_&&(a.render(),s.adjustRotationInternal(e,this.anchor_))}},e.prototype.handleUpEvent=function(t){return!(this.targetPointers.length<2&&(t.map.getView().endInteraction(this.duration_),1))},e.prototype.handleDownEvent=function(t){if(this.targetPointers.length>=2){var e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1},e}(xw);const cS=lS;var fS=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),pS=function(t){function e(e){var r=this,n=e||{},i=n;return i.stopDown||(i.stopDown=Yh),(r=t.call(this,i)||this).anchor_=null,r.duration_=void 0!==n.duration?n.duration:400,r.lastDistance_=void 0,r.lastScaleDelta_=1,r}return fS(e,t),e.prototype.handleDragEvent=function(t){var e=1,r=this.targetPointers[0],n=this.targetPointers[1],i=r.clientX-n.clientX,o=r.clientY-n.clientY,a=Math.sqrt(i*i+o*o);void 0!==this.lastDistance_&&(e=this.lastDistance_/a),this.lastDistance_=a;var s=t.map,u=s.getView();1!=e&&(this.lastScaleDelta_=e);var l=s.getViewport().getBoundingClientRect(),c=Ow(this.targetPointers);c[0]-=l.left,c[1]-=l.top,this.anchor_=s.getCoordinateFromPixelInternal(c),s.render(),u.adjustResolutionInternal(e,this.anchor_)},e.prototype.handleUpEvent=function(t){if(this.targetPointers.length<2){var e=t.map.getView(),r=this.lastScaleDelta_>1?1:-1;return e.endInteraction(this.duration_,r),!1}return!0},e.prototype.handleDownEvent=function(t){if(this.targetPointers.length>=2){var e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1},e}(xw);const hS=pS;var yS=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),dS=function(t){function e(e){return(e=Jh({},e)).controls||(e.controls=function(t){var e={},r=new ob;return(void 0===e.zoom||e.zoom)&&r.push(new hw(e.zoomOptions)),(void 0===e.rotate||e.rotate)&&r.push(new cw(e.rotateOptions)),(void 0===e.attribution||e.attribution)&&r.push(new sw(e.attributionOptions)),r}()),e.interactions||(e.interactions=function(t){var e={onFocusOnly:!0}||{},r=new ob,n=new nS(-.005,.05,100);return(void 0===e.altShiftDragRotate||e.altShiftDragRotate)&&r.push(new Gw),(void 0===e.doubleClickZoom||e.doubleClickZoom)&&r.push(new bw({delta:e.zoomDelta,duration:e.zoomDuration})),(void 0===e.dragPan||e.dragPan)&&r.push(new Nw({onFocusOnly:e.onFocusOnly,kinetic:n})),(void 0===e.pinchRotate||e.pinchRotate)&&r.push(new cS),(void 0===e.pinchZoom||e.pinchZoom)&&r.push(new hS({duration:e.zoomDuration})),(void 0===e.keyboard||e.keyboard)&&(r.push(new Qw),r.push(new rS({delta:e.zoomDelta,duration:e.zoomDuration}))),(void 0===e.mouseWheelZoom||e.mouseWheelZoom)&&r.push(new sS({onFocusOnly:e.onFocusOnly,duration:e.zoomDuration})),(void 0===e.shiftDragZoom||e.shiftDragZoom)&&r.push(new Kw({duration:e.zoomDuration})),r}()),t.call(this,e)||this}return yS(e,t),e.prototype.createRenderer=function(){return new $_(this)},e}(ew);const gS=dS;var mS=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const vS=function(t){function e(e,r,n,i,o){var a=this,s=void 0!==o?0:2;return(a=t.call(this,e,r,n,s)||this).loader_=void 0!==o?o:null,a.canvas_=i,a.error_=null,a}return mS(e,t),e.prototype.getError=function(){return this.error_},e.prototype.handleLoad_=function(t){t?(this.error_=t,this.state=3):this.state=2,this.changed()},e.prototype.load=function(){0==this.state&&(this.state=1,this.changed(),this.loader_(this.handleLoad_.bind(this)))},e.prototype.getImage=function(){return this.canvas_},e}(ud);const _S=function(){function t(t,e,r,n,i,o){this.sourceProj_=t,this.targetProj_=e;var a={},s=Jg(this.targetProj_,this.sourceProj_);this.transformInv_=function(t){var e=t[0]+"/"+t[1];return a[e]||(a[e]=s(t)),a[e]},this.maxSourceExtent_=n,this.errorThresholdSquared_=i*i,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!n&&!!this.sourceProj_.getExtent()&&zd(n)==zd(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?zd(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?zd(this.targetProj_.getExtent()):null;var u=Nd(r),l=Fd(r),c=jd(r),f=Td(r),p=this.transformInv_(u),h=this.transformInv_(l),y=this.transformInv_(c),d=this.transformInv_(f),g=10+(o?Math.max(0,Math.ceil(fh(kd(r)/(o*o*256*256)))):0);if(this.addQuad_(u,l,c,f,p,h,y,d,g),this.wrapsXInSource_){var m=1/0;this.triangles_.forEach((function(t,e,r){m=Math.min(m,t.source[0][0],t.source[1][0],t.source[2][0])})),this.triangles_.forEach(function(t){if(Math.max(t.source[0][0],t.source[1][0],t.source[2][0])-m>this.sourceWorldWidth_/2){var e=[[t.source[0][0],t.source[0][1]],[t.source[1][0],t.source[1][1]],[t.source[2][0],t.source[2][1]]];e[0][0]-m>this.sourceWorldWidth_/2&&(e[0][0]-=this.sourceWorldWidth_),e[1][0]-m>this.sourceWorldWidth_/2&&(e[1][0]-=this.sourceWorldWidth_),e[2][0]-m>this.sourceWorldWidth_/2&&(e[2][0]-=this.sourceWorldWidth_);var r=Math.min(e[0][0],e[1][0],e[2][0]);Math.max(e[0][0],e[1][0],e[2][0])-r<this.sourceWorldWidth_/2&&(t.source=e)}}.bind(this))}a={}}return t.prototype.addTriangle_=function(t,e,r,n,i,o){this.triangles_.push({source:[n,i,o],target:[t,e,r]})},t.prototype.addQuad_=function(t,e,r,n,i,o,a,s,u){var l=cd([i,o,a,s]),c=this.sourceWorldWidth_?zd(l)/this.sourceWorldWidth_:null,f=this.sourceWorldWidth_,p=this.sourceProj_.canWrapX()&&c>.5&&c<1,h=!1;if(u>0&&(this.targetProj_.isGlobal()&&this.targetWorldWidth_&&(h=zd(cd([t,e,r,n]))/this.targetWorldWidth_>.25||h),!p&&this.sourceProj_.isGlobal()&&c&&(h=c>.25||h)),!(!h&&this.maxSourceExtent_&&isFinite(l[0])&&isFinite(l[1])&&isFinite(l[2])&&isFinite(l[3]))||Gd(l,this.maxSourceExtent_)){var y=0;if(!(h||isFinite(i[0])&&isFinite(i[1])&&isFinite(o[0])&&isFinite(o[1])&&isFinite(a[0])&&isFinite(a[1])&&isFinite(s[0])&&isFinite(s[1])))if(u>0)h=!0;else if(1!=(y=(isFinite(i[0])&&isFinite(i[1])?0:8)+(isFinite(o[0])&&isFinite(o[1])?0:4)+(isFinite(a[0])&&isFinite(a[1])?0:2)+(isFinite(s[0])&&isFinite(s[1])?0:1))&&2!=y&&4!=y&&8!=y)return;if(u>0){if(!h){var d=[(t[0]+r[0])/2,(t[1]+r[1])/2],g=this.transformInv_(d),m=void 0;m=p?(dh(i[0],f)+dh(a[0],f))/2-dh(g[0],f):(i[0]+a[0])/2-g[0];var v=(i[1]+a[1])/2-g[1];h=m*m+v*v>this.errorThresholdSquared_}if(h){if(Math.abs(t[0]-r[0])<=Math.abs(t[1]-r[1])){var _=[(e[0]+r[0])/2,(e[1]+r[1])/2],b=this.transformInv_(_),w=[(n[0]+t[0])/2,(n[1]+t[1])/2],S=this.transformInv_(w);this.addQuad_(t,e,_,w,i,o,b,S,u-1),this.addQuad_(w,_,r,n,S,b,a,s,u-1)}else{var O=[(t[0]+e[0])/2,(t[1]+e[1])/2],x=this.transformInv_(O),C=[(r[0]+n[0])/2,(r[1]+n[1])/2],E=this.transformInv_(C);this.addQuad_(t,O,C,n,i,x,E,s,u-1),this.addQuad_(O,e,r,C,x,o,a,E,u-1)}return}}if(p){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}0==(11&y)&&this.addTriangle_(t,r,n,i,a,s),0==(14&y)&&this.addTriangle_(t,r,e,i,a,o),y&&(0==(13&y)&&this.addTriangle_(e,n,t,o,s,i),0==(7&y)&&this.addTriangle_(e,n,r,o,s,a))}},t.prototype.calculateSourceExtent=function(){var t=[1/0,1/0,-1/0,-1/0];return this.triangles_.forEach((function(e,r,n){var i=e.source;xd(t,i[0]),xd(t,i[1]),xd(t,i[2])})),t},t.prototype.getTriangles=function(){return this.triangles_},t}();var bS,wS=[];function SS(t,e,r,n,i){t.beginPath(),t.moveTo(0,0),t.lineTo(e,r),t.lineTo(n,i),t.closePath(),t.save(),t.clip(),t.fillRect(0,0,Math.max(e,n)+1,Math.max(r,i)),t.restore()}function OS(t,e){return Math.abs(t[4*e]-210)>2||Math.abs(t[4*e+3]-191.25)>2}function xS(t,e,r,n){var i=$g(r,e,t),o=Wg(e,n,r),a=e.getMetersPerUnit();void 0!==a&&(o*=a);var s=t.getMetersPerUnit();void 0!==s&&(o/=s);var u=t.getExtent();if(!u||yd(u,i)){var l=Wg(t,o,i)/o;isFinite(l)&&l>0&&(o/=l)}return o}function CS(t,e,r,n,i,o,a,s,u,l,c,f){var p=Dh(Math.round(r*t),Math.round(r*e),wS);if(f||Jh(p,L_),0===u.length)return p.canvas;function h(t){return Math.round(t*r)/r}p.scale(r,r),p.globalCompositeOperation="lighter";var y=[1/0,1/0,-1/0,-1/0];u.forEach((function(t,e,r){Od(y,t.extent)}));var d=zd(y),g=Ad(y),m=Dh(Math.round(r*d/n),Math.round(r*g/n));f||Jh(m,L_);var v=r/n;u.forEach((function(t,e,r){var n=t.extent[0]-y[0],i=-(t.extent[3]-y[3]),o=zd(t.extent),a=Ad(t.extent);t.image.width>0&&t.image.height>0&&m.drawImage(t.image,l,l,t.image.width-2*l,t.image.height-2*l,n*v,i*v,o*v,a*v)}));var _=Nd(a);return s.getTriangles().forEach((function(t,e,i){var a=t.source,s=t.target,u=a[0][0],l=a[0][1],c=a[1][0],d=a[1][1],g=a[2][0],v=a[2][1],b=h((s[0][0]-_[0])/o),w=h(-(s[0][1]-_[1])/o),S=h((s[1][0]-_[0])/o),O=h(-(s[1][1]-_[1])/o),x=h((s[2][0]-_[0])/o),C=h(-(s[2][1]-_[1])/o),E=u,P=l;u=0,l=0;var k=function(t){for(var e=t.length,r=0;r<e;r++){for(var n=r,i=Math.abs(t[r][r]),o=r+1;o<e;o++){var a=Math.abs(t[o][r]);a>i&&(i=a,n=o)}if(0===i)return null;var s=t[n];t[n]=t[r],t[r]=s;for(var u=r+1;u<e;u++)for(var l=-t[u][r]/t[r][r],c=r;c<e+1;c++)r==c?t[u][c]=0:t[u][c]+=l*t[r][c]}for(var f=new Array(e),p=e-1;p>=0;p--){f[p]=t[p][e]/t[p][p];for(var h=p-1;h>=0;h--)t[h][e]-=t[h][p]*f[p]}return f}([[c-=E,d-=P,0,0,S-b],[g-=E,v-=P,0,0,x-b],[0,0,c,d,O-w],[0,0,g,v,C-w]]);if(k){if(p.save(),p.beginPath(),function(){if(void 0===bS){var t=document.createElement("canvas").getContext("2d");t.globalCompositeOperation="lighter",t.fillStyle="rgba(210, 0, 0, 0.75)",SS(t,4,5,4,0),SS(t,4,5,0,5);var e=t.getImageData(0,0,3,3).data;bS=OS(e,0)||OS(e,4)||OS(e,8)}return bS}()||!f){p.moveTo(S,O);for(var T=b-S,j=w-O,R=0;R<4;R++)p.lineTo(S+h((R+1)*T/4),O+h(R*j/3)),3!=R&&p.lineTo(S+h((R+1)*T/4),O+h((R+1)*j/3));p.lineTo(x,C)}else p.moveTo(S,O),p.lineTo(b,w),p.lineTo(x,C);p.clip(),p.transform(k[0],k[2],k[1],k[3],b,w),p.translate(y[0]-E,y[3]-P),p.scale(n/r,-n/r),p.drawImage(m.canvas,0,0),p.restore()}})),c&&(p.save(),p.globalCompositeOperation="source-over",p.strokeStyle="black",p.lineWidth=1,s.getTriangles().forEach((function(t,e,r){var n=t.target,i=(n[0][0]-_[0])/o,a=-(n[0][1]-_[1])/o,s=(n[1][0]-_[0])/o,u=-(n[1][1]-_[1])/o,l=(n[2][0]-_[0])/o,c=-(n[2][1]-_[1])/o;p.beginPath(),p.moveTo(s,u),p.lineTo(i,a),p.lineTo(l,c),p.closePath(),p.stroke()})),p.restore()),p.canvas}var ES=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),PS=function(t){function e(e,r,n,i,o,a,s){var u=this,l=e.getExtent(),c=r.getExtent(),f=c?Dd(n,c):n,p=xS(e,r,Rd(f),i),h=new _S(e,r,f,l,.5*p,i),y=a(h.calculateSourceExtent(),p,o),d=y?0:4,g=y?y.getPixelRatio():1;return(u=t.call(this,n,i,g,d)||this).targetProj_=r,u.maxSourceExtent_=l,u.triangulation_=h,u.targetResolution_=i,u.targetExtent_=n,u.sourceImage_=y,u.sourcePixelRatio_=g,u.interpolate_=s,u.canvas_=null,u.sourceListenerKey_=null,u}return ES(e,t),e.prototype.disposeInternal=function(){1==this.state&&this.unlistenSource_(),t.prototype.disposeInternal.call(this)},e.prototype.getImage=function(){return this.canvas_},e.prototype.getProjection=function(){return this.targetProj_},e.prototype.reproject_=function(){var t=this.sourceImage_.getState();if(2==t){var e=zd(this.targetExtent_)/this.targetResolution_,r=Ad(this.targetExtent_)/this.targetResolution_;this.canvas_=CS(e,r,this.sourcePixelRatio_,this.sourceImage_.getResolution(),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_)}this.state=t,this.changed()},e.prototype.load=function(){if(0==this.state){this.state=1,this.changed();var t=this.sourceImage_.getState();2==t||3==t?this.reproject_():(this.sourceListenerKey_=cy(this.sourceImage_,ny,(function(t){var e=this.sourceImage_.getState();2!=e&&3!=e||(this.unlistenSource_(),this.reproject_())}),this),this.sourceImage_.load())}},e.prototype.unlistenSource_=function(){py(this.sourceListenerKey_),this.sourceListenerKey_=null},e}(ud);const kS=PS;var TS=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),jS=function(t){function e(e){var r=t.call(this)||this;r.projection=qg(e.projection),r.attributions_=RS(e.attributions),r.attributionsCollapsible_=void 0===e.attributionsCollapsible||e.attributionsCollapsible,r.loading=!1,r.state_=void 0!==e.state?e.state:"ready",r.wrapX_=void 0!==e.wrapX&&e.wrapX,r.interpolate_=!!e.interpolate,r.viewResolver=null,r.viewRejector=null;var n=r;return r.viewPromise_=new Promise((function(t,e){n.viewResolver=t,n.viewRejector=e})),r}return TS(e,t),e.prototype.getAttributions=function(){return this.attributions_},e.prototype.getAttributionsCollapsible=function(){return this.attributionsCollapsible_},e.prototype.getProjection=function(){return this.projection},e.prototype.getResolutions=function(){return $p()},e.prototype.getView=function(){return this.viewPromise_},e.prototype.getState=function(){return this.state_},e.prototype.getWrapX=function(){return this.wrapX_},e.prototype.getInterpolate=function(){return this.interpolate_},e.prototype.refresh=function(){this.changed()},e.prototype.setAttributions=function(t){this.attributions_=RS(t),this.changed()},e.prototype.setState=function(t){this.state_=t,this.changed()},e}(vy);function RS(t){return t?Array.isArray(t)?function(e){return t}:"function"==typeof t?t:function(e){return[t]}:null}const LS=jS;var IS=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),MS=function(t){function e(e,r){var n=t.call(this,e)||this;return n.image=r,n}return IS(e,t),e}(Gh),AS=function(t){function e(e){var r=this,n=void 0===e.imageSmoothing||e.imageSmoothing;return void 0!==e.interpolate&&(n=e.interpolate),(r=t.call(this,{attributions:e.attributions,projection:e.projection,state:e.state,interpolate:n})||this).on,r.once,r.un,r.resolutions_=void 0!==e.resolutions?e.resolutions:null,r.reprojectedImage_=null,r.reprojectedRevision_=0,r}return IS(e,t),e.prototype.getResolutions=function(){return this.resolutions_},e.prototype.findNearestResolution=function(t){if(this.resolutions_){var e=qh(this.resolutions_,t,0);t=this.resolutions_[e]}return t},e.prototype.getImage=function(t,e,r,n){var i=this.getProjection();if(i&&n&&!Yg(i,n)){if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&Yg(this.reprojectedImage_.getProjection(),n)&&this.reprojectedImage_.getResolution()==e&&Sd(this.reprojectedImage_.getExtent(),t))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new kS(i,n,t,e,r,function(t,e,r){return this.getImageInternal(t,e,r,i)}.bind(this),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}return i&&(n=i),this.getImageInternal(t,e,r,n)},e.prototype.getImageInternal=function(t,e,r,n){return $p()},e.prototype.handleImageChange=function(t){var e,r=t.target;switch(r.getState()){case 1:this.loading=!0,e="imageloadstart";break;case 2:this.loading=!1,e="imageloadend";break;case 3:this.loading=!1,e="imageloaderror";break;default:return}this.hasListener(e)&&this.dispatchEvent(new MS(e,r))},e}(LS);const DS=AS,NS="preload",FS="useInterimTilesOnError";var zS=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),GS=function(t){function e(e){var r=this,n=e||{},i=Jh({},n);return delete i.preload,delete i.useInterimTilesOnError,(r=t.call(this,i)||this).on,r.once,r.un,r.setPreload(void 0!==n.preload?n.preload:0),r.setUseInterimTilesOnError(void 0===n.useInterimTilesOnError||n.useInterimTilesOnError),r}return zS(e,t),e.prototype.getPreload=function(){return this.get(NS)},e.prototype.setPreload=function(t){this.set(NS,t)},e.prototype.getUseInterimTilesOnError=function(){return this.get(FS)},e.prototype.setUseInterimTilesOnError=function(t){this.set(FS,t)},e.prototype.getData=function(e){return t.prototype.getData.call(this,e)},e}(v_);const BS=GS;var VS=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),US=function(t){function e(e,r,n){var i=t.call(this)||this,o=n||{};return i.tileCoord=e,i.state=r,i.interimTile=null,i.key="",i.transition_=void 0===o.transition?250:o.transition,i.transitionStarts_={},i.interpolate=!!o.interpolate,i}return VS(e,t),e.prototype.changed=function(){this.dispatchEvent(ny)},e.prototype.release=function(){},e.prototype.getKey=function(){return this.key+"/"+this.tileCoord},e.prototype.getInterimTile=function(){if(!this.interimTile)return this;var t=this.interimTile;do{if(2==t.getState())return this.transition_=0,t;t=t.interimTile}while(t);return this},e.prototype.refreshInterimChain=function(){if(this.interimTile){var t=this.interimTile,e=this;do{if(2==t.getState()){t.interimTile=null;break}1==t.getState()?e=t:0==t.getState()?e.interimTile=t.interimTile:e=t,t=e.interimTile}while(t)}},e.prototype.getTileCoord=function(){return this.tileCoord},e.prototype.getState=function(){return this.state},e.prototype.setState=function(t){if(3!==this.state&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()},e.prototype.load=function(){$p()},e.prototype.getAlpha=function(t,e){if(!this.transition_)return 1;var r=this.transitionStarts_[t];if(r){if(-1===r)return 1}else r=e,this.transitionStarts_[t]=r;var n=e-r+1e3/60;return n>=this.transition_?1:Bb(n/this.transition_)},e.prototype.inTransition=function(t){return!!this.transition_&&-1!==this.transitionStarts_[t]},e.prototype.endTransition=function(t){this.transition_&&(this.transitionStarts_[t]=-1)},e}(ry);const qS=US;var WS=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const XS=function(t){function e(e,r,n,i,o,a){var s=t.call(this,e,r,a)||this;return s.crossOrigin_=i,s.src_=n,s.key=n,s.image_=new Image,null!==i&&(s.image_.crossOrigin=i),s.unlisten_=null,s.tileLoadFunction_=o,s}return WS(e,t),e.prototype.getImage=function(){return this.image_},e.prototype.setImage=function(t){this.image_=t,this.state=2,this.unlistenImage_(),this.changed()},e.prototype.handleImageError_=function(){var t;this.state=3,this.unlistenImage_(),this.image_=((t=Dh(1,1)).fillStyle="rgba(0,0,0,0)",t.fillRect(0,0,1,1),t.canvas),this.changed()},e.prototype.handleImageLoad_=function(){var t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=2:this.state=4,this.unlistenImage_(),this.changed()},e.prototype.load=function(){3==this.state&&(this.state=0,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),0==this.state&&(this.state=1,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=Wd(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},e.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},e}(qS);var ZS=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),HS=function(t){function e(e,r,n,i,o,a,s,u,l,c,f,p){var h=t.call(this,o,0,{interpolate:!!p})||this;h.renderEdges_=void 0!==f&&f,h.pixelRatio_=s,h.gutter_=u,h.canvas_=null,h.sourceTileGrid_=r,h.targetTileGrid_=i,h.wrappedTileCoord_=a||o,h.sourceTiles_=[],h.sourcesListenerKeys_=null,h.sourceZ_=0;var y=i.getTileCoordExtent(h.wrappedTileCoord_),d=h.targetTileGrid_.getExtent(),g=h.sourceTileGrid_.getExtent(),m=d?Dd(y,d):y;if(0===kd(m))return h.state=4,h;var v=e.getExtent();v&&(g=g?Dd(g,v):v);var _=i.getResolution(h.wrappedTileCoord_[0]),b=function(t,e,r,n){var i=Rd(r),o=xS(t,e,i,n);return(!isFinite(o)||o<=0)&&Pd(r,(function(r){return o=xS(t,e,r,n),isFinite(o)&&o>0})),o}(e,n,m,_);if(!isFinite(b)||b<=0)return h.state=4,h;var w=void 0!==c?c:.5;if(h.triangulation_=new _S(e,n,m,g,b*w,_),0===h.triangulation_.getTriangles().length)return h.state=4,h;h.sourceZ_=r.getZForResolution(b);var S=h.triangulation_.calculateSourceExtent();if(g&&(e.canWrapX()?(S[1]=lh(S[1],g[1],g[3]),S[3]=lh(S[3],g[1],g[3])):S=Dd(S,g)),kd(S)){for(var O=r.getTileRangeForExtentAndZ(S,h.sourceZ_),x=O.minX;x<=O.maxX;x++)for(var C=O.minY;C<=O.maxY;C++){var E=l(h.sourceZ_,x,C,s);E&&h.sourceTiles_.push(E)}0===h.sourceTiles_.length&&(h.state=4)}else h.state=4;return h}return ZS(e,t),e.prototype.getImage=function(){return this.canvas_},e.prototype.reproject_=function(){var t=[];if(this.sourceTiles_.forEach(function(e,r,n){e&&2==e.getState()&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),image:e.getImage()})}.bind(this)),this.sourceTiles_.length=0,0===t.length)this.state=3;else{var e=this.wrappedTileCoord_[0],r=this.targetTileGrid_.getTileSize(e),n="number"==typeof r?r:r[0],i="number"==typeof r?r:r[1],o=this.targetTileGrid_.getResolution(e),a=this.sourceTileGrid_.getResolution(this.sourceZ_),s=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=CS(n,i,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,s,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=2}this.changed()},e.prototype.load=function(){if(0==this.state){this.state=1,this.changed();var t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(function(e,r,n){var i=e.getState();if(0==i||1==i){t++;var o=cy(e,ny,(function(r){var n=e.getState();2!=n&&3!=n&&4!=n||(py(o),0==--t&&(this.unlistenSources_(),this.reproject_()))}),this);this.sourcesListenerKeys_.push(o)}}.bind(this)),0===t?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach((function(t,e,r){0==t.getState()&&t.load()}))}},e.prototype.unlistenSources_=function(){this.sourcesListenerKeys_.forEach(py),this.sourcesListenerKeys_=null},e.prototype.release=function(){this.canvas_&&(Nh(this.canvas_.getContext("2d")),wS.push(this.canvas_),this.canvas_=null),t.prototype.release.call(this)},e}(qS);const YS=HS;var KS=function(){function t(t,e,r,n){this.minX=t,this.maxX=e,this.minY=r,this.maxY=n}return t.prototype.contains=function(t){return this.containsXY(t[1],t[2])},t.prototype.containsTileRange=function(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY},t.prototype.containsXY=function(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY},t.prototype.equals=function(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY},t.prototype.extend=function(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)},t.prototype.getHeight=function(){return this.maxY-this.minY+1},t.prototype.getSize=function(){return[this.getWidth(),this.getHeight()]},t.prototype.getWidth=function(){return this.maxX-this.minX+1},t.prototype.intersects=function(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY},t}();function JS(t,e,r,n,i){return void 0!==i?(i.minX=t,i.maxX=e,i.minY=r,i.maxY=n,i):new KS(t,e,r,n)}const $S=KS;var QS=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),tO=function(t){function e(e){var r=t.call(this,e)||this;return r.extentChanged=!0,r.renderedExtent_=null,r.renderedPixelRatio,r.renderedProjection=null,r.renderedRevision,r.renderedTiles=[],r.newTiles_=!1,r.tmpExtent=[1/0,1/0,-1/0,-1/0],r.tmpTileRange_=new $S(0,0,0,0),r}return QS(e,t),e.prototype.isDrawableTile=function(t){var e=this.getLayer(),r=t.getState(),n=e.getUseInterimTilesOnError();return 2==r||4==r||3==r&&!n},e.prototype.getTile=function(t,e,r,n){var i=n.pixelRatio,o=n.viewState.projection,a=this.getLayer(),s=a.getSource().getTile(t,e,r,i,o);return 3==s.getState()&&(a.getUseInterimTilesOnError()?a.getPreload()>0&&(this.newTiles_=!0):s.setState(2)),this.isDrawableTile(s)||(s=s.getInterimTile()),s},e.prototype.getData=function(t){var e=this.frameState;if(!e)return null;var r=this.getLayer(),n=ng(e.pixelToCoordinateTransform,t.slice()),i=r.getExtent();if(i&&!yd(i,n))return null;for(var o=e.pixelRatio,a=e.viewState.projection,s=e.viewState,u=r.getRenderSource(),l=u.getTileGridForProjection(s.projection),c=u.getTilePixelRatio(e.pixelRatio),f=l.getZForResolution(s.resolution);f>=l.getMinZoom();--f){var p=l.getTileCoordForCoordAndZ(n,f),h=u.getTile(f,p[1],p[2],o,a);if(!(h instanceof XS||h instanceof YS))return null;if(2===h.getState()){var y=l.getOrigin(f),d=rh(l.getTileSize(f)),g=l.getResolution(f),m=Math.floor(c*((n[0]-y[0])/g-p[1]*d[0])),v=Math.floor(c*((y[1]-n[1])/g-p[2]*d[1])),_=Math.round(c*u.getGutterForProjection(s.projection));return this.getImageData(h.getImage(),m+_,v+_)}}return null},e.prototype.loadedTileCallback=function(e,r,n){return!!this.isDrawableTile(n)&&t.prototype.loadedTileCallback.call(this,e,r,n)},e.prototype.prepareFrame=function(t){return!!this.getLayer().getSource()},e.prototype.renderFrame=function(t,e){var r=t.layerStatesArray[t.layerIndex],n=t.viewState,i=n.projection,o=n.resolution,a=n.center,s=n.rotation,u=t.pixelRatio,l=this.getLayer(),c=l.getSource(),f=c.getRevision(),p=c.getTileGridForProjection(i),h=p.getZForResolution(o,c.zDirection),y=p.getResolution(h),d=t.extent,g=t.viewState.resolution,m=c.getTilePixelRatio(u),v=Math.round(zd(d)/g*u),_=Math.round(Ad(d)/g*u),b=r.extent&&um(r.extent,i);b&&(d=Dd(d,um(r.extent,i)));var w=y*v/2/m,S=y*_/2/m,O=[a[0]-w,a[1]-S,a[0]+w,a[1]+S],x=p.getTileRangeForExtentAndZ(d,h),C={};C[h]={};var E=this.createLoadedTileFinder(c,i,C),P=this.tmpExtent,k=this.tmpTileRange_;this.newTiles_=!1;for(var T=s?Md(n.center,g,s,t.size):void 0,j=x.minX;j<=x.maxX;++j)for(var R=x.minY;R<=x.maxY;++R)if(!s||p.tileCoordIntersectsViewport([h,j,R],T)){var L=this.getTile(h,j,R,t);if(this.isDrawableTile(L)){var I=th(this);if(2==L.getState()&&(C[h][L.tileCoord.toString()]=L,(rt=L.inTransition(I))&&1!==r.opacity&&(L.endTransition(I),rt=!1),this.newTiles_||!rt&&-1!==this.renderedTiles.indexOf(L)||(this.newTiles_=!0)),1===L.getAlpha(I,t.time))continue}var M=p.getTileCoordChildTileRange(L.tileCoord,k,P),A=!1;M&&(A=E(h+1,M)),A||p.forEachTileCoordParentTileRange(L.tileCoord,E,k,P)}var D=y/o*u/m;og(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/u,1/u,s,-v/2,-_/2);var N=sg(this.pixelTransform);this.useContainer(e,N,this.getBackground(t));var F=this.context,z=F.canvas;ag(this.inversePixelTransform,this.pixelTransform),og(this.tempTransform,v/2,_/2,D,D,0,-v/2,-_/2),z.width!=v||z.height!=_?(z.width=v,z.height=_):this.containerReused||F.clearRect(0,0,v,_),b&&this.clipUnrotated(F,t,b),c.getInterpolate()||Jh(F,L_),this.preRender(F,t),this.renderedTiles.length=0;var G,B,V,U=Object.keys(C).map(Number);U.sort(Uh),1!==r.opacity||this.containerReused&&!c.getOpaque(t.viewState.projection)?(G=[],B=[]):U=U.reverse();for(var q=U.length-1;q>=0;--q){var W=U[q],X=c.getTilePixelSize(W,u,i),Z=p.getResolution(W)/y,H=X[0]*Z*D,Y=X[1]*Z*D,K=p.getTileCoordForCoordAndZ(Nd(O),W),J=p.getTileCoordExtent(K),$=ng(this.tempTransform,[m*(J[0]-O[0])/y,m*(O[3]-J[3])/y]),Q=m*c.getGutterForProjection(i),tt=C[W];for(var et in tt){var rt,nt=(L=tt[et]).tileCoord,it=K[1]-nt[1],ot=Math.round($[0]-(it-1)*H),at=K[2]-nt[2],st=Math.round($[1]-(at-1)*Y),ut=ot-(j=Math.round($[0]-it*H)),lt=st-(R=Math.round($[1]-at*Y)),ct=h===W,ft=!1;if(!(rt=ct&&1!==L.getAlpha(th(this),t.time)))if(G){V=[j,R,j+ut,R,j+ut,R+lt,j,R+lt];for(var pt=0,ht=G.length;pt<ht;++pt)if(h!==W&&W<B[pt]){var yt=G[pt];Gd([j,R,j+ut,R+lt],[yt[0],yt[3],yt[4],yt[7]])&&(ft||(F.save(),ft=!0),F.beginPath(),F.moveTo(V[0],V[1]),F.lineTo(V[2],V[3]),F.lineTo(V[4],V[5]),F.lineTo(V[6],V[7]),F.moveTo(yt[6],yt[7]),F.lineTo(yt[4],yt[5]),F.lineTo(yt[2],yt[3]),F.lineTo(yt[0],yt[1]),F.clip())}G.push(V),B.push(W)}else F.clearRect(j,R,ut,lt);this.drawTileImage(L,t,j,R,ut,lt,Q,ct),G&&!rt?(ft&&F.restore(),this.renderedTiles.unshift(L)):this.renderedTiles.push(L),this.updateUsedTiles(t.usedTiles,c,L)}}return this.renderedRevision=f,this.renderedResolution=y,this.extentChanged=!this.renderedExtent_||!Sd(this.renderedExtent_,O),this.renderedExtent_=O,this.renderedPixelRatio=u,this.renderedProjection=i,this.manageTilePyramid(t,c,p,u,i,d,h,l.getPreload()),this.scheduleExpireCache(t,c),this.postRender(F,t),r.extent&&F.restore(),Jh(F,I_),N!==z.style.transform&&(z.style.transform=N),this.container},e.prototype.drawTileImage=function(t,e,r,n,i,o,a,s){var u=this.getTileImage(t);if(u){var l=th(this),c=e.layerStatesArray[e.layerIndex],f=c.opacity*(s?t.getAlpha(l,e.time):1),p=f!==this.context.globalAlpha;p&&(this.context.save(),this.context.globalAlpha=f),this.context.drawImage(u,a,a,u.width-2*a,u.height-2*a,r,n,i,o),p&&this.context.restore(),f!==c.opacity?e.animate=!0:s&&t.endTransition(l)}},e.prototype.getImage=function(){var t=this.context;return t?t.canvas:null},e.prototype.getTileImage=function(t){return t.getImage()},e.prototype.scheduleExpireCache=function(t,e){if(e.canExpireCache()){var r=function(t,e,r){var n=th(t);n in r.usedTiles&&t.expireCache(r.viewState.projection,r.usedTiles[n])}.bind(null,e);t.postRenderFunctions.push(r)}},e.prototype.updateUsedTiles=function(t,e,r){var n=th(e);n in t||(t[n]={}),t[n][r.getKey()]=!0},e.prototype.manageTilePyramid=function(t,e,r,n,i,o,a,s,u){var l=th(e);l in t.wantedTiles||(t.wantedTiles[l]={});var c,f,p,h,y,d,g=t.wantedTiles[l],m=t.tileQueue,v=r.getMinZoom(),_=t.viewState.rotation,b=_?Md(t.viewState.center,t.viewState.resolution,_,t.size):void 0,w=0;for(d=v;d<=a;++d)for(f=r.getTileRangeForExtentAndZ(o,d,f),p=r.getResolution(d),h=f.minX;h<=f.maxX;++h)for(y=f.minY;y<=f.maxY;++y)_&&!r.tileCoordIntersectsViewport([d,h,y],b)||(a-d<=s?(++w,0==(c=e.getTile(d,h,y,n,i)).getState()&&(g[c.getKey()]=!0,m.isKeyQueued(c.getKey())||m.enqueue([c,l,r.getTileCoordCenter(c.tileCoord),p])),void 0!==u&&u(c)):e.useTile(d,h,y,i));e.updateCacheSize(w,i)},e}(R_);const eO=tO;var rO=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const nO=function(t){function e(e){return t.call(this,e)||this}return rO(e,t),e.prototype.createRenderer=function(){return new eO(this)},e}(BS),iO=function(){function t(t){this.highWaterMark=void 0!==t?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}return t.prototype.canExpireCache=function(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark},t.prototype.expireCache=function(t){for(;this.canExpireCache();)this.pop()},t.prototype.clear=function(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null},t.prototype.containsKey=function(t){return this.entries_.hasOwnProperty(t)},t.prototype.forEach=function(t){for(var e=this.oldest_;e;)t(e.value_,e.key_,this),e=e.newer},t.prototype.get=function(t,e){var r=this.entries_[t];return uh(void 0!==r,15),r===this.newest_||(r===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(r.newer.older=r.older,r.older.newer=r.newer),r.newer=null,r.older=this.newest_,this.newest_.newer=r,this.newest_=r),r.value_},t.prototype.remove=function(t){var e=this.entries_[t];return uh(void 0!==e,15),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_},t.prototype.getCount=function(){return this.count_},t.prototype.getKeys=function(){var t,e=new Array(this.count_),r=0;for(t=this.newest_;t;t=t.older)e[r++]=t.key_;return e},t.prototype.getValues=function(){var t,e=new Array(this.count_),r=0;for(t=this.newest_;t;t=t.older)e[r++]=t.value_;return e},t.prototype.peekLast=function(){return this.oldest_.value_},t.prototype.peekLastKey=function(){return this.oldest_.key_},t.prototype.peekFirstKey=function(){return this.newest_.key_},t.prototype.peek=function(t){if(this.containsKey(t))return this.entries_[t].value_},t.prototype.pop=function(){var t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_},t.prototype.replace=function(t,e){this.get(t),this.entries_[t].value_=e},t.prototype.set=function(t,e){uh(!(t in this.entries_),16);var r={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=r:this.oldest_=r,this.newest_=r,this.entries_[t]=r,++this.count_},t.prototype.setSize=function(t){this.highWaterMark=t},t}();var oO=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),aO=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return oO(e,t),e.prototype.expireCache=function(t){for(;this.canExpireCache()&&!(this.peekLast().getKey()in t);)this.pop().release()},e.prototype.pruneExceptNewestZ=function(){if(0!==this.getCount()){var t=jm(this.peekFirstKey())[0];this.forEach(function(e){e.tileCoord[0]!==t&&(this.remove(Tm(e.tileCoord)),e.release())}.bind(this))}},e}(iO);const sO=aO;var uO=[0,0,0],lO=function(){function t(t){var e;if(this.minZoom=void 0!==t.minZoom?t.minZoom:0,this.resolutions_=t.resolutions,uh(function(t,e,r){var n=function(t,e){return e-t}||Uh;return t.every((function(e,r){if(0===r)return!0;var i=n(t[r-1],e);return!(i>0||0===i)}))}(this.resolutions_),17),!t.origins)for(var r=0,n=this.resolutions_.length-1;r<n;++r)if(e){if(this.resolutions_[r]/this.resolutions_[r+1]!==e){e=void 0;break}}else e=this.resolutions_[r]/this.resolutions_[r+1];this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==t.origin?t.origin:null,this.origins_=null,void 0!==t.origins&&(this.origins_=t.origins,uh(this.origins_.length==this.resolutions_.length,20));var i=t.extent;void 0===i||this.origin_||this.origins_||(this.origin_=Nd(i)),uh(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,void 0!==t.tileSizes&&(this.tileSizes_=t.tileSizes,uh(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=void 0!==t.tileSize?t.tileSize:this.tileSizes_?null:Ib,uh(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=void 0!==i?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],void 0!==t.sizes?this.fullTileRanges_=t.sizes.map((function(t,e){var r=new $S(Math.min(0,t[0]),Math.max(t[0]-1,-1),Math.min(0,t[1]),Math.max(t[1]-1,-1));if(i){var n=this.getTileRangeForExtentAndZ(i,e);r.minX=Math.max(n.minX,r.minX),r.maxX=Math.min(n.maxX,r.maxX),r.minY=Math.max(n.minY,r.minY),r.maxY=Math.min(n.maxY,r.maxY)}return r}),this):i&&this.calculateTileRanges_(i)}return t.prototype.forEachTileCoord=function(t,e,r){for(var n=this.getTileRangeForExtentAndZ(t,e),i=n.minX,o=n.maxX;i<=o;++i)for(var a=n.minY,s=n.maxY;a<=s;++a)r([e,i,a])},t.prototype.forEachTileCoordParentTileRange=function(t,e,r,n){var i,o,a=null,s=t[0]-1;for(2===this.zoomFactor_?(i=t[1],o=t[2]):a=this.getTileCoordExtent(t,n);s>=this.minZoom;){if(e(s,2===this.zoomFactor_?JS(i=Math.floor(i/2),i,o=Math.floor(o/2),o,r):this.getTileRangeForExtentAndZ(a,s,r)))return!0;--s}return!1},t.prototype.getExtent=function(){return this.extent_},t.prototype.getMaxZoom=function(){return this.maxZoom},t.prototype.getMinZoom=function(){return this.minZoom},t.prototype.getOrigin=function(t){return this.origin_?this.origin_:this.origins_[t]},t.prototype.getResolution=function(t){return this.resolutions_[t]},t.prototype.getResolutions=function(){return this.resolutions_},t.prototype.getTileCoordChildTileRange=function(t,e,r){if(t[0]<this.maxZoom){if(2===this.zoomFactor_){var n=2*t[1],i=2*t[2];return JS(n,n+1,i,i+1,e)}var o=this.getTileCoordExtent(t,r||this.tmpExtent_);return this.getTileRangeForExtentAndZ(o,t[0]+1,e)}return null},t.prototype.getTileRangeForTileCoordAndZ=function(t,e,r){if(e>this.maxZoom||e<this.minZoom)return null;var n=t[0],i=t[1],o=t[2];if(e===n)return JS(i,o,i,o,r);if(this.zoomFactor_){var a=Math.pow(this.zoomFactor_,e-n),s=Math.floor(i*a),u=Math.floor(o*a);return e<n?JS(s,s,u,u,r):JS(s,Math.floor(a*(i+1))-1,u,Math.floor(a*(o+1))-1,r)}var l=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(l,e,r)},t.prototype.getTileRangeExtent=function(t,e,r){var n=this.getOrigin(t),i=this.getResolution(t),o=rh(this.getTileSize(t),this.tmpSize_),a=n[0]+e.minX*o[0]*i,s=n[0]+(e.maxX+1)*o[0]*i;return vd(a,n[1]+e.minY*o[1]*i,s,n[1]+(e.maxY+1)*o[1]*i,r)},t.prototype.getTileRangeForExtentAndZ=function(t,e,r){var n=uO;this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,n);var i=n[1],o=n[2];return this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,n),JS(i,n[1],o,n[2],r)},t.prototype.getTileCoordCenter=function(t){var e=this.getOrigin(t[0]),r=this.getResolution(t[0]),n=rh(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*n[0]*r,e[1]-(t[2]+.5)*n[1]*r]},t.prototype.getTileCoordExtent=function(t,e){var r=this.getOrigin(t[0]),n=this.getResolution(t[0]),i=rh(this.getTileSize(t[0]),this.tmpSize_),o=r[0]+t[1]*i[0]*n,a=r[1]-(t[2]+1)*i[1]*n;return vd(o,a,o+i[0]*n,a+i[1]*n,e)},t.prototype.getTileCoordForCoordAndResolution=function(t,e,r){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,r)},t.prototype.getTileCoordForXYAndResolution_=function(t,e,r,n,i){var o=this.getZForResolution(r),a=r/this.getResolution(o),s=this.getOrigin(o),u=rh(this.getTileSize(o),this.tmpSize_),l=a*(t-s[0])/r/u[0],c=a*(s[1]-e)/r/u[1];return n?(l=_h(l,5)-1,c=_h(c,5)-1):(l=vh(l,5),c=vh(c,5)),Pm(o,l,c,i)},t.prototype.getTileCoordForXYAndZ_=function(t,e,r,n,i){var o=this.getOrigin(r),a=this.getResolution(r),s=rh(this.getTileSize(r),this.tmpSize_),u=(t-o[0])/a/s[0],l=(o[1]-e)/a/s[1];return n?(u=_h(u,5)-1,l=_h(l,5)-1):(u=vh(u,5),l=vh(l,5)),Pm(r,u,l,i)},t.prototype.getTileCoordForCoordAndZ=function(t,e,r){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,r)},t.prototype.getTileCoordResolution=function(t){return this.resolutions_[t[0]]},t.prototype.getTileSize=function(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]},t.prototype.getFullTileRange=function(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null},t.prototype.getZForResolution=function(t,e){return lh(qh(this.resolutions_,t,e||0),this.minZoom,this.maxZoom)},t.prototype.tileCoordIntersectsViewport=function(t,e){return vv(e,0,e.length,2,this.getTileCoordExtent(t))},t.prototype.calculateTileRanges_=function(t){for(var e=this.resolutions_.length,r=new Array(e),n=this.minZoom;n<e;++n)r[n]=this.getTileRangeForExtentAndZ(t,n);this.fullTileRanges_=r},t}();const cO=lO;function fO(t){var e=t.getDefaultTileGrid();return e||(e=function(t,e,r,n){return function(t,e,r,n){var i=hO(t,undefined,r);return new cO({extent:t,origin:Ld(t,"top-left"),resolutions:i,tileSize:r})}(yO(t),0,void 0)}(t),t.setDefaultTileGrid(e)),e}function pO(t){var e=t||{},r=e.extent||qg("EPSG:3857").getExtent(),n={extent:r,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:hO(r,e.maxZoom,e.tileSize,e.maxResolution)};return new cO(n)}function hO(t,e,r,n){for(var i=void 0!==e?e:Lb,o=Ad(t),a=zd(t),s=rh(void 0!==r?r:Ib),u=n>0?n:Math.max(a/s[0],o/s[1]),l=i+1,c=new Array(l),f=0;f<l;++f)c[f]=u/Math.pow(2,f);return c}function yO(t){var e=(t=qg(t)).getExtent();if(!e){var r=180*yg[dg.DEGREES]/t.getMetersPerUnit();e=vd(-r,-r,r,r)}return e}var dO=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),gO=function(t){function e(e){var r=t.call(this,{attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate})||this;return r.on,r.once,r.un,r.opaque_=void 0!==e.opaque&&e.opaque,r.tilePixelRatio_=void 0!==e.tilePixelRatio?e.tilePixelRatio:1,r.tileGrid=void 0!==e.tileGrid?e.tileGrid:null,r.tileGrid&&rh(r.tileGrid.getTileSize(r.tileGrid.getMinZoom()),[256,256]),r.tileCache=new sO(e.cacheSize||0),r.tmpSize=[0,0],r.key_=e.key||"",r.tileOptions={transition:e.transition,interpolate:e.interpolate},r.zDirection=e.zDirection?e.zDirection:0,r}return dO(e,t),e.prototype.canExpireCache=function(){return this.tileCache.canExpireCache()},e.prototype.expireCache=function(t,e){var r=this.getTileCacheForProjection(t);r&&r.expireCache(e)},e.prototype.forEachLoadedTile=function(t,e,r,n){var i=this.getTileCacheForProjection(t);if(!i)return!1;for(var o,a,s,u=!0,l=r.minX;l<=r.maxX;++l)for(var c=r.minY;c<=r.maxY;++c)a=km(e,l,c),s=!1,i.containsKey(a)&&(s=2===(o=i.get(a)).getState())&&(s=!1!==n(o)),s||(u=!1);return u},e.prototype.getGutterForProjection=function(t){return 0},e.prototype.getKey=function(){return this.key_},e.prototype.setKey=function(t){this.key_!==t&&(this.key_=t,this.changed())},e.prototype.getOpaque=function(t){return this.opaque_},e.prototype.getResolutions=function(){return this.tileGrid?this.tileGrid.getResolutions():null},e.prototype.getTile=function(t,e,r,n,i){return $p()},e.prototype.getTileGrid=function(){return this.tileGrid},e.prototype.getTileGridForProjection=function(t){return this.tileGrid?this.tileGrid:fO(t)},e.prototype.getTileCacheForProjection=function(t){var e=this.getProjection();return uh(null===e||Yg(e,t),68),this.tileCache},e.prototype.getTilePixelRatio=function(t){return this.tilePixelRatio_},e.prototype.getTilePixelSize=function(t,e,r){var n,i,o,a=this.getTileGridForProjection(r),s=this.getTilePixelRatio(e),u=rh(a.getTileSize(t),this.tmpSize);return 1==s?u:(n=u,i=s,void 0===(o=this.tmpSize)&&(o=[0,0]),o[0]=n[0]*i+.5|0,o[1]=n[1]*i+.5|0,o)},e.prototype.getTileCoordForTileUrlFunction=function(t,e){var r=void 0!==e?e:this.getProjection(),n=this.getTileGridForProjection(r);return this.getWrapX()&&r.isGlobal()&&(t=function(t,e,r){var n=e[0],i=t.getTileCoordCenter(e),o=yO(r);if(yd(o,i))return e;var a=zd(o),s=Math.ceil((o[0]-i[0])/a);return i[0]+=a*s,t.getTileCoordForCoordAndZ(i,n)}(n,t,r)),function(t,e){var r=t[0],n=t[1],i=t[2];if(e.getMinZoom()>r||r>e.getMaxZoom())return!1;var o=e.getFullTileRange(r);return!o||o.containsXY(n,i)}(t,n)?t:null},e.prototype.clear=function(){this.tileCache.clear()},e.prototype.refresh=function(){this.clear(),t.prototype.refresh.call(this)},e.prototype.updateCacheSize=function(t,e){var r=this.getTileCacheForProjection(e);t>r.highWaterMark&&(r.highWaterMark=t)},e.prototype.useTile=function(t,e,r,n){},e}(LS),mO=function(t){function e(e,r){var n=t.call(this,e)||this;return n.tile=r,n}return dO(e,t),e}(Gh);const vO=gO;var _O,bO=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),wO=!0;try{new ImageData(10,10)}catch(t){wO=!1}function SO(t){var e=!0;try{new ImageData(10,10)}catch(t){e=!1}function r(t,r,n){return e?new ImageData(t,r,n):{data:t,width:r,height:n}}return function(e){var n=e.buffers,i=e.meta,o=e.imageOps,a=e.width,s=e.height,u=n.length,l=n[0].byteLength;if(o){for(var c=new Array(u),f=0;f<u;++f)c[f]=r(new Uint8ClampedArray(n[f]),a,s);return t(c,i).data.buffer}var p=new Uint8ClampedArray(l),h=new Array(u),y=new Array(u);for(f=0;f<u;++f)h[f]=new Uint8ClampedArray(n[f]),y[f]=[0,0,0,0];for(var d=0;d<l;d+=4){for(var g=0;g<u;++g){var m=h[g];y[g][0]=m[d],y[g][1]=m[d+1],y[g][2]=m[d+2],y[g][3]=m[d+3]}var v=t(y,i);p[d]=v[0],p[d+1]=v[1],p[d+2]=v[2],p[d+3]=v[3]}return p.buffer}}function OO(t,e){var r=Object.keys(t.lib||{}).map((function(e){return"var "+e+" = "+t.lib[e].toString()+";"})).concat(["var __minion__ = ("+SO.toString()+")(",t.operation.toString(),");",'self.addEventListener("message", function(event) {',"  var buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),n=new Worker("undefined"==typeof Blob?"data:text/javascript;base64,"+Buffer.from(r.join("\n"),"binary").toString("base64"):URL.createObjectURL(new Blob(r,{type:"text/javascript"})));return n.addEventListener("message",e),n}var xO=function(t){function e(e){var r,n=t.call(this)||this;n._imageOps=!!e.imageOps,r=0===e.threads?0:n._imageOps?1:e.threads||1;var i=new Array(r);if(r)for(var o=0;o<r;++o)i[o]=OO(e,n._onWorkerMessage.bind(n,o));else i[0]=function(t,e){var r=SO(t.operation),n=!1;return{postMessage:function(t){setTimeout((function(){n||e({data:{buffer:r(t),meta:t.meta}})}),0)},terminate:function(){n=!0}}}(e,n._onWorkerMessage.bind(n,0));return n._workers=i,n._queue=[],n._maxQueueLength=e.queue||1/0,n._running=0,n._dataLookup={},n._job=null,n}return bO(e,t),e.prototype.process=function(t,e,r){this._enqueue({inputs:t,meta:e,callback:r}),this._dispatch()},e.prototype._enqueue=function(t){for(this._queue.push(t);this._queue.length>this._maxQueueLength;)this._queue.shift().callback(null,null)},e.prototype._dispatch=function(){if(!this._running&&0!==this._queue.length){var t=this._queue.shift();this._job=t;var e=t.inputs[0].width,r=t.inputs[0].height,n=t.inputs.map((function(t){return t.data.buffer})),i=this._workers.length;if(this._running=i,1!==i)for(var o=t.inputs[0].data.length,a=4*Math.ceil(o/4/i),s=0;s<i;++s){for(var u=s*a,l=[],c=0,f=n.length;c<f;++c)l.push(n[c].slice(u,u+a));this._workers[s].postMessage({buffers:l,meta:t.meta,imageOps:this._imageOps,width:e,height:r},l)}else this._workers[0].postMessage({buffers:n,meta:t.meta,imageOps:this._imageOps,width:e,height:r},n)}},e.prototype._onWorkerMessage=function(t,e){this.disposed||(this._dataLookup[t]=e.data,--this._running,0===this._running&&this._resolveJob())},e.prototype._resolveJob=function(){var t,e,r=this._job,n=this._workers.length;if(1===n)t=new Uint8ClampedArray(this._dataLookup[0].buffer),e=this._dataLookup[0].meta;else{var i=r.inputs[0].data.length;t=new Uint8ClampedArray(i),e=new Array(n);for(var o=4*Math.ceil(i/4/n),a=0;a<n;++a){var s=this._dataLookup[a].buffer,u=a*o;t.set(new Uint8ClampedArray(s),u),e[a]=this._dataLookup[a].meta}}this._job=null,this._dataLookup={},r.callback(null,function(t,e,r){if(wO)return new ImageData(t,e,r);_O||(_O=document.createElement("canvas").getContext("2d"));var n=_O.createImageData(e,r);return n.data.set(t),n}(t,r.inputs[0].width,r.inputs[0].height),e),this._dispatch()},e.prototype.disposeInternal=function(){for(var t=0;t<this._workers.length;++t)this._workers[t].terminate();this._workers.length=0},e}(Vh),CO=function(t){function e(e,r,n){var i=t.call(this,e)||this;return i.extent=r.extent,i.resolution=r.viewState.resolution/r.pixelRatio,i.data=n,i}return bO(e,t),e}(Gh),EO=function(t){function e(e){var r=t.call(this,{projection:null})||this;r.on,r.once,r.un,r.processor_=null,r.operationType_=void 0!==e.operationType?e.operationType:"pixel",r.threads_=void 0!==e.threads?e.threads:1,r.layers_=function(t){for(var e=t.length,r=new Array(e),n=0;n<e;++n)r[n]=(i=t[n],o=void 0,i instanceof LS?i instanceof vO?o=new nO({source:i}):i instanceof DS&&(o=new F_({source:i})):o=i,o);var i,o;return r}(e.sources);for(var n,i=r.changed.bind(r),o=0,a=r.layers_.length;o<a;++o)r.layers_[o].addEventListener(ny,i);return r.tileQueue_=new jb((function(){return 1}),r.changed.bind(r)),r.requestedFrameState_,r.renderedImageCanvas_=null,r.renderedRevision_,r.frameState_={animate:!1,coordinateToPixelTransform:[1,0,0,1,0,0],declutterTree:null,extent:null,index:0,layerIndex:0,layerStatesArray:(n=r.layers_,n.map((function(t){return t.getLayerState()}))),pixelRatio:1,pixelToCoordinateTransform:[1,0,0,1,0,0],postRenderFunctions:[],size:[0,0],tileQueue:r.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{},mapId:th(r),renderTargets:{}},r.setAttributions((function(t){for(var r=[],n=0,i=e.sources.length;n<i;++n){var o=e.sources[n],a=(o instanceof LS?o:o.getSource()).getAttributions();if("function"==typeof a){var s=a(t);r.push.apply(r,s)}}return 0!==r.length?r:null})),void 0!==e.operation&&r.setOperation(e.operation,e.lib),r}return bO(e,t),e.prototype.setOperation=function(t,e){this.processor_&&this.processor_.dispose(),this.processor_=new xO({operation:t,imageOps:"image"===this.operationType_,queue:1,lib:e,threads:this.threads_}),this.changed()},e.prototype.updateFrameState_=function(t,e,r){var n=Jh({},this.frameState_);n.viewState=Jh({},n.viewState);var i=Rd(t);n.extent=t.slice(),n.size[0]=Math.round(zd(t)/e),n.size[1]=Math.round(Ad(t)/e),n.time=Date.now();var o=n.viewState;return o.center=i,o.projection=r,o.resolution=e,n},e.prototype.allSourcesReady_=function(){for(var t=!0,e=0,r=this.layers_.length;e<r;++e)if("ready"!==this.layers_[e].getSource().getState()){t=!1;break}return t},e.prototype.getImage=function(t,e,r,n){if(!this.allSourcesReady_())return null;var i=this.updateFrameState_(t,e,n);if(this.requestedFrameState_=i,this.renderedImageCanvas_){var o=this.renderedImageCanvas_.getResolution(),a=this.renderedImageCanvas_.getExtent();e===o&&Sd(t,a)||(this.renderedImageCanvas_=null)}return this.renderedImageCanvas_&&this.getRevision()===this.renderedRevision_||this.processSources_(),i.tileQueue.loadMoreTiles(16,16),i.animate&&requestAnimationFrame(this.changed.bind(this)),this.renderedImageCanvas_},e.prototype.processSources_=function(){for(var t=this.requestedFrameState_,e=this.layers_.length,r=new Array(e),n=0;n<e;++n){t.layerIndex=n;var i=kO(this.layers_[n],t);if(!i)return;r[n]=i}var o={};this.dispatchEvent(new CO("beforeoperations",t,o)),this.processor_.process(r,o,this.onWorkerComplete_.bind(this,t))},e.prototype.onWorkerComplete_=function(t,e,r,n){if(!e&&r){var i,o=t.extent,a=t.viewState.resolution;if(a===this.requestedFrameState_.viewState.resolution&&Sd(o,this.requestedFrameState_.extent))this.renderedImageCanvas_?i=this.renderedImageCanvas_.getImage().getContext("2d"):(i=Dh(Math.round(zd(o)/a),Math.round(Ad(o)/a)),this.renderedImageCanvas_=new vS(o,a,1,i.canvas)),i.putImageData(r,0,0),this.changed(),this.renderedRevision_=this.getRevision(),this.dispatchEvent(new CO("afteroperations",t,n)),t.animate&&requestAnimationFrame(this.changed.bind(this))}},e.prototype.disposeInternal=function(){this.processor_&&this.processor_.dispose(),t.prototype.disposeInternal.call(this)},e}(DS);EO.prototype.dispose;var PO=null;function kO(t,e){var r=t.getRenderer();if(!r)throw new Error("Unsupported layer type: "+t);if(!r.prepareFrame(e))return null;var n=e.size[0],i=e.size[1];if(0===n||0===i)return null;var o,a=r.renderFrame(e,null);if(a instanceof HTMLCanvasElement)o=a;else{if(a&&(o=a.firstElementChild),!(o instanceof HTMLCanvasElement))throw new Error("Unsupported rendered element: "+o);if(o.width===n&&o.height===i)return o.getContext("2d").getImageData(0,0,n,i)}if(PO){var s=PO.canvas;s.width!==n||s.height!==i?PO=Dh(n,i):PO.clearRect(0,0,n,i)}else PO=Dh(n,i);return PO.drawImage(o,0,0,n,i),PO.getImageData(0,0,n,i)}const TO=EO;var jO=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),RO=function(t){function e(r){var n=t.call(this,{attributions:r.attributions,cacheSize:r.cacheSize,opaque:r.opaque,projection:r.projection,state:r.state,tileGrid:r.tileGrid,tilePixelRatio:r.tilePixelRatio,wrapX:r.wrapX,transition:r.transition,interpolate:r.interpolate,key:r.key,attributionsCollapsible:r.attributionsCollapsible,zDirection:r.zDirection})||this;return n.generateTileUrlFunction_=n.tileUrlFunction===e.prototype.tileUrlFunction,n.tileLoadFunction=r.tileLoadFunction,r.tileUrlFunction&&(n.tileUrlFunction=r.tileUrlFunction),n.urls=null,r.urls?n.setUrls(r.urls):r.url&&n.setUrl(r.url),n.tileLoadingKeys_={},n}return jO(e,t),e.prototype.getTileLoadFunction=function(){return this.tileLoadFunction},e.prototype.getTileUrlFunction=function(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction},e.prototype.getUrls=function(){return this.urls},e.prototype.handleTileChange=function(t){var e,r=t.target,n=th(r),i=r.getState();1==i?(this.tileLoadingKeys_[n]=!0,e="tileloadstart"):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],e=3==i?"tileloaderror":2==i?"tileloadend":void 0),null!=e&&this.dispatchEvent(new mO(e,r))},e.prototype.setTileLoadFunction=function(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()},e.prototype.setTileUrlFunction=function(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),void 0!==e?this.setKey(e):this.changed()},e.prototype.setUrl=function(t){var e=Im(t);this.urls=e,this.setUrls(e)},e.prototype.setUrls=function(t){this.urls=t;var e=t.join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(Lm(t,this.tileGrid),e):this.setKey(e)},e.prototype.tileUrlFunction=function(t,e,r){},e.prototype.useTile=function(t,e,r){var n=km(t,e,r);this.tileCache.containsKey(n)&&this.tileCache.get(n)},e}(vO);const LO=RO;var IO=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),MO=function(t){function e(e){var r=this,n=void 0===e.imageSmoothing||e.imageSmoothing;return void 0!==e.interpolate&&(n=e.interpolate),(r=t.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:AO,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:n,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection})||this).crossOrigin=void 0!==e.crossOrigin?e.crossOrigin:null,r.tileClass=void 0!==e.tileClass?e.tileClass:XS,r.tileCacheForProjection={},r.tileGridForProjection={},r.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,r.renderReprojectionEdges_=!1,r}return IO(e,t),e.prototype.canExpireCache=function(){if(this.tileCache.canExpireCache())return!0;for(var t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1},e.prototype.expireCache=function(t,e){var r=this.getTileCacheForProjection(t);for(var n in this.tileCache.expireCache(this.tileCache==r?e:{}),this.tileCacheForProjection){var i=this.tileCacheForProjection[n];i.expireCache(i==r?e:{})}},e.prototype.getGutterForProjection=function(t){return this.getProjection()&&t&&!Yg(this.getProjection(),t)?0:this.getGutter()},e.prototype.getGutter=function(){return 0},e.prototype.getKey=function(){var e=t.prototype.getKey.call(this);return this.getInterpolate()||(e+=":disable-interpolation"),e},e.prototype.getOpaque=function(e){return!(this.getProjection()&&e&&!Yg(this.getProjection(),e))&&t.prototype.getOpaque.call(this,e)},e.prototype.getTileGridForProjection=function(t){var e=this.getProjection();if(!this.tileGrid||e&&!Yg(e,t)){var r=th(t);return r in this.tileGridForProjection||(this.tileGridForProjection[r]=fO(t)),this.tileGridForProjection[r]}return this.tileGrid},e.prototype.getTileCacheForProjection=function(t){var e=this.getProjection();if(!e||Yg(e,t))return this.tileCache;var r=th(t);return r in this.tileCacheForProjection||(this.tileCacheForProjection[r]=new sO(this.tileCache.highWaterMark)),this.tileCacheForProjection[r]},e.prototype.createTile_=function(t,e,r,n,i,o){var a=[t,e,r],s=this.getTileCoordForTileUrlFunction(a,i),u=s?this.tileUrlFunction(s,n,i):void 0,l=new this.tileClass(a,void 0!==u?0:4,void 0!==u?u:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return l.key=o,l.addEventListener(ny,this.handleTileChange.bind(this)),l},e.prototype.getTile=function(t,e,r,n,i){var o=this.getProjection();if(o&&i&&!Yg(o,i)){var a=this.getTileCacheForProjection(i),s=[t,e,r],u=void 0,l=Tm(s);a.containsKey(l)&&(u=a.get(l));var c=this.getKey();if(u&&u.key==c)return u;var f=this.getTileGridForProjection(o),p=this.getTileGridForProjection(i),h=this.getTileCoordForTileUrlFunction(s,i),y=new YS(o,f,i,p,s,h,this.getTilePixelRatio(n),this.getGutter(),function(t,e,r,n){return this.getTileInternal(t,e,r,n,o)}.bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.getInterpolate());return y.key=c,u?(y.interimTile=u,y.refreshInterimChain(),a.replace(l,y)):a.set(l,y),y}return this.getTileInternal(t,e,r,n,o||i)},e.prototype.getTileInternal=function(t,e,r,n,i){var o=null,a=km(t,e,r),s=this.getKey();if(this.tileCache.containsKey(a)){if((o=this.tileCache.get(a)).key!=s){var u=o;o=this.createTile_(t,e,r,n,i,s),0==u.getState()?o.interimTile=u.interimTile:o.interimTile=u,o.refreshInterimChain(),this.tileCache.replace(a,o)}}else o=this.createTile_(t,e,r,n,i,s),this.tileCache.set(a,o);return o},e.prototype.setRenderReprojectionEdges=function(t){if(this.renderReprojectionEdges_!=t){for(var e in this.renderReprojectionEdges_=t,this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}},e.prototype.setTileGridForProjection=function(t,e){var r=qg(t);if(r){var n=th(r);n in this.tileGridForProjection||(this.tileGridForProjection[n]=e)}},e}(LO);function AO(t,e){t.getImage().src=e}const DO=MO;var NO,FO=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();NO=Error,FO((function(t){var e=this,r="Unexpected response status: "+t.status;return(e=NO.call(this,r)||this).name="ResponseError",e.response=t,e}),NO),function(t){FO((function(e){var r=t.call(this,"Failed to issue request")||this;return r.name="ClientError",r.client=e,r}),t)}(Error);var zO=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),GO=function(t){function e(e){var r=this,n=void 0===e.imageSmoothing||e.imageSmoothing;if(void 0!==e.interpolate&&(n=e.interpolate),(r=t.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:n,projection:qg("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition,zDirection:e.zDirection})||this).tileJSON_=null,r.tileSize_=e.tileSize,e.url)if(e.jsonp)!function(t,e,r,n){var i=document.createElement("script"),o="olc_"+th(e);function a(){delete window[o],i.parentNode.removeChild(i)}i.async=!0,i.src=t+(-1==t.indexOf("?")?"?":"&")+"callback="+o;var s=setTimeout((function(){a(),r&&r()}),1e4);window[o]=function(t){clearTimeout(s),a(),e(t)},document.head.appendChild(i)}(e.url,r.handleTileJSONResponse.bind(r),r.handleTileJSONError.bind(r));else{var i=new XMLHttpRequest;i.addEventListener("load",r.onXHRLoad_.bind(r)),i.addEventListener("error",r.onXHRError_.bind(r)),i.open("GET",e.url),i.send()}else e.tileJSON?r.handleTileJSONResponse(e.tileJSON):uh(!1,51);return r}return zO(e,t),e.prototype.onXHRLoad_=function(t){var e=t.target;if(!e.status||e.status>=200&&e.status<300){var r=void 0;try{r=JSON.parse(e.responseText)}catch(t){return void this.handleTileJSONError()}this.handleTileJSONResponse(r)}else this.handleTileJSONError()},e.prototype.onXHRError_=function(t){this.handleTileJSONError()},e.prototype.getTileJSON=function(){return this.tileJSON_},e.prototype.handleTileJSONResponse=function(t){var e,r=qg("EPSG:4326"),n=this.getProjection();if(void 0!==t.bounds){var i=Kg(r,n);e=Vd(t.bounds,i)}var o=yO(n),a=t.minzoom||0,s=pO({extent:o,maxZoom:t.maxzoom||22,minZoom:a,tileSize:this.tileSize_});if(this.tileGrid=s,this.tileUrlFunction=Lm(t.tiles,s),void 0!==t.attribution&&!this.getAttributions()){var u=void 0!==e?e:o;this.setAttributions((function(e){return Gd(u,e.extent)?[t.attribution]:null}))}this.tileJSON_=t,this.setState("ready")},e.prototype.handleTileJSONError=function(){this.setState("error")},e}(DO);const BO=GO;var VO=r(2582),UO=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),qO="renderOrder",WO=function(t){function e(e){var r=this,n=e||{},i=Jh({},n);return delete i.style,delete i.renderBuffer,delete i.updateWhileAnimating,delete i.updateWhileInteracting,(r=t.call(this,i)||this).declutter_=void 0!==n.declutter&&n.declutter,r.renderBuffer_=void 0!==n.renderBuffer?n.renderBuffer:100,r.style_=null,r.styleFunction_=void 0,r.setStyle(n.style),r.updateWhileAnimating_=void 0!==n.updateWhileAnimating&&n.updateWhileAnimating,r.updateWhileInteracting_=void 0!==n.updateWhileInteracting&&n.updateWhileInteracting,r}return UO(e,t),e.prototype.getDeclutter=function(){return this.declutter_},e.prototype.getFeatures=function(e){return t.prototype.getFeatures.call(this,e)},e.prototype.getRenderBuffer=function(){return this.renderBuffer_},e.prototype.getRenderOrder=function(){return this.get(qO)},e.prototype.getStyle=function(){return this.style_},e.prototype.getStyleFunction=function(){return this.styleFunction_},e.prototype.getUpdateWhileAnimating=function(){return this.updateWhileAnimating_},e.prototype.getUpdateWhileInteracting=function(){return this.updateWhileInteracting_},e.prototype.renderDeclutter=function(t){t.declutterTree||(t.declutterTree=new VO(9)),this.getRenderer().renderDeclutter(t)},e.prototype.setRenderOrder=function(t){this.set(qO,t)},e.prototype.setStyle=function(t){this.style_=void 0!==t?t:Sm,this.styleFunction_=null===t?void 0:function(t){var e,r;"function"==typeof t?e=t:(Array.isArray(t)?r=t:(uh("function"==typeof t.getZIndex,41),r=[t]),e=function(){return r});return e}(this.style_),this.changed()},e}(v_);const XO=WO;var ZO={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},HO=[ZO.FILL],YO=[ZO.STROKE],KO=[ZO.BEGIN_PATH],JO=[ZO.CLOSE_PATH];const $O=ZO,QO=function(){function t(){}return t.prototype.drawCustom=function(t,e,r,n){},t.prototype.drawGeometry=function(t){},t.prototype.setStyle=function(t){},t.prototype.drawCircle=function(t,e){},t.prototype.drawFeature=function(t,e){},t.prototype.drawGeometryCollection=function(t,e){},t.prototype.drawLineString=function(t,e){},t.prototype.drawMultiLineString=function(t,e){},t.prototype.drawMultiPoint=function(t,e){},t.prototype.drawMultiPolygon=function(t,e){},t.prototype.drawPoint=function(t,e){},t.prototype.drawPolygon=function(t,e){},t.prototype.drawText=function(t,e){},t.prototype.setFillStrokeStyle=function(t,e){},t.prototype.setImageStyle=function(t,e){},t.prototype.setTextStyle=function(t,e){},t}();var tx=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ex=function(t){function e(e,r,n,i){var o=t.call(this)||this;return o.tolerance=e,o.maxExtent=r,o.pixelRatio=i,o.maxLineWidth=0,o.resolution=n,o.beginGeometryInstruction1_=null,o.beginGeometryInstruction2_=null,o.bufferedMaxExtent_=null,o.instructions=[],o.coordinates=[],o.tmpCoordinate_=[],o.hitDetectionInstructions=[],o.state={},o}return tx(e,t),e.prototype.applyPixelRatio=function(t){var e=this.pixelRatio;return 1==e?t:t.map((function(t){return t*e}))},e.prototype.appendFlatPointCoordinates=function(t,e){for(var r=this.getBufferedMaxExtent(),n=this.tmpCoordinate_,i=this.coordinates,o=i.length,a=0,s=t.length;a<s;a+=e)n[0]=t[a],n[1]=t[a+1],yd(r,n)&&(i[o++]=n[0],i[o++]=n[1]);return o},e.prototype.appendFlatLineCoordinates=function(t,e,r,n,i,o){var a=this.coordinates,s=a.length,u=this.getBufferedMaxExtent();o&&(e+=n);var l,c,f,p=t[e],h=t[e+1],y=this.tmpCoordinate_,d=!0;for(l=e+n;l<r;l+=n)y[0]=t[l],y[1]=t[l+1],(f=md(u,y))!==c?(d&&(a[s++]=p,a[s++]=h,d=!1),a[s++]=y[0],a[s++]=y[1]):f===ld.INTERSECTING?(a[s++]=y[0],a[s++]=y[1],d=!1):d=!0,p=y[0],h=y[1],c=f;return(i&&d||l===e+n)&&(a[s++]=p,a[s++]=h),s},e.prototype.drawCustomCoordinates_=function(t,e,r,n,i){for(var o=0,a=r.length;o<a;++o){var s=r[o],u=this.appendFlatLineCoordinates(t,e,s,n,!1,!1);i.push(u),e=s}return e},e.prototype.drawCustom=function(t,e,r,n){this.beginGeometry(t,e);var i,o,a,s,u,l=t.getType(),c=t.getStride(),f=this.coordinates.length;switch(l){case"MultiPolygon":i=t.getOrientedFlatCoordinates(),s=[];var p=t.getEndss();u=0;for(var h=0,y=p.length;h<y;++h){var d=[];u=this.drawCustomCoordinates_(i,u,p[h],c,d),s.push(d)}this.instructions.push([$O.CUSTOM,f,s,t,r,gv]),this.hitDetectionInstructions.push([$O.CUSTOM,f,s,t,n||r,gv]);break;case"Polygon":case"MultiLineString":a=[],i="Polygon"==l?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),u=this.drawCustomCoordinates_(i,0,t.getEnds(),c,a),this.instructions.push([$O.CUSTOM,f,a,t,r,dv]),this.hitDetectionInstructions.push([$O.CUSTOM,f,a,t,n||r,dv]);break;case"LineString":case"Circle":i=t.getFlatCoordinates(),o=this.appendFlatLineCoordinates(i,0,i.length,c,!1,!1),this.instructions.push([$O.CUSTOM,f,o,t,r,yv]),this.hitDetectionInstructions.push([$O.CUSTOM,f,o,t,n||r,yv]);break;case"MultiPoint":i=t.getFlatCoordinates(),(o=this.appendFlatPointCoordinates(i,c))>f&&(this.instructions.push([$O.CUSTOM,f,o,t,r,yv]),this.hitDetectionInstructions.push([$O.CUSTOM,f,o,t,n||r,yv]));break;case"Point":i=t.getFlatCoordinates(),this.coordinates.push(i[0],i[1]),o=this.coordinates.length,this.instructions.push([$O.CUSTOM,f,o,t,r]),this.hitDetectionInstructions.push([$O.CUSTOM,f,o,t,n||r])}this.endGeometry(e)},e.prototype.beginGeometry=function(t,e){this.beginGeometryInstruction1_=[$O.BEGIN_GEOMETRY,e,0,t],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[$O.BEGIN_GEOMETRY,e,0,t],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)},e.prototype.finish=function(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}},e.prototype.reverseHitDetectionInstructions=function(){var t,e=this.hitDetectionInstructions;e.reverse();var r,n,i=e.length,o=-1;for(t=0;t<i;++t)(n=(r=e[t])[0])==$O.END_GEOMETRY?o=t:n==$O.BEGIN_GEOMETRY&&(r[2]=t,Wh(this.hitDetectionInstructions,o,t),o=-1)},e.prototype.setFillStrokeStyle=function(t,e){var r=this.state;if(t){var n=t.getColor();r.fillStyle=Ph(n||Py)}else r.fillStyle=void 0;if(e){var i=e.getColor();r.strokeStyle=Ph(i||Ry);var o=e.getLineCap();r.lineCap=void 0!==o?o:ky;var a=e.getLineDash();r.lineDash=a?a.slice():Ty;var s=e.getLineDashOffset();r.lineDashOffset=s||0;var u=e.getLineJoin();r.lineJoin=void 0!==u?u:jy;var l=e.getWidth();r.lineWidth=void 0!==l?l:1;var c=e.getMiterLimit();r.miterLimit=void 0!==c?c:10,r.lineWidth>this.maxLineWidth&&(this.maxLineWidth=r.lineWidth,this.bufferedMaxExtent_=null)}else r.strokeStyle=void 0,r.lineCap=void 0,r.lineDash=null,r.lineDashOffset=void 0,r.lineJoin=void 0,r.lineWidth=void 0,r.miterLimit=void 0},e.prototype.createFill=function(t){var e=t.fillStyle,r=[$O.SET_FILL_STYLE,e];return"string"!=typeof e&&r.push(!0),r},e.prototype.applyStroke=function(t){this.instructions.push(this.createStroke(t))},e.prototype.createStroke=function(t){return[$O.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]},e.prototype.updateFillStyle=function(t,e){var r=t.fillStyle;"string"==typeof r&&t.currentFillStyle==r||(void 0!==r&&this.instructions.push(e.call(this,t)),t.currentFillStyle=r)},e.prototype.updateStrokeStyle=function(t,e){var r=t.strokeStyle,n=t.lineCap,i=t.lineDash,o=t.lineDashOffset,a=t.lineJoin,s=t.lineWidth,u=t.miterLimit;(t.currentStrokeStyle!=r||t.currentLineCap!=n||i!=t.currentLineDash&&!Zh(t.currentLineDash,i)||t.currentLineDashOffset!=o||t.currentLineJoin!=a||t.currentLineWidth!=s||t.currentMiterLimit!=u)&&(void 0!==r&&e.call(this,t),t.currentStrokeStyle=r,t.currentLineCap=n,t.currentLineDash=i,t.currentLineDashOffset=o,t.currentLineJoin=a,t.currentLineWidth=s,t.currentMiterLimit=u)},e.prototype.endGeometry=function(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;var e=[$O.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)},e.prototype.getBufferedMaxExtent=function(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=pd(this.maxExtent),this.maxLineWidth>0)){var t=this.resolution*(this.maxLineWidth+1)/2;fd(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_},e}(QO);const rx=ex;var nx=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const ix=function(t){function e(e,r,n,i){var o=t.call(this,e,r,n,i)||this;return o.hitDetectionImage_=null,o.image_=null,o.imagePixelRatio_=void 0,o.anchorX_=void 0,o.anchorY_=void 0,o.height_=void 0,o.opacity_=void 0,o.originX_=void 0,o.originY_=void 0,o.rotateWithView_=void 0,o.rotation_=void 0,o.scale_=void 0,o.width_=void 0,o.declutterMode_=void 0,o.declutterImageWithText_=void 0,o}return nx(e,t),e.prototype.drawPoint=function(t,e){if(this.image_){this.beginGeometry(t,e);var r=t.getFlatCoordinates(),n=t.getStride(),i=this.coordinates.length,o=this.appendFlatPointCoordinates(r,n);this.instructions.push([$O.DRAW_IMAGE,i,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([$O.DRAW_IMAGE,i,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}},e.prototype.drawMultiPoint=function(t,e){if(this.image_){this.beginGeometry(t,e);var r=t.getFlatCoordinates(),n=t.getStride(),i=this.coordinates.length,o=this.appendFlatPointCoordinates(r,n);this.instructions.push([$O.DRAW_IMAGE,i,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([$O.DRAW_IMAGE,i,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}},e.prototype.finish=function(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,t.prototype.finish.call(this)},e.prototype.setImageStyle=function(t,e){var r=t.getAnchor(),n=t.getSize(),i=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=r[0],this.anchorY_=r[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=n[1],this.opacity_=t.getOpacity(),this.originX_=i[0],this.originY_=i[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=n[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e},e}(rx);var ox=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ax=function(t){function e(e,r,n,i){return t.call(this,e,r,n,i)||this}return ox(e,t),e.prototype.drawFlatCoordinates_=function(t,e,r,n){var i=this.coordinates.length,o=this.appendFlatLineCoordinates(t,e,r,n,!1,!1),a=[$O.MOVE_TO_LINE_TO,i,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),r},e.prototype.drawLineString=function(t,e){var r=this.state,n=r.strokeStyle,i=r.lineWidth;if(void 0!==n&&void 0!==i){this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([$O.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,Ty,0],KO);var o=t.getFlatCoordinates(),a=t.getStride();this.drawFlatCoordinates_(o,0,o.length,a),this.hitDetectionInstructions.push(YO),this.endGeometry(e)}},e.prototype.drawMultiLineString=function(t,e){var r=this.state,n=r.strokeStyle,i=r.lineWidth;if(void 0!==n&&void 0!==i){this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([$O.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset],KO);for(var o=t.getEnds(),a=t.getFlatCoordinates(),s=t.getStride(),u=0,l=0,c=o.length;l<c;++l)u=this.drawFlatCoordinates_(a,u,o[l],s);this.hitDetectionInstructions.push(YO),this.endGeometry(e)}},e.prototype.finish=function(){var e=this.state;return null!=e.lastStroke&&e.lastStroke!=this.coordinates.length&&this.instructions.push(YO),this.reverseHitDetectionInstructions(),this.state=null,t.prototype.finish.call(this)},e.prototype.applyStroke=function(e){null!=e.lastStroke&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(YO),e.lastStroke=this.coordinates.length),e.lastStroke=0,t.prototype.applyStroke.call(this,e),this.instructions.push(KO)},e}(rx);const sx=ax;var ux=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),lx=function(t){function e(e,r,n,i){return t.call(this,e,r,n,i)||this}return ux(e,t),e.prototype.drawFlatCoordinatess_=function(t,e,r,n){var i=this.state,o=void 0!==i.fillStyle,a=void 0!==i.strokeStyle,s=r.length;this.instructions.push(KO),this.hitDetectionInstructions.push(KO);for(var u=0;u<s;++u){var l=r[u],c=this.coordinates.length,f=this.appendFlatLineCoordinates(t,e,l,n,!0,!a),p=[$O.MOVE_TO_LINE_TO,c,f];this.instructions.push(p),this.hitDetectionInstructions.push(p),a&&(this.instructions.push(JO),this.hitDetectionInstructions.push(JO)),e=l}return o&&(this.instructions.push(HO),this.hitDetectionInstructions.push(HO)),a&&(this.instructions.push(YO),this.hitDetectionInstructions.push(YO)),e},e.prototype.drawCircle=function(t,e){var r=this.state,n=r.fillStyle,i=r.strokeStyle;if(void 0!==n||void 0!==i){this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==r.fillStyle&&this.hitDetectionInstructions.push([$O.SET_FILL_STYLE,Py]),void 0!==r.strokeStyle&&this.hitDetectionInstructions.push([$O.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset]);var o=t.getFlatCoordinates(),a=t.getStride(),s=this.coordinates.length;this.appendFlatLineCoordinates(o,0,o.length,a,!1,!1);var u=[$O.CIRCLE,s];this.instructions.push(KO,u),this.hitDetectionInstructions.push(KO,u),void 0!==r.fillStyle&&(this.instructions.push(HO),this.hitDetectionInstructions.push(HO)),void 0!==r.strokeStyle&&(this.instructions.push(YO),this.hitDetectionInstructions.push(YO)),this.endGeometry(e)}},e.prototype.drawPolygon=function(t,e){var r=this.state,n=r.fillStyle,i=r.strokeStyle;if(void 0!==n||void 0!==i){this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==r.fillStyle&&this.hitDetectionInstructions.push([$O.SET_FILL_STYLE,Py]),void 0!==r.strokeStyle&&this.hitDetectionInstructions.push([$O.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset]);var o=t.getEnds(),a=t.getOrientedFlatCoordinates(),s=t.getStride();this.drawFlatCoordinatess_(a,0,o,s),this.endGeometry(e)}},e.prototype.drawMultiPolygon=function(t,e){var r=this.state,n=r.fillStyle,i=r.strokeStyle;if(void 0!==n||void 0!==i){this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==r.fillStyle&&this.hitDetectionInstructions.push([$O.SET_FILL_STYLE,Py]),void 0!==r.strokeStyle&&this.hitDetectionInstructions.push([$O.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset]);for(var o=t.getEndss(),a=t.getOrientedFlatCoordinates(),s=t.getStride(),u=0,l=0,c=o.length;l<c;++l)u=this.drawFlatCoordinatess_(a,u,o[l],s);this.endGeometry(e)}},e.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.state=null;var e=this.tolerance;if(0!==e)for(var r=this.coordinates,n=0,i=r.length;n<i;++n)r[n]=cv(r[n],e);return t.prototype.finish.call(this)},e.prototype.setFillStrokeStyles_=function(){var t=this.state;void 0!==t.fillStyle&&this.updateFillStyle(t,this.createFill),void 0!==t.strokeStyle&&this.updateStrokeStyle(t,this.applyStroke)},e}(rx);const cx=lx;function fx(t,e,r,n,i){var o,a,s,u,l,c,f,p,h,y=r,d=r,g=0,m=0,v=r;for(o=r;o<n;o+=i){var _=e[o],b=e[o+1];void 0!==u&&(p=_-u,h=b-l,s=Math.sqrt(p*p+h*h),void 0!==c&&(m+=a,Math.acos((c*p+f*h)/(a*s))>t&&(m>g&&(g=m,y=v,d=o),m=0,v=o-i)),a=s,c=p,f=h),u=_,l=b}return(m+=s)>g?[v,o]:[y,d]}var px=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),hx={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},yx=function(t){function e(e,r,n,i){var o=t.call(this,e,r,n,i)||this;return o.labels_=null,o.text_="",o.textOffsetX_=0,o.textOffsetY_=0,o.textRotateWithView_=void 0,o.textRotation_=0,o.textFillState_=null,o.fillStates={},o.textStrokeState_=null,o.strokeStates={},o.textState_={},o.textStates={},o.textKey_="",o.fillKey_="",o.strokeKey_="",o.declutterImageWithText_=void 0,o}return px(e,t),e.prototype.finish=function(){var e=t.prototype.finish.call(this);return e.textStates=this.textStates,e.fillStates=this.fillStates,e.strokeStates=this.strokeStates,e},e.prototype.drawText=function(t,e){var r=this.textFillState_,n=this.textStrokeState_,i=this.textState_;if(""!==this.text_&&i&&(r||n)){var o=this.coordinates,a=o.length,s=t.getType(),u=null,l=t.getStride();if("line"!==i.placement||"LineString"!=s&&"MultiLineString"!=s&&"Polygon"!=s&&"MultiPolygon"!=s){var c=i.overflow?null:[];switch(s){case"Point":case"MultiPoint":u=t.getFlatCoordinates();break;case"LineString":u=t.getFlatMidpoint();break;case"Circle":u=t.getCenter();break;case"MultiLineString":u=t.getFlatMidpoints(),l=2;break;case"Polygon":u=t.getFlatInteriorPoint(),i.overflow||c.push(u[2]/this.resolution),l=3;break;case"MultiPolygon":var f=t.getFlatInteriorPoints();for(u=[],S=0,O=f.length;S<O;S+=3)i.overflow||c.push(f[S+2]/this.resolution),u.push(f[S],f[S+1]);if(0===u.length)return;l=2}if((j=this.appendFlatPointCoordinates(u,l))===a)return;if(c&&(j-a)/2!=u.length/l){var p=a/2;c=c.filter((function(t,e){var r=o[2*(p+e)]===u[e*l]&&o[2*(p+e)+1]===u[e*l+1];return r||--p,r}))}this.saveTextStates_(),(i.backgroundFill||i.backgroundStroke)&&(this.setFillStrokeStyle(i.backgroundFill,i.backgroundStroke),i.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),i.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e);var h=i.padding;if(h!=My&&(i.scale[0]<0||i.scale[1]<0)){var y=i.padding[0],d=i.padding[1],g=i.padding[2],m=i.padding[3];i.scale[0]<0&&(d=-d,m=-m),i.scale[1]<0&&(y=-y,g=-g),h=[y,d,g,m]}var v=this.pixelRatio;this.instructions.push([$O.DRAW_IMAGE,a,j,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,void 0,this.declutterImageWithText_,h==My?My:h.map((function(t){return t*v})),!!i.backgroundFill,!!i.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,c]);var _=1/v;this.hitDetectionInstructions.push([$O.DRAW_IMAGE,a,j,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[_,_],NaN,void 0,this.declutterImageWithText_,h,!!i.backgroundFill,!!i.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,c]),this.endGeometry(e)}else{if(!Gd(this.getBufferedMaxExtent(),t.getExtent()))return;var b=void 0;if(u=t.getFlatCoordinates(),"LineString"==s)b=[u.length];else if("MultiLineString"==s)b=t.getEnds();else if("Polygon"==s)b=t.getEnds().slice(0,1);else if("MultiPolygon"==s){var w=t.getEndss();b=[];for(var S=0,O=w.length;S<O;++S)b.push(w[S][0])}this.beginGeometry(t,e);for(var x=i.textAlign,C=0,E=void 0,P=0,k=b.length;P<k;++P){if(null==x){var T=fx(i.maxAngle,u,C,b[P],l);C=T[0],E=T[1]}else E=b[P];for(S=C;S<E;S+=l)o.push(u[S],u[S+1]);var j=o.length;C=b[P],this.drawChars_(a,j),a=j}this.endGeometry(e)}}},e.prototype.saveTextStates_=function(){var t=this.textStrokeState_,e=this.textState_,r=this.textFillState_,n=this.strokeKey_;t&&(n in this.strokeStates||(this.strokeStates[n]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));var i=this.textKey_;i in this.textStates||(this.textStates[i]={font:e.font,textAlign:e.textAlign||Ly,justify:e.justify,textBaseline:e.textBaseline||Iy,scale:e.scale});var o=this.fillKey_;r&&(o in this.fillStates||(this.fillStates[o]={fillStyle:r.fillStyle}))},e.prototype.drawChars_=function(t,e){var r=this.textStrokeState_,n=this.textState_,i=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();var s=this.pixelRatio,u=hx[n.textBaseline],l=this.textOffsetY_*s,c=this.text_,f=r?r.lineWidth*Math.abs(n.scale[0])/2:0;this.instructions.push([$O.DRAW_CHARS,t,e,u,n.overflow,a,n.maxAngle,s,l,i,f*s,c,o,1]),this.hitDetectionInstructions.push([$O.DRAW_CHARS,t,e,u,n.overflow,a,n.maxAngle,1,l,i,f,c,o,1/s])},e.prototype.setTextStyle=function(t,e){var r,n,i;if(t){var o=t.getFill();o?((n=this.textFillState_)||(n={},this.textFillState_=n),n.fillStyle=Ph(o.getColor()||Py)):(n=null,this.textFillState_=n);var a=t.getStroke();if(a){(i=this.textStrokeState_)||(i={},this.textStrokeState_=i);var s=a.getLineDash(),u=a.getLineDashOffset(),l=a.getWidth(),c=a.getMiterLimit();i.lineCap=a.getLineCap()||ky,i.lineDash=s?s.slice():Ty,i.lineDashOffset=void 0===u?0:u,i.lineJoin=a.getLineJoin()||jy,i.lineWidth=void 0===l?1:l,i.miterLimit=void 0===c?10:c,i.strokeStyle=Ph(a.getColor()||Ry)}else i=null,this.textStrokeState_=i;r=this.textState_;var f=t.getFont()||Ey;Gy(f);var p=t.getScaleArray();r.overflow=t.getOverflow(),r.font=f,r.maxAngle=t.getMaxAngle(),r.placement=t.getPlacement(),r.textAlign=t.getTextAlign(),r.justify=t.getJustify(),r.textBaseline=t.getTextBaseline()||Iy,r.backgroundFill=t.getBackgroundFill(),r.backgroundStroke=t.getBackgroundStroke(),r.padding=t.getPadding()||My,r.scale=void 0===p?[1,1]:p;var h=t.getOffsetX(),y=t.getOffsetY(),d=t.getRotateWithView(),g=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=void 0===h?0:h,this.textOffsetY_=void 0===y?0:y,this.textRotateWithView_=void 0!==d&&d,this.textRotation_=void 0===g?0:g,this.strokeKey_=i?("string"==typeof i.strokeStyle?i.strokeStyle:th(i.strokeStyle))+i.lineCap+i.lineDashOffset+"|"+i.lineWidth+i.lineJoin+i.miterLimit+"["+i.lineDash.join()+"]":"",this.textKey_=r.font+r.scale+(r.textAlign||"?")+(r.justify||"?")+(r.textBaseline||"?"),this.fillKey_=n?"string"==typeof n.fillStyle?n.fillStyle:"|"+th(n.fillStyle):""}else this.text_="";this.declutterImageWithText_=e},e}(rx),dx={Circle:cx,Default:rx,Image:ix,LineString:sx,Polygon:cx,Text:yx};const gx=function(){function t(t,e,r,n){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=n,this.resolution_=r,this.buildersByZIndex_={}}return t.prototype.finish=function(){var t={};for(var e in this.buildersByZIndex_){t[e]=t[e]||{};var r=this.buildersByZIndex_[e];for(var n in r){var i=r[n].finish();t[e][n]=i}}return t},t.prototype.getBuilder=function(t,e){var r=void 0!==t?t.toString():"0",n=this.buildersByZIndex_[r];void 0===n&&(n={},this.buildersByZIndex_[r]=n);var i=n[e];return void 0===i&&(i=new(0,dx[e])(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),n[e]=i),i},t}();function mx(t,e,r,n,i,o,a,s,u,l,c,f){var p=t[e],h=t[e+1],y=0,d=0,g=0,m=0;function v(){y=p,d=h,p=t[e+=n],h=t[e+1],m+=g,g=Math.sqrt((p-y)*(p-y)+(h-d)*(h-d))}do{v()}while(e<r-n&&m+g<o);for(var _=0===g?0:(o-m)/g,b=gh(y,p,_),w=gh(d,h,_),S=e-n,O=m,x=o+s*u(l,i,c);e<r-n&&m+g<x;)v();var C,E=gh(y,p,_=0===g?0:(x-m)/g),P=gh(d,h,_);if(f){var k=[b,w,E,P];ym(k,0,4,2,f,k,k),C=k[0]>k[2]}else C=b>E;var T,j=Math.PI,R=[],L=S+n===e;if(g=0,m=O,p=t[e=S],h=t[e+1],L){v(),T=Math.atan2(h-d,p-y),C&&(T+=T>0?-j:j);var I=(E+b)/2,M=(P+w)/2;return R[0]=[I,M,(x-o)/2,T,i],R}for(var A=0,D=(i=i.replace(/\n/g," ")).length;A<D;){v();var N=Math.atan2(h-d,p-y);if(C&&(N+=N>0?-j:j),void 0!==T){var F=N-T;if(F+=F>j?-2*j:F<-j?2*j:0,Math.abs(F)>a)return null}T=N;for(var z=A,G=0;A<D;++A){var B=s*u(l,i[C?D-A-1:A],c);if(e+n<r&&m+g<o+G+B/2)break;G+=B}if(A!==z){var V=C?i.substring(D-z,D-A):i.substring(z,A);I=gh(y,p,_=0===g?0:(o+G/2-m)/g),M=gh(d,h,_),R.push([I,M,G/2,N,V]),o+=G}}return R}var vx=[1/0,1/0,-1/0,-1/0],_x=[],bx=[],wx=[],Sx=[];function Ox(t){return t[3].declutterBox}var xx=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function Cx(t,e){return"start"!==e&&"end"!==e||xx.test(t)||(e="start"===e?"left":"right"),hx[e]}function Ex(t,e,r){return r>0&&t.push("\n",""),t.push(e,""),t}var Px=function(){function t(t,e,r,n){this.overlaps=r,this.pixelRatio=e,this.resolution=t,this.alignFill_,this.instructions=n.instructions,this.coordinates=n.coordinates,this.coordinateCache_={},this.renderedTransform_=[1,0,0,1,0,0],this.hitDetectionInstructions=n.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=n.fillStates||{},this.strokeStates=n.strokeStates||{},this.textStates=n.textStates||{},this.widths_={},this.labels_={}}return t.prototype.createLabel=function(t,e,r,n){var i=t+e+r+n;if(this.labels_[i])return this.labels_[i];var o=n?this.strokeStates[n]:null,a=r?this.fillStates[r]:null,s=this.textStates[e],u=this.pixelRatio,l=[s.scale[0]*u,s.scale[1]*u],c=Array.isArray(t),f=s.justify?hx[s.justify]:Cx(Array.isArray(t)?t[0]:t,s.textAlign||Ly),p=n&&o.lineWidth?o.lineWidth:0,h=c?t:t.split("\n").reduce(Ex,[]),y=function(t,e){for(var r=[],n=[],i=[],o=0,a=0,s=0,u=0,l=0,c=e.length;l<=c;l+=2){var f=e[l];if("\n"!==f&&l!==c){var p=e[l+1]||t.font,h=Uy(p,f);r.push(h),a+=h;var y=By(p);n.push(y),u=Math.max(u,y)}else o=Math.max(o,a),i.push(a),a=0,s+=u}return{width:o,height:s,widths:r,heights:n,lineWidths:i}}(s,h),d=y.width,g=y.height,m=y.widths,v=y.heights,_=y.lineWidths,b=d+p,w=[],S=(b+2)*l[0],O=(g+p)*l[1],x={width:S<0?Math.floor(S):Math.ceil(S),height:O<0?Math.floor(O):Math.ceil(O),contextInstructions:w};1==l[0]&&1==l[1]||w.push("scale",l),n&&(w.push("strokeStyle",o.strokeStyle),w.push("lineWidth",p),w.push("lineCap",o.lineCap),w.push("lineJoin",o.lineJoin),w.push("miterLimit",o.miterLimit),(Ih?OffscreenCanvasRenderingContext2D:CanvasRenderingContext2D).prototype.setLineDash&&(w.push("setLineDash",[o.lineDash]),w.push("lineDashOffset",o.lineDashOffset))),r&&w.push("fillStyle",a.fillStyle),w.push("textBaseline","middle"),w.push("textAlign","center");for(var C,E=.5-f,P=f*b+E*p,k=[],T=[],j=0,R=0,L=0,I=0,M=0,A=h.length;M<A;M+=2){var D=h[M];if("\n"!==D){var N=h[M+1]||s.font;N!==C&&(n&&k.push("font",N),r&&T.push("font",N),C=N),j=Math.max(j,v[L]);var F=[D,P+E*m[L]+f*(m[L]-_[I]),.5*(p+j)+R];P+=m[L],n&&k.push("strokeText",F),r&&T.push("fillText",F),++L}else R+=j,j=0,P=f*b+E*p,++I}return Array.prototype.push.apply(w,k),Array.prototype.push.apply(w,T),this.labels_[i]=x,x},t.prototype.replayTextBackground_=function(t,e,r,n,i,o,a){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,r),t.lineTo.apply(t,n),t.lineTo.apply(t,i),t.lineTo.apply(t,e),o&&(this.alignFill_=o[2],this.fill_(t)),a&&(this.setStrokeStyle_(t,a),t.stroke())},t.prototype.calculateImageOrLabelDimensions_=function(t,e,r,n,i,o,a,s,u,l,c,f,p,h,y,d){var g,m=r-(a*=f[0]),v=n-(s*=f[1]),_=i+u>t?t-u:i,b=o+l>e?e-l:o,w=h[3]+_*f[0]+h[1],S=h[0]+b*f[1]+h[2],O=m-h[3],x=v-h[0];return(y||0!==c)&&(_x[0]=O,Sx[0]=O,_x[1]=x,bx[1]=x,bx[0]=O+w,wx[0]=bx[0],wx[1]=x+S,Sx[1]=wx[1]),0!==c?(ng(g=og([1,0,0,1,0,0],r,n,1,1,c,-r,-n),_x),ng(g,bx),ng(g,wx),ng(g,Sx),vd(Math.min(_x[0],bx[0],wx[0],Sx[0]),Math.min(_x[1],bx[1],wx[1],Sx[1]),Math.max(_x[0],bx[0],wx[0],Sx[0]),Math.max(_x[1],bx[1],wx[1],Sx[1]),vx)):vd(Math.min(O,O+w),Math.min(x,x+S),Math.max(O,O+w),Math.max(x,x+S),vx),p&&(m=Math.round(m),v=Math.round(v)),{drawImageX:m,drawImageY:v,drawImageW:_,drawImageH:b,originX:u,originY:l,declutterBox:{minX:vx[0],minY:vx[1],maxX:vx[2],maxY:vx[3],value:d},canvasTransform:g,scale:f}},t.prototype.replayImageOrLabel_=function(t,e,r,n,i,o,a){var s=!(!o&&!a),u=n.declutterBox,l=t.canvas,c=a?a[2]*n.scale[0]/2:0;return u.minX-c<=l.width/e&&u.maxX+c>=0&&u.minY-c<=l.height/e&&u.maxY+c>=0&&(s&&this.replayTextBackground_(t,_x,bx,wx,Sx,o,a),function(t,e,r,n,i,o,a,s,u,l,c){t.save(),1!==r&&(t.globalAlpha*=r),e&&t.setTransform.apply(t,e),n.contextInstructions?(t.translate(u,l),t.scale(c[0],c[1]),function(t,e){for(var r=t.contextInstructions,n=0,i=r.length;n<i;n+=2)Array.isArray(r[n+1])?e[r[n]].apply(e,r[n+1]):e[r[n]]=r[n+1]}(n,t)):c[0]<0||c[1]<0?(t.translate(u,l),t.scale(c[0],c[1]),t.drawImage(n,i,o,a,s,0,0,a,s)):t.drawImage(n,i,o,a,s,u,l,a*c[0],s*c[1]),t.restore()}(t,n.canvasTransform,i,r,n.originX,n.originY,n.drawImageW,n.drawImageH,n.drawImageX,n.drawImageY,n.scale)),!0},t.prototype.fill_=function(t){if(this.alignFill_){var e=ng(this.renderedTransform_,[0,0]),r=512*this.pixelRatio;t.save(),t.translate(e[0]%r,e[1]%r),t.rotate(this.viewRotation_)}t.fill(),this.alignFill_&&t.restore()},t.prototype.setStrokeStyle_=function(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.setLineDash&&(t.lineDashOffset=e[7],t.setLineDash(e[6]))},t.prototype.drawLabelWithPointPlacement_=function(t,e,r,n){var i=this.textStates[e],o=this.createLabel(t,e,n,r),a=this.strokeStates[r],s=this.pixelRatio,u=Cx(Array.isArray(t)?t[0]:t,i.textAlign||Ly),l=hx[i.textBaseline||Iy],c=a&&a.lineWidth?a.lineWidth:0;return{label:o,anchorX:u*(o.width/s-2*i.scale[0])+2*(.5-u)*c,anchorY:l*o.height/s+2*(.5-l)*c}},t.prototype.execute_=function(t,e,r,n,i,o,a,s){var u,l,c;this.pixelCoordinates_&&Zh(r,this.renderedTransform_)?u=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),u=hm(this.coordinates,0,this.coordinates.length,2,r,this.pixelCoordinates_),c=r,(l=this.renderedTransform_)[0]=c[0],l[1]=c[1],l[2]=c[2],l[3]=c[3],l[4]=c[4],l[5]=c[5]);for(var f,p,h,y,d,g,m,v,_,b,w,S,O,x,C,E,P=0,k=n.length,T=0,j=0,R=0,L=null,I=null,M=this.coordinateCache_,A=this.viewRotation_,D=Math.round(1e12*Math.atan2(-r[1],r[0]))/1e12,N={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:A},F=this.instructions!=n||this.overlaps?0:200;P<k;){var z=n[P];switch(z[0]){case $O.BEGIN_GEOMETRY:O=z[1],E=z[3],O.getGeometry()?void 0===a||Gd(a,E.getExtent())?++P:P=z[2]+1:P=z[2];break;case $O.BEGIN_PATH:j>F&&(this.fill_(t),j=0),R>F&&(t.stroke(),R=0),j||R||(t.beginPath(),y=NaN,d=NaN),++P;break;case $O.CIRCLE:var G=u[T=z[1]],B=u[T+1],V=u[T+2]-G,U=u[T+3]-B,q=Math.sqrt(V*V+U*U);t.moveTo(G+q,B),t.arc(G,B,q,0,2*Math.PI,!0),++P;break;case $O.CLOSE_PATH:t.closePath(),++P;break;case $O.CUSTOM:T=z[1],f=z[2];var W=z[3],X=z[4],Z=6==z.length?z[5]:void 0;N.geometry=W,N.feature=O,P in M||(M[P]=[]);var H=M[P];Z?Z(u,T,f,2,H):(H[0]=u[T],H[1]=u[T+1],H.length=2),X(H,N),++P;break;case $O.DRAW_IMAGE:T=z[1],f=z[2],v=z[3],p=z[4],h=z[5];var Y=z[6],K=z[7],J=z[8],$=z[9],Q=z[10],tt=z[11],et=z[12],rt=z[13],nt=z[14],it=z[15];if(!v&&z.length>=20){_=z[19],b=z[20],w=z[21],S=z[22];var ot=this.drawLabelWithPointPlacement_(_,b,w,S);v=ot.label,z[3]=v;var at=z[23];p=(ot.anchorX-at)*this.pixelRatio,z[4]=p;var st=z[24];h=(ot.anchorY-st)*this.pixelRatio,z[5]=h,Y=v.height,z[6]=Y,rt=v.width,z[13]=rt}var ut=void 0;z.length>25&&(ut=z[25]);var lt=void 0,ct=void 0,ft=void 0;z.length>17?(lt=z[16],ct=z[17],ft=z[18]):(lt=My,ct=!1,ft=!1),Q&&D?tt+=A:Q||D||(tt-=A);for(var pt=0;T<f;T+=2)if(!(ut&&ut[pt++]<rt/this.pixelRatio)){var ht=[t,e,v,Gt=this.calculateImageOrLabelDimensions_(v.width,v.height,u[T],u[T+1],rt,Y,p,h,J,$,tt,et,i,lt,ct||ft,O),K,ct?L:null,ft?I:null];if(s){if("none"===nt)continue;if("obstacle"===nt){s.insert(Gt.declutterBox);continue}var yt=void 0,dt=void 0;if(it){var gt=f-T;if(!it[gt]){it[gt]=ht;continue}if(yt=it[gt],delete it[gt],dt=Ox(yt),s.collides(dt))continue}if(s.collides(Gt.declutterBox))continue;yt&&(s.insert(dt),this.replayImageOrLabel_.apply(this,yt)),s.insert(Gt.declutterBox)}this.replayImageOrLabel_.apply(this,ht)}++P;break;case $O.DRAW_CHARS:var mt=z[1],vt=z[2],_t=z[3],bt=z[4];S=z[5];var wt=z[6],St=z[7],Ot=z[8];w=z[9];var xt=z[10];_=z[11],b=z[12];var Ct=[z[13],z[13]],Et=this.textStates[b],Pt=Et.font,kt=[Et.scale[0]*St,Et.scale[1]*St],Tt=void 0;Pt in this.widths_?Tt=this.widths_[Pt]:(Tt={},this.widths_[Pt]=Tt);var jt=bv(u,mt,vt,2),Rt=Math.abs(kt[0])*qy(Pt,_,Tt);if(bt||Rt<=jt){var Lt=this.textStates[b].textAlign,It=mx(u,mt,vt,2,_,(jt-Rt)*hx[Lt],wt,Math.abs(kt[0]),qy,Pt,Tt,D?0:this.viewRotation_);t:if(It){var Mt=[],At=void 0,Dt=void 0,Nt=void 0,Ft=void 0,zt=void 0;if(w)for(At=0,Dt=It.length;At<Dt;++At){Nt=(zt=It[At])[4],Ft=this.createLabel(Nt,b,"",w),p=zt[2]+(kt[0]<0?-xt:xt),h=_t*Ft.height+2*(.5-_t)*xt*kt[1]/kt[0]-Ot;var Gt=this.calculateImageOrLabelDimensions_(Ft.width,Ft.height,zt[0],zt[1],Ft.width,Ft.height,p,h,0,0,zt[3],Ct,!1,My,!1,O);if(s&&s.collides(Gt.declutterBox))break t;Mt.push([t,e,Ft,Gt,1,null,null])}if(S)for(At=0,Dt=It.length;At<Dt;++At){if(Nt=(zt=It[At])[4],Ft=this.createLabel(Nt,b,S,""),p=zt[2],h=_t*Ft.height-Ot,Gt=this.calculateImageOrLabelDimensions_(Ft.width,Ft.height,zt[0],zt[1],Ft.width,Ft.height,p,h,0,0,zt[3],Ct,!1,My,!1,O),s&&s.collides(Gt.declutterBox))break t;Mt.push([t,e,Ft,Gt,1,null,null])}s&&s.load(Mt.map(Ox));for(var Bt=0,Vt=Mt.length;Bt<Vt;++Bt)this.replayImageOrLabel_.apply(this,Mt[Bt])}}++P;break;case $O.END_GEOMETRY:if(void 0!==o){var Ut=o(O=z[1],E);if(Ut)return Ut}++P;break;case $O.FILL:F?j++:this.fill_(t),++P;break;case $O.MOVE_TO_LINE_TO:for(T=z[1],f=z[2],x=u[T],m=(C=u[T+1])+.5|0,(g=x+.5|0)===y&&m===d||(t.moveTo(x,C),y=g,d=m),T+=2;T<f;T+=2)g=(x=u[T])+.5|0,m=(C=u[T+1])+.5|0,T!=f-2&&g===y&&m===d||(t.lineTo(x,C),y=g,d=m);++P;break;case $O.SET_FILL_STYLE:L=z,this.alignFill_=z[2],j&&(this.fill_(t),j=0,R&&(t.stroke(),R=0)),t.fillStyle=z[1],++P;break;case $O.SET_STROKE_STYLE:I=z,R&&(t.stroke(),R=0),this.setStrokeStyle_(t,z),++P;break;case $O.STROKE:F?R++:t.stroke(),++P;break;default:++P}}j&&this.fill_(t),R&&t.stroke()},t.prototype.execute=function(t,e,r,n,i,o){this.viewRotation_=n,this.execute_(t,e,r,this.instructions,i,void 0,void 0,o)},t.prototype.executeHitDetection=function(t,e,r,n,i){return this.viewRotation_=r,this.execute_(t,1,e,this.hitDetectionInstructions,!0,n,i)},t}();const kx=Px;var Tx=["Polygon","Circle","LineString","Image","Text","Default"],jx=function(){function t(t,e,r,n,i,o){this.maxExtent_=t,this.overlaps_=n,this.pixelRatio_=r,this.resolution_=e,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=[1,0,0,1,0,0],this.createExecutors_(i)}return t.prototype.clip=function(t,e){var r=this.getClipCoords(e);t.beginPath(),t.moveTo(r[0],r[1]),t.lineTo(r[2],r[3]),t.lineTo(r[4],r[5]),t.lineTo(r[6],r[7]),t.clip()},t.prototype.createExecutors_=function(t){for(var e in t){var r=this.executorsByZIndex_[e];void 0===r&&(r={},this.executorsByZIndex_[e]=r);var n=t[e];for(var i in n){var o=n[i];r[i]=new kx(this.resolution_,this.pixelRatio_,this.overlaps_,o)}}},t.prototype.hasExecutors=function(t){for(var e in this.executorsByZIndex_)for(var r=this.executorsByZIndex_[e],n=0,i=t.length;n<i;++n)if(t[n]in r)return!0;return!1},t.prototype.forEachFeatureAtCoordinate=function(t,e,r,n,i,o){var a=2*(n=Math.round(n))+1,s=og(this.hitDetectionTransform_,n+.5,n+.5,1/e,-1/e,-r,-t[0],-t[1]),u=!this.hitDetectionContext_;u&&(this.hitDetectionContext_=Dh(a,a));var l,c=this.hitDetectionContext_;c.canvas.width!==a||c.canvas.height!==a?(c.canvas.width=a,c.canvas.height=a):u||c.clearRect(0,0,a,a),void 0!==this.renderBuffer_&&(xd(l=[1/0,1/0,-1/0,-1/0],t),fd(l,e*(this.renderBuffer_+n),l));var f,p=function(t){if(void 0!==Rx[t])return Rx[t];for(var e=2*t+1,r=t*t,n=new Array(r+1),i=0;i<=t;++i)for(var o=0;o<=t;++o){var a=i*i+o*o;if(a>r)break;var s=n[a];s||(s=[],n[a]=s),s.push(4*((t+i)*e+(t+o))+3),i>0&&s.push(4*((t-i)*e+(t+o))+3),o>0&&(s.push(4*((t+i)*e+(t-o))+3),i>0&&s.push(4*((t-i)*e+(t-o))+3))}for(var u=[],l=(i=0,n.length);i<l;++i)n[i]&&u.push.apply(u,n[i]);return Rx[t]=u,u}(n);function h(t,e){for(var r=c.getImageData(0,0,a,a).data,s=0,u=p.length;s<u;s++)if(r[p[s]]>0){if(!o||"Image"!==f&&"Text"!==f||-1!==o.indexOf(t)){var l=(p[s]-3)/4,h=n-l%a,y=n-(l/a|0),d=i(t,e,h*h+y*y);if(d)return d}c.clearRect(0,0,a,a);break}}var y,d,g,m,v,_=Object.keys(this.executorsByZIndex_).map(Number);for(_.sort(Uh),y=_.length-1;y>=0;--y){var b=_[y].toString();for(g=this.executorsByZIndex_[b],d=Tx.length-1;d>=0;--d)if(void 0!==(m=g[f=Tx[d]])&&(v=m.executeHitDetection(c,s,r,h,l)))return v}},t.prototype.getClipCoords=function(t){var e=this.maxExtent_;if(!e)return null;var r=e[0],n=e[1],i=e[2],o=e[3],a=[r,n,r,o,i,o,i,n];return hm(a,0,8,2,t,a),a},t.prototype.isEmpty=function(){return ty(this.executorsByZIndex_)},t.prototype.execute=function(t,e,r,n,i,o,a){var s=Object.keys(this.executorsByZIndex_).map(Number);s.sort(Uh),this.maxExtent_&&(t.save(),this.clip(t,r));var u,l,c,f,p,h,y=o||Tx;for(a&&s.reverse(),u=0,l=s.length;u<l;++u){var d=s[u].toString();for(p=this.executorsByZIndex_[d],c=0,f=y.length;c<f;++c)void 0!==(h=p[y[c]])&&h.execute(t,e,r,n,i,a)}this.maxExtent_&&t.restore()},t}(),Rx={};const Lx=jx;var Ix=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Mx=function(t){function e(e,r,n,i,o,a,s){var u=t.call(this)||this;return u.context_=e,u.pixelRatio_=r,u.extent_=n,u.transform_=i,u.viewRotation_=o,u.squaredTolerance_=a,u.userTransform_=s,u.contextFillState_=null,u.contextStrokeState_=null,u.contextTextState_=null,u.fillState_=null,u.strokeState_=null,u.image_=null,u.imageAnchorX_=0,u.imageAnchorY_=0,u.imageHeight_=0,u.imageOpacity_=0,u.imageOriginX_=0,u.imageOriginY_=0,u.imageRotateWithView_=!1,u.imageRotation_=0,u.imageScale_=[0,0],u.imageWidth_=0,u.text_="",u.textOffsetX_=0,u.textOffsetY_=0,u.textRotateWithView_=!1,u.textRotation_=0,u.textScale_=[0,0],u.textFillState_=null,u.textStrokeState_=null,u.textState_=null,u.pixelCoordinates_=[],u.tmpLocalTransform_=[1,0,0,1,0,0],u}return Ix(e,t),e.prototype.drawImages_=function(t,e,r,n){if(this.image_){var i=hm(t,e,r,n,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,s=o.globalAlpha;1!=this.imageOpacity_&&(o.globalAlpha=s*this.imageOpacity_);var u=this.imageRotation_;this.imageRotateWithView_&&(u+=this.viewRotation_);for(var l=0,c=i.length;l<c;l+=2){var f=i[l]-this.imageAnchorX_,p=i[l+1]-this.imageAnchorY_;if(0!==u||1!=this.imageScale_[0]||1!=this.imageScale_[1]){var h=f+this.imageAnchorX_,y=p+this.imageAnchorY_;og(a,h,y,1,1,u,-h,-y),o.setTransform.apply(o,a),o.translate(h,y),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.setTransform(1,0,0,1,0,0)}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,f,p,this.imageWidth_,this.imageHeight_)}1!=this.imageOpacity_&&(o.globalAlpha=s)}},e.prototype.drawText_=function(t,e,r,n){if(this.textState_&&""!==this.text_){this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);var i=hm(t,e,r,n,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.textRotation_;for(this.textRotateWithView_&&(a+=this.viewRotation_);e<r;e+=n){var s=i[e]+this.textOffsetX_,u=i[e+1]+this.textOffsetY_;if(0!==a||1!=this.textScale_[0]||1!=this.textScale_[1]){var l=og(this.tmpLocalTransform_,s,u,1,1,a,-s,-u);o.setTransform.apply(o,l),o.translate(s,u),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.setTransform(1,0,0,1,0,0)}else this.textStrokeState_&&o.strokeText(this.text_,s,u),this.textFillState_&&o.fillText(this.text_,s,u)}}},e.prototype.moveToLineTo_=function(t,e,r,n,i){var o=this.context_,a=hm(t,e,r,n,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);var s=a.length;i&&(s-=2);for(var u=2;u<s;u+=2)o.lineTo(a[u],a[u+1]);return i&&o.closePath(),r},e.prototype.drawRings_=function(t,e,r,n){for(var i=0,o=r.length;i<o;++i)e=this.moveToLineTo_(t,e,r[i],n,!0);return e},e.prototype.drawCircle=function(t){if(Gd(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=function(t,e,r){var n=t.getFlatCoordinates();if(n){var i=t.getStride();return hm(n,0,n.length,i,e,r)}return null}(t,this.transform_,this.pixelCoordinates_),r=e[2]-e[0],n=e[3]-e[1],i=Math.sqrt(r*r+n*n),o=this.context_;o.beginPath(),o.arc(e[0],e[1],i,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}""!==this.text_&&this.drawText_(t.getCenter(),0,2,2)}},e.prototype.setStyle=function(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())},e.prototype.setTransform=function(t){this.transform_=t},e.prototype.drawGeometry=function(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t)}},e.prototype.drawFeature=function(t,e){var r=e.getGeometryFunction()(t);r&&Gd(this.extent_,r.getExtent())&&(this.setStyle(e),this.drawGeometry(r))},e.prototype.drawGeometryCollection=function(t){for(var e=t.getGeometriesArray(),r=0,n=e.length;r<n;++r)this.drawGeometry(e[r])},e.prototype.drawPoint=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getFlatCoordinates(),r=t.getStride();this.image_&&this.drawImages_(e,0,e.length,r),""!==this.text_&&this.drawText_(e,0,e.length,r)},e.prototype.drawMultiPoint=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getFlatCoordinates(),r=t.getStride();this.image_&&this.drawImages_(e,0,e.length,r),""!==this.text_&&this.drawText_(e,0,e.length,r)},e.prototype.drawLineString=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),Gd(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var e=this.context_,r=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(r,0,r.length,t.getStride(),!1),e.stroke()}if(""!==this.text_){var n=t.getFlatMidpoint();this.drawText_(n,0,2,2)}}},e.prototype.drawMultiLineString=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getExtent();if(Gd(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var r=this.context_,n=t.getFlatCoordinates(),i=0,o=t.getEnds(),a=t.getStride();r.beginPath();for(var s=0,u=o.length;s<u;++s)i=this.moveToLineTo_(n,i,o[s],a,!1);r.stroke()}if(""!==this.text_){var l=t.getFlatMidpoints();this.drawText_(l,0,l.length,2)}}},e.prototype.drawPolygon=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),Gd(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){var r=t.getFlatInteriorPoint();this.drawText_(r,0,2,2)}}},e.prototype.drawMultiPolygon=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),Gd(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_,r=t.getOrientedFlatCoordinates(),n=0,i=t.getEndss(),o=t.getStride();e.beginPath();for(var a=0,s=i.length;a<s;++a){var u=i[a];n=this.drawRings_(r,n,u,o)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){var l=t.getFlatInteriorPoints();this.drawText_(l,0,l.length,2)}}},e.prototype.setContextFillState_=function(t){var e=this.context_,r=this.contextFillState_;r?r.fillStyle!=t.fillStyle&&(r.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})},e.prototype.setContextStrokeState_=function(t){var e=this.context_,r=this.contextStrokeState_;r?(r.lineCap!=t.lineCap&&(r.lineCap=t.lineCap,e.lineCap=t.lineCap),e.setLineDash&&(Zh(r.lineDash,t.lineDash)||e.setLineDash(r.lineDash=t.lineDash),r.lineDashOffset!=t.lineDashOffset&&(r.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset)),r.lineJoin!=t.lineJoin&&(r.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),r.lineWidth!=t.lineWidth&&(r.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),r.miterLimit!=t.miterLimit&&(r.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),r.strokeStyle!=t.strokeStyle&&(r.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})},e.prototype.setContextTextState_=function(t){var e=this.context_,r=this.contextTextState_,n=t.textAlign?t.textAlign:Ly;r?(r.font!=t.font&&(r.font=t.font,e.font=t.font),r.textAlign!=n&&(r.textAlign=n,e.textAlign=n),r.textBaseline!=t.textBaseline&&(r.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=n,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:n,textBaseline:t.textBaseline})},e.prototype.setFillStrokeStyle=function(t,e){var r=this;if(t){var n=t.getColor();this.fillState_={fillStyle:Ph(n||Py)}}else this.fillState_=null;if(e){var i=e.getColor(),o=e.getLineCap(),a=e.getLineDash(),s=e.getLineDashOffset(),u=e.getLineJoin(),l=e.getWidth(),c=e.getMiterLimit(),f=a||Ty;this.strokeState_={lineCap:void 0!==o?o:ky,lineDash:1===this.pixelRatio_?f:f.map((function(t){return t*r.pixelRatio_})),lineDashOffset:(s||0)*this.pixelRatio_,lineJoin:void 0!==u?u:jy,lineWidth:(void 0!==l?l:1)*this.pixelRatio_,miterLimit:void 0!==c?c:10,strokeStyle:Ph(i||Ry)}}else this.strokeState_=null},e.prototype.setImageStyle=function(t){var e;if(t&&(e=t.getSize())){var r=t.getAnchor(),n=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=r[0]*this.pixelRatio_,this.imageAnchorY_=r[1]*this.pixelRatio_,this.imageHeight_=e[1]*this.pixelRatio_,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=n[0],this.imageOriginY_=n[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation(),this.imageScale_=t.getScaleArray(),this.imageWidth_=e[0]*this.pixelRatio_}else this.image_=null},e.prototype.setTextStyle=function(t){if(t){var e=t.getFill();if(e){var r=e.getColor();this.textFillState_={fillStyle:Ph(r||Py)}}else this.textFillState_=null;var n=t.getStroke();if(n){var i=n.getColor(),o=n.getLineCap(),a=n.getLineDash(),s=n.getLineDashOffset(),u=n.getLineJoin(),l=n.getWidth(),c=n.getMiterLimit();this.textStrokeState_={lineCap:void 0!==o?o:ky,lineDash:a||Ty,lineDashOffset:s||0,lineJoin:void 0!==u?u:jy,lineWidth:void 0!==l?l:1,miterLimit:void 0!==c?c:10,strokeStyle:Ph(i||Ry)}}else this.textStrokeState_=null;var f=t.getFont(),p=t.getOffsetX(),h=t.getOffsetY(),y=t.getRotateWithView(),d=t.getRotation(),g=t.getScaleArray(),m=t.getText(),v=t.getTextAlign(),_=t.getTextBaseline();this.textState_={font:void 0!==f?f:Ey,textAlign:void 0!==v?v:Ly,textBaseline:void 0!==_?_:Iy},this.text_=void 0!==m?Array.isArray(m)?m.reduce((function(t,e,r){return t+(r%2?" ":e)}),""):m:"",this.textOffsetX_=void 0!==p?this.pixelRatio_*p:0,this.textOffsetY_=void 0!==h?this.pixelRatio_*h:0,this.textRotateWithView_=void 0!==y&&y,this.textRotation_=void 0!==d?d:0,this.textScale_=[this.pixelRatio_*g[0],this.pixelRatio_*g[1]]}else this.text_=""},e}(QO);const Ax=Mx;var Dx=.5;function Nx(t,e,r,n,i,o,a){var s=Dh(t[0]*Dx,t[1]*Dx);s.imageSmoothingEnabled=!1;for(var u=s.canvas,l=new Ax(s,Dx,i,null,a),c=r.length,f=Math.floor(16777215/c),p={},h=1;h<=c;++h){var y=r[h-1],d=y.getStyleFunction()||n;if(n){var g=d(y,o);if(g){Array.isArray(g)||(g=[g]);for(var m="#"+("000000"+(h*f).toString(16)).slice(-6),v=0,_=g.length;v<_;++v){var b=g[v],w=b.getGeometryFunction()(y);if(w&&Gd(i,w.getExtent())){var S=b.clone(),O=S.getFill();O&&O.setColor(m);var x=S.getStroke();x&&(x.setColor(m),x.setLineDash(null)),S.setText(void 0);var C=b.getImage();if(C&&0!==C.getOpacity()){var E=C.getImageSize();if(!E)continue;var P=Dh(E[0],E[1],void 0,{alpha:!1}),k=P.canvas;P.fillStyle=m,P.fillRect(0,0,k.width,k.height),S.setImage(new Jd({img:k,imgSize:E,anchor:C.getAnchor(),anchorXUnits:td,anchorYUnits:td,offset:C.getOrigin(),opacity:1,size:C.getSize(),scale:C.getScale(),rotation:C.getRotation(),rotateWithView:C.getRotateWithView()}))}var T=S.getZIndex()||0;(L=p[T])||(L={},p[T]=L,L.Polygon=[],L.Circle=[],L.LineString=[],L.Point=[]),L[w.getType().replace("Multi","")].push(w,S)}}}}}for(var j=Object.keys(p).map(Number).sort(Uh),R=(h=0,j.length);h<R;++h){var L=p[j[h]];for(var I in L){var M=L[I];for(v=0,_=M.length;v<_;v+=2){l.setStyle(M[v+1]);for(var A=0,D=e.length;A<D;++A)l.setTransform(e[A]),l.drawGeometry(M[v])}}}return s.getImageData(0,0,u.width,u.height)}function Fx(t,e,r){var n=[];if(r){var i=Math.floor(Math.round(t[0])*Dx),o=Math.floor(Math.round(t[1])*Dx),a=4*(lh(i,0,r.width-1)+lh(o,0,r.height-1)*r.width),s=r.data[a],u=r.data[a+1],l=r.data[a+2]+256*(u+256*s),c=Math.floor(16777215/e.length);l&&l%c==0&&n.push(e[l/c-1])}return n}var zx=.5,Gx={Point:function(t,e,r,n,i){var o,a=r.getImage(),s=r.getText();if(a){if(2!=a.getImageState())return;var u=t;if(i){var l=a.getDeclutterMode();if("none"!==l)if(u=i,"obstacle"===l){var c=t.getBuilder(r.getZIndex(),"Image");c.setImageStyle(a,o),c.drawPoint(e,n)}else s&&s.getText()&&(o={})}var f=u.getBuilder(r.getZIndex(),"Image");f.setImageStyle(a,o),f.drawPoint(e,n)}if(s&&s.getText()){var p=t;i&&(p=i);var h=p.getBuilder(r.getZIndex(),"Text");h.setTextStyle(s,o),h.drawText(e,n)}},LineString:function(t,e,r,n,i){var o=r.getStroke();if(o){var a=t.getBuilder(r.getZIndex(),"LineString");a.setFillStrokeStyle(null,o),a.drawLineString(e,n)}var s=r.getText();if(s&&s.getText()){var u=(i||t).getBuilder(r.getZIndex(),"Text");u.setTextStyle(s),u.drawText(e,n)}},Polygon:function(t,e,r,n,i){var o=r.getFill(),a=r.getStroke();if(o||a){var s=t.getBuilder(r.getZIndex(),"Polygon");s.setFillStrokeStyle(o,a),s.drawPolygon(e,n)}var u=r.getText();if(u&&u.getText()){var l=(i||t).getBuilder(r.getZIndex(),"Text");l.setTextStyle(u),l.drawText(e,n)}},MultiPoint:function(t,e,r,n,i){var o,a=r.getImage(),s=r.getText();if(a){if(2!=a.getImageState())return;var u=t;if(i){var l=a.getDeclutterMode();if("none"!==l)if(u=i,"obstacle"===l){var c=t.getBuilder(r.getZIndex(),"Image");c.setImageStyle(a,o),c.drawMultiPoint(e,n)}else s&&s.getText()&&(o={})}var f=u.getBuilder(r.getZIndex(),"Image");f.setImageStyle(a,o),f.drawMultiPoint(e,n)}if(s&&s.getText()){var p=t;i&&(p=i);var h=p.getBuilder(r.getZIndex(),"Text");h.setTextStyle(s,o),h.drawText(e,n)}},MultiLineString:function(t,e,r,n,i){var o=r.getStroke();if(o){var a=t.getBuilder(r.getZIndex(),"LineString");a.setFillStrokeStyle(null,o),a.drawMultiLineString(e,n)}var s=r.getText();if(s&&s.getText()){var u=(i||t).getBuilder(r.getZIndex(),"Text");u.setTextStyle(s),u.drawText(e,n)}},MultiPolygon:function(t,e,r,n,i){var o=r.getFill(),a=r.getStroke();if(a||o){var s=t.getBuilder(r.getZIndex(),"Polygon");s.setFillStrokeStyle(o,a),s.drawMultiPolygon(e,n)}var u=r.getText();if(u&&u.getText()){var l=(i||t).getBuilder(r.getZIndex(),"Text");l.setTextStyle(u),l.drawText(e,n)}},GeometryCollection:function(t,e,r,n,i){var o,a,s=e.getGeometriesArray();for(o=0,a=s.length;o<a;++o)(0,Gx[s[o].getType()])(t,s[o],r,n,i)},Circle:function(t,e,r,n,i){var o=r.getFill(),a=r.getStroke();if(o||a){var s=t.getBuilder(r.getZIndex(),"Circle");s.setFillStrokeStyle(o,a),s.drawCircle(e,n)}var u=r.getText();if(u&&u.getText()){var l=(i||t).getBuilder(r.getZIndex(),"Text");l.setTextStyle(u),l.drawText(e,n)}}};function Bx(t,e){return parseInt(th(t),10)-parseInt(th(e),10)}function Vx(t,e){var r=Ux(t,e);return r*r}function Ux(t,e){return zx*t/e}function qx(t,e,r,n,i,o,a){var s=!1,u=r.getImage();if(u){var l=u.getImageState();2==l||3==l?u.unlistenImageChange(i):(0==l&&u.load(),u.listenImageChange(i),s=!0)}return function(t,e,r,n,i,o){var a=r.getGeometryFunction()(e);if(a){var s=a.simplifyTransformed(n,i);r.getRenderer()?Wx(t,s,r,e):(0,Gx[s.getType()])(t,s,r,e,o)}}(t,e,r,n,o,a),s}function Wx(t,e,r,n){if("GeometryCollection"!=e.getType())t.getBuilder(r.getZIndex(),"Default").drawCustom(e,n,r.getRenderer(),r.getHitDetectionRenderer());else for(var i=e.getGeometries(),o=0,a=i.length;o<a;++o)Wx(t,i[o],r,n)}var Xx=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Zx=function(t){function e(e){var r=t.call(this,e)||this;return r.boundHandleStyleImageChange_=r.handleStyleImageChange_.bind(r),r.animatingOrInteracting_,r.hitDetectionImageData_=null,r.renderedFeatures_=null,r.renderedRevision_=-1,r.renderedResolution_=NaN,r.renderedExtent_=[1/0,1/0,-1/0,-1/0],r.wrappedRenderedExtent_=[1/0,1/0,-1/0,-1/0],r.renderedRotation_,r.renderedCenter_=null,r.renderedProjection_=null,r.renderedRenderOrder_=null,r.replayGroup_=null,r.replayGroupChanged=!0,r.declutterExecutorGroup=null,r.clipping=!0,r.compositionContext_=null,r.opacity_=1,r}return Xx(e,t),e.prototype.renderWorlds=function(t,e,r){var n=e.extent,i=e.viewState,o=i.center,a=i.resolution,s=i.projection,u=i.rotation,l=s.getExtent(),c=this.getLayer().getSource(),f=e.pixelRatio,p=e.viewHints,h=!(p[0]||p[1]),y=this.compositionContext_,d=Math.round(e.size[0]*f),g=Math.round(e.size[1]*f),m=c.getWrapX()&&s.canWrapX(),v=m?zd(l):null,_=m?Math.ceil((n[2]-l[2])/v)+1:1,b=m?Math.floor((n[0]-l[0])/v):0;do{var w=this.getRenderTransform(o,a,u,f,d,g,b*v);t.execute(y,1,w,u,h,void 0,r)}while(++b<_)},e.prototype.setupCompositionContext_=function(){if(1!==this.opacity_){var t=Dh(this.context.canvas.width,this.context.canvas.height,k_);this.compositionContext_=t}else this.compositionContext_=this.context},e.prototype.releaseCompositionContext_=function(){if(1!==this.opacity_){var t=this.context.globalAlpha;this.context.globalAlpha=this.opacity_,this.context.drawImage(this.compositionContext_.canvas,0,0),this.context.globalAlpha=t,Nh(this.compositionContext_),k_.push(this.compositionContext_.canvas),this.compositionContext_=null}},e.prototype.renderDeclutter=function(t){this.declutterExecutorGroup&&(this.setupCompositionContext_(),this.renderWorlds(this.declutterExecutorGroup,t,t.declutterTree),this.releaseCompositionContext_())},e.prototype.renderFrame=function(t,e){var r=t.pixelRatio,n=t.layerStatesArray[t.layerIndex];!function(t,e,r){rg(t,e,0,0,r,0,0)}(this.pixelTransform,1/r,1/r),ag(this.inversePixelTransform,this.pixelTransform);var i=sg(this.pixelTransform);this.useContainer(e,i,this.getBackground(t));var o=this.context,a=o.canvas,s=this.replayGroup_,u=this.declutterExecutorGroup;if((!s||s.isEmpty())&&(!u||u.isEmpty()))return null;var l=Math.round(t.size[0]*r),c=Math.round(t.size[1]*r);a.width!=l||a.height!=c?(a.width=l,a.height=c,a.style.transform!==i&&(a.style.transform=i)):this.containerReused||o.clearRect(0,0,l,c),this.preRender(o,t);var f=t.viewState,p=f.projection;this.opacity_=n.opacity,this.setupCompositionContext_();var h=!1,y=!0;if(n.extent&&this.clipping){var d=um(n.extent,p);(h=(y=Gd(d,t.extent))&&!dd(d,t.extent))&&this.clipUnrotated(this.compositionContext_,t,d)}return y&&this.renderWorlds(s,t),h&&this.compositionContext_.restore(),this.releaseCompositionContext_(),this.postRender(o,t),this.renderedRotation_!==f.rotation&&(this.renderedRotation_=f.rotation,this.hitDetectionImageData_=null),this.container},e.prototype.getFeatures=function(t){return new Promise(function(e){if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){var r=[this.context.canvas.width,this.context.canvas.height];ng(this.pixelTransform,r);var n=this.renderedCenter_,i=this.renderedResolution_,o=this.renderedRotation_,a=this.renderedProjection_,s=this.wrappedRenderedExtent_,u=this.getLayer(),l=[],c=r[0]*Dx,f=r[1]*Dx;l.push(this.getRenderTransform(n,i,o,Dx,c,f,0).slice());var p=u.getSource(),h=a.getExtent();if(p.getWrapX()&&a.canWrapX()&&!dd(h,s)){for(var y=s[0],d=zd(h),g=0,m=void 0;y<h[0];)m=d*--g,l.push(this.getRenderTransform(n,i,o,Dx,c,f,m).slice()),y+=d;for(g=0,y=s[2];y>h[2];)m=d*++g,l.push(this.getRenderTransform(n,i,o,Dx,c,f,m).slice()),y-=d}this.hitDetectionImageData_=Nx(r,l,this.renderedFeatures_,u.getStyleFunction(),s,i,o)}e(Fx(t,this.renderedFeatures_,this.hitDetectionImageData_))}.bind(this))},e.prototype.forEachFeatureAtCoordinate=function(t,e,r,n,i){var o=this;if(this.replayGroup_){var a,s=e.viewState.resolution,u=e.viewState.rotation,l=this.getLayer(),c={},f=function(t,e,r){var o=th(t),a=c[o];if(a){if(!0!==a&&r<a.distanceSq){if(0===r)return c[o]=!0,i.splice(i.lastIndexOf(a),1),n(t,l,e);a.geometry=e,a.distanceSq=r}}else{if(0===r)return c[o]=!0,n(t,l,e);i.push(c[o]={feature:t,layer:l,geometry:e,distanceSq:r,callback:n})}},p=[this.replayGroup_];return this.declutterExecutorGroup&&p.push(this.declutterExecutorGroup),p.some((function(n){return a=n.forEachFeatureAtCoordinate(t,s,u,r,f,n===o.declutterExecutorGroup&&e.declutterTree?e.declutterTree.all().map((function(t){return t.value})):null)})),a}},e.prototype.handleFontsChanged=function(){var t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()},e.prototype.handleStyleImageChange_=function(t){this.renderIfReadyAndVisible()},e.prototype.prepareFrame=function(t){var e=this.getLayer(),r=e.getSource();if(!r)return!1;var n=t.viewHints[0],i=t.viewHints[1],o=e.getUpdateWhileAnimating(),a=e.getUpdateWhileInteracting();if(this.ready&&!o&&n||!a&&i)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;var s=t.extent,u=t.viewState,l=u.projection,c=u.resolution,f=t.pixelRatio,p=e.getRevision(),h=e.getRenderBuffer(),y=e.getRenderOrder();void 0===y&&(y=Bx);var d=u.center.slice(),g=fd(s,h*c),m=g.slice(),v=[g.slice()],_=l.getExtent();if(r.getWrapX()&&l.canWrapX()&&!dd(_,t.extent)){var b=zd(_),w=Math.max(zd(g)/2,b);g[0]=_[0]-w,g[2]=_[2]+w,Dg(d,l);var S=Ud(v[0],l);S[0]<_[0]&&S[2]<_[2]?v.push([S[0]+b,S[1],S[2]+b,S[3]]):S[0]>_[0]&&S[2]>_[2]&&v.push([S[0]-b,S[1],S[2]-b,S[3]])}if(this.ready&&this.renderedResolution_==c&&this.renderedRevision_==p&&this.renderedRenderOrder_==y&&dd(this.wrappedRenderedExtent_,g))return Zh(this.renderedExtent_,m)||(this.hitDetectionImageData_=null,this.renderedExtent_=m),this.renderedCenter_=d,this.replayGroupChanged=!1,!0;this.replayGroup_=null;var O,x=new gx(Ux(c,f),g,c,f);this.getLayer().getDeclutter()&&(O=new gx(Ux(c,f),g,c,f));var C,E=im();if(E){for(var P=0,k=v.length;P<k;++P){var T=sm(v[P],l);r.loadFeatures(T,lm(c,l),E)}C=Kg(E,l)}else for(P=0,k=v.length;P<k;++P)r.loadFeatures(v[P],c,l);var j=Vx(c,f),R=!0,L=function(t){var r,n=t.getStyleFunction()||e.getStyleFunction();if(n&&(r=n(t,c)),r){var i=this.renderFeature(t,j,r,x,C,O);R=R&&!i}}.bind(this),I=sm(g,l),M=r.getFeaturesInExtent(I);for(y&&M.sort(y),P=0,k=M.length;P<k;++P)L(M[P]);this.renderedFeatures_=M,this.ready=R;var A=x.finish(),D=new Lx(g,c,f,r.getOverlaps(),A,e.getRenderBuffer());return O&&(this.declutterExecutorGroup=new Lx(g,c,f,r.getOverlaps(),O.finish(),e.getRenderBuffer())),this.renderedResolution_=c,this.renderedRevision_=p,this.renderedRenderOrder_=y,this.renderedExtent_=m,this.wrappedRenderedExtent_=g,this.renderedCenter_=d,this.renderedProjection_=l,this.replayGroup_=D,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0},e.prototype.renderFeature=function(t,e,r,n,i,o){if(!r)return!1;var a=!1;if(Array.isArray(r))for(var s=0,u=r.length;s<u;++s)a=qx(n,t,r[s],e,this.boundHandleStyleImageChange_,i,o)||a;else a=qx(n,t,r,e,this.boundHandleStyleImageChange_,i,o);return a},e}(R_);const Hx=Zx;var Yx=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const Kx=function(t){function e(e){return t.call(this,e)||this}return Yx(e,t),e.prototype.createRenderer=function(){return new Hx(this)},e}(XO),Jx=function(){function t(t){this.rbush_=new VO(t),this.items_={}}return t.prototype.insert=function(t,e){var r={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(r),this.items_[th(e)]=r},t.prototype.load=function(t,e){for(var r=new Array(e.length),n=0,i=e.length;n<i;n++){var o=t[n],a=e[n],s={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:a};r[n]=s,this.items_[th(a)]=s}this.rbush_.load(r)},t.prototype.remove=function(t){var e=th(t),r=this.items_[e];return delete this.items_[e],null!==this.rbush_.remove(r)},t.prototype.update=function(t,e){var r=this.items_[th(e)];Sd([r.minX,r.minY,r.maxX,r.maxY],t)||(this.remove(e),this.insert(t,e))},t.prototype.getAll=function(){return this.rbush_.all().map((function(t){return t.value}))},t.prototype.getInExtent=function(t){var e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map((function(t){return t.value}))},t.prototype.forEach=function(t){return this.forEach_(this.getAll(),t)},t.prototype.forEachInExtent=function(t,e){return this.forEach_(this.getInExtent(t),e)},t.prototype.forEach_=function(t,e){for(var r,n=0,i=t.length;n<i;n++)if(r=e(t[n]))return r;return r},t.prototype.isEmpty=function(){return ty(this.items_)},t.prototype.clear=function(){this.rbush_.clear(),this.items_={}},t.prototype.getExtent=function(t){var e=this.rbush_.toJSON();return vd(e.minX,e.minY,e.maxX,e.maxY,t)},t.prototype.concat=function(t){for(var e in this.rbush_.load(t.rbush_.all()),t.items_)this.items_[e]=t.items_[e]},t}(),$x="addfeature",Qx="removefeature";function tC(t,e){return[[-1/0,-1/0,1/0,1/0]]}function eC(t,e){return[t]}var rC=!1;function nC(t,e,r,n,i,o,a){var s=new XMLHttpRequest;s.open("GET","function"==typeof t?t(r,n,i):t,!0),"arraybuffer"==e.getType()&&(s.responseType="arraybuffer"),s.withCredentials=rC,s.onload=function(t){if(!s.status||s.status>=200&&s.status<300){var n=e.getType(),u=void 0;"json"==n||"text"==n?u=s.responseText:"xml"==n?(u=s.responseXML)||(u=(new DOMParser).parseFromString(s.responseText,"application/xml")):"arraybuffer"==n&&(u=s.response),u?o(e.readFeatures(u,{extent:r,featureProjection:i}),e.readProjection(u)):a()}else a()},s.onerror=a,s.send()}function iC(t,e){return function(r,n,i,o,a){var s=this;nC(t,e,r,n,i,(function(t,e){s.addFeatures(t),void 0!==o&&o(t)}),a||Kh)}}var oC=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),aC=function(t){function e(e,r,n){var i=t.call(this,e)||this;return i.feature=r,i.features=n,i}return oC(e,t),e}(Gh),sC=function(t){function e(e){var r=this,n=e||{};(r=t.call(this,{attributions:n.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:void 0===n.wrapX||n.wrapX})||this).on,r.once,r.un,r.loader_=Kh,r.format_=n.format,r.overlaps_=void 0===n.overlaps||n.overlaps,r.url_=n.url,void 0!==n.loader?r.loader_=n.loader:void 0!==r.url_&&(uh(r.format_,7),r.loader_=iC(r.url_,r.format_)),r.strategy_=void 0!==n.strategy?n.strategy:tC;var i,o,a=void 0===n.useSpatialIndex||n.useSpatialIndex;return r.featuresRtree_=a?new Jx:null,r.loadedExtentsRtree_=new Jx,r.loadingExtentsCount_=0,r.nullGeometryFeatures_={},r.idIndex_={},r.uidIndex_={},r.featureChangeKeys_={},r.featuresCollection_=null,Array.isArray(n.features)?o=n.features:n.features&&(o=(i=n.features).getArray()),a||void 0!==i||(i=new ob(o)),void 0!==o&&r.addFeaturesInternal(o),void 0!==i&&r.bindFeaturesCollection_(i),r}return oC(e,t),e.prototype.addFeature=function(t){this.addFeatureInternal(t),this.changed()},e.prototype.addFeatureInternal=function(t){var e=th(t);if(this.addToIndex_(e,t)){this.setupChangeEvents_(e,t);var r=t.getGeometry();if(r){var n=r.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(n,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new aC($x,t))}else this.featuresCollection_&&this.featuresCollection_.remove(t)},e.prototype.setupChangeEvents_=function(t,e){this.featureChangeKeys_[t]=[cy(e,ny,this.handleFeatureChange_,this),cy(e,Bh,this.handleFeatureChange_,this)]},e.prototype.addToIndex_=function(t,e){var r=!0,n=e.getId();return void 0!==n&&(n.toString()in this.idIndex_?r=!1:this.idIndex_[n.toString()]=e),r&&(uh(!(t in this.uidIndex_),30),this.uidIndex_[t]=e),r},e.prototype.addFeatures=function(t){this.addFeaturesInternal(t),this.changed()},e.prototype.addFeaturesInternal=function(t){for(var e=[],r=[],n=[],i=0,o=t.length;i<o;i++){var a=th(u=t[i]);this.addToIndex_(a,u)&&r.push(u)}i=0;for(var s=r.length;i<s;i++){var u;a=th(u=r[i]),this.setupChangeEvents_(a,u);var l=u.getGeometry();if(l){var c=l.getExtent();e.push(c),n.push(u)}else this.nullGeometryFeatures_[a]=u}if(this.featuresRtree_&&this.featuresRtree_.load(e,n),this.hasListener($x)){i=0;for(var f=r.length;i<f;i++)this.dispatchEvent(new aC($x,r[i]))}},e.prototype.bindFeaturesCollection_=function(t){var e=!1;this.addEventListener($x,(function(r){e||(e=!0,t.push(r.feature),e=!1)})),this.addEventListener(Qx,(function(r){e||(e=!0,t.remove(r.feature),e=!1)})),t.addEventListener(Q_,function(t){e||(e=!0,this.addFeature(t.element),e=!1)}.bind(this)),t.addEventListener(tb,function(t){e||(e=!0,this.removeFeature(t.element),e=!1)}.bind(this)),this.featuresCollection_=t},e.prototype.clear=function(t){if(t){for(var e in this.featureChangeKeys_)this.featureChangeKeys_[e].forEach(py);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){var r=function(t){this.removeFeatureInternal(t)}.bind(this);for(var n in this.featuresRtree_.forEach(r),this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[n])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};var i=new aC("clear");this.dispatchEvent(i),this.changed()},e.prototype.forEachFeature=function(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)},e.prototype.forEachFeatureAtCoordinateDirect=function(t,e){var r=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(r,(function(r){return r.getGeometry().intersectsCoordinate(t)?e(r):void 0}))},e.prototype.forEachFeatureInExtent=function(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)},e.prototype.forEachFeatureIntersectingExtent=function(t,e){return this.forEachFeatureInExtent(t,(function(r){if(r.getGeometry().intersectsExtent(t)){var n=e(r);if(n)return n}}))},e.prototype.getFeaturesCollection=function(){return this.featuresCollection_},e.prototype.getFeatures=function(){var t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),ty(this.nullGeometryFeatures_)||Xh(t,Qh(this.nullGeometryFeatures_))),t},e.prototype.getFeaturesAtCoordinate=function(t){var e=[];return this.forEachFeatureAtCoordinateDirect(t,(function(t){e.push(t)})),e},e.prototype.getFeaturesInExtent=function(t,e){var r=this;if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);var n=function(t,e){if(e.canWrapX()){var r=e.getExtent();if(!isFinite(t[0])||!isFinite(t[2]))return[[r[0],t[1],r[2],t[3]]];Ud(t,e);var n=zd(r);if(zd(t)>n)return[[r[0],t[1],r[2],t[3]]];if(t[0]<r[0])return[[t[0]+n,t[1],r[2],t[3]],[r[0],t[1],t[2],t[3]]];if(t[2]>r[2])return[[t[0],t[1],r[2],t[3]],[r[0],t[1],t[2]-n,t[3]]]}return[t]}(t,e);return[].concat.apply([],n.map((function(t){return r.featuresRtree_.getInExtent(t)})))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]},e.prototype.getClosestFeatureToCoordinate=function(t,e){var r=t[0],n=t[1],i=null,o=[NaN,NaN],a=1/0,s=[-1/0,-1/0,1/0,1/0],u=e||Hh;return this.featuresRtree_.forEachInExtent(s,(function(t){if(u(t)){var e=t.getGeometry(),l=a;if((a=e.closestPointXY(r,n,o,a))<l){i=t;var c=Math.sqrt(a);s[0]=r-c,s[1]=n-c,s[2]=r+c,s[3]=n+c}}})),i},e.prototype.getExtent=function(t){return this.featuresRtree_.getExtent(t)},e.prototype.getFeatureById=function(t){var e=this.idIndex_[t.toString()];return void 0!==e?e:null},e.prototype.getFeatureByUid=function(t){var e=this.uidIndex_[t];return void 0!==e?e:null},e.prototype.getFormat=function(){return this.format_},e.prototype.getOverlaps=function(){return this.overlaps_},e.prototype.getUrl=function(){return this.url_},e.prototype.handleFeatureChange_=function(t){var e=t.target,r=th(e),n=e.getGeometry();if(n){var i=n.getExtent();r in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[r],this.featuresRtree_&&this.featuresRtree_.insert(i,e)):this.featuresRtree_&&this.featuresRtree_.update(i,e)}else r in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[r]=e);var o=e.getId();if(void 0!==o){var a=o.toString();this.idIndex_[a]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[a]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[r]=e;this.changed(),this.dispatchEvent(new aC("changefeature",e))},e.prototype.hasFeature=function(t){var e=t.getId();return void 0!==e?e in this.idIndex_:th(t)in this.uidIndex_},e.prototype.isEmpty=function(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&ty(this.nullGeometryFeatures_):!this.featuresCollection_||0===this.featuresCollection_.getLength()},e.prototype.loadFeatures=function(t,e,r){for(var n=this.loadedExtentsRtree_,i=this.strategy_(t,e,r),o=function(t,o){var s=i[t];n.forEachInExtent(s,(function(t){return dd(t.extent,s)}))||(++a.loadingExtentsCount_,a.dispatchEvent(new aC("featuresloadstart")),a.loader_.call(a,s,e,r,function(t){--this.loadingExtentsCount_,this.dispatchEvent(new aC("featuresloadend",void 0,t))}.bind(a),function(){--this.loadingExtentsCount_,this.dispatchEvent(new aC("featuresloaderror"))}.bind(a)),n.insert(s,{extent:s.slice()}))},a=this,s=0,u=i.length;s<u;++s)o(s);this.loading=!(this.loader_.length<4)&&this.loadingExtentsCount_>0},e.prototype.refresh=function(){this.clear(!0),this.loadedExtentsRtree_.clear(),t.prototype.refresh.call(this)},e.prototype.removeLoadedExtent=function(t){var e,r=this.loadedExtentsRtree_;r.forEachInExtent(t,(function(r){if(Sd(r.extent,t))return e=r,!0})),e&&r.remove(e)},e.prototype.removeFeature=function(t){if(t){var e=th(t);e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.removeFeatureInternal(t)&&this.changed()}},e.prototype.removeFeatureInternal=function(t){var e=th(t),r=this.featureChangeKeys_[e];if(r){r.forEach(py),delete this.featureChangeKeys_[e];var n=t.getId();return void 0!==n&&delete this.idIndex_[n.toString()],delete this.uidIndex_[e],this.dispatchEvent(new aC(Qx,t)),t}},e.prototype.removeFromIdIndex_=function(t){var e=!1;for(var r in this.idIndex_)if(this.idIndex_[r]===t){delete this.idIndex_[r],e=!0;break}return e},e.prototype.setLoader=function(t){this.loader_=t},e.prototype.setUrl=function(t){uh(this.format_,7),this.url_=t,this.setLoader(iC(t,this.format_))},e}(LS);const uC=sC,lC="hybrid",cC="vector";var fC=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),pC={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},hC={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]},yC=function(t){function e(e){var r=t.call(this,e)||this;return r.boundHandleStyleImageChange_=r.handleStyleImageChange_.bind(r),r.renderedLayerRevision_,r.renderedPixelToCoordinateTransform_=null,r.renderedRotation_,r.tmpTransform_=[1,0,0,1,0,0],r}return fC(e,t),e.prototype.prepareTile=function(t,e,r){var n,i=t.getState();return 2!==i&&3!==i||(this.updateExecutorGroup_(t,e,r),this.tileImageNeedsRender_(t)&&(n=!0)),n},e.prototype.getTile=function(e,r,n,i){var o=i.pixelRatio,a=i.viewState,s=a.resolution,u=a.projection,l=this.getLayer(),c=l.getSource().getTile(e,r,n,o,u),f=i.viewHints,p=!(f[0]||f[1]);return!p&&c.wantedResolution||(c.wantedResolution=s),this.prepareTile(c,o,u)&&(p||Date.now()-i.time<8)&&l.getRenderMode()!==cC&&this.renderTileImage_(c,i),t.prototype.getTile.call(this,e,r,n,i)},e.prototype.isDrawableTile=function(e){var r=this.getLayer();return t.prototype.isDrawableTile.call(this,e)&&(r.getRenderMode()===cC?th(r)in e.executorGroups:e.hasContext(r))},e.prototype.getTileImage=function(t){return t.getImage(this.getLayer())},e.prototype.prepareFrame=function(e){var r=this.getLayer().getRevision();return this.renderedLayerRevision_!==r&&(this.renderedLayerRevision_=r,this.renderedTiles.length=0),t.prototype.prepareFrame.call(this,e)},e.prototype.updateExecutorGroup_=function(t,e,r){var n=this.getLayer(),i=n.getRevision(),o=n.getRenderOrder()||null,a=t.wantedResolution,s=t.getReplayState(n);if(s.dirty||s.renderedResolution!==a||s.renderedRevision!=i||s.renderedRenderOrder!=o){var u=n.getSource(),l=n.getDeclutter(),c=u.getTileGrid(),f=u.getTileGridForProjection(r).getTileCoordExtent(t.wrappedTileCoord),p=u.getSourceTiles(e,r,t),h=th(n);delete t.hitDetectionImageData[h],t.executorGroups[h]=[],l&&(t.declutterExecutorGroups[h]=[]),s.dirty=!1;for(var y=function(r,i){var y=p[r];if(2!=y.getState())return"continue";var g=y.tileCoord,m=c.getTileCoordExtent(g),v=Dd(f,m),_=fd(v,n.getRenderBuffer()*a,d.tmpExtent),b=Sd(m,v)?null:_,w=new gx(0,_,a,e),S=l?new gx(0,v,a,e):void 0,O=Vx(a,e),x=function(t){var e,r=t.getStyleFunction()||n.getStyleFunction();if(r&&(e=r(t,a)),e){var i=this.renderFeature(t,O,e,w,S);s.dirty=s.dirty||i}},C=y.getFeatures();o&&o!==s.renderedRenderOrder&&C.sort(o);for(var E=0,P=C.length;E<P;++E){var k=C[E];b&&!Gd(b,k.getGeometry().getExtent())||x.call(d,k)}var T=w.finish(),j=n.getRenderMode()!==cC&&l&&1===p.length?null:v,R=new Lx(j,a,e,u.getOverlaps(),T,n.getRenderBuffer());if(t.executorGroups[h].push(R),S){var L=new Lx(null,a,e,u.getOverlaps(),S.finish(),n.getRenderBuffer());t.declutterExecutorGroups[h].push(L)}},d=this,g=0,m=p.length;g<m;++g)y(g);s.renderedRevision=i,s.renderedRenderOrder=o,s.renderedResolution=a}},e.prototype.forEachFeatureAtCoordinate=function(t,e,r,n,i){var o=e.viewState.resolution,a=e.viewState.rotation;r=null==r?0:r;var s=this.getLayer(),u=s.getSource().getTileGridForProjection(e.viewState.projection),l=cd([t]);fd(l,o*r,l);for(var c,f={},p=function(t,e,r){var o=t.getId();void 0===o&&(o=th(t));var a=f[o];if(a){if(!0!==a&&r<a.distanceSq){if(0===r)return f[o]=!0,i.splice(i.lastIndexOf(a),1),n(t,s,e);a.geometry=e,a.distanceSq=r}}else{if(0===r)return f[o]=!0,n(t,s,e);i.push(f[o]={feature:t,layer:s,geometry:e,distanceSq:r,callback:n})}},h=this.renderedTiles,y=function(n,i){var f=h[n];if(!Gd(u.getTileCoordExtent(f.wrappedTileCoord),l))return"continue";var y=th(s),d=[f.executorGroups[y]],g=f.declutterExecutorGroups[y];g&&d.push(g),d.some((function(n){for(var i=n===g?e.declutterTree.all().map((function(t){return t.value})):null,s=0,u=n.length;s<u;++s){var l=n[s];if(c=l.forEachFeatureAtCoordinate(t,o,a,r,p,i))return!0}}))},d=0,g=h.length;!c&&d<g;++d)y(d);return c},e.prototype.getFeatures=function(t){return new Promise(function(e,r){for(var n,i=this.getLayer(),o=th(i),a=i.getSource(),s=this.renderedProjection,u=s.getExtent(),l=this.renderedResolution,c=a.getTileGridForProjection(s),f=ng(this.renderedPixelToCoordinateTransform_,t.slice()),p=c.getTileCoordForCoordAndResolution(f,l),h=0,y=this.renderedTiles.length;h<y;++h)if(p.toString()===this.renderedTiles[h].tileCoord.toString()){if(2===(n=this.renderedTiles[h]).getState()){var d=c.getTileCoordExtent(n.tileCoord);a.getWrapX()&&s.canWrapX()&&!dd(u,d)&&Dg(f,s);break}n=void 0}if(!n||n.loadingSourceTiles>0)e([]);else{var g=Nd(c.getTileCoordExtent(n.wrappedTileCoord)),m=[(f[0]-g[0])/l,(g[1]-f[1])/l],v=n.getSourceTiles().reduce((function(t,e){return t.concat(e.getFeatures())}),[]),_=n.hitDetectionImageData[o];if(!_&&!this.animatingOrInteracting_){var b=rh(c.getTileSize(c.getZForResolution(l,a.zDirection))),w=this.renderedRotation_;_=Nx(b,[this.getRenderTransform(c.getTileCoordCenter(n.wrappedTileCoord),l,0,Dx,b[0]*Dx,b[1]*Dx,0)],v,i.getStyleFunction(),c.getTileCoordExtent(n.wrappedTileCoord),n.getReplayState(i).renderedResolution,w),n.hitDetectionImageData[o]=_}e(Fx(m,v,_))}}.bind(this))},e.prototype.handleFontsChanged=function(){var t=this.getLayer();t.getVisible()&&void 0!==this.renderedLayerRevision_&&t.changed()},e.prototype.handleStyleImageChange_=function(t){this.renderIfReadyAndVisible()},e.prototype.renderDeclutter=function(t){var e=this.context,r=e.globalAlpha;e.globalAlpha=this.getLayer().getOpacity();for(var n=t.viewHints,i=!(n[0]||n[1]),o=this.renderedTiles,a=0,s=o.length;a<s;++a){var u=o[a],l=u.declutterExecutorGroups[th(this.getLayer())];if(l)for(var c=l.length-1;c>=0;--c)l[c].execute(this.context,1,this.getTileRenderTransform(u,t),t.viewState.rotation,i,void 0,t.declutterTree)}e.globalAlpha=r},e.prototype.getTileRenderTransform=function(t,e){var r=e.pixelRatio,n=e.viewState,i=n.center,o=n.resolution,a=n.rotation,s=e.size,u=Math.round(s[0]*r),l=Math.round(s[1]*r),c=this.getLayer().getSource().getTileGridForProjection(e.viewState.projection),f=t.tileCoord,p=c.getTileCoordExtent(t.wrappedTileCoord),h=c.getTileCoordExtent(f,this.tmpExtent)[0]-p[0];return eg(ig(this.inversePixelTransform.slice(),1/r,1/r),this.getRenderTransform(i,o,a,r,u,l,h))},e.prototype.renderFrame=function(e,r){var n=e.viewHints,i=!(n[0]||n[1]);t.prototype.renderFrame.call(this,e,r),this.renderedPixelToCoordinateTransform_=e.pixelToCoordinateTransform.slice(),this.renderedRotation_=e.viewState.rotation;var o=this.getLayer(),a=o.getRenderMode(),s=this.context,u=s.globalAlpha;s.globalAlpha=o.getOpacity();for(var l=hC[a],c=e.viewState,f=c.rotation,p=o.getSource(),h=p.getTileGridForProjection(c.projection).getZForResolution(c.resolution,p.zDirection),y=this.renderedTiles,d=[],g=[],m=!0,v=y.length-1;v>=0;--v){var _=y[v];m=m&&!_.getReplayState(o).dirty;var b=_.executorGroups[th(o)].filter((function(t){return t.hasExecutors(l)}));if(0!==b.length){var w=this.getTileRenderTransform(_,e),S=_.tileCoord[0],O=!1,x=b[0].getClipCoords(w);if(x){for(var C=0,E=d.length;C<E;++C)if(h!==S&&S<g[C]){var P=d[C];Gd([x[0],x[3],x[4],x[7]],[P[0],P[3],P[4],P[7]])&&(O||(s.save(),O=!0),s.beginPath(),s.moveTo(x[0],x[1]),s.lineTo(x[2],x[3]),s.lineTo(x[4],x[5]),s.lineTo(x[6],x[7]),s.moveTo(P[6],P[7]),s.lineTo(P[4],P[5]),s.lineTo(P[2],P[3]),s.lineTo(P[0],P[1]),s.clip())}d.push(x),g.push(S)}for(var k=0,T=b.length;k<T;++k)b[k].execute(s,1,w,f,i,l);O&&s.restore()}}return s.globalAlpha=u,this.ready=m,this.container},e.prototype.renderFeature=function(t,e,r,n,i){if(!r)return!1;var o=!1;if(Array.isArray(r))for(var a=0,s=r.length;a<s;++a)o=qx(n,t,r[a],e,this.boundHandleStyleImageChange_,void 0,i)||o;else o=qx(n,t,r,e,this.boundHandleStyleImageChange_,void 0,i);return o},e.prototype.tileImageNeedsRender_=function(t){var e=this.getLayer();if(e.getRenderMode()===cC)return!1;var r=t.getReplayState(e),n=e.getRevision(),i=t.wantedResolution;return r.renderedTileResolution!==i||r.renderedTileRevision!==n},e.prototype.renderTileImage_=function(t,e){var r=this.getLayer(),n=t.getReplayState(r),i=r.getRevision(),o=t.executorGroups[th(r)];n.renderedTileRevision=i;var a=t.wrappedTileCoord,s=a[0],u=r.getSource(),l=e.pixelRatio,c=e.viewState.projection,f=u.getTileGridForProjection(c),p=f.getResolution(t.tileCoord[0]),h=e.pixelRatio/t.wantedResolution*p,y=f.getResolution(s),d=t.getContext(r);l=Math.round(Math.max(l,h/l));var g=u.getTilePixelSize(s,l,c);d.canvas.width=g[0],d.canvas.height=g[1];var m=l/h;if(1!==m){var v=tg(this.tmpTransform_);ig(v,m,m),d.setTransform.apply(d,v)}var _=f.getTileCoordExtent(a,this.tmpExtent),b=h/y,w=tg(this.tmpTransform_);ig(w,b,-b),function(t,e,r){eg(t,rg(Qd,1,0,0,1,e,r))}(w,-_[0],-_[3]);for(var S=0,O=o.length;S<O;++S)o[S].execute(d,m,w,0,!0,pC[r.getRenderMode()]);n.renderedTileResolution=t.wantedResolution},e}(eO);const dC=yC;var gC=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),mC=function(t){function e(e){var r=this,n=e||{},i=Jh({},n);delete i.preload,delete i.useInterimTilesOnError,(r=t.call(this,i)||this).on,r.once,r.un,"image"===n.renderMode&&(console.warn('renderMode: "image" is deprecated. Option ignored.'),n.renderMode=void 0);var o=n.renderMode||lC;return uh(o==lC||o==cC,28),r.renderMode_=o,r.setPreload(n.preload?n.preload:0),r.setUseInterimTilesOnError(void 0===n.useInterimTilesOnError||n.useInterimTilesOnError),r.getBackground,r.setBackground,r}return gC(e,t),e.prototype.createRenderer=function(){return new dC(this)},e.prototype.getFeatures=function(e){return t.prototype.getFeatures.call(this,e)},e.prototype.getRenderMode=function(){return this.renderMode_},e.prototype.getPreload=function(){return this.get(NS)},e.prototype.getUseInterimTilesOnError=function(){return this.get(FS)},e.prototype.setPreload=function(t){this.set(NS,t)},e.prototype.setUseInterimTilesOnError=function(t){this.set(FS,t)},e}(XO);const vC=mC;var _C=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),bC=function(t){function e(e,r,n,i,o,a){var s=t.call(this,e,r,a)||this;return s.extent=null,s.format_=i,s.features_=null,s.loader_,s.projection=null,s.resolution,s.tileLoadFunction_=o,s.url_=n,s.key=n,s}return _C(e,t),e.prototype.getFormat=function(){return this.format_},e.prototype.getFeatures=function(){return this.features_},e.prototype.load=function(){0==this.state&&(this.setState(1),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))},e.prototype.onLoad=function(t,e){this.setFeatures(t)},e.prototype.onError=function(){this.setState(3)},e.prototype.setFeatures=function(t){this.features_=t,this.setState(2)},e.prototype.setLoader=function(t){this.loader_=t},e}(qS);const wC=bC;var SC=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),OC=[],xC=function(t){function e(e,r,n,i){var o=t.call(this,e,r,{transition:0})||this;return o.context_={},o.executorGroups={},o.declutterExecutorGroups={},o.loadingSourceTiles=0,o.hitDetectionImageData={},o.replayState_={},o.sourceTiles=[],o.errorTileKeys={},o.wantedResolution,o.getSourceTiles=i.bind(void 0,o),o.wrappedTileCoord=n,o}return SC(e,t),e.prototype.getContext=function(t){var e=th(t);return e in this.context_||(this.context_[e]=Dh(1,1,OC)),this.context_[e]},e.prototype.hasContext=function(t){return th(t)in this.context_},e.prototype.getImage=function(t){return this.hasContext(t)?this.getContext(t).canvas:null},e.prototype.getReplayState=function(t){var e=th(t);return e in this.replayState_||(this.replayState_[e]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[e]},e.prototype.load=function(){this.getSourceTiles()},e.prototype.release=function(){for(var e in this.context_){var r=this.context_[e];Nh(r),OC.push(r.canvas),delete this.context_[e]}t.prototype.release.call(this)},e}(qS);const CC=xC;var EC=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),PC=function(t){function e(e){var r=this,n=e.projection||"EPSG:3857",i=e.extent||yO(n),o=e.tileGrid||pO({extent:i,maxResolution:e.maxResolution,maxZoom:void 0!==e.maxZoom?e.maxZoom:22,minZoom:e.minZoom,tileSize:e.tileSize||512});return(r=t.call(this,{attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,interpolate:!0,opaque:!1,projection:n,state:e.state,tileGrid:o,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:TC,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition,zDirection:void 0===e.zDirection?1:e.zDirection})||this).format_=e.format?e.format:null,r.sourceTileCache=new sO(r.tileCache.highWaterMark),r.overlaps_=null==e.overlaps||e.overlaps,r.tileClass=e.tileClass?e.tileClass:wC,r.tileGrids_={},r}return EC(e,t),e.prototype.getFeaturesInExtent=function(t){var e=[],r=this.tileCache;if(0===r.getCount())return e;var n=jm(r.peekFirstKey())[0],i=this.tileGrid;return r.forEach((function(r){if(r.tileCoord[0]===n&&2===r.getState())for(var o=r.getSourceTiles(),a=0,s=o.length;a<s;++a){var u=o[a],l=u.tileCoord;if(Gd(t,i.getTileCoordExtent(l))){var c=u.getFeatures();if(c)for(var f=0,p=c.length;f<p;++f){var h=c[f],y=h.getGeometry();Gd(t,y.getExtent())&&e.push(h)}}}})),e},e.prototype.getOverlaps=function(){return this.overlaps_},e.prototype.clear=function(){this.tileCache.clear(),this.sourceTileCache.clear()},e.prototype.expireCache=function(e,r){var n=this.getTileCacheForProjection(e),i=Object.keys(r).reduce((function(t,e){var r,i,o=km((i=(r=e).substring(r.lastIndexOf("/")+1,r.length).split(",").map(Number))[0],i[1],i[2]),a=n.peek(o);if(a)for(var s=a.sourceTiles,u=0,l=s.length;u<l;++u)t[s[u].getKey()]=!0;return t}),{});t.prototype.expireCache.call(this,e,r),this.sourceTileCache.expireCache(i)},e.prototype.getSourceTiles=function(t,e,r){var n=this;if(0===r.getState()){r.setState(1);var i=r.wrappedTileCoord,o=this.getTileGridForProjection(e),a=o.getTileCoordExtent(i),s=i[0],u=o.getResolution(s);fd(a,-u,a);var l=this.tileGrid,c=l.getExtent();c&&Dd(a,c,a);var f=l.getZForResolution(u,this.zDirection);l.forEachTileCoord(a,f,(function(i){var o=n.tileUrlFunction(i,t,e),a=n.sourceTileCache.containsKey(o)?n.sourceTileCache.get(o):new n.tileClass(i,o?0:4,o,n.format_,n.tileLoadFunction);r.sourceTiles.push(a);var s=a.getState();if(s<2){var u=function(t){n.handleTileChange(t);var e=a.getState();if(2===e||3===e){var i=a.getKey();i in r.errorTileKeys?2===a.getState()&&delete r.errorTileKeys[i]:r.loadingSourceTiles--,3===e?r.errorTileKeys[i]=!0:a.removeEventListener(ny,u),0===r.loadingSourceTiles&&r.setState(ty(r.errorTileKeys)?2:3)}};a.addEventListener(ny,u),r.loadingSourceTiles++}0===s&&(a.extent=l.getTileCoordExtent(i),a.projection=e,a.resolution=l.getResolution(i[0]),n.sourceTileCache.set(o,a),a.load())})),r.loadingSourceTiles||r.setState(r.sourceTiles.some((function(t){return 3===t.getState()}))?3:2)}return r.sourceTiles},e.prototype.getTile=function(t,e,r,n,i){var o,a=km(t,e,r),s=this.getKey();if(this.tileCache.containsKey(a)&&(o=this.tileCache.get(a)).key===s)return o;var u=[t,e,r],l=this.getTileCoordForTileUrlFunction(u,i),c=this.getTileGrid().getExtent(),f=this.getTileGridForProjection(i);if(l&&c){var p=f.getTileCoordExtent(l);fd(p,-f.getResolution(t),p),Gd(c,p)||(l=null)}var h=!0;if(null!==l){var y=this.tileGrid,d=f.getResolution(t),g=y.getZForResolution(d,1),m=f.getTileCoordExtent(l);fd(m,-d,m),y.forEachTileCoord(m,g,function(t){h=h&&!this.tileUrlFunction(t,n,i)}.bind(this))}var v=new CC(u,h?4:0,l,this.getSourceTiles.bind(this,n,i));return v.key=s,o?(v.interimTile=o,v.refreshInterimChain(),this.tileCache.replace(a,v)):this.tileCache.set(a,v),v},e.prototype.getTileGridForProjection=function(t){var e=t.getCode(),r=this.tileGrids_[e];if(!r){for(var n=this.tileGrid,i=n.getResolutions().slice(),o=i.map((function(t,e){return n.getOrigin(e)})),a=i.map((function(t,e){return n.getTileSize(e)})),s=Lb+1,u=i.length;u<s;++u)i.push(i[u-1]/2),o.push(o[u-1]),a.push(a[u-1]);r=new cO({extent:n.getExtent(),origins:o,resolutions:i,tileSizes:a}),this.tileGrids_[e]=r}return r},e.prototype.getTilePixelRatio=function(t){return t},e.prototype.getTilePixelSize=function(t,e,r){var n=rh(this.getTileGridForProjection(r).getTileSize(t),this.tmpSize);return[Math.round(n[0]*e),Math.round(n[1]*e)]},e.prototype.updateCacheSize=function(e,r){t.prototype.updateCacheSize.call(this,2*e,r),this.sourceTileCache.highWaterMark=this.getTileCacheForProjection(r).highWaterMark},e}(LO);const kC=PC;function TC(t,e){t.setLoader((function(r,n,i){nC(e,t.getFormat(),r,n,i,t.onLoad.bind(t),t.onError.bind(t))}))}var jC,RC={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function LC(t){return(t=Math.round(t))<0?0:t>255?255:t}function IC(t){return t<0?0:t>1?1:t}function MC(t){return"%"===t[t.length-1]?LC(parseFloat(t)/100*255):LC(parseInt(t))}function AC(t){return"%"===t[t.length-1]?IC(parseFloat(t)/100):IC(parseFloat(t))}function DC(t,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?t+(e-t)*r*6:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}try{jC={}.parseCSSColor=function(t){var e,r=t.replace(/ /g,"").toLowerCase();if(r in RC)return RC[r].slice();if("#"===r[0])return 4===r.length?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===r.length&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var n=r.indexOf("("),i=r.indexOf(")");if(-1!==n&&i+1===r.length){var o=r.substr(0,n),a=r.substr(n+1,i-(n+1)).split(","),s=1;switch(o){case"rgba":if(4!==a.length)return null;s=AC(a.pop());case"rgb":return 3!==a.length?null:[MC(a[0]),MC(a[1]),MC(a[2]),s];case"hsla":if(4!==a.length)return null;s=AC(a.pop());case"hsl":if(3!==a.length)return null;var u=(parseFloat(a[0])%360+360)%360/360,l=AC(a[1]),c=AC(a[2]),f=c<=.5?c*(l+1):c+l-c*l,p=2*c-f;return[LC(255*DC(p,f,u+1/3)),LC(255*DC(p,f,u)),LC(255*DC(p,f,u-1/3)),s];default:return null}}return null}}catch(t){}var NC=function(t,e,r,n){void 0===n&&(n=1),this.r=t,this.g=e,this.b=r,this.a=n};NC.parse=function(t){if(t){if(t instanceof NC)return t;if("string"==typeof t){var e=jC(t);if(e)return new NC(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3])}}},NC.prototype.toString=function(){var t=this.toArray(),e=t[0],r=t[1],n=t[2],i=t[3];return"rgba("+Math.round(e)+","+Math.round(r)+","+Math.round(n)+","+i+")"},NC.prototype.toArray=function(){var t=this,e=t.r,r=t.g,n=t.b,i=t.a;return 0===i?[0,0,0,0]:[255*e/i,255*r/i,255*n/i,i]},NC.prototype.toArray01=function(){var t=this,e=t.r,r=t.g,n=t.b,i=t.a;return 0===i?[0,0,0,0]:[e/i,r/i,n/i,i]},NC.prototype.toArray01PremultipliedAlpha=function(){var t=this;return[t.r,t.g,t.b,t.a]},NC.black=new NC(0,0,0,1),NC.white=new NC(1,1,1,1),NC.transparent=new NC(0,0,0,0),NC.red=new NC(1,0,0,1),NC.blue=new NC(0,0,1,1);var FC=NC;function zC(t){return"object"==typeof t?["literal",t]:t}function GC(t){switch(t.colorSpace){case"hcl":return"interpolate-hcl";case"lab":return"interpolate-lab";default:return"interpolate"}}function BC(t,e){var r,n,i=zC((r=t.default,n=e.default,void 0!==r?r:void 0!==n?n:void 0));return void 0===i&&"resolvedImage"===e.type?"":i}function VC(t,e,r){var n=WC(t,e),i=["get",t.property];if("categorical"===n&&"boolean"==typeof r[0][0]){for(var o=["case"],a=0,s=r;a<s.length;a+=1){var u=s[a];o.push(["==",i,u[0]],u[1])}return o.push(BC(t,e)),o}if("categorical"===n){for(var l=["match",i],c=0,f=r;c<f.length;c+=1){var p=f[c];qC(l,p[0],p[1],!1)}return l.push(BC(t,e)),l}if("interval"===n){for(var h=["step",["number",i]],y=0,d=r;y<d.length;y+=1){var g=d[y];qC(h,g[0],g[1],!0)}return UC(h),void 0===t.default?h:["case",["==",["typeof",i],"number"],h,zC(t.default)]}if("exponential"===n){for(var m=void 0!==t.base?t.base:1,v=[GC(t),1===m?["linear"]:["exponential",m],["number",i]],_=0,b=r;_<b.length;_+=1){var w=b[_];qC(v,w[0],w[1],!1)}return void 0===t.default?v:["case",["==",["typeof",i],"number"],v,zC(t.default)]}throw new Error("Unknown property function type "+n)}function UC(t){"step"===t[0]&&3===t.length&&(t.push(0),t.push(t[3]))}function qC(t,e,r,n){t.length>3&&e===t[t.length-2]||(n&&2===t.length||t.push(e),t.push(r))}function WC(t,e){return t.type?t.type:e.expression.interpolated?"exponential":"interval"}function XC(t){for(var e=["concat"],r=/{([^{}]+)}/g,n=0,i=r.exec(t);null!==i;i=r.exec(t)){var o=t.slice(n,r.lastIndex-i[0].length);n=r.lastIndex,o.length>0&&e.push(o),e.push(["get",i[1]])}if(1===e.length)return t;if(n<t.length)e.push(t.slice(n));else if(2===e.length)return["to-string",e[1]];return e}var ZC=function(t){function e(e,r){t.call(this,r),this.message=r,this.key=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),HC=function(t,e){void 0===e&&(e=[]),this.parent=t,this.bindings={};for(var r=0,n=e;r<n.length;r+=1){var i=n[r],o=i[0],a=i[1];this.bindings[o]=a}};HC.prototype.concat=function(t){return new HC(this,t)},HC.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},HC.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var YC=HC,KC={kind:"null"},JC={kind:"number"},$C={kind:"string"},QC={kind:"boolean"},tE={kind:"color"},eE={kind:"object"},rE={kind:"value"},nE={kind:"collator"},iE={kind:"formatted"},oE={kind:"resolvedImage"};function aE(t,e){return{kind:"array",itemType:t,N:e}}function sE(t){if("array"===t.kind){var e=sE(t.itemType);return"number"==typeof t.N?"array<"+e+", "+t.N+">":"value"===t.itemType.kind?"array":"array<"+e+">"}return t.kind}var uE=[KC,JC,$C,QC,tE,iE,eE,aE(rE),oE];function lE(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!lE(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(var r=0,n=uE;r<n.length;r+=1)if(!lE(n[r],e))return null}return"Expected "+sE(t)+" but found "+sE(e)+" instead."}function cE(t,e){return e.some((function(e){return e.kind===t.kind}))}function fE(t,e){return e.some((function(e){return"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t}))}var pE=function(t,e,r){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};pE.prototype.compare=function(t,e){return this.collator.compare(t,e)},pE.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var hE=pE,yE=function(t,e,r,n,i){this.text=t.normalize?t.normalize():t,this.image=e,this.scale=r,this.fontStack=n,this.textColor=i},dE=function(t){this.sections=t};dE.fromString=function(t){return new dE([new yE(t,null,null,null,null)])},dE.prototype.isEmpty=function(){return 0===this.sections.length||!this.sections.some((function(t){return 0!==t.text.length||t.image&&0!==t.image.name.length}))},dE.factory=function(t){return t instanceof dE?t:dE.fromString(t)},dE.prototype.toString=function(){return 0===this.sections.length?"":this.sections.map((function(t){return t.text})).join("")},dE.prototype.serialize=function(){for(var t=["format"],e=0,r=this.sections;e<r.length;e+=1){var n=r[e];if(n.image)t.push(["image",n.image.name]);else{t.push(n.text);var i={};n.fontStack&&(i["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(i["font-scale"]=n.scale),n.textColor&&(i["text-color"]=["rgba"].concat(n.textColor.toArray())),t.push(i)}}return t};var gE=dE,mE=function(t){this.name=t.name,this.available=t.available};mE.prototype.toString=function(){return this.name},mE.fromString=function(t){return t?new mE({name:t,available:!1}):null},mE.prototype.serialize=function(){return["image",this.name]};var vE=mE;function _E(t,e,r,n){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof r&&r>=0&&r<=255?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:"Invalid rgba value ["+[t,e,r,n].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+("number"==typeof n?[t,e,r,n]:[t,e,r]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function bE(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof FC)return!0;if(t instanceof hE)return!0;if(t instanceof gE)return!0;if(t instanceof vE)return!0;if(Array.isArray(t)){for(var e=0,r=t;e<r.length;e+=1)if(!bE(r[e]))return!1;return!0}if("object"==typeof t){for(var n in t)if(!bE(t[n]))return!1;return!0}return!1}function wE(t){if(null===t)return KC;if("string"==typeof t)return $C;if("boolean"==typeof t)return QC;if("number"==typeof t)return JC;if(t instanceof FC)return tE;if(t instanceof hE)return nE;if(t instanceof gE)return iE;if(t instanceof vE)return oE;if(Array.isArray(t)){for(var e,r=t.length,n=0,i=t;n<i.length;n+=1){var o=wE(i[n]);if(e){if(e===o)continue;e=rE;break}e=o}return aE(e||rE,r)}return eE}function SE(t){var e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof FC||t instanceof gE||t instanceof vE?t.toString():JSON.stringify(t)}var OE=function(t,e){this.type=t,this.value=e};OE.parse=function(t,e){if(2!==t.length)return e.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!bE(t[1]))return e.error("invalid value");var r=t[1],n=wE(r),i=e.expectedType;return"array"!==n.kind||0!==n.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(n=i),new OE(n,r)},OE.prototype.evaluate=function(){return this.value},OE.prototype.eachChild=function(){},OE.prototype.outputDefined=function(){return!0},OE.prototype.serialize=function(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof FC?["rgba"].concat(this.value.toArray()):this.value instanceof gE?this.value.serialize():this.value};var xE=OE,CE=function(t){this.name="ExpressionEvaluationError",this.message=t};CE.prototype.toJSON=function(){return this.message};var EE=CE,PE={string:$C,number:JC,boolean:QC,object:eE},kE=function(t,e){this.type=t,this.args=e};kE.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var r,n=1,i=t[0];if("array"===i){var o,a;if(t.length>2){var s=t[1];if("string"!=typeof s||!(s in PE)||"object"===s)return e.error('The item type argument of "array" must be one of string, number, boolean',1);o=PE[s],n++}else o=rE;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);a=t[2],n++}r=aE(o,a)}else r=PE[i];for(var u=[];n<t.length;n++){var l=e.parse(t[n],n,rE);if(!l)return null;u.push(l)}return new kE(r,u)},kE.prototype.evaluate=function(t){for(var e=0;e<this.args.length;e++){var r=this.args[e].evaluate(t);if(!lE(this.type,wE(r)))return r;if(e===this.args.length-1)throw new EE("Expected value to be of type "+sE(this.type)+", but found "+sE(wE(r))+" instead.")}return null},kE.prototype.eachChild=function(t){this.args.forEach(t)},kE.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},kE.prototype.serialize=function(){var t=this.type,e=[t.kind];if("array"===t.kind){var r=t.itemType;if("string"===r.kind||"number"===r.kind||"boolean"===r.kind){e.push(r.kind);var n=t.N;("number"==typeof n||this.args.length>1)&&e.push(n)}}return e.concat(this.args.map((function(t){return t.serialize()})))};var TE=kE,jE=function(t){this.type=iE,this.sections=t};jE.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var r=t[1];if(!Array.isArray(r)&&"object"==typeof r)return e.error("First argument must be an image or text section.");for(var n=[],i=!1,o=1;o<=t.length-1;++o){var a=t[o];if(i&&"object"==typeof a&&!Array.isArray(a)){i=!1;var s=null;if(a["font-scale"]&&!(s=e.parse(a["font-scale"],1,JC)))return null;var u=null;if(a["text-font"]&&!(u=e.parse(a["text-font"],1,aE($C))))return null;var l=null;if(a["text-color"]&&!(l=e.parse(a["text-color"],1,tE)))return null;var c=n[n.length-1];c.scale=s,c.font=u,c.textColor=l}else{var f=e.parse(t[o],1,rE);if(!f)return null;var p=f.type.kind;if("string"!==p&&"value"!==p&&"null"!==p&&"resolvedImage"!==p)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");i=!0,n.push({content:f,scale:null,font:null,textColor:null})}}return new jE(n)},jE.prototype.evaluate=function(t){return new gE(this.sections.map((function(e){var r=e.content.evaluate(t);return wE(r)===oE?new yE("",r,null,null,null):new yE(SE(r),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)})))},jE.prototype.eachChild=function(t){for(var e=0,r=this.sections;e<r.length;e+=1){var n=r[e];t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor)}},jE.prototype.outputDefined=function(){return!1},jE.prototype.serialize=function(){for(var t=["format"],e=0,r=this.sections;e<r.length;e+=1){var n=r[e];t.push(n.content.serialize());var i={};n.scale&&(i["font-scale"]=n.scale.serialize()),n.font&&(i["text-font"]=n.font.serialize()),n.textColor&&(i["text-color"]=n.textColor.serialize()),t.push(i)}return t};var RE=jE,LE=function(t){this.type=oE,this.input=t};LE.parse=function(t,e){if(2!==t.length)return e.error("Expected two arguments.");var r=e.parse(t[1],1,$C);return r?new LE(r):e.error("No image name provided.")},LE.prototype.evaluate=function(t){var e=this.input.evaluate(t),r=vE.fromString(e);return r&&t.availableImages&&(r.available=t.availableImages.indexOf(e)>-1),r},LE.prototype.eachChild=function(t){t(this.input)},LE.prototype.outputDefined=function(){return!1},LE.prototype.serialize=function(){return["image",this.input.serialize()]};var IE=LE,ME={"to-boolean":QC,"to-color":tE,"to-number":JC,"to-string":$C},AE=function(t,e){this.type=t,this.args=e};AE.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var r=t[0];if(("to-boolean"===r||"to-string"===r)&&2!==t.length)return e.error("Expected one argument.");for(var n=ME[r],i=[],o=1;o<t.length;o++){var a=e.parse(t[o],o,rE);if(!a)return null;i.push(a)}return new AE(n,i)},AE.prototype.evaluate=function(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){for(var e,r,n=0,i=this.args;n<i.length;n+=1){if(r=null,(e=i[n].evaluate(t))instanceof FC)return e;if("string"==typeof e){var o=t.parseColor(e);if(o)return o}else if(Array.isArray(e)&&!(r=e.length<3||e.length>4?"Invalid rbga value "+JSON.stringify(e)+": expected an array containing either three or four numeric values.":_E(e[0],e[1],e[2],e[3])))return new FC(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new EE(r||"Could not parse color from value '"+("string"==typeof e?e:String(JSON.stringify(e)))+"'")}if("number"===this.type.kind){for(var a=null,s=0,u=this.args;s<u.length;s+=1){if(null===(a=u[s].evaluate(t)))return 0;var l=Number(a);if(!isNaN(l))return l}throw new EE("Could not convert "+JSON.stringify(a)+" to number.")}return"formatted"===this.type.kind?gE.fromString(SE(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?vE.fromString(SE(this.args[0].evaluate(t))):SE(this.args[0].evaluate(t))},AE.prototype.eachChild=function(t){this.args.forEach(t)},AE.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},AE.prototype.serialize=function(){if("formatted"===this.type.kind)return new RE([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new IE(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild((function(e){t.push(e.serialize())})),t};var DE=AE,NE=["Unknown","Point","LineString","Polygon"],FE=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null};FE.prototype.id=function(){return this.feature&&void 0!==this.feature.id?this.feature.id:null},FE.prototype.geometryType=function(){return this.feature?"number"==typeof this.feature.type?NE[this.feature.type]:this.feature.type:null},FE.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},FE.prototype.canonicalID=function(){return this.canonical},FE.prototype.properties=function(){return this.feature&&this.feature.properties||{}},FE.prototype.distanceFromCenter=function(){if(this.featureTileCoord&&this.featureDistanceData){var t=this.featureDistanceData.center,e=this.featureDistanceData.scale,r=this.featureTileCoord,n=r.x,i=r.y,o=n*e-t[0],a=i*e-t[1];return this.featureDistanceData.bearing[0]*o+this.featureDistanceData.bearing[1]*a}return 0},FE.prototype.parseColor=function(t){var e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=FC.parse(t)),e};var zE=FE,GE=function(t,e,r,n){this.name=t,this.type=e,this._evaluate=r,this.args=n};GE.prototype.evaluate=function(t){return this._evaluate(t,this.args)},GE.prototype.eachChild=function(t){this.args.forEach(t)},GE.prototype.outputDefined=function(){return!1},GE.prototype.serialize=function(){return[this.name].concat(this.args.map((function(t){return t.serialize()})))},GE.parse=function(t,e){var r,n=t[0],i=GE.definitions[n];if(!i)return e.error('Unknown expression "'+n+'". If you wanted a literal array, use ["literal", [...]].',0);for(var o=Array.isArray(i)?i[0]:i.type,a=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,s=a.filter((function(e){var r=e[0];return!Array.isArray(r)||r.length===t.length-1})),u=null,l=0,c=s;l<c.length;l+=1){var f=c[l],p=f[0],h=f[1];u=new dP(e.registry,e.path,null,e.scope);for(var y=[],d=!1,g=1;g<t.length;g++){var m=t[g],v=Array.isArray(p)?p[g-1]:p.type,_=u.parse(m,1+y.length,v);if(!_){d=!0;break}y.push(_)}if(!d)if(Array.isArray(p)&&p.length!==y.length)u.error("Expected "+p.length+" arguments, but found "+y.length+" instead.");else{for(var b=0;b<y.length;b++){var w=Array.isArray(p)?p[b]:p.type,S=y[b];u.concat(b+1).checkSubtype(w,S.type)}if(0===u.errors.length)return new GE(n,o,h,y)}}if(1===s.length)(r=e.errors).push.apply(r,u.errors);else{for(var O=(s.length?s:a).map((function(t){var e;return e=t[0],Array.isArray(e)?"("+e.map(sE).join(", ")+")":"("+sE(e.type)+"...)"})).join(" | "),x=[],C=1;C<t.length;C++){var E=e.parse(t[C],1+x.length);if(!E)return null;x.push(sE(E.type))}e.error("Expected arguments of type "+O+", but found ("+x.join(", ")+") instead.")}return null},GE.register=function(t,e){for(var r in GE.definitions=e,e)t[r]=GE};var BE=GE,VE=function(t,e,r){this.type=nE,this.locale=r,this.caseSensitive=t,this.diacriticSensitive=e};VE.parse=function(t,e){if(2!==t.length)return e.error("Expected one argument.");var r=t[1];if("object"!=typeof r||Array.isArray(r))return e.error("Collator options argument must be an object.");var n=e.parse(void 0!==r["case-sensitive"]&&r["case-sensitive"],1,QC);if(!n)return null;var i=e.parse(void 0!==r["diacritic-sensitive"]&&r["diacritic-sensitive"],1,QC);if(!i)return null;var o=null;return r.locale&&!(o=e.parse(r.locale,1,$C))?null:new VE(n,i,o)},VE.prototype.evaluate=function(t){return new hE(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},VE.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},VE.prototype.outputDefined=function(){return!1},VE.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var UE=VE,qE=8192;function WE(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function XE(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function ZE(t,e){var r,n=(180+t[0])/360,i=(r=t[1],(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360),o=Math.pow(2,e.z);return[Math.round(n*o*qE),Math.round(i*o*qE)]}function HE(t,e,r){var n=t[0]-e[0],i=t[1]-e[1],o=t[0]-r[0],a=t[1]-r[1];return n*a-o*i==0&&n*o<=0&&i*a<=0}function YE(t,e,r){return e[1]>t[1]!=r[1]>t[1]&&t[0]<(r[0]-e[0])*(t[1]-e[1])/(r[1]-e[1])+e[0]}function KE(t,e){for(var r=!1,n=0,i=e.length;n<i;n++)for(var o=e[n],a=0,s=o.length;a<s-1;a++){if(HE(t,o[a],o[a+1]))return!1;YE(t,o[a],o[a+1])&&(r=!r)}return r}function JE(t,e){for(var r=0;r<e.length;r++)if(KE(t,e[r]))return!0;return!1}function $E(t,e,r,n){var i=t[0]-r[0],o=t[1]-r[1],a=e[0]-r[0],s=e[1]-r[1],u=n[0]-r[0],l=n[1]-r[1],c=i*l-u*o,f=a*l-u*s;return c>0&&f<0||c<0&&f>0}function QE(t,e,r){for(var n=0,i=r;n<i.length;n+=1)for(var o=i[n],a=0;a<o.length-1;++a)if(s=t,u=e,l=o[a],c=o[a+1],void 0,void 0,void 0,void 0,h=[u[0]-s[0],u[1]-s[1]],0!=(f=[c[0]-l[0],c[1]-l[1]])[0]*(p=h)[1]-f[1]*p[0]&&$E(s,u,l,c)&&$E(l,c,s,u))return!0;var s,u,l,c,f,p,h;return!1}function tP(t,e){for(var r=0;r<t.length;++r)if(!KE(t[r],e))return!1;for(var n=0;n<t.length-1;++n)if(QE(t[n],t[n+1],e))return!1;return!0}function eP(t,e){for(var r=0;r<e.length;r++)if(tP(t,e[r]))return!0;return!1}function rP(t,e,r){for(var n=[],i=0;i<t.length;i++){for(var o=[],a=0;a<t[i].length;a++){var s=ZE(t[i][a],r);WE(e,s),o.push(s)}n.push(o)}return n}function nP(t,e,r){for(var n=[],i=0;i<t.length;i++){var o=rP(t[i],e,r);n.push(o)}return n}function iP(t,e,r,n){if(t[0]<r[0]||t[0]>r[2]){var i=.5*n,o=t[0]-r[0]>i?-n:r[0]-t[0]>i?n:0;0===o&&(o=t[0]-r[2]>i?-n:r[2]-t[0]>i?n:0),t[0]+=o}WE(e,t)}function oP(t,e,r,n){var i=Math.pow(2,n.z)*qE,o=[n.x*qE,n.y*qE],a=[];if(!t)return a;for(var s=0,u=t;s<u.length;s+=1)for(var l=0,c=u[s];l<c.length;l+=1){var f=c[l],p=[f.x+o[0],f.y+o[1]];iP(p,e,r,i),a.push(p)}return a}function aP(t,e,r,n){var i,o=Math.pow(2,n.z)*qE,a=[n.x*qE,n.y*qE],s=[];if(!t)return s;for(var u=0,l=t;u<l.length;u+=1){for(var c=[],f=0,p=l[u];f<p.length;f+=1){var h=p[f],y=[h.x+a[0],h.y+a[1]];WE(e,y),c.push(y)}s.push(c)}if(e[2]-e[0]<=o/2){(i=e)[0]=i[1]=1/0,i[2]=i[3]=-1/0;for(var d=0,g=s;d<g.length;d+=1)for(var m=0,v=g[d];m<v.length;m+=1)iP(v[m],e,r,o)}return s}var sP=function(t,e){this.type=QC,this.geojson=t,this.geometries=e};sP.parse=function(t,e){if(2!==t.length)return e.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(bE(t[1])){var r=t[1];if("FeatureCollection"===r.type)for(var n=0;n<r.features.length;++n){var i=r.features[n].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new sP(r,r.features[n].geometry)}else if("Feature"===r.type){var o=r.geometry.type;if("Polygon"===o||"MultiPolygon"===o)return new sP(r,r.geometry)}else if("Polygon"===r.type||"MultiPolygon"===r.type)return new sP(r,r)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")},sP.prototype.evaluate=function(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){var r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if(!i)return!1;if("Polygon"===e.type){var o=rP(e.coordinates,n,i),a=oP(t.geometry(),r,n,i);if(!XE(r,n))return!1;for(var s=0,u=a;s<u.length;s+=1)if(!KE(u[s],o))return!1}if("MultiPolygon"===e.type){var l=nP(e.coordinates,n,i),c=oP(t.geometry(),r,n,i);if(!XE(r,n))return!1;for(var f=0,p=c;f<p.length;f+=1)if(!JE(p[f],l))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){var r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if(!i)return!1;if("Polygon"===e.type){var o=rP(e.coordinates,n,i),a=aP(t.geometry(),r,n,i);if(!XE(r,n))return!1;for(var s=0,u=a;s<u.length;s+=1)if(!tP(u[s],o))return!1}if("MultiPolygon"===e.type){var l=nP(e.coordinates,n,i),c=aP(t.geometry(),r,n,i);if(!XE(r,n))return!1;for(var f=0,p=c;f<p.length;f+=1)if(!eP(p[f],l))return!1}return!0}(t,this.geometries)}return!1},sP.prototype.eachChild=function(){},sP.prototype.outputDefined=function(){return!0},sP.prototype.serialize=function(){return["within",this.geojson]};var uP=sP;function lP(t){if(t instanceof BE){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof uP)return!1;var e=!0;return t.eachChild((function(t){e&&!lP(t)&&(e=!1)})),e}function cP(t){if(t instanceof BE&&"feature-state"===t.name)return!1;var e=!0;return t.eachChild((function(t){e&&!cP(t)&&(e=!1)})),e}function fP(t,e){if(t instanceof BE&&e.indexOf(t.name)>=0)return!1;var r=!0;return t.eachChild((function(t){r&&!fP(t,e)&&(r=!1)})),r}var pP=function(t,e){this.type=e.type,this.name=t,this.boundExpression=e};pP.parse=function(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");var r=t[1];return e.scope.has(r)?new pP(r,e.scope.get(r)):e.error('Unknown variable "'+r+'". Make sure "'+r+'" has been bound in an enclosing "let" expression before using it.',1)},pP.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},pP.prototype.eachChild=function(){},pP.prototype.outputDefined=function(){return!1},pP.prototype.serialize=function(){return["var",this.name]};var hP=pP,yP=function(t,e,r,n,i){void 0===e&&(e=[]),void 0===n&&(n=new YC),void 0===i&&(i=[]),this.registry=t,this.path=e,this.key=e.map((function(t){return"["+t+"]"})).join(""),this.scope=n,this.errors=i,this.expectedType=r};yP.prototype.parse=function(t,e,r,n,i){return void 0===i&&(i={}),e?this.concat(e,r,n)._parse(t,i):this._parse(t,i)},yP.prototype._parse=function(t,e){function r(t,e,r){return"assert"===r?new TE(e,[t]):"coerce"===r?new DE(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var n=t[0];if("string"!=typeof n)return this.error("Expression name must be a string, but found "+typeof n+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var i=this.registry[n];if(i){var o=i.parse(t,this);if(!o)return null;if(this.expectedType){var a=this.expectedType,s=o.type;if("string"!==a.kind&&"number"!==a.kind&&"boolean"!==a.kind&&"object"!==a.kind&&"array"!==a.kind||"value"!==s.kind)if("color"!==a.kind&&"formatted"!==a.kind&&"resolvedImage"!==a.kind||"value"!==s.kind&&"string"!==s.kind){if(this.checkSubtype(a,s))return null}else o=r(o,a,e.typeAnnotation||"coerce");else o=r(o,a,e.typeAnnotation||"assert")}if(!(o instanceof xE)&&"resolvedImage"!==o.type.kind&&gP(o)){var u=new zE;try{o=new xE(o.type,o.evaluate(u))}catch(t){return this.error(t.message),null}}return o}return this.error('Unknown expression "'+n+'". If you wanted a literal array, use ["literal", [...]].',0)}return void 0===t?this.error("'undefined' value invalid. Use null instead."):"object"==typeof t?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error("Expected an array, but found "+typeof t+" instead.")},yP.prototype.concat=function(t,e,r){var n="number"==typeof t?this.path.concat(t):this.path,i=r?this.scope.concat(r):this.scope;return new yP(this.registry,n,e||null,i,this.errors)},yP.prototype.error=function(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];var n=""+this.key+e.map((function(t){return"["+t+"]"})).join("");this.errors.push(new ZC(n,t))},yP.prototype.checkSubtype=function(t,e){var r=lE(t,e);return r&&this.error(r),r};var dP=yP;function gP(t){if(t instanceof hP)return gP(t.boundExpression);if(t instanceof BE&&"error"===t.name)return!1;if(t instanceof UE)return!1;if(t instanceof uP)return!1;var e=t instanceof DE||t instanceof TE,r=!0;return t.eachChild((function(t){r=e?r&&gP(t):r&&t instanceof xE})),!!r&&lP(t)&&fP(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function mP(t,e){for(var r,n,i=t.length-1,o=0,a=i,s=0;o<=a;)if(r=t[s=Math.floor((o+a)/2)],n=t[s+1],r<=e){if(s===i||e<n)return s;o=s+1}else{if(!(r>e))throw new EE("Input is not a number.");a=s-1}return 0}var vP=function(t,e,r){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(var n=0,i=r;n<i.length;n+=1){var o=i[n],a=o[0],s=o[1];this.labels.push(a),this.outputs.push(s)}};vP.parse=function(t,e){if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");var r=e.parse(t[1],1,JC);if(!r)return null;var n=[],i=null;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);for(var o=1;o<t.length;o+=2){var a=1===o?-1/0:t[o],s=t[o+1],u=o,l=o+1;if("number"!=typeof a)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',u);if(n.length&&n[n.length-1][0]>=a)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',u);var c=e.parse(s,l,i);if(!c)return null;i=i||c.type,n.push([a,c])}return new vP(i,r,n)},vP.prototype.evaluate=function(t){var e=this.labels,r=this.outputs;if(1===e.length)return r[0].evaluate(t);var n=this.input.evaluate(t);if(n<=e[0])return r[0].evaluate(t);var i=e.length;return n>=e[i-1]?r[i-1].evaluate(t):r[mP(e,n)].evaluate(t)},vP.prototype.eachChild=function(t){t(this.input);for(var e=0,r=this.outputs;e<r.length;e+=1)t(r[e])},vP.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))},vP.prototype.serialize=function(){for(var t=["step",this.input.serialize()],e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t};var _P=vP,bP=wP;function wP(t,e,r,n){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=r,this.p2y=n}function SP(t,e,r){return t*(1-r)+e*r}wP.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},wP.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},wP.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},wP.prototype.solveCurveX=function(t,e){var r,n,i,o,a;for(void 0===e&&(e=1e-6),i=t,a=0;a<8;a++){if(o=this.sampleCurveX(i)-t,Math.abs(o)<e)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=o/s}if((i=t)<(r=0))return r;if(i>(n=1))return n;for(;r<n;){if(o=this.sampleCurveX(i),Math.abs(o-t)<e)return i;t>o?r=i:n=i,i=.5*(n-r)+r}return i},wP.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var OP=Object.freeze({__proto__:null,number:SP,color:function(t,e,r){return new FC(SP(t.r,e.r,r),SP(t.g,e.g,r),SP(t.b,e.b,r),SP(t.a,e.a,r))},array:function(t,e,r){return t.map((function(t,n){return SP(t,e[n],r)}))}}),xP=.95047,CP=1.08883,EP=4/29,PP=6/29,kP=3*PP*PP,TP=PP*PP*PP,jP=Math.PI/180,RP=180/Math.PI;function LP(t){return t>TP?Math.pow(t,1/3):t/kP+EP}function IP(t){return t>PP?t*t*t:kP*(t-EP)}function MP(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function AP(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function DP(t){var e=AP(t.r),r=AP(t.g),n=AP(t.b),i=LP((.4124564*e+.3575761*r+.1804375*n)/xP),o=LP((.2126729*e+.7151522*r+.072175*n)/1);return{l:116*o-16,a:500*(i-o),b:200*(o-LP((.0193339*e+.119192*r+.9503041*n)/CP)),alpha:t.a}}function NP(t){var e=(t.l+16)/116,r=isNaN(t.a)?e:e+t.a/500,n=isNaN(t.b)?e:e-t.b/200;return e=1*IP(e),r=xP*IP(r),n=CP*IP(n),new FC(MP(3.2404542*r-1.5371385*e-.4985314*n),MP(-.969266*r+1.8760108*e+.041556*n),MP(.0556434*r-.2040259*e+1.0572252*n),t.alpha)}function FP(t,e,r){var n=e-t;return t+r*(n>180||n<-180?n-360*Math.round(n/360):n)}var zP={forward:DP,reverse:NP,interpolate:function(t,e,r){return{l:SP(t.l,e.l,r),a:SP(t.a,e.a,r),b:SP(t.b,e.b,r),alpha:SP(t.alpha,e.alpha,r)}}},GP=function(t){var e=DP(t),r=e.l,n=e.a,i=e.b,o=Math.atan2(i,n)*RP;return{h:o<0?o+360:o,c:Math.sqrt(n*n+i*i),l:r,alpha:t.a}},BP=function(t){var e=t.h*jP,r=t.c;return NP({l:t.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:t.alpha})},VP=function(t,e,r){return{h:FP(t.h,e.h,r),c:SP(t.c,e.c,r),l:SP(t.l,e.l,r),alpha:SP(t.alpha,e.alpha,r)}},UP=function(t,e,r,n,i){this.type=t,this.operator=e,this.interpolation=r,this.input=n,this.labels=[],this.outputs=[];for(var o=0,a=i;o<a.length;o+=1){var s=a[o],u=s[0],l=s[1];this.labels.push(u),this.outputs.push(l)}};function qP(t,e,r,n){var i=n-r,o=t-r;return 0===i?0:1===e?o/i:(Math.pow(e,o)-1)/(Math.pow(e,i)-1)}UP.interpolationFactor=function(t,e,r,n){var i=0;if("exponential"===t.name)i=qP(e,t.base,r,n);else if("linear"===t.name)i=qP(e,1,r,n);else if("cubic-bezier"===t.name){var o=t.controlPoints;i=new bP(o[0],o[1],o[2],o[3]).solve(qP(e,1,r,n))}return i},UP.parse=function(t,e){var r=t[0],n=t[1],i=t[2],o=t.slice(3);if(!Array.isArray(n)||0===n.length)return e.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){var a=n[1];if("number"!=typeof a)return e.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:a}}else{if("cubic-bezier"!==n[0])return e.error("Unknown interpolation type "+String(n[0]),1,0);var s=n.slice(1);if(4!==s.length||s.some((function(t){return"number"!=typeof t||t<0||t>1})))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:s}}if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(i=e.parse(i,2,JC)))return null;var u=[],l=null;"interpolate-hcl"===r||"interpolate-lab"===r?l=tE:e.expectedType&&"value"!==e.expectedType.kind&&(l=e.expectedType);for(var c=0;c<o.length;c+=2){var f=o[c],p=o[c+1],h=c+3,y=c+4;if("number"!=typeof f)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',h);if(u.length&&u[u.length-1][0]>=f)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',h);var d=e.parse(p,y,l);if(!d)return null;l=l||d.type,u.push([f,d])}return"number"===l.kind||"color"===l.kind||"array"===l.kind&&"number"===l.itemType.kind&&"number"==typeof l.N?new UP(l,r,n,i,u):e.error("Type "+sE(l)+" is not interpolatable.")},UP.prototype.evaluate=function(t){var e=this.labels,r=this.outputs;if(1===e.length)return r[0].evaluate(t);var n=this.input.evaluate(t);if(n<=e[0])return r[0].evaluate(t);var i=e.length;if(n>=e[i-1])return r[i-1].evaluate(t);var o=mP(e,n),a=e[o],s=e[o+1],u=UP.interpolationFactor(this.interpolation,n,a,s),l=r[o].evaluate(t),c=r[o+1].evaluate(t);return"interpolate"===this.operator?OP[this.type.kind.toLowerCase()](l,c,u):"interpolate-hcl"===this.operator?BP(VP(GP(l),GP(c),u)):zP.reverse(zP.interpolate(zP.forward(l),zP.forward(c),u))},UP.prototype.eachChild=function(t){t(this.input);for(var e=0,r=this.outputs;e<r.length;e+=1)t(r[e])},UP.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))},UP.prototype.serialize=function(){var t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var e=[this.operator,t,this.input.serialize()],r=0;r<this.labels.length;r++)e.push(this.labels[r],this.outputs[r].serialize());return e};var WP=UP,XP=function(t,e){this.type=t,this.args=e};XP.parse=function(t,e){if(t.length<2)return e.error("Expectected at least one argument.");var r=null,n=e.expectedType;n&&"value"!==n.kind&&(r=n);for(var i=[],o=0,a=t.slice(1);o<a.length;o+=1){var s=a[o],u=e.parse(s,1+i.length,r,void 0,{typeAnnotation:"omit"});if(!u)return null;r=r||u.type,i.push(u)}var l=n&&i.some((function(t){return lE(n,t.type)}));return new XP(l?rE:r,i)},XP.prototype.evaluate=function(t){for(var e,r=null,n=0,i=0,o=this.args;i<o.length;i+=1){if(n++,(r=o[i].evaluate(t))&&r instanceof vE&&!r.available&&(e||(e=r),r=null,n===this.args.length))return e;if(null!==r)break}return r},XP.prototype.eachChild=function(t){this.args.forEach(t)},XP.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},XP.prototype.serialize=function(){var t=["coalesce"];return this.eachChild((function(e){t.push(e.serialize())})),t};var ZP=XP,HP=function(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e};HP.prototype.evaluate=function(t){return this.result.evaluate(t)},HP.prototype.eachChild=function(t){for(var e=0,r=this.bindings;e<r.length;e+=1)t(r[e][1]);t(this.result)},HP.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var r=[],n=1;n<t.length-1;n+=2){var i=t[n];if("string"!=typeof i)return e.error("Expected string, but found "+typeof i+" instead.",n);if(/[^a-zA-Z0-9_]/.test(i))return e.error("Variable names must contain only alphanumeric characters or '_'.",n);var o=e.parse(t[n+1],n+1);if(!o)return null;r.push([i,o])}var a=e.parse(t[t.length-1],t.length-1,e.expectedType,r);return a?new HP(r,a):null},HP.prototype.outputDefined=function(){return this.result.outputDefined()},HP.prototype.serialize=function(){for(var t=["let"],e=0,r=this.bindings;e<r.length;e+=1){var n=r[e],i=n[0],o=n[1];t.push(i,o.serialize())}return t.push(this.result.serialize()),t};var YP=HP,KP=function(t,e,r){this.type=t,this.index=e,this.input=r};KP.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,JC),n=e.parse(t[2],2,aE(e.expectedType||rE));if(!r||!n)return null;var i=n.type;return new KP(i.itemType,r,n)},KP.prototype.evaluate=function(t){var e=this.index.evaluate(t),r=this.input.evaluate(t);if(e<0)throw new EE("Array index out of bounds: "+e+" < 0.");if(e>=r.length)throw new EE("Array index out of bounds: "+e+" > "+(r.length-1)+".");if(e!==Math.floor(e))throw new EE("Array index must be an integer, but found "+e+" instead.");return r[e]},KP.prototype.eachChild=function(t){t(this.index),t(this.input)},KP.prototype.outputDefined=function(){return!1},KP.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var JP=KP,$P=function(t,e){this.type=QC,this.needle=t,this.haystack=e};$P.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,rE),n=e.parse(t[2],2,rE);return r&&n?cE(r.type,[QC,$C,JC,KC,rE])?new $P(r,n):e.error("Expected first argument to be of type boolean, string, number or null, but found "+sE(r.type)+" instead"):null},$P.prototype.evaluate=function(t){var e=this.needle.evaluate(t),r=this.haystack.evaluate(t);if(null==r)return!1;if(!fE(e,["boolean","string","number","null"]))throw new EE("Expected first argument to be of type boolean, string, number or null, but found "+sE(wE(e))+" instead.");if(!fE(r,["string","array"]))throw new EE("Expected second argument to be of type array or string, but found "+sE(wE(r))+" instead.");return r.indexOf(e)>=0},$P.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},$P.prototype.outputDefined=function(){return!0},$P.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var QP=$P,tk=function(t,e,r){this.type=JC,this.needle=t,this.haystack=e,this.fromIndex=r};tk.parse=function(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,rE),n=e.parse(t[2],2,rE);if(!r||!n)return null;if(!cE(r.type,[QC,$C,JC,KC,rE]))return e.error("Expected first argument to be of type boolean, string, number or null, but found "+sE(r.type)+" instead");if(4===t.length){var i=e.parse(t[3],3,JC);return i?new tk(r,n,i):null}return new tk(r,n)},tk.prototype.evaluate=function(t){var e=this.needle.evaluate(t),r=this.haystack.evaluate(t);if(!fE(e,["boolean","string","number","null"]))throw new EE("Expected first argument to be of type boolean, string, number or null, but found "+sE(wE(e))+" instead.");if(!fE(r,["string","array"]))throw new EE("Expected second argument to be of type array or string, but found "+sE(wE(r))+" instead.");if(this.fromIndex){var n=this.fromIndex.evaluate(t);return r.indexOf(e,n)}return r.indexOf(e)},tk.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},tk.prototype.outputDefined=function(){return!1},tk.prototype.serialize=function(){if(null!=this.fromIndex&&void 0!==this.fromIndex){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var ek=tk,rk=function(t,e,r,n,i,o){this.inputType=t,this.type=e,this.input=r,this.cases=n,this.outputs=i,this.otherwise=o};rk.parse=function(t,e){if(t.length<5)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return e.error("Expected an even number of arguments.");var r,n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);for(var i={},o=[],a=2;a<t.length-1;a+=2){var s=t[a],u=t[a+1];Array.isArray(s)||(s=[s]);var l=e.concat(a);if(0===s.length)return l.error("Expected at least one branch label.");for(var c=0,f=s;c<f.length;c+=1){var p=f[c];if("number"!=typeof p&&"string"!=typeof p)return l.error("Branch labels must be numbers or strings.");if("number"==typeof p&&Math.abs(p)>Number.MAX_SAFE_INTEGER)return l.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if("number"==typeof p&&Math.floor(p)!==p)return l.error("Numeric branch labels must be integer values.");if(r){if(l.checkSubtype(r,wE(p)))return null}else r=wE(p);if(void 0!==i[String(p)])return l.error("Branch labels must be unique.");i[String(p)]=o.length}var h=e.parse(u,a,n);if(!h)return null;n=n||h.type,o.push(h)}var y=e.parse(t[1],1,rE);if(!y)return null;var d=e.parse(t[t.length-1],t.length-1,n);return d?"value"!==y.type.kind&&e.concat(1).checkSubtype(r,y.type)?null:new rk(r,n,y,i,o,d):null},rk.prototype.evaluate=function(t){var e=this.input.evaluate(t);return(wE(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)},rk.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},rk.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))&&this.otherwise.outputDefined()},rk.prototype.serialize=function(){for(var t=this,e=["match",this.input.serialize()],r=[],n={},i=0,o=Object.keys(this.cases).sort();i<o.length;i+=1){var a=o[i];void 0===(f=n[this.cases[a]])?(n[this.cases[a]]=r.length,r.push([this.cases[a],[a]])):r[f][1].push(a)}for(var s=function(e){return"number"===t.inputType.kind?Number(e):e},u=0,l=r;u<l.length;u+=1){var c=l[u],f=c[0],p=c[1];1===p.length?e.push(s(p[0])):e.push(p.map(s)),e.push(this.outputs[outputIndex$1].serialize())}return e.push(this.otherwise.serialize()),e};var nk=rk,ik=function(t,e,r){this.type=t,this.branches=e,this.otherwise=r};ik.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return e.error("Expected an odd number of arguments.");var r;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(var n=[],i=1;i<t.length-1;i+=2){var o=e.parse(t[i],i,QC);if(!o)return null;var a=e.parse(t[i+1],i+1,r);if(!a)return null;n.push([o,a]),r=r||a.type}var s=e.parse(t[t.length-1],t.length-1,r);return s?new ik(r,n,s):null},ik.prototype.evaluate=function(t){for(var e=0,r=this.branches;e<r.length;e+=1){var n=r[e],i=n[0],o=n[1];if(i.evaluate(t))return o.evaluate(t)}return this.otherwise.evaluate(t)},ik.prototype.eachChild=function(t){for(var e=0,r=this.branches;e<r.length;e+=1){var n=r[e],i=n[0],o=n[1];t(i),t(o)}t(this.otherwise)},ik.prototype.outputDefined=function(){return this.branches.every((function(t){return t[0],t[1].outputDefined()}))&&this.otherwise.outputDefined()},ik.prototype.serialize=function(){var t=["case"];return this.eachChild((function(e){t.push(e.serialize())})),t};var ok=ik,ak=function(t,e,r,n){this.type=t,this.input=e,this.beginIndex=r,this.endIndex=n};ak.parse=function(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,rE),n=e.parse(t[2],2,JC);if(!r||!n)return null;if(!cE(r.type,[aE(rE),$C,rE]))return e.error("Expected first argument to be of type array or string, but found "+sE(r.type)+" instead");if(4===t.length){var i=e.parse(t[3],3,JC);return i?new ak(r.type,r,n,i):null}return new ak(r.type,r,n)},ak.prototype.evaluate=function(t){var e=this.input.evaluate(t),r=this.beginIndex.evaluate(t);if(!fE(e,["string","array"]))throw new EE("Expected first argument to be of type array or string, but found "+sE(wE(e))+" instead.");if(this.endIndex){var n=this.endIndex.evaluate(t);return e.slice(r,n)}return e.slice(r)},ak.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},ak.prototype.outputDefined=function(){return!1},ak.prototype.serialize=function(){if(null!=this.endIndex&&void 0!==this.endIndex){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var sk=ak;function uk(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function lk(t,e,r,n){return 0===n.compare(e,r)}function ck(t,e,r){var n="=="!==t&&"!="!==t;return function(){function i(t,e,r){this.type=QC,this.lhs=t,this.rhs=e,this.collator=r,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}return i.parse=function(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");var r=t[0],o=e.parse(t[1],1,rE);if(!o)return null;if(!uk(r,o.type))return e.concat(1).error('"'+r+"\" comparisons are not supported for type '"+sE(o.type)+"'.");var a=e.parse(t[2],2,rE);if(!a)return null;if(!uk(r,a.type))return e.concat(2).error('"'+r+"\" comparisons are not supported for type '"+sE(a.type)+"'.");if(o.type.kind!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return e.error("Cannot compare types '"+sE(o.type)+"' and '"+sE(a.type)+"'.");n&&("value"===o.type.kind&&"value"!==a.type.kind?o=new TE(a.type,[o]):"value"!==o.type.kind&&"value"===a.type.kind&&(a=new TE(o.type,[a])));var s=null;if(4===t.length){if("string"!==o.type.kind&&"string"!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return e.error("Cannot use collator to compare non-string types.");if(!(s=e.parse(t[3],3,nE)))return null}return new i(o,a,s)},i.prototype.evaluate=function(i){var o=this.lhs.evaluate(i),a=this.rhs.evaluate(i);if(n&&this.hasUntypedArgument){var s=wE(o),u=wE(a);if(s.kind!==u.kind||"string"!==s.kind&&"number"!==s.kind)throw new EE('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+s.kind+", "+u.kind+") instead.")}if(this.collator&&!n&&this.hasUntypedArgument){var l=wE(o),c=wE(a);if("string"!==l.kind||"string"!==c.kind)return e(i,o,a)}return this.collator?r(i,o,a,this.collator.evaluate(i)):e(i,o,a)},i.prototype.eachChild=function(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)},i.prototype.outputDefined=function(){return!0},i.prototype.serialize=function(){var e=[t];return this.eachChild((function(t){e.push(t.serialize())})),e},i}()}var fk=ck("==",(function(t,e,r){return e===r}),lk),pk=ck("!=",(function(t,e,r){return e!==r}),(function(t,e,r,n){return!lk(0,e,r,n)})),hk=ck("<",(function(t,e,r){return e<r}),(function(t,e,r,n){return n.compare(e,r)<0})),yk=ck(">",(function(t,e,r){return e>r}),(function(t,e,r,n){return n.compare(e,r)>0})),dk=ck("<=",(function(t,e,r){return e<=r}),(function(t,e,r,n){return n.compare(e,r)<=0})),gk=ck(">=",(function(t,e,r){return e>=r}),(function(t,e,r,n){return n.compare(e,r)>=0})),mk=function(t,e,r,n,i,o){this.type=$C,this.number=t,this.locale=e,this.currency=r,this.unit=n,this.minFractionDigits=i,this.maxFractionDigits=o};mk.parse=function(t,e){if(3!==t.length)return e.error("Expected two arguments.");var r=e.parse(t[1],1,JC);if(!r)return null;var n=t[2];if("object"!=typeof n||Array.isArray(n))return e.error("NumberFormat options argument must be an object.");var i=null;if(n.locale&&!(i=e.parse(n.locale,1,$C)))return null;var o=null;if(n.currency&&!(o=e.parse(n.currency,1,$C)))return null;var a=null;if(n.unit&&!(a=e.parse(n.unit,1,$C)))return null;var s=null;if(n["min-fraction-digits"]&&!(s=e.parse(n["min-fraction-digits"],1,JC)))return null;var u=null;return n["max-fraction-digits"]&&!(u=e.parse(n["max-fraction-digits"],1,JC))?null:new mk(r,i,o,a,s,u)},mk.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},mk.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},mk.prototype.outputDefined=function(){return!1},mk.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var vk=mk,_k=function(t){this.type=JC,this.input=t};_k.parse=function(t,e){if(2!==t.length)return e.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1);return r?"array"!==r.type.kind&&"string"!==r.type.kind&&"value"!==r.type.kind?e.error("Expected argument of type string or array, but found "+sE(r.type)+" instead."):new _k(r):null},_k.prototype.evaluate=function(t){var e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new EE("Expected value to be of type string or array, but found "+sE(wE(e))+" instead.")},_k.prototype.eachChild=function(t){t(this.input)},_k.prototype.outputDefined=function(){return!1},_k.prototype.serialize=function(){var t=["length"];return this.eachChild((function(e){t.push(e.serialize())})),t};var bk={"==":fk,"!=":pk,">":yk,"<":hk,">=":gk,"<=":dk,array:TE,at:JP,boolean:TE,case:ok,coalesce:ZP,collator:UE,format:RE,image:IE,in:QP,"index-of":ek,interpolate:WP,"interpolate-hcl":WP,"interpolate-lab":WP,length:_k,let:YP,literal:xE,match:nk,number:TE,"number-format":vk,object:TE,slice:sk,step:_P,string:TE,"to-boolean":DE,"to-color":DE,"to-number":DE,"to-string":DE,var:hP,within:uP};function wk(t,e){var r=e[0],n=e[1],i=e[2],o=e[3];r=r.evaluate(t),n=n.evaluate(t),i=i.evaluate(t);var a=o?o.evaluate(t):1,s=_E(r,n,i,a);if(s)throw new EE(s);return new FC(r/255*a,n/255*a,i/255*a,a)}function Sk(t,e){return t in e}function Ok(t,e){var r=e[t];return void 0===r?null:r}function xk(t){return{type:t}}BE.register(bk,{error:[{kind:"error"},[$C],function(t,e){var r=e[0];throw new EE(r.evaluate(t))}],typeof:[$C,[rE],function(t,e){return sE(wE(e[0].evaluate(t)))}],"to-rgba":[aE(JC,4),[tE],function(t,e){return e[0].evaluate(t).toArray()}],rgb:[tE,[JC,JC,JC],wk],rgba:[tE,[JC,JC,JC,JC],wk],has:{type:QC,overloads:[[[$C],function(t,e){return Sk(e[0].evaluate(t),t.properties())}],[[$C,eE],function(t,e){var r=e[0],n=e[1];return Sk(r.evaluate(t),n.evaluate(t))}]]},get:{type:rE,overloads:[[[$C],function(t,e){return Ok(e[0].evaluate(t),t.properties())}],[[$C,eE],function(t,e){var r=e[0],n=e[1];return Ok(r.evaluate(t),n.evaluate(t))}]]},"feature-state":[rE,[$C],function(t,e){return Ok(e[0].evaluate(t),t.featureState||{})}],properties:[eE,[],function(t){return t.properties()}],"geometry-type":[$C,[],function(t){return t.geometryType()}],id:[rE,[],function(t){return t.id()}],zoom:[JC,[],function(t){return t.globals.zoom}],pitch:[JC,[],function(t){return t.globals.pitch||0}],"distance-from-center":[JC,[],function(t){return t.distanceFromCenter()}],"heatmap-density":[JC,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[JC,[],function(t){return t.globals.lineProgress||0}],"sky-radial-progress":[JC,[],function(t){return t.globals.skyRadialProgress||0}],accumulated:[rE,[],function(t){return void 0===t.globals.accumulated?null:t.globals.accumulated}],"+":[JC,xk(JC),function(t,e){for(var r=0,n=0,i=e;n<i.length;n+=1)r+=i[n].evaluate(t);return r}],"*":[JC,xk(JC),function(t,e){for(var r=1,n=0,i=e;n<i.length;n+=1)r*=i[n].evaluate(t);return r}],"-":{type:JC,overloads:[[[JC,JC],function(t,e){var r=e[0],n=e[1];return r.evaluate(t)-n.evaluate(t)}],[[JC],function(t,e){return-e[0].evaluate(t)}]]},"/":[JC,[JC,JC],function(t,e){var r=e[0],n=e[1];return r.evaluate(t)/n.evaluate(t)}],"%":[JC,[JC,JC],function(t,e){var r=e[0],n=e[1];return r.evaluate(t)%n.evaluate(t)}],ln2:[JC,[],function(){return Math.LN2}],pi:[JC,[],function(){return Math.PI}],e:[JC,[],function(){return Math.E}],"^":[JC,[JC,JC],function(t,e){var r=e[0],n=e[1];return Math.pow(r.evaluate(t),n.evaluate(t))}],sqrt:[JC,[JC],function(t,e){var r=e[0];return Math.sqrt(r.evaluate(t))}],log10:[JC,[JC],function(t,e){var r=e[0];return Math.log(r.evaluate(t))/Math.LN10}],ln:[JC,[JC],function(t,e){var r=e[0];return Math.log(r.evaluate(t))}],log2:[JC,[JC],function(t,e){var r=e[0];return Math.log(r.evaluate(t))/Math.LN2}],sin:[JC,[JC],function(t,e){var r=e[0];return Math.sin(r.evaluate(t))}],cos:[JC,[JC],function(t,e){var r=e[0];return Math.cos(r.evaluate(t))}],tan:[JC,[JC],function(t,e){var r=e[0];return Math.tan(r.evaluate(t))}],asin:[JC,[JC],function(t,e){var r=e[0];return Math.asin(r.evaluate(t))}],acos:[JC,[JC],function(t,e){var r=e[0];return Math.acos(r.evaluate(t))}],atan:[JC,[JC],function(t,e){var r=e[0];return Math.atan(r.evaluate(t))}],min:[JC,xk(JC),function(t,e){return Math.min.apply(Math,e.map((function(e){return e.evaluate(t)})))}],max:[JC,xk(JC),function(t,e){return Math.max.apply(Math,e.map((function(e){return e.evaluate(t)})))}],abs:[JC,[JC],function(t,e){var r=e[0];return Math.abs(r.evaluate(t))}],round:[JC,[JC],function(t,e){var r=e[0].evaluate(t);return r<0?-Math.round(-r):Math.round(r)}],floor:[JC,[JC],function(t,e){var r=e[0];return Math.floor(r.evaluate(t))}],ceil:[JC,[JC],function(t,e){var r=e[0];return Math.ceil(r.evaluate(t))}],"filter-==":[QC,[$C,rE],function(t,e){var r=e[0],n=e[1];return t.properties()[r.value]===n.value}],"filter-id-==":[QC,[rE],function(t,e){var r=e[0];return t.id()===r.value}],"filter-type-==":[QC,[$C],function(t,e){var r=e[0];return t.geometryType()===r.value}],"filter-<":[QC,[$C,rE],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],o=n.value;return typeof i==typeof o&&i<o}],"filter-id-<":[QC,[rE],function(t,e){var r=e[0],n=t.id(),i=r.value;return typeof n==typeof i&&n<i}],"filter->":[QC,[$C,rE],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],o=n.value;return typeof i==typeof o&&i>o}],"filter-id->":[QC,[rE],function(t,e){var r=e[0],n=t.id(),i=r.value;return typeof n==typeof i&&n>i}],"filter-<=":[QC,[$C,rE],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],o=n.value;return typeof i==typeof o&&i<=o}],"filter-id-<=":[QC,[rE],function(t,e){var r=e[0],n=t.id(),i=r.value;return typeof n==typeof i&&n<=i}],"filter->=":[QC,[$C,rE],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],o=n.value;return typeof i==typeof o&&i>=o}],"filter-id->=":[QC,[rE],function(t,e){var r=e[0],n=t.id(),i=r.value;return typeof n==typeof i&&n>=i}],"filter-has":[QC,[rE],function(t,e){return e[0].value in t.properties()}],"filter-has-id":[QC,[],function(t){return null!==t.id()&&void 0!==t.id()}],"filter-type-in":[QC,[aE($C)],function(t,e){return e[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[QC,[aE(rE)],function(t,e){return e[0].value.indexOf(t.id())>=0}],"filter-in-small":[QC,[$C,aE(rE)],function(t,e){var r=e[0];return e[1].value.indexOf(t.properties()[r.value])>=0}],"filter-in-large":[QC,[$C,aE(rE)],function(t,e){var r=e[0],n=e[1];return function(t,e,r,n){for(;r<=n;){var i=r+n>>1;if(e[i]===t)return!0;e[i]>t?n=i-1:r=i+1}return!1}(t.properties()[r.value],n.value,0,n.value.length-1)}],all:{type:QC,overloads:[[[QC,QC],function(t,e){var r=e[0],n=e[1];return r.evaluate(t)&&n.evaluate(t)}],[xk(QC),function(t,e){for(var r=0,n=e;r<n.length;r+=1)if(!n[r].evaluate(t))return!1;return!0}]]},any:{type:QC,overloads:[[[QC,QC],function(t,e){var r=e[0],n=e[1];return r.evaluate(t)||n.evaluate(t)}],[xk(QC),function(t,e){for(var r=0,n=e;r<n.length;r+=1)if(n[r].evaluate(t))return!0;return!1}]]},"!":[QC,[QC],function(t,e){return!e[0].evaluate(t)}],"is-supported-script":[QC,[$C],function(t,e){var r=e[0],n=t.globals&&t.globals.isSupportedScript;return!n||n(r.evaluate(t))}],upcase:[$C,[$C],function(t,e){return e[0].evaluate(t).toUpperCase()}],downcase:[$C,[$C],function(t,e){return e[0].evaluate(t).toLowerCase()}],concat:[$C,xk(rE),function(t,e){return e.map((function(e){return SE(e.evaluate(t))})).join("")}],"resolved-locale":[$C,[nE],function(t,e){return e[0].evaluate(t).resolvedLocale()}]});var Ck=bk;function Ek(t){return{result:"success",value:t}}function Pk(t){return{result:"error",value:t}}function kk(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}var Tk=function(t,e){this.expression=t,this._warningHistory={},this._evaluator=new zE,this._defaultValue=e?function(t){return"color"===t.type&&(kk(t.default)||Array.isArray(t.default))?new FC(0,0,0,0):"color"===t.type?FC.parse(t.default)||null:void 0===t.default?null:t.default}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null};function jk(t,e){var r=new dP(Ck,[],e?function(t){var e={color:tE,string:$C,number:JC,enum:$C,boolean:QC,formatted:iE,resolvedImage:oE};return"array"===t.type?aE(e[t.value]||rE,t.length):e[t.type]}(e):void 0),n=r.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return n?Ek(new Tk(n,e)):Pk(r.errors)}Tk.prototype.evaluateWithoutErrorHandling=function(t,e,r,n,i,o,a,s){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=r,this._evaluator.canonical=n||null,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=s||null,this.expression.evaluate(this._evaluator)},Tk.prototype.evaluate=function(t,e,r,n,i,o,a,s){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=r||null,this._evaluator.canonical=n||null,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=s||null;try{var u=this.expression.evaluate(this._evaluator);if(null==u||"number"==typeof u&&u!=u)return this._defaultValue;if(this._enumValues&&!(u in this._enumValues))throw new EE("Expected value to be one of "+Object.keys(this._enumValues).map((function(t){return JSON.stringify(t)})).join(", ")+", but found "+JSON.stringify(u)+" instead.");return u}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}};var Rk=function(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!cP(e.expression)};Rk.prototype.evaluateWithoutErrorHandling=function(t,e,r,n,i,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r,n,i,o)},Rk.prototype.evaluate=function(t,e,r,n,i,o){return this._styleExpression.evaluate(t,e,r,n,i,o)};var Lk=function(t,e,r,n){this.kind=t,this.zoomStops=r,this._styleExpression=e,this.isStateDependent="camera"!==t&&!cP(e.expression),this.interpolationType=n};function Ik(t,e){if("error"===(t=jk(t,e)).result)return t;var r=t.value.expression,n=lP(r);if(!n&&!function(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}(e))return Pk([new ZC("","data expressions not supported")]);var i=fP(r,["zoom","pitch","distance-from-center"]);if(!i&&!function(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}(e))return Pk([new ZC("","zoom expressions not supported")]);var o=Mk(r);if(!o&&!i)return Pk([new ZC("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(o instanceof ZC)return Pk([o]);if(o instanceof WP&&!function(t){return!!t.expression&&t.expression.interpolated}(e))return Pk([new ZC("",'"interpolate" expressions cannot be used with this property')]);if(!o)return Ek(new Rk(n?"constant":"source",t.value));var a=o instanceof WP?o.interpolation:void 0;return Ek(new Lk(n?"camera":"composite",t.value,o.labels,a))}function Mk(t){var e=null;if(t instanceof YP)e=Mk(t.result);else if(t instanceof ZP)for(var r=0,n=t.args;r<n.length;r+=1){var i=n[r];if(e=Mk(i))break}else(t instanceof _P||t instanceof WP)&&t.input instanceof BE&&"zoom"===t.input.name&&(e=t);return e instanceof ZC||t.eachChild((function(t){var r=Mk(t);r instanceof ZC?e=r:!e&&r?e=new ZC("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&r&&e!==r&&(e=new ZC("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}function Ak(t){if(Array.isArray(t))return t.map(Ak);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var e={};for(var r in t)e[r]=Ak(t[r]);return e}return function(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}(t)}Lk.prototype.evaluateWithoutErrorHandling=function(t,e,r,n,i,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r,n,i,o)},Lk.prototype.evaluate=function(t,e,r,n,i,o){return this._styleExpression.evaluate(t,e,r,n,i,o)},Lk.prototype.interpolationFactor=function(t,e,r){return this.interpolationType?WP.interpolationFactor(this.interpolationType,t,e,r):0};var Dk={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},fog:{type:"fog"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},projection:{type:"projection"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{},sky:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"},"fill-extrusion-edge-radius":{type:"number",private:!0,default:0,minimum:0,maximum:1,"property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_symbol:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature","pitch","distance-from-center"]}},filter_fill:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_line:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_circle:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},"filter_fill-extrusion":{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_heatmap:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},expression_name:{type:"enum",values:{let:{group:"Variable binding"},var:{group:"Variable binding"},literal:{group:"Types"},array:{group:"Types"},at:{group:"Lookup"},in:{group:"Lookup"},"index-of":{group:"Lookup"},slice:{group:"Lookup"},case:{group:"Decision"},match:{group:"Decision"},coalesce:{group:"Decision"},step:{group:"Ramps, scales, curves"},interpolate:{group:"Ramps, scales, curves"},"interpolate-hcl":{group:"Ramps, scales, curves"},"interpolate-lab":{group:"Ramps, scales, curves"},ln2:{group:"Math"},pi:{group:"Math"},e:{group:"Math"},typeof:{group:"Types"},string:{group:"Types"},number:{group:"Types"},boolean:{group:"Types"},object:{group:"Types"},collator:{group:"Types"},format:{group:"Types"},image:{group:"Types"},"number-format":{group:"Types"},"to-string":{group:"Types"},"to-number":{group:"Types"},"to-boolean":{group:"Types"},"to-rgba":{group:"Color"},"to-color":{group:"Types"},rgb:{group:"Color"},rgba:{group:"Color"},get:{group:"Lookup"},has:{group:"Lookup"},length:{group:"Lookup"},properties:{group:"Feature data"},"feature-state":{group:"Feature data"},"geometry-type":{group:"Feature data"},id:{group:"Feature data"},zoom:{group:"Camera"},pitch:{group:"Camera"},"distance-from-center":{group:"Camera"},"heatmap-density":{group:"Heatmap"},"line-progress":{group:"Feature data"},"sky-radial-progress":{group:"sky"},accumulated:{group:"Feature data"},"+":{group:"Math"},"*":{group:"Math"},"-":{group:"Math"},"/":{group:"Math"},"%":{group:"Math"},"^":{group:"Math"},sqrt:{group:"Math"},log10:{group:"Math"},ln:{group:"Math"},log2:{group:"Math"},sin:{group:"Math"},cos:{group:"Math"},tan:{group:"Math"},asin:{group:"Math"},acos:{group:"Math"},atan:{group:"Math"},min:{group:"Math"},max:{group:"Math"},round:{group:"Math"},abs:{group:"Math"},ceil:{group:"Math"},floor:{group:"Math"},distance:{group:"Math"},"==":{group:"Decision"},"!=":{group:"Decision"},">":{group:"Decision"},"<":{group:"Decision"},">=":{group:"Decision"},"<=":{group:"Decision"},all:{group:"Decision"},any:{group:"Decision"},"!":{group:"Decision"},within:{group:"Decision"},"is-supported-script":{group:"String"},upcase:{group:"String"},downcase:{group:"String"},concat:{group:"String"},"resolved-locale":{group:"String"}}},fog:{range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"high-color":{type:"color","property-type":"data-constant",default:"#245cdf",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"space-color":{type:"color","property-type":"data-constant",default:["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:["interpolate",["linear"],["zoom"],4,.2,7,.1],minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"star-intensity":{type:"number","property-type":"data-constant",default:["interpolate",["linear"],["zoom"],5,.35,6,0],minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},projection:{name:{type:"enum",values:{albers:{},equalEarth:{},equirectangular:{},lambertConformalConic:{},mercator:{},naturalEarth:{},winkelTripel:{},globe:{}},default:"mercator",required:!0},center:{type:"array",length:2,value:"number","property-type":"data-constant",minimum:[-180,-90],maximum:[180,90],transition:!1,requires:[{name:["albers","lambertConformalConic"]}]},parallels:{type:"array",length:2,value:"number","property-type":"data-constant",minimum:[-90,-90],maximum:[90,90],transition:!1,requires:[{name:["albers","lambertConformalConic"]}]}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,requires:["source"]}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant",type:"number",private:!0,default:0,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant",type:"number",private:!0,default:3,minimum:0,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{type:"array",value:"number",length:2,default:[0,0],minimum:[0,0],maximum:[1,1],transition:!1,requires:[{source:"geojson",has:{lineMetrics:!0}}],"property-type":"constant"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{},atmosphere:{}},default:"atmosphere",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],transition:!1,requires:[{"sky-type":"gradient"}],expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};function Nk(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var e=0,r=t.slice(1);e<r.length;e+=1){var n=r[e];if(!Nk(n)&&"boolean"!=typeof n)return!1}return!0;default:return!0}}function Fk(t,e){if(void 0===e&&(e="fill"),null==t)return{filter:function(){return!0},needGeometry:!1,needFeature:!1};Nk(t)||(t=Wk(t));var r=t,n=!0;try{n=function(t){if(!Bk(t))return t;var e=Ak(t);return Gk(e),zk(e)}(r)}catch(t){console.warn("Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n"+JSON.stringify(r,null,2)+"\n        ")}var i,o=Dk["filter_"+e],a=jk(n,o);if("error"===a.result)throw new Error(a.value.map((function(t){return t.key+": "+t.message})).join(", "));i=function(t,e,r){return a.value.evaluate(t,e,{},r)};var s=null,u=null;if(n!==r){var l=jk(r,o);if("error"===l.result)throw new Error(l.value.map((function(t){return t.key+": "+t.message})).join(", "));s=function(t,e,r,n,i){return l.value.evaluate(t,e,{},r,void 0,void 0,n,i)},u=!lP(l.value.expression)}return{filter:i,dynamicFilter:s||void 0,needGeometry:qk(n),needFeature:!!u}}function zk(t){if(!Array.isArray(t))return t;var e=function(t){if(Vk.has(t[0]))for(var e=1;e<t.length;e++)if(Bk(t[e]))return!0;return t}(t);return!0===e?e:e.map((function(t){return zk(t)}))}function Gk(t){var e=!1,r=[];if("case"===t[0]){for(var n=1;n<t.length-1;n+=2)e=e||Bk(t[n]),r.push(t[n+1]);r.push(t[t.length-1])}else if("match"===t[0]){e=e||Bk(t[1]);for(var i=2;i<t.length-1;i+=2)r.push(t[i+1]);r.push(t[t.length-1])}else if("step"===t[0]){e=e||Bk(t[1]);for(var o=1;o<t.length-1;o+=2)r.push(t[o+1])}e&&(t.length=0,t.push.apply(t,["any"].concat(r)));for(var a=1;a<t.length;a++)Gk(t[a])}function Bk(t){if(!Array.isArray(t))return!1;if("pitch"===(e=t[0])||"distance-from-center"===e)return!0;for(var e,r=1;r<t.length;r++)if(Bk(t[r]))return!0;return!1}var Vk=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Uk(t,e){return t<e?-1:t>e?1:0}function qk(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(var e=1;e<t.length;e++)if(qk(t[e]))return!0;return!1}function Wk(t){if(!t)return!0;var e,r=t[0];return t.length<=1?"any"!==r:"=="===r?Xk(t[1],t[2],"=="):"!="===r?Yk(Xk(t[1],t[2],"==")):"<"===r||">"===r||"<="===r||">="===r?Xk(t[1],t[2],r):"any"===r?(e=t.slice(1),["any"].concat(e.map(Wk))):"all"===r?["all"].concat(t.slice(1).map(Wk)):"none"===r?["all"].concat(t.slice(1).map(Wk).map(Yk)):"in"===r?Zk(t[1],t.slice(2)):"!in"===r?Yk(Zk(t[1],t.slice(2))):"has"===r?Hk(t[1]):"!has"===r?Yk(Hk(t[1])):"within"!==r||t}function Xk(t,e,r){switch(t){case"$type":return["filter-type-"+r,e];case"$id":return["filter-id-"+r,e];default:return["filter-"+r,t,e]}}function Zk(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((function(t){return typeof t!=typeof e[0]}))?["filter-in-large",t,["literal",e.sort(Uk)]]:["filter-in-small",t,["literal",e]]}}function Hk(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Yk(t){return["!",t]}var Kk=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Jk(t,e){var r={};for(var n in t)"ref"!==n&&(r[n]=t[n]);return Kk.forEach((function(t){t in e&&(r[t]=e[t])})),r}var $k={thin:100,hairline:100,"ultra-light":100,"extra-light":100,light:200,book:300,regular:400,normal:400,plain:400,roman:400,standard:400,medium:500,"semi-bold":600,"demi-bold":600,bold:700,heavy:800,black:800,"extra-bold":800,"ultra-black":900,"extra-black":900,"ultra-bold":900,"heavy-black":900,fat:900,poster:900},Qk=" ",tT=/(italic|oblique)$/i,eT={},rT=function(t,e,r){var n=eT[t];if(!n){Array.isArray(t)||(t=[t]);for(var i=400,o="normal",a=[],s=0,u=t.length;s<u;++s){var l=t[s].split(" "),c=l[l.length-1].toLowerCase();for(var f in"normal"==c||"italic"==c||"oblique"==c?(o=c,l.pop(),c=l[l.length-1].toLowerCase()):tT.test(c)&&(c=c.replace(tT,""),o=l[l.length-1].replace(c,"")),$k){var p=l.length>1?l[l.length-2].toLowerCase():"";if(c==f||c==f.replace("-","")||p+"-"+c==f){i=$k[f],l.pop(),p&&f.startsWith(p)&&l.pop();break}}"number"==typeof c&&(i=c);var h=l.join(Qk).replace("Klokantech Noto Sans","Noto Sans");-1!==h.indexOf(Qk)&&(h='"'+h+'"'),a.push(h)}n=eT[t]=[o,i,a]}return n[0]+Qk+n[1]+Qk+e+"px"+(r?"/"+r:"")+Qk+n[2]},nT="https://api.mapbox.com";function iT(t){return 0!==t.indexOf("mapbox://")?"":t.slice(9)}function oT(t,e){var r=iT(t);if(!r)return decodeURI(new URL(t,location.href).href);if(0!==r.indexOf("styles/"))throw new Error("unexpected style url: "+t);var n=r.slice(7);return nT+"/styles/v1/"+n+"?&access_token="+e}function aT(t,e,r,n){var i=new URL(t,n),o=iT(t);return o?"mapbox.satellite"===o?"https://api.mapbox.com/v4/"+o+"/{z}/{x}/{y}"+(window.devicePixelRatio>=1.5?"@2x":"")+".webp?access_token="+e:"https://{a-d}.tiles.mapbox.com/v4/"+o+"/{z}/{x}/{y}.vector.pbf?access_token="+e:e?(i.searchParams.set(r,e),decodeURI(i.href)):decodeURI(i.href)}function sT(t){return t*Math.PI/180}var uT=function(){for(var t=[],e=78271.51696402048;t.length<=24;e/=2)t.push(e);return t}();function lT(t,e){if("undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"undefined"!=typeof OffscreenCanvas)return new OffscreenCanvas(t,e);var r=document.createElement("canvas");return r.width=t,r.height=e,r}function cT(t,e){for(var r=0,n=e.length;r<n;++r)if(e[r]<t&&r+1<n){var i=e[r]/e[r+1];return r+Math.log(e[r]/t)/Math.log(i)}return n-1}var fT={};function pT(t,e,r,n){if(void 0===r&&(r={}),e in fT)return n&&(n.request=fT[e][0]),fT[e][1];var i=r.transformRequest&&r.transformRequest(e,t)||new Request(e);i.headers.get("Accept")||i.headers.set("Accept","application/json"),n&&(n.request=i);var o=fetch(i).then((function(t){return delete fT[e],t.ok?t.json():Promise.reject(new Error("Error fetching source "+e))})).catch((function(t){return delete fT[e],Promise.reject(new Error("Error fetching source "+e))}));return fT[e]=[i,o],o}function hT(t,e){if("string"!=typeof t)return Promise.resolve(t);if(!t.trim().startsWith("{"))return pT("Style",t=oT(t,e.accessToken),e);try{var r=JSON.parse(t);return Promise.resolve(r)}catch(t){return Promise.reject(t)}}function yT(t,e){if(e.transformRequest){var r=e.transformRequest(t,"Tiles");if(r instanceof Request)return decodeURI(r.url)}return t}var dT={};function gT(t,e,r){void 0===r&&(r={});var n=[e,JSON.stringify(t)].toString(),i=dT[n];if(!i||r.transformRequest){var o=t.url;if(o&&!t.tiles){var a=aT(o,r.accessToken,r.accessTokenParam||"access_token",e||location.href);if(o.startsWith("mapbox://"))i=Promise.resolve(Object.assign({},t,{url:void 0,tiles:Im(a)}));else{var s={};i=pT("Source",a,r,s).then((function(t){return t.tiles=t.tiles.map((function(t){return yT(aT(t,r.accessToken,r.accessTokenParam||"access_token",s.request.url),r)})),Promise.resolve(t)}))}}else t=Object.assign({},t,{tiles:t.tiles.map((function(t){return yT(aT(t,r.accessToken,r.accessTokenParam||"access_token",e||location.href),r)}))}),i=Promise.resolve(Object.assign({},t));dT[n]=i}return i}var mT,vT=Array(256).join(" ");function _T(t,e){if(e>=.05){for(var r="",n=t.split("\n"),i=vT.slice(0,Math.round(e/.1)),o=0,a=n.length;o<a;++o)o>0&&(r+="\n"),r+=n[o].split("").join(i);return r}return t}function bT(){return mT||(mT=lT(1,1).getContext("2d")),mT}function wT(t,e){return bT().measureText(t).width+(t.length-1)*e}var ST={};function OT(t,e,r,n){if(-1!==t.indexOf("\n")){for(var i=t.split("\n"),o=[],a=0,s=i.length;a<s;++a)o.push(OT(i[a],e,r,n));return o.join("\n")}var u=r+","+e+","+t+","+n,l=ST[u];if(!l){var c=t.split(" ");if(c.length>1){var f=bT();f.font=e;for(var p=f.measureText("M").width*r,h="",y=[],d=0,g=c.length;d<g;++d){var m=c[d],v=h+(h?" ":"")+m;wT(v,n)<=p?h=v:(h&&y.push(h),h=m)}h&&y.push(h);for(var _=0,b=y.length;_<b&&b>1;++_){var w=y[_];if(wT(w,n)<.35*p){var S=_>0?wT(y[_-1],n):1/0,O=_<b-1?wT(y[_+1],n):1/0;y.splice(_,1),b-=1,S<O?(y[_-1]+=" "+w,_-=1):y[_]=w+" "+y[_]}}for(var x=0,C=y.length-1;x<C;++x){var E=y[x],P=y[x+1];if(wT(E,n)>.7*p&&wT(P,n)<.6*p){var k=E.split(" "),T=k.pop();wT(T,n)<.2*p&&(y[x]=k.join(" "),y[x+1]=T+" "+P),C-=1}}l=y.join("\n")}else l=t;l=_T(l,n),ST[u]=l}return l}var xT,CT=/font-family: ?([^;]*);/,ET=/("|')/g;function PT(t){if(!xT){xT={};for(var e=document.styleSheets,r=0,n=e.length;r<n;++r){var i=e[r];try{var o=i.rules||i.cssRules;if(o)for(var a=0,s=o.length;a<s;++a){var u=o[a];if(5==u.type){var l=u.cssText.match(CT);xT[l[1].replace(ET,"")]=!0}}}catch(t){}}}return t in xT}var kT={};function TT(t){var e=t.toString();if(e in kT)return kT[e];for(var r=[],n=0,i=t.length;n<i;++n){t[n]=t[n].replace("Arial Unicode MS","Arial");var o=t[n],a=rT(o,1);Gy(a);var s=a.split(" ");r.push([s.slice(3).join(" ").replace(/"/g,""),s[1],s[0]])}for(var u=0,l=r.length;u<l;++u){var c=r[u],f=c[0];if(!PT(f)&&100!==Ay.get(c[2]+"\n"+c[1]+" \n"+f)){var p="https://fonts.googleapis.com/css?family="+f.replace(/ /g,"+")+":"+c[1]+c[2];if(!document.querySelector('link[href="'+p+'"]')){var h=document.createElement("link");h.href=p,h.rel="stylesheet",document.head.appendChild(h)}}}return kT[e]=t,t}var jT,RT,LT={Point:1,MultiPoint:1,LineString:2,MultiLineString:2,Polygon:3,MultiPolygon:3},IT={center:[.5,.5],left:[0,.5],right:[1,.5],top:[.5,0],bottom:[.5,1],"top-left":[0,0],"top-right":[1,0],"bottom-left":[0,1],"bottom-right":[1,1]},MT=function(t,e){var r=Ik(t,e);if("error"===r.result)throw new Error(r.value.map((function(t){return t.key+": "+t.message})).join(", "));return r.value},AT={},DT={zoom:0};function NT(t,e,r,n,i,o,a){var s=t.id;o||(o={},console.warn("No functionCache provided to getValue()")),o[s]||(o[s]={});var u,l=o[s];if(!l[r]){var c=(t[e]||AT)[r],f=Dk[e+"_"+t.type][r];void 0===c&&(c=f.default);var p=(u=c,Array.isArray(u)&&u.length>0&&"string"==typeof u[0]&&u[0]in Ck);if(!p&&kk(c)&&(c=function(t,e){var r=t.stops;if(!r)return function(t,e){var r=["get",t.property];if(void 0===t.default)return"string"===e.type?["string",r]:r;if("enum"===e.type)return["match",r,Object.keys(e.values),r,t.default];var n=["color"===e.type?"to-color":e.type,r,zC(t.default)];return"array"===e.type&&n.splice(1,0,e.value,e.length||null),n}(t,e);var n=r&&"object"==typeof r[0][0],i=n||void 0!==t.property,o=n||!i;return r=r.map((function(t){return!i&&e.tokens&&"string"==typeof t[1]?[t[0],XC(t[1])]:[t[0],zC(t[1])]})),n?function(t,e,r){for(var n={},i={},o=[],a=0;a<r.length;a++){var s=r[a],u=s[0].zoom;void 0===n[u]&&(n[u]={zoom:u,type:t.type,property:t.property,default:t.default},i[u]=[],o.push(u)),i[u].push([s[0].value,s[1]])}if("exponential"===WC({},e)){for(var l=[GC(t),["linear"],["zoom"]],c=0,f=o;c<f.length;c+=1){var p=f[c];qC(l,p,VC(n[p],e,i[p]),!1)}return l}for(var h=["step",["zoom"]],y=0,d=o;y<d.length;y+=1){var g=d[y];qC(h,g,VC(n[g],e,i[g]),!0)}return UC(h),h}(t,e,r):o?function(t,e,r,n){void 0===n&&(n=["zoom"]);var i,o=WC(t,e),a=!1;if("interval"===o)i=["step",n],a=!0;else{if("exponential"!==o)throw new Error('Unknown zoom function type "'+o+'"');var s=void 0!==t.base?t.base:1;i=[GC(t),1===s?["linear"]:["exponential",s],n]}for(var u=0,l=r;u<l.length;u+=1){var c=l[u];qC(i,c[0],c[1],a)}return UC(i),i}(t,e,r):VC(t,e,r)}(c,f),p=!0),p){var h=MT(c,f);l[r]=h.evaluate.bind(h)}else"color"==f.type&&(c=FC.parse(c)),l[r]=function(){return c}}return DT.zoom=n,l[r](DT,i,a)}function FT(t,e,r,n){return NT(t,"layout","icon-allow-overlap",e,r,n)?NT(t,"layout","icon-ignore-placement",e,r,n)?"none":"obstacle":"declutter"}function zT(t,e,r,n,i){return i||console.warn("No filterCache provided to evaluateFilter()"),t in i||(i[t]=Fk(e).filter),DT.zoom=n,i[t](DT,r)}var GT=!1;function BT(t,e){if(t){if(!GT&&(0===t.a||0===e))return;var r=t.a;return e=void 0===e?1:e,0===r?"transparent":"rgba("+Math.round(255*t.r/r)+","+Math.round(255*t.g/r)+","+Math.round(255*t.b/r)+","+r*e+")"}return t}var VT=/\{[^{}}]*\}/g;function UT(t,e){return t.replace(VT,(function(t){return e[t.slice(1,-1)]||""}))}var qT=!1;function WT(t,e){var r,n,i,o,a,s,u,l,c,f,p,h,y,d,g,m,v,_,b,w,S=t[0],O=S.width,x=S.height,C=S.data,E=new Uint8ClampedArray(C.length),P=2*e.resolution,k=O-1,T=x-1,j=[0,0,0,0],R=2*Math.PI,L=Math.PI/2,I=Math.PI*e.sunEl/180,M=Math.PI*e.sunAz/180,A=Math.cos(I),D=Math.sin(I),N=e.highlightColor,F=e.shadowColor,z=e.accentColor;function G(t){return.1*(256*t[0]*256+256*t[1]+t[2])-1e4}for(n=0;n<=T;++n)for(o=0===n?0:n-1,a=n===T?T:n+1,r=0;r<=k;++r)i=r===k?k:r+1,s=4*(n*O+(0===r?0:r-1)),j[0]=C[s],j[1]=C[s+1],j[2]=C[s+2],j[3]=C[s+3],u=e.vert*G(j),s=4*(n*O+i),j[0]=C[s],j[1]=C[s+1],j[2]=C[s+2],j[3]=C[s+3],l=(e.vert*G(j)-u)/P,s=4*(o*O+r),j[0]=C[s],j[1]=C[s+1],j[2]=C[s+2],j[3]=C[s+3],u=e.vert*G(j),s=4*(a*O+r),j[0]=C[s],j[1]=C[s+1],j[2]=C[s+2],j[3]=C[s+3],c=(e.vert*G(j)-u)/P,p=(p=Math.atan2(c,-l))<0?L-p:p>L?R-p+L:L-p,f=Math.atan(Math.sqrt(l*l+c*c)),w=D*Math.cos(f)+A*Math.sin(f)*Math.cos(M-p),h=Math.cos(f),y=255*w,v=Math.min(Math.max(2*e.sunEl,0),1),_=1.875-1.75*e.opacity,b=.5!==e.opacity?L*((Math.pow(_,f)-1)/(Math.pow(_,L)-1)):f,g={r:(1-h)*z.r*v*255,g:(1-h)*z.g*v*255,b:(1-h)*z.b*v*255,a:(1-h)*z.a*v*255},d=Math.abs(((p+M)/Math.PI+.5)%2-1),m={r:(N.r*(1-d)+F.r*d)*y,g:(N.g*(1-d)+F.g*d)*y,b:(N.b*(1-d)+F.b*d)*y,a:(N.a*(1-d)+F.a*d)*y},E[s=4*(n*O+r)]=g.r*(1-d)+m.r,E[s+1]=g.g*(1-d)+m.g,E[s+2]=g.b*(1-d)+m.b,E[s+3]=C[s+3]*e.opacity*v*Math.sin(b);return new ImageData(E,O,x)}function XT(t,e){return e.accessToken||(e=Object.assign({},e),new URL(t).searchParams.forEach((function(t,r){e.accessToken=t,e.accessTokenParam=r}))),e}function ZT(t,e,r,n,i){var o,a,s,u;return void 0===r&&(r=""),void 0===n&&(n={}),void 0===i&&(i=void 0),"string"==typeof r||Array.isArray(r)?u=r:(u=(s=r).source||s.layers,n=s),"string"==typeof n?(o=n,s={}):(o=n.styleUrl,s=n),i||(i=s.resolutions),o||"string"!=typeof e||e.trim().startsWith("{")||(o=e),o&&(o=o.startsWith("data:")?location.href:oT(o,s.accessToken),s=XT(o,s)),new Promise((function(r,n){hT(e,s).then((function(e){if(8!=e.version)return n(new Error("glStyle version 8 required."));if(!(t instanceof Kx||t instanceof vC))return n(new Error("Can only apply to VectorLayer or VectorTileLayer"));var l,c,f,p=t instanceof vC?"vector":"geojson";if(u?a=Array.isArray(u)?e.layers.find((function(t){return t.id===u[0]})).source:u:(a=Object.keys(e.sources).find((function(t){return e.sources[t].type===p})),u=a),!a)return n(new Error("No "+p+" source found in the glStyle."));function h(){if(t instanceof vC)return JT(e.sources[a],o,s).then((function(e){var r=t.getSource();if(r?e!==r&&(r.setTileUrlFunction(e.getTileUrlFunction()),r.format_||(r.format_=e.format_),r.getAttributions()||r.setAttributions(e.getAttributions()),r.getTileLoadFunction()===TC&&r.setTileLoadFunction(e.getTileLoadFunction()),Yg(r.getProjection(),e.getProjection())&&(r.tileGrid=e.getTileGrid())):t.setSource(e),!isFinite(t.getMaxResolution())&&!isFinite(t.getMinZoom())){var n=t.getSource().getTileGrid();t.setMaxResolution(n.getResolution(n.getMinZoom()))}}));var r=e.sources[a],n=t.getSource();n&&n.get("mapbox-source")===r||(n=tj(r,o,s));var i=t.getSource();return i?n!==i&&(i.getAttributions()||i.setAttributions(n.getAttributions()),i.format_||(i.format_=n.getFormat()),i.url_=n.getUrl()):t.setSource(n),Promise.resolve()}function y(){f||e.sprite&&!l?f?(t.setStyle(f),h().then(r).catch(n)):n(new Error("Something went wrong trying to apply style.")):(f=function(t,e,r,n,i,o,a,s){if(void 0===n&&(n=uT),void 0===i&&(i=void 0),void 0===o&&(o=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),"string"==typeof e&&(e=JSON.parse(e)),8!=e.version)throw new Error("glStyle version 8 required.");var u,l;if(o)if("undefined"!=typeof Image){var c=new Image;c.crossOrigin="anonymous",c.onload=function(){u=c,l=[c.width,c.height],t.changed(),c.onload=null},c.src=o}else if("undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope){var f=self;f.postMessage({action:"loadImage",src:o}),f.addEventListener("message",(function(t){"imageLoaded"===t.data.action&&t.data.src===o&&(u=t.data.image,l=[u.width,u.height])}))}for(var p,h=function(t){t=t.slice();for(var e=Object.create(null),r=0;r<t.length;r++)e[t[r].id]=t[r];for(var n=0;n<t.length;n++)"ref"in t[n]&&(t[n]=Jk(t[n],e[t[n].ref]));return t}(e.layers),y={},d=[],g={},m={},v={},_={},b=0,w=h.length;b<w;++b){var S=h[b],O=S.id;if("string"==typeof r&&S.source==r||-1!==r.indexOf(O)){var x=S["source-layer"];if(p){if(S.source!==p)throw new Error('Layer "'+O+'" does not use source "'+p)}else{p=S.source;var C=e.sources[p];if(!C)throw new Error('Source "'+p+'" is not defined');var E=C.type;if("vector"!==E&&"geojson"!==E)throw new Error('Source "'+p+'" is not of type "vector" or "geojson", but "'+E+'"')}var P=y[x];P||(P=[],y[x]=P),P.push({layer:S,index:b}),d.push(O)}}var k=new _m,T=new $y,j=[],R=function(e,r){var o=e.getProperties(),c=y[o.layer];if(c){var f=n.indexOf(r);-1==f&&(f=cT(r,n));for(var p,h=LT[e.getGeometry().getType()],d={properties:o,type:h},b=t.get("mapbox-featurestate")[e.getId()],w=-1,S=0,O=c.length;S<O;++S){var x=c[S],C=x.layer,E=C.id,P=C.layout||AT,R=C.paint||AT;if(!("none"===P.visibility||"minzoom"in C&&f<C.minzoom||"maxzoom"in C&&f>=C.maxzoom)){var L=C.filter;if(!L||zT(E,L,d,f,_)){p=C;var I=void 0,M=void 0,A=void 0,D=void 0,N=void 0,F=void 0,z=x.index;if(3==h&&("fill"==C.type||"fill-extrusion"==C.type))if(M=NT(C,"paint",C.type+"-opacity",f,d,v,b),C.type+"-pattern"in R){var G=NT(C,"paint",C.type+"-pattern",f,d,v,b);if(G){var B="string"==typeof G?UT(G,o):G.toString();if(u&&i&&i[B]){++w,(F=j[w])&&F.getFill()&&!F.getStroke()&&!F.getText()||(F=new xm({fill:new $y}),j[w]=F),A=F.getFill(),F.setZIndex(z);var V=B+"."+M,U=m[V];if(!U){var q=i[B],W=lT(q.width,q.height),X=W.getContext("2d");X.globalAlpha=M,X.drawImage(u,q.x,q.y,q.width,q.height,0,0,q.width,q.height),U=X.createPattern(W,"repeat"),m[V]=U}A.setColor(U)}}}else I=BT(NT(C,"paint",C.type+"-color",f,d,v,b),M),C.type+"-outline-color"in R&&(N=BT(NT(C,"paint",C.type+"-outline-color",f,d,v,b),M)),N||(N=I),(I||N)&&(++w,(!(F=j[w])||I&&!F.getFill()||!I&&F.getFill()||N&&!F.getStroke()||!N&&F.getStroke()||F.getText())&&(F=new xm({fill:I?new $y:void 0,stroke:N?new _m:void 0}),j[w]=F),I&&(A=F.getFill()).setColor(I),N&&((D=F.getStroke()).setColor(N),D.setWidth(.5)),F.setZIndex(z));if(1!=h&&"line"==C.type){I=!("line-pattern"in R)&&"line-color"in R?BT(NT(C,"paint","line-color",f,d,v,b),NT(C,"paint","line-opacity",f,d,v,b)):void 0;var Z=NT(C,"paint","line-width",f,d,v,b);I&&Z>0&&(++w,(F=j[w])&&F.getStroke()&&!F.getFill()&&!F.getText()||(F=new xm({stroke:new _m}),j[w]=F),(D=F.getStroke()).setLineCap(NT(C,"layout","line-cap",f,d,v,b)),D.setLineJoin(NT(C,"layout","line-join",f,d,v,b)),D.setMiterLimit(NT(C,"layout","line-miter-limit",f,d,v,b)),D.setColor(I),D.setWidth(Z),D.setLineDash(R["line-dasharray"]?NT(C,"paint","line-dasharray",f,d,v,b).map((function(t){return t*Z})):null),F.setZIndex(z))}var H=!1,Y=null,K=0,J=void 0,$=void 0,Q=void 0;if((1==h||2==h)&&"icon-image"in P){var tt=NT(C,"layout","icon-image",f,d,v,b);if(tt){J="string"==typeof tt?UT(tt,o):tt.toString();var et=void 0,rt=s?s(t,J):void 0;if(u&&i&&i[J]||rt){var nt=NT(C,"layout","icon-rotation-alignment",f,d,v,b);if(2==h){var it=e.getGeometry();if(it.getFlatMidpoint||it.getFlatMidpoints){var ot=it.getExtent();if(Math.sqrt(Math.max(Math.pow((ot[2]-ot[0])/r,2),Math.pow((ot[3]-ot[1])/r,2)))>150){var at="MultiLineString"===it.getType()?it.getFlatMidpoints():it.getFlatMidpoint();if(RT||(RT=new mm("Point",jT=[NaN,NaN],[],{},null)),et=RT,jT[0]=at[0],jT[1]=at[1],"line"===NT(C,"layout","symbol-placement",f,d,v,b)&&"map"===nt)for(var st=it.getStride(),ut=it.getFlatCoordinates(),lt=0,ct=ut.length-st;lt<ct;lt+=st){var ft=ut[lt],pt=ut[lt+1],ht=ut[lt+st],yt=ut[lt+st+1],dt=Math.min(ft,ht),gt=Math.min(pt,yt),mt=Math.max(ft,ht),vt=Math.max(pt,yt);if(at[0]>=dt&&at[0]<=mt&&at[1]>=gt&&at[1]<=vt){K=Math.atan2(pt-yt,ht-ft);break}}}}}if(2!==h||et){var _t=NT(C,"layout","icon-size",f,d,v,b),bt=void 0!==R["icon-color"]?NT(C,"paint","icon-color",f,d,v,b):null;if(!bt||0!==bt.a){var wt=J+"."+_t;if(null!==bt&&(wt+="."+bt),!($=g[wt])){var St=FT(C,f,d,v),Ot=void 0;"icon-offset"in P&&((Ot=NT(C,"layout","icon-offset",f,d,v,b))[1]*=-1);var xt=bt?[255*bt.r,255*bt.g,255*bt.b,bt.a]:void 0;if(rt)$=new Jd("string"==typeof rt?{color:xt,src:rt,rotateWithView:"map"===nt,displacement:Ot,declutterMode:St}:{color:xt,img:rt,imgSize:[rt.width,rt.height],rotateWithView:"map"===nt,displacement:Ot,declutterMode:St});else{var Ct=i[J];$=new Jd({color:xt,img:u,imgSize:l,size:[Ct.width,Ct.height],offset:[Ct.x,Ct.y],rotateWithView:"map"===nt,scale:_t/Ct.pixelRatio,displacement:Ot,declutterMode:St})}g[wt]=$}}$&&(++w,(F=j[w])&&F.getImage()&&!F.getFill()&&!F.getStroke()||(F=new xm,j[w]=F),F.setGeometry(et),$.setRotation(K+sT(NT(C,"layout","icon-rotate",f,d,v,b))),$.setOpacity(NT(C,"paint","icon-opacity",f,d,v,b)),$.setAnchor(IT[NT(C,"layout","icon-anchor",f,d,v,b)]),F.setImage($),Y=F.getText(),F.setText(void 0),F.setZIndex(z),H=!0,Q=!1)}else Q=!0}}}if(1==h&&"circle"===C.type){++w,(F=j[w])&&F.getImage()&&!F.getFill()&&!F.getStroke()||(F=new xm,j[w]=F);var Et="circle-radius"in R?NT(C,"paint","circle-radius",f,d,v,b):5,Pt=BT(NT(C,"paint","circle-stroke-color",f,d,v,b),NT(C,"paint","circle-stroke-opacity",f,d,v,b)),kt=BT(NT(C,"paint","circle-color",f,d,v,b),NT(C,"paint","circle-opacity",f,d,v,b)),Tt=NT(C,"paint","circle-stroke-width",f,d,v,b),jt=Et+"."+Pt+"."+kt+"."+Tt;($=g[jt])||($=new Ky({radius:Et,stroke:Pt&&Tt>0?new _m({width:Tt,color:Pt}):void 0,fill:kt?new $y({color:kt}):void 0,declutterMode:"none"}),g[jt]=$),F.setImage($),Y=F.getText(),F.setText(void 0),F.setGeometry(void 0),F.setZIndex(z),H=!0}var Rt=void 0,Lt=void 0,It=void 0,Mt=void 0,At=void 0,Dt=void 0;if("text-field"in P){Mt=Math.round(NT(C,"layout","text-size",f,d,v,b));var Nt=NT(C,"layout","text-font",f,d,v,b);It=NT(C,"layout","text-line-height",f,d,v,b),(Lt=rT(a?a(Nt):Nt,Mt,It)).includes("sans-serif")||(Lt+=",sans-serif"),At=NT(C,"layout","text-letter-spacing",f,d,v,b),Dt=NT(C,"layout","text-max-width",f,d,v,b);var Ft=NT(C,"layout","text-field",f,d,v,b);Rt="object"==typeof Ft&&Ft.sections?1===Ft.sections.length?Ft.toString():Ft.sections.reduce((function(t,e,r){var n=e.fontStack?e.fontStack.split(","):Nt,i=rT(a?a(n):n,Mt*(e.scale||1),It),o=e.text;if("\n"===o)return t.push("\n",""),t;if(2!=h){for(var s=0,u=(o=OT(o,i,Dt,At).split("\n")).length;s<u;++s)s>0&&t.push("\n",""),t.push(o[s],i);return t}t.push(_T(o,At),i)}),[]):UT(Ft,o).trim(),M=NT(C,"paint","text-opacity",f,d,v,b)}if(Rt&&M&&!Q){H||(++w,(F=j[w])&&F.getText()&&!F.getFill()&&!F.getStroke()||(F=new xm,j[w]=F),F.setImage(void 0),F.setGeometry(void 0)),F.getText()||F.setText(Y||new Em({padding:[2,2,2,2]})),Y=F.getText();var zt=P["text-transform"];"uppercase"==zt?Rt=Array.isArray(Rt)?Rt.map((function(t,e){return e%2?t:t.toUpperCase()})):Rt.toUpperCase():"lowercase"==zt&&(Rt=Array.isArray(Rt)?Rt.map((function(t,e){return e%2?t:t.toLowerCase()})):Rt.toLowerCase());var Gt=Array.isArray(Rt)?Rt:2==h?_T(Rt,At):OT(Rt,Lt,Dt,At);Y.setText(Gt),Y.setFont(Lt),Y.setRotation(sT(NT(C,"layout","text-rotate",f,d,v,b)));var Bt=NT(C,"layout","text-anchor",f,d,v,b),Vt=H||1==h?"point":NT(C,"layout","symbol-placement",f,d,v,b);if(Y.setPlacement(Vt),"function"==typeof Y.setRepeat){var Ut=NT(C,"layout","symbol-spacing",f,d,v,b);Y.setRepeat(2*Ut)}Y.setOverflow("point"===Vt);var qt=NT(C,"paint","text-halo-width",f,d,v,b),Wt=NT(C,"layout","text-offset",f,d,v,b),Xt=NT(C,"paint","text-translate",f,d,v,b),Zt=0,Ht=0;if("point"==Vt){var Yt="center";-1!==Bt.indexOf("left")?(Yt="left",Ht=qt):-1!==Bt.indexOf("right")&&(Yt="right",Ht=-qt),Y.setTextAlign(Yt);var Kt=NT(C,"layout","text-rotation-alignment",f,d,v,b);Y.setRotateWithView("map"==Kt)}else Y.setMaxAngle(sT(NT(C,"layout","text-max-angle",f,d,v,b))*Rt.length/Gt.length),Y.setTextAlign(),Y.setRotateWithView(!1);var Jt="middle";0==Bt.indexOf("bottom")?(Jt="bottom",Zt=-qt-.5*(It-1)*Mt):0==Bt.indexOf("top")&&(Jt="top",Zt=qt+.5*(It-1)*Mt),Y.setTextBaseline(Jt);var $t=NT(C,"layout","text-justify",f,d,v,b);Y.setJustify("auto"===$t?void 0:$t),Y.setOffsetX(Wt[0]*Mt+Ht+Xt[0]),Y.setOffsetY(Wt[1]*Mt+Zt+Xt[1]),T.setColor(BT(NT(C,"paint","text-color",f,d,v,b),M)),Y.setFill(T);var Qt=BT(NT(C,"paint","text-halo-color",f,d,v,b),M);if(Qt){k.setColor(Qt),qt*=2;var te=.5*Mt;k.setWidth(qt<=te?qt:te),Y.setStroke(k)}else Y.setStroke(void 0);var ee=NT(C,"layout","text-padding",f,d,v,b),re=Y.getPadding();ee!==re[0]&&(re[0]=ee,re[1]=ee,re[2]=ee,re[3]=ee),F.setZIndex(z)}}}}return w>-1?(j.length=w+1,qT&&("function"==typeof e.set?e.set("mapbox-layer",p):e.getProperties()["mapbox-layer"]=p),j):void 0}};return t.setStyle(R),t.set("mapbox-source",p),t.set("mapbox-layers",d),t.set("mapbox-featurestate",{}),R}(t,e,u,i,l,c,TT,s.getImage),t.getStyle()?h().then(r).catch(n):n(new Error("Nothing to show for source ["+a+"]")))}if(e.sprite){var d=new URL(function(t,e,r){var n=iT(t);if(!n)return decodeURI(new URL(t,r).href);if(0!==n.indexOf("sprites/"))throw new Error("unexpected sprites url: "+t);var i=n.slice(8);return nT+"/styles/v1/"+i+"/sprite?access_token="+e}(e.sprite,s.accessToken,o||location.href)),g=.5==(window.devicePixelRatio>=1.5?.5:1)?"@2x":"",m=d.origin+d.pathname+g+".json"+d.search;new Promise((function(t,e){pT("Sprite",m,s).then(t).catch((function(r){pT("Sprite",m=d.origin+d.pathname+".json"+d.search,s).then(t).catch(e)}))})).then((function(t){if(void 0===t&&n(new Error("No sprites found.")),l=t,c=d.origin+d.pathname+g+".png"+d.search,s.transformRequest){var e=s.transformRequest(c,"SpriteImage");e instanceof Request&&(c=encodeURI(e.url))}y()})).catch((function(t){n(new Error("Sprites cannot be loaded: "+m+": "+t.message))}))}else y()})).catch(n)}))}var HT={};function YT(t){var e=t.bounds;if(e){var r=Hg([e[0],e[1]]),n=Hg([e[2],e[3]]);return[r[0],r[1],n[0],n[1]]}}function KT(t,e,r){var n=document.createElement("div");return n.className="ol-mapbox-style-background",n.style.position="absolute",n.style.width="100%",n.style.height="100%",new v_({source:new LS({}),render:function(i){var o=function(t,e,r,n){var i={id:t.id,type:t.type},o=t.layout||{},a=t.paint||{};i.paint=a;var s,u,l=cT(e,r.resolutions||uT);return void 0!==a["background-color"]&&(s=NT(i,"paint","background-color",l,HT,n)),void 0!==a["background-opacity"]&&(u=NT(i,"paint","background-opacity",l,HT,n)),"none"==o.visibility?void 0:BT(s,u)}(t,i.viewState.resolution,e,r);return n.style.backgroundColor=o,n}})}function JT(t,e,r){return new Promise((function(n,i){gT(t,e,r).then((function(t){var e=new BO({tileJSON:t}),r=e.getTileJSON(),i=e.getTileGrid(),o=YT(r),a=r.minzoom||0,s=r.maxzoom||22,u={attributions:e.getAttributions(),format:new X_,tileGrid:new cO({origin:i.getOrigin(0),extent:o||i.getExtent(),minZoom:a,resolutions:uT.slice(0,s+1),tileSize:512})};Array.isArray(r.tiles)?u.urls=r.tiles:u.url=r.tiles,t.olSourceOptions&&Object.assign(u,t.olSourceOptions),n(new kC(u))})).catch(i)}))}function $T(t,e,r){var n=new nO;return gT(t,e,r).then((function(e){var i=new BO({interpolate:void 0===r.interpolate||r.interpolate,transition:0,crossOrigin:"anonymous",tileJSON:e}),o=YT(e),a=i.getTileGrid(),s=t.tileSize||e.tileSize||512,u=e.minzoom||0,l=e.maxzoom||22;i.tileGrid=new cO({origin:a.getOrigin(0),extent:o||a.getExtent(),minZoom:u,resolutions:pO({maxZoom:l,tileSize:s}).getResolutions(),tileSize:s});var c=i.getTileUrlFunction();i.setTileUrlFunction((function(t,e,r){var n=c(t,e,r);if(-1!=n.indexOf("{bbox-epsg-3857}")){var o=i.getTileGrid().getTileCoordExtent(t);n=n.replace("{bbox-epsg-3857}",o.toString())}return n})),i.set("mapbox-source",t),n.setSource(i)})).catch((function(t){n.setSource(void 0)})),n}var QT=new t_;function tj(t,e,r){var n=t.data,i={};if("string"==typeof n){var o=aT(n,r.accessToken,r.accessTokenParam||"access_token",e||location.href);if(r.transformRequest){var a=r.transformRequest(o,"GeoJSON");a instanceof Request&&(o=decodeURI(a.url))}if(-1!=o.indexOf("{bbox-epsg-3857}")){var s=new uC({attributions:t.attribution,format:QT,url:function(t){return o.replace("{bbox-epsg-3857}",t.join(",")+",EPSG:3857")},strategy:eC});return s.set("mapbox-source",t),s}return new uC({attributions:t.attribution,format:QT,url:o})}i.features=QT.readFeatures(n,{featureProjection:im()||"EPSG:3857"});var u=new uC(Object.assign({attributions:t.attribution,format:QT},i));return u.set("mapbox-source",t),u}function ej(t,e,r,n){var i=[],o=null;e instanceof gS&&((o=e.getView()).isDef()||o.getRotation()||o.getResolutions()||(o=new Kb(Object.assign(o.getProperties(),{maxResolution:uT[0]})),e.setView(o)),"center"in t&&!o.getCenter()&&o.setCenter(Hg(t.center)),"zoom"in t&&void 0===o.getZoom()&&o.setResolution(uT[0]/Math.pow(2,t.zoom)),o.getCenter()&&void 0!==o.getZoom()||o.fit(o.getProjection().getExtent(),{nearest:!0,size:e.getSize()}));for(var a,s,u,l,c=t.layers,f=[],p=function(o,p){var h,y,d,g=c[o],m=g.type;if("heatmap"==m)throw new Error(m+" layers are not supported");if(l=g.source||(h=c,y=g.ref,h.some((function(t){if(t.id==y)return d=t.source,!0})),d),!l||l!=u){f.length&&(i.push(rj(a,f,t,r,e,n)),f=[]),s=t.sources[l];var v={};if("background"==m)a=KT(g,n,v);else if("vector"==s.type)a=function(t,e,r){var n=new vC({declutter:!0,visible:!1});return JT(t,e,r).then((function(e){e.set("mapbox-source",t),n.setSource(e)})).catch((function(t){n.setSource(void 0)})),n}(s,r,n);else if("raster"==s.type)(a=$T(s,r,n)).setVisible(!g.layout||"none"!==g.layout.visibility),a.on("prerender",function(t,e,r){var n=null;return function(i){t.paint&&"raster-opacity"in t.paint&&i.frameState.viewState.zoom!==n&&(n=i.frameState.viewState.zoom,delete r[t.id],function(t,e,r,n){var i=NT(t,"paint","raster-opacity",r,HT,n);e.setOpacity(i)}(t,e,n,r))}}(g,a,v));else if("geojson"==s.type)a=function(t,e,r){return new Kx({declutter:!0,source:tj(t,e,r),visible:!1})}(s,r,n);else if("raster-dem"==s.type&&"hillshade"==g.type){var _=function(t,e,r){var n=$T(t,e,r);return new F_({source:new TO({operationType:"image",operation:WT,sources:[n]})})}(s,r,n);a=_,_.getSource().on("beforeoperations",(function(t){var e=t.data;e.resolution=t.resolution;var r=cT(t.resolution,n.resolutions||uT);e.vert=5*NT(g,"paint","hillshade-exaggeration",r,HT,v),e.sunAz=NT(g,"paint","hillshade-illumination-direction",r,HT,v),e.sunEl=35,e.opacity=.3,e.highlightColor=NT(g,"paint","hillshade-highlight-color",r,HT,v),e.shadowColor=NT(g,"paint","hillshade-shadow-color",r,HT,v),e.accentColor=NT(g,"paint","hillshade-accent-color",r,HT,v)})),a.setVisible(!g.layout||"none"!==g.layout.visibility)}u=l,a&&a.set("mapbox-source",u)}f.push(g.id)},h=0,y=c.length;h<y;++h)p(h);return i.push(rj(a,f,t,r,e,n)),e.set("mapbox-style",t),Promise.all(i)}function rj(t,e,r,n,i,o){void 0===o&&(o={});for(var a=24,s=0,u=r.layers,l=0,c=u.length;l<c;++l){var f=u[l];-1!==e.indexOf(f.id)&&(a=Math.min("minzoom"in f?f.minzoom:0,a),s=Math.max("maxzoom"in f?f.maxzoom:24,s))}return new Promise((function(u,l){var c=function(){var i=t.getSource();if(i&&"error"!==i.getState()){if("getTileGrid"in i){var c=i.getTileGrid();if(c){var f=c.getMinZoom();(a>0||f>0)&&t.setMaxResolution(Math.min(uT[a],c.getResolution(f))+1e-9),s<24&&t.setMinResolution(uT[s]+1e-9)}}else a>0&&t.setMaxResolution(uT[a]+1e-9);i instanceof uC||i instanceof kC?ZT(t,r,e,Object.assign({styleUrl:n},o)).then((function(){t.setVisible(!0),u()})).catch(l):u()}else l(new Error("Error accessing data for source "+t.get("mapbox-source")))};t.set("mapbox-layers",e);var f=i.getLayers();-1===f.getArray().indexOf(t)&&f.push(t),t.getSource()?c():t.once("change:source",c)}))}function nj(t){return nj="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nj(t)}function ij(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function oj(t){return function(t){if(Array.isArray(t))return aj(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return aj(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?aj(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function aj(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function sj(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,uj(n.key),n)}}function uj(t){var e=function(t,e){if("object"!=nj(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=nj(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==nj(e)?e:String(e)}function lj(){return lj="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=fj(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},lj.apply(this,arguments)}function cj(t,e){return cj=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},cj(t,e)}function fj(t){return fj=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},fj(t)}var pj=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&cj(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=fj(n);if(i){var r=fj(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===nj(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(t=o.call.apply(o,[this].concat(r)))._features=void 0,t._gifMap=new Map,t._gifLoadError=new Set,t._bounceMap=new Map,t._flickerMap=new Map,t._diffuseMap=new Map,t}return e=a,r=[{key:"diffuseMap",get:function(){return this._diffuseMap}},{key:"loadBounce",value:function(t,e){if(this._bounceMap.has(t)){var r=this._bounceMap.get(t);r._running||r.start()}else{var n=this,i=!1!==(null==e?void 0:e.hoverStop);this._bounceMap.set(t,new Xt((function(e){if((!i||!0!==t.get("_hover"))&&t.get("_bounce")){var r=t.get("_bounce"),o=r.style,a=r.params||{},s=a.imgOffset,u=void 0===s?[0,0]:s,l=a.offset,c=void 0===l?[0,0]:l;t.set("_bounce_offset",{imgOffset:[u[0],u[1]+e],offset:[c[0],c[1]+e]},!0),n.updateBounceStyle(o,[u[0],u[1]+e],[c[0],c[1]+e]),t.changed()}}),e,(function(){return!i||!0!==t.get("_hover")})))}}},{key:"updateBounceStyle",value:function(t,e,r){var n=this;Array.isArray(t)?t.forEach((function(t){return n.updateBounceStyle(t,e,r)})):(t.getImage()&&t.getImage().setDisplacement(e),t.getText()&&t.getText().setOffsetY(-r[1]))}},{key:"removeBounce",value:function(t){this._bounceMap.has(t)&&(this._bounceMap.get(t).dispose(),this._bounceMap.delete(t))}},{key:"loadFlicker",value:function(t,e){if(this._flickerMap.has(t)){var r=this._flickerMap.get(t);r._running||r.start()}else{var n=this,i=!1!==(null==e?void 0:e.hoverStop);this._flickerMap.set(t,new ae((function(e){if((!i||!0!==t.get("_hover"))&&t.get("_opacity")){var r=t.get("_opacity").style;n.updateFlickerStyle(r,e),t.changed()}}),e,(function(){return!i||!0!==t.get("_hover")})))}}},{key:"updateFlickerStyle",value:function(t,e){var r=this;Array.isArray(t)?t.forEach((function(t){return r.updateFlickerStyle(t,e)})):t.getImage()&&t.getImage().setOpacity(e)}},{key:"removeFlicker",value:function(t){this._flickerMap.has(t)&&(this._flickerMap.get(t).dispose(),this._flickerMap.delete(t))}},{key:"loadDiffuse",value:function(t,e){if(this._diffuseMap.has(t)){var r=this._diffuseMap.get(t);r._running||r.start()}else{var n=this,i=oj(Opl.color.fromString(e.color));i.pop();var o=oj(Opl.color.fromString(e.fillColor));o.pop();var a="ripple"===e.type;this._diffuseMap.set(t,new Qt((function(r){if(t.get("_diffuse")&&r.length>0){var s=r.map((function(t){return new Opl.style.Style({image:new Opl.style.Circle({radius:t.value/2,fill:a?new Opl.style.Fill({color:o.concat(t.opacity)}):null,stroke:new Opl.style.Stroke({width:e.width,color:i.concat(t.opacity)})})})}));if(t.getStyle()){var u=t.get("_diffuse");n.updateDiffuseStyle(t,u,s)}else t.set("_diffuse_styles",s,!0);t.changed()}})))}}},{key:"getDefaultDiffuse",value:function(t){return Qt.getDefaultOptions(t)}},{key:"updateDiffuseStyle",value:function(t,e,r){var n=Array.isArray(e)?e:[e];t.setStyle(r.concat(n))}},{key:"removeDiffuse",value:function(t){this._diffuseMap.has(t)&&this._diffuseMap.delete(t)}},{key:"load",value:function(t,e){var r=this;if(!this._gifMap.has(t)){var n,i,o={url:t,gifler:null,features:[],gifOptions:null},a=null===(n=(i=window).gifler)||void 0===n?void 0:n.call(i,t);a?a._animatorPromise.then((function(n){return o.gifler=n,a.frames(document.createElement("canvas"),(function(t,r){if(o.features.length>0){var n=o.gifOptions=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ij(Object(r),!0).forEach((function(e){var n,i,o;n=t,i=e,o=r[e],(i=uj(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ij(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({src:void 0,img:t.canvas,imgSize:[r.width,r.height],size:[r.width,r.height]},e);o.features.forEach((function(t,e){if(t.get("_gif")){var r=t.get("_gif").style;r&&("function"==typeof r||(Array.isArray(r)?r.length>0&&(r[r.length-1].setImage(new Opl.style.Icon(n)),t.changed()):(r.setImage(new Opl.style.Icon(n)),t.changed())))}})),t.clearRect(0,0,r.width,r.height),t.drawImage(r.buffer,r.x,r.y)}}),!0).then((function(){})).catch((function(e){r._gifLoadError.add(t)}))})).catch((function(e){r._gifLoadError.add(t)})):(this._gifLoadError.add(t),window.gifler||rt('使用动态GIF图，请引入gifler插件，MapInit初始化时设置：plugin: ["gif"]',"warn")),this._gifMap.set(t,o)}return this._gifMap.get(t)}},{key:"remove",value:function(t){if(this._gifLoadError.has(t)&&this._gifLoadError.delete(t),this._gifMap.has(t)){var e=this._gifMap.get(t);e.gifler.cancel(),e.features.length=0}}},{key:"has",value:function(t){return this._gifMap.has(t)}},{key:"hasError",value:function(t){return this._gifLoadError.has(t)}},{key:"hasFeature",value:function(t,e){return!!this._gifMap.has(t)&&this._gifMap.get(t).features.findIndex((function(t){return t===e}))>=0}},{key:"addFeature",value:function(t,e){if(this._gifMap.has(t)){var r=this._gifMap.get(t);r.features.findIndex((function(t){return t===e}))<0&&(r.features.push(e),r.gifler&&!r.gifler._running&&r.gifler.start())}}},{key:"removeFeature",value:function(t,e){if(this._gifMap.has(t)){var r=this._gifMap.get(t),n=r.features.findIndex((function(t){return t===e}));n>=0&&(r.features.splice(n,1),0===r.features.length&&r.gifler&&r.gifler._running&&r.gifler.stop())}}},{key:"dispose",value:function(){lj(fj(a.prototype),"dispose",this).call(this),this._gifLoadError.clear(),this._gifMap.forEach((function(t){t.features.length=0,t.gifler.stop()})),this._gifMap.clear(),this._bounceMap.forEach((function(t){return t.dispose()})),this._bounceMap.clear(),this._diffuseMap.forEach((function(t){return t.dispose()})),this._diffuseMap.clear()}}],r&&sj(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t),hj=new pj;function yj(t){return yj="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yj(t)}var dj=["_rules"];function gj(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function mj(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function vj(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?mj(Object(r),!0).forEach((function(e){_j(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):mj(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function _j(t,e,r){return(e=wj(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function bj(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,wj(n.key),n)}}function wj(t){var e=function(t,e){if("object"!=yj(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=yj(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==yj(e)?e:String(e)}function Sj(){return Sj="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=xj(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},Sj.apply(this,arguments)}function Oj(t,e){return Oj=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Oj(t,e)}function xj(t){return xj=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},xj(t)}var Cj=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Oj(t,e)}(s,e);var r,n,i,o,a=(i=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=xj(i);if(o){var r=xj(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===yj(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(e=a.call(this))._cacheStyle=new Map,e._cacheRuleStyle=new Map,e._excludeCacheEventNames=[],e._defaultOptions=null,e._cacheDefaultStyleOptions=null,e._options={},e.currentDefaultEventName="default",t&&nt(e._options,t),e}return r=s,n=[{key:"options",get:function(){return this._options}},{key:"_getStyleOptions",value:function(t){var e={};if(t.geometry&&(e.geometry=t.geometry),t.fill&&(e.fill=new Opl.style.Fill({color:t.fill})),t.strokeColor){var r,n,i="dash"===t.lineType;e.stroke=new Opl.style.Stroke({color:t.strokeColor,lineCap:i?"butt":"round",lineJoin:i?"bevel":"round",lineDash:i?t.lineDash?t.lineDash:[16,16]:null,width:t.strokeWidth||1}),i&&null!==(r=t.background)&&void 0!==r&&r.fill&&Object.defineProperty(e,"_lineDash",{value:new Opl.style.Stroke({color:null===(n=t.background)||void 0===n?void 0:n.fill,lineCap:"round",lineJoin:"round",width:t.strokeWidth||1}),configurable:!1})}if(t.html){var o=we.loadCanvas(at(t.text,t.html));o?e.image=new Opl.style.Icon({img:o,size:[o.width,o.height],imgSize:[o.width,o.height],scale:t.scale,displacement:t.imgOffset,opacity:t.opacity}):Object.defineProperty(e,"_html",{value:{html:at(t.text,t.html),params:{scale:t.scale,displacement:t.imgOffset,opacity:t.opacity}},configurable:!1})}else if(t.iconUrl||t.img){var a=!1;if(t.iconUrl&&/\.gif$/i.test(t.iconUrl)){var s=hj.load(t.iconUrl,{scale:t.scale,displacement:t.imgOffset,opacity:t.opacity});Object.defineProperty(e,"_gif",{value:t.iconUrl,configurable:!1}),s.gifOptions&&(e.image=new Opl.style.Icon(vj(vj({},s.gifOptions),{},{scale:t.scale,displacement:t.imgOffset,opacity:t.opacity})),a=!0)}a||(e.image=new Opl.style.Icon({src:t.iconUrl,img:t.img,imgSize:t.imgSize,size:t.imgSize,scale:t.scale,displacement:t.imgOffset,opacity:t.opacity}))}else if(t.radius){var u,l;e.image=new Opl.style.Circle({radius:t.radius||6,stroke:t.strokeWidth&&new Opl.style.Stroke({width:(null===(u=t.background)||void 0===u?void 0:u.strokeWidth)||2,color:(null===(l=t.background)||void 0===l?void 0:l.strokeColor)||"rgba(255, 255, 255, 1)"}),fill:new Opl.style.Fill({color:t.fill||"rgba(0, 0, 255, 0.5)"})})}return!t.html&&t.text&&(e.text=new Opl.style.Text({text:t.text,fill:new Opl.style.Fill({color:t.fontColor||"#333"}),font:t.fontStyle||"15px Microsoft YaHei",stroke:t.strokeWidth||t.strokeColor?new Opl.style.Stroke({color:t.strokeColor,lineDash:t.lineDash||[],width:t.strokeWidth||1}):null,backgroundFill:t.background?new Opl.style.Fill({color:t.background.fill}):void 0,backgroundStroke:t.background?new Opl.style.Stroke({color:t.background.strokeColor,lineDash:t.background.lineDash,width:t.background.strokeWidth}):void 0,padding:t.padding,offsetX:t.offset?t.offset[0]:0,offsetY:t.offset?t.offset[1]:0})),Reflect.has(t,"_zIndex")&&(e.zIndex=t._zIndex),t._bounce&&Object.defineProperty(e,"_bounce",{value:{bounce:t._bounce,imgOffset:t.imgOffset,offset:t.offset||[0,0]},configurable:!1}),t._opacity&&(t.opacity&&!t._opacity.max&&(t._opacity.max=t.opacity),Object.defineProperty(e,"_opacity",{value:t._opacity,configurable:!1})),t._diffuse&&Object.defineProperty(e,"_diffuse",{value:hj.getDefaultDiffuse(t._diffuse),configurable:!1}),e}},{key:"_getOptionsToStyle",value:function(t,e){var r=this._getStyleOptions(e),n=new Opl.style.Style(r);return Object.defineProperty(n,"_options",{value:e,configurable:!1}),Object.defineProperty(n,"_eventName",{value:t,configurable:!1}),Reflect.has(r,"_lineDash")&&Object.defineProperty(n,"_lineDash",{value:Reflect.get(r,"_lineDash"),configurable:!1}),Reflect.has(r,"_html")&&Object.defineProperty(n,"_html",{value:Reflect.get(r,"_html"),configurable:!1}),Reflect.has(r,"_gif")&&Object.defineProperty(n,"_gif",{value:Reflect.get(r,"_gif"),configurable:!1}),Reflect.has(r,"_bounce")&&Object.defineProperty(n,"_bounce",{value:Reflect.get(r,"_bounce"),configurable:!1}),Reflect.has(r,"_opacity")&&Object.defineProperty(n,"_opacity",{value:Reflect.get(r,"_opacity"),configurable:!1}),Reflect.has(r,"_diffuse")&&Object.defineProperty(n,"_diffuse",{value:Reflect.get(r,"_diffuse"),configurable:!1}),n}},{key:"_styleIntercept",value:function(t,e){if(e&&Reflect.has(e,"_lineDash")){var r=Array.isArray(e)?e:[e];return[new Opl.style.Style({stroke:Reflect.get(e,"_lineDash")})].concat(r)}if(t.get("_lineDash")&&t.unset("_lineDash",!0),e&&Reflect.has(e,"_html")){if(!t.get("_html")){var n=Reflect.get(e,"_html");t.set("_html",n,!0);var i=Array.isArray(e)?e.length>0?e[e.length-1]:null:e;we.add(n.html,(function(e){i&&i.setImage(new Opl.style.Icon(vj({img:e,size:[e.width,e.height],imgSize:[e.width,e.height]},n.params))),t.changed()}))}}else t.get("_html")&&t.unset("_html",!0);if(e&&Reflect.has(e,"_gif"))t.get("_gif")||(t.set("_gif",{src:Reflect.get(e,"_gif"),style:e},!0),hj.addFeature(Reflect.get(e,"_gif"),t));else if(t.get("_gif")){var o=t.get("_gif");t.unset("_gif",!0),hj.removeFeature(o.src,t)}if(e&&Reflect.has(e,"_bounce"))if(t.get("_bounce")){if(t.get("_bounce_offset")){var a=t.get("_bounce_offset"),s=a.imgOffset,u=a.offset;hj.updateBounceStyle(e,s,u)}}else hj.loadBounce(t,Reflect.get(e,"_bounce").bounce),t.set("_bounce",vj(vj({},Reflect.get(e,"_bounce")),{},{style:e}),!0);else t.get("_bounce")&&(t.unset("_bounce",!0),t.unset("_bounce_offset",!0),hj.removeBounce(t));if(e&&Reflect.has(e,"_opacity"))if(t.get("_opacity")){if(t.get("_bounce_opacity")){var l=t.get("_bounce_opacity");hj.updateFlickerStyle(e,l)}}else hj.loadFlicker(t,Reflect.get(e,"_opacity")),t.set("_opacity",{opacity:Reflect.get(e,"_opacity"),style:e},!0);else t.get("_opacity")&&(t.unset("_opacity",!0),t.unset("_bounce_opacity",!0),hj.removeFlicker(t));if(e&&Reflect.has(e,"_diffuse"))if(t.get("_diffuse")){if(t.get("_diffuse_styles")){var c=Array.isArray(e)?e:[e];return t.get("_diffuse_styles").concat(c)}}else hj.loadDiffuse(t,Reflect.get(e,"_diffuse")),t.set("_diffuse",e,!0);else t.get("_diffuse")&&(t.unset("_diffuse",!0),hj.removeDiffuse(t))}},{key:"_convertStyles",value:function(t){var e=this;if(!t)return{};var r=ot(t),n=(r._rules,function(t,e){if(null==t)return{};var r,n,i=function(t,e){if(null==t)return{};var r,n,i={},o=Object.keys(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||(i[r]=t[r]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}(r,dj)),i={};return i[this.currentDefaultEventName]=this._getOptionsToStyle(this.currentDefaultEventName,n),Object.keys(n).forEach((function(t){t.startsWith("_")&&t.endsWith("Style")&&(i[t]=e._getOptionsToStyle(t,it(n[t],n)))})),i}},{key:"_getFeatureDefaultStyle",value:function(t){if(this._cacheStyle.has(t)){var e=this._cacheStyle.get(t)[this.currentDefaultEventName];if(e&&Reflect.has(e,"_options"))return Reflect.get(e,"_options")}}},{key:"_getFeatureStyle",value:function(t,e,r){var n;if(this._cacheStyle.has(t)?n=this._cacheStyle.get(t)[e]:this._cacheStyle.set(t,{}),n){if(r&&!1!==(null==r?void 0:r.isMergeStyle))if(e===this.currentDefaultEventName)n=this._getOptionsToStyle(e,this.getMergeStyleOptions(t,r));else{var i=this._getFeatureDefaultStyle(t),o=i?this.getMergeStyleOptions(t,r,i):this.getMergeStyleOptions(t,r);n=this._getOptionsToStyle(e,o[e]?this.getMergeStyleOptions(t,o[e],o):o)}}else{if(e===this.currentDefaultEventName)n=this._getOptionsToStyle(e,this.getMergeStyleOptions(t,r));else{var a=this._getFeatureDefaultStyle(t),s=a?this.getMergeStyleOptions(t,r,a):this.getMergeStyleOptions(t,r);n=this._getOptionsToStyle(e,s[e]?this.getMergeStyleOptions(t,s[e],s):s)}e!==this.currentDefaultEventName&&this._excludeCacheEventNames.includes(e)||(this._cacheStyle.get(t)[e]=n)}return n}},{key:"getMergeStyleOptions",value:function(e,r,n){var i=ot(n||this._defaultOptions);if(i._rules){var o=xe(e,i._rules);o&&(i=nt(i,o,t))}return r?nt(i,r):i}},{key:"addExcludeCacheEventName",value:function(t){var e,r;(e=this._excludeCacheEventNames).push.apply(e,function(t){if(Array.isArray(t))return gj(t)}(r=Array.isArray(t)?t:[t])||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(r)||function(t,e){if(t){if("string"==typeof t)return gj(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?gj(t,e):void 0}}(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}},{key:"removeExcludeCacheEventName",value:function(t){var e=Array.isArray(t)?t:[t];this._excludeCacheEventNames=this._excludeCacheEventNames.filter((function(t){return!e.includes(t)}))}},{key:"setOptions",value:function(t){t&&nt(this._options,t)}},{key:"setDefaultOptions",value:function(t){return this._defaultOptions=t,this._cacheDefaultStyleOptions=this._convertStyles(t),this}},{key:"removeStyle",value:function(t){this._cacheStyle.has(t)&&this._cacheStyle.delete(t)}},{key:"removeFeatureStyle",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";if(this._cacheStyle.has(t)){var r=this._cacheStyle.get(t);r[e]||Reflect.deleteProperty(r,e)}}},{key:"addStyle",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",r=arguments.length>2?arguments[2]:void 0;return this._getFeatureStyle(t,e,r)}},{key:"getStyle",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",r=arguments.length>2?arguments[2]:void 0;if(!r&&("_hoverStyle"===e||"_clickStyle"===e)){var n=t.getStyle();n&&Reflect.get(n,"_eventName")!==this.currentDefaultEventName&&Reflect.has(n,"_options")&&(r=_j({},e,Reflect.get(n,"_options")[e]))}var i=this._getFeatureStyle(t,e,r);if(i||this._cacheDefaultStyleOptions){var o=i||this._cacheDefaultStyleOptions[e];return o&&!1===t.get("_visibleText")&&(Array.isArray(o)?o.forEach((function(t){t.getText()&&t.setText(null)})):o.getText()&&o.setText(null)),this._styleIntercept(t,o)||o}}},{key:"dispose",value:function(){Sj(xj(s.prototype),"dispose",this).call(this),this._cacheStyle.clear(),this._defaultOptions=null,this._cacheDefaultStyleOptions=null}}],n&&bj(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),s}(_t);function Ej(t){return Ej="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ej(t)}function Pj(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,kj(n.key),n)}}function kj(t){var e=function(t,e){if("object"!=Ej(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Ej(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ej(e)?e:String(e)}function Tj(){return Tj="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Rj(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},Tj.apply(this,arguments)}function jj(t,e){return jj=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},jj(t,e)}function Rj(t){return Rj=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Rj(t)}var Lj=new(function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&jj(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Rj(n);if(i){var r=Rj(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Ej(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(t=o.call.apply(o,[this].concat(r)))._map=void 0,t._appHandler=new nr,t._events=[],t._registered=new Map,t._eventsZoom=[],t._zoomCallback=null,t}return e=a,r=[{key:"_useEvents",get:function(){var t=this;return function(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t._events.filter((function(n){return n.type===e&&(!r||t._appHandler.judgeOpl(e,n.params))}))}}},{key:"map",get:function(){if(!this._map)throw Error("未注册 map 实例，无法注册地图事件！");return this._map}},{key:"setMap",value:function(t){this._map=t}},{key:"_registryEvent",value:function(t){var e=this;this._registered.has(t)||(this._registered.set(t,(function(r){e._useEvents(t,!0).forEach((function(t){return t.fun(r)}))})),this.map.addEventListener(t,this._registered.get(t)))}},{key:"on",value:function(t,e,r,n){return this._registryEvent(t),this._events.push({type:t,fun:e,key:r,params:n}),this}},{key:"off",value:function(t,e){for(var r="function"==typeof t,n=(e?this._useEvents(e):this._events).filter((function(e){return r?e.fun===t:e.key===t})),i=0;i<this._events.length;i++)if(n.includes(this._events[i])){var o=this._events[i].type;this._events.splice(i,1),0===this._useEvents(o).length&&this._registered.has(o)&&(this.map.removeEventListener(o,this._registered.get(o)),this._registered.delete(o)),i--}return this}},{key:"onZoom",value:function(t,e){var r=this;if(!this._zoomCallback){var n=this.map.getView(),i=n.getZoom();this._zoomCallback=function(t){var e=Math.round(t.target.getZoom());e!==i&&(i=e,r._eventsZoom.filter((function(t){return r._appHandler.judgeOpl("change:resolution",t.params)})).forEach((function(e){return e.fun(i,t)})))},n.addEventListener("change:resolution",this._zoomCallback)}return this._eventsZoom.push({fun:t,params:e}),this}},{key:"offZoom",value:function(t){if(t){var e=this._eventsZoom.findIndex((function(e){return e.fun===t}));e>=0&&this._eventsZoom.splice(e,1)}else this._eventsZoom.length=0;return 0===this._eventsZoom.length&&(this.map.getView().removeEventListener("change:resolution",this._zoomCallback),this._zoomCallback=null),this}},{key:"clear",value:function(){var t=this;this._events.length=0,this._registered.forEach((function(e,r){t.map.removeEventListener(r,e)})),this._registered.clear(),this.offZoom()}},{key:"dispose",value:function(){Tj(Rj(a.prototype),"dispose",this).call(this),this.clear(),this._map=null}}],r&&Pj(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t));function Ij(t){return Ij="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ij(t)}function Mj(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Aj(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Dj(n.key),n)}}function Dj(t){var e=function(t,e){if("object"!=Ij(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Ij(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ij(e)?e:String(e)}function Nj(){return Nj="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=zj(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},Nj.apply(this,arguments)}function Fj(t,e){return Fj=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Fj(t,e)}function zj(t){return zj=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},zj(t)}var Gj=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Fj(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=zj(n);if(i){var r=zj(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Ij(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=o.call(this))._tempInteraction=[],e._map=void 0,e._selects=[],e._map=t,Lj._appHandler.addEventListener("disabled",(function(t){t?e._selects.forEach((function(t){Reflect.has(t,"_event_controlled")&&(e._tempInteraction.push(t),e._map.removeInteraction(t))})):e._tempInteraction.length>0&&(e._tempInteraction.forEach((function(t){e._selects.includes(t)&&e._map.addInteraction(t)})),e._tempInteraction.length=0)})),e}return e=a,r=[{key:"map",get:function(){return this._map}},{key:"addInteraction",value:function(t,e){var r=this;if(t)if(Array.isArray(t))t.forEach((function(t){r.addInteraction(t,e)}));else if(!this._selects.includes(t)){if(!0!==(null==e?void 0:e.uncontrolled)&&(Object.defineProperty(t,"_event_controlled",{value:e}),Lj._appHandler.options.disabled))return this._tempInteraction.push(t),void this._selects.push(t);this._selects.push(t),this.map.addInteraction(t)}}},{key:"findIndexInteraction",value:function(t){var e="string"==typeof t;return this._selects.findIndex((function(r){return e&&r.get("name")===t||r===t}))}},{key:"findInteraction",value:function(t){var e="string"==typeof t;return this._selects.find((function(r){return e&&r.get("name")===t||r===t}))}},{key:"filterInteraction",value:function(t){var e=this;if(Array.isArray(t)){var r=[];return t.forEach((function(t){var n,i=e.filterInteraction(t);r.push.apply(r,function(t){if(Array.isArray(t))return Mj(t)}(n=i)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||function(t,e){if(t){if("string"==typeof t)return Mj(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Mj(t,e):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())})),r}var n="string"==typeof t;return this._selects.filter((function(e){return n&&e.get("name")===t||e===t}))}},{key:"removeInteraction",value:function(t){var e=this;if(!t)return this._selects.forEach((function(t){return e.map.removeInteraction(t)})),this._selects.length=0,void(this._tempInteraction.length=0);if(Array.isArray(t))t.forEach((function(t){e.removeInteraction(t)}));else{var r=this.findIndexInteraction(t);r>-1&&(this._selects.splice(r,1),this.map.removeInteraction(t))}}},{key:"clearSelection",value:function(){this._selects.forEach((function(t){t.getFeatures().clear()}))}},{key:"dispose",value:function(){Nj(zj(a.prototype),"dispose",this).call(this),this.removeInteraction(),this._tempInteraction.length=0}}],r&&Aj(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t);function Bj(t){if(!t)return[0,0];if(Array.isArray(t)){var e=Opl.extent.createEmpty();return t.forEach((function(t){Opl.extent.extend(e,t.getExtent())})),Opl.extent.getCenter(e)}return Opl.extent.getCenter(t.getExtent())}function Vj(t){return t?Opl.proj.toLonLat(Bj(t)):[0,0]}function Uj(t){return Uj="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Uj(t)}function qj(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Wj(n.key),n)}}function Wj(t){var e=function(t,e){if("object"!=Uj(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Uj(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Uj(e)?e:String(e)}function Xj(){return Xj="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Yj(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},Xj.apply(this,arguments)}function Zj(t,e){return Zj=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Zj(t,e)}function Hj(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Yj(t){return Yj=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Yj(t)}var Kj=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Zj(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Yj(n);if(i){var r=Yj(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Uj(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Hj(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,e))._zoomChangeHandler=null,r.parent=void 0,r._interactionService=void 0,r._selected=null,r._hoverSelected=null,r._events=[],r._mapClick=r.mapClick.bind(Hj(r)),r._mapMove=r.mapMove.bind(Hj(r)),r.parent=t,r.setDefaultOptions(e),r._interactionService=new Gj(t.map),r._initStyleEvent(e),r}return e=a,r=[{key:"map",get:function(){return this.parent.map}},{key:"selected",get:function(){return this._selected}},{key:"hoverSelected",get:function(){return this._hoverSelected}},{key:"hoverEvent",get:function(){return this._events.filter((function(t){return"hover"===t.type}))}},{key:"clickEvent",get:function(){return this._events.filter((function(t){return"click"===t.type}))}},{key:"_initStyleEvent",value:function(t){Lj.on("click",this._mapClick),this.mapMoveSelect();var e=this;t._clickStyle&&this.on({type:"click",change:function(t,r,n){r&&r!==t&&(r.setStyle(r.get("__oldStyle")),r.unset("__oldStyle",!0)),t&&r!==t&&(t.get("__oldStyle")||t.set("__oldStyle",t.getStyle(),!0),t.setStyle(e.getStyle(t,"_clickStyle")))}}),t._hoverStyle&&this.on({type:"hover",change:function(t,r,n){r&&r!==t&&(e.parent.options._clickStyle&&e._selected===r||(r.setStyle(r.get("__oldStyle")),r.unset("__oldStyle",!0))),t&&r!==t&&e._selected!==t&&(t.get("__oldStyle")||t.set("__oldStyle",t.getStyle(),!0),t.setStyle(e.getStyle(t,"_hoverStyle")))}})}},{key:"__zoomChange",value:function(t,e){if(Array.isArray(t)?e>=t[0]&&e<=t[1]:e>=t){var r=this.map.getView().calculateExtent(this.map.getSize());this.parent.forEach((function(t){Opl.extent.containsExtent(r,t.getGeometry().getExtent())?!1===t.get("_visibleText")&&(t.unset("_visibleText"),t.changed()):!1!==t.get("_visibleText")&&(t.set("_visibleText",!1,!0),t.changed())}))}else this.parent.forEach((function(t){!1!==t.get("_visibleText")&&(t.set("_visibleText",!1,!0),t.changed())}))}},{key:"_zoomChangeShowLabel",value:function(t,e){this._zoomChangeHandler&&(Lj.offZoom(this._zoomChangeHandler),this._zoomChangeHandler=null),t&&(this._zoomChangeHandler=this.__zoomChange.bind(this,t),Lj.onZoom(this._zoomChangeHandler),!0===e&&this.__zoomChange(t,this.map.getView().getZoom()))}},{key:"mapClick",value:function(t){var e=this,r=this.parent,n=t.map.getFeaturesAtPixel(t.pixel,{layerFilter:function(t){return t===r.layer}}),i=n.length>0?n[0]:null;this.clickEvent.forEach((function(n){return n.change.call(r.layer,i,e._selected,t)})),this._selected=i}},{key:"mapMove",value:function(t){var e=this,r=this.parent,n=t.map.getFeaturesAtPixel(t.pixel,{layerFilter:function(t){return t===r.layer}}),i=n.length>0?n[0]:null;i!==this._hoverSelected&&(this.hoverEvent.forEach((function(n){return n.change.call(r.layer,i,e._hoverSelected,t)})),this._hoverSelected=i)}},{key:"mapMoveSelect",value:function(){var t=this,e=new Opl.interaction.Select({condition:Opl.events.condition.pointerMove,layers:[this.parent.layer],style:null});e.set("name","_hoverStyle",!0),e.on("select",(function(e){var r=e.selected.length>0?e.selected[0]:null;r!==t._hoverSelected&&(t.hoverEvent.forEach((function(n){return n.change.call(t.parent.layer,r,t._hoverSelected,e)})),t._hoverSelected=r)})),this._interactionService.addInteraction(e)}},{key:"setSelected",value:function(t,e){if(t){if(this.parent.hasFeature(t)){if(e){var r=this.map.getView();r.cancelAnimations(),r.animate({zoom:null==e?void 0:e.zoom,center:Bj(t.getGeometry()),duration:(null==e?void 0:e.duration)||1e3})}this._selected!==t&&(this._selected&&this.setSelected(),t.get("__oldStyle")||t.set("__oldStyle",t.getStyle(),!0),t.setStyle(this.getStyle(t,"_clickStyle")),this._selected=t)}}else this._selected&&(this._selected.get("__oldStyle")?(this._selected.setStyle(this._selected.get("__oldStyle")),this._selected.unset("__oldStyle",!0)):this._selected.setStyle(this.getStyle(this._selected)),this._selected=null);return this}},{key:"setStyle",value:function(t,e,r){var n=this,i=e?r||"_temp":void 0;return Array.isArray(t)?t.forEach((function(t){return t.setStyle(n.getStyle(t,i,e))})):t.setStyle(this.getStyle(t,i,e)),this}},{key:"resetState",value:function(){return this._selected&&(this._selected.setStyle(this.getStyle(this._selected)),this._selected=null),this._hoverSelected&&(this._hoverSelected.setStyle(this.getStyle(this._hoverSelected)),this._hoverSelected=null),this}},{key:"on",value:function(t){return this._events.push(t),this}},{key:"off",value:function(t){for(var e=0;e<this._events.length;e++)this._events[e].id!==t&&this._events[e].change!==t||(this._events.splice(e,1),e--);return this}},{key:"dispose",value:function(){Xj(Yj(a.prototype),"dispose",this).call(this),this._zoomChangeShowLabel(),this._interactionService.dispose(),this._selected=null,this._hoverSelected=null,Lj.off(this._mapClick,"click"),this._events.length=0}}],r&&qj(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(Cj);function Jj(t){return Jj="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Jj(t)}function $j(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Qj(n.key),n)}}function Qj(t){var e=function(t,e){if("object"!=Jj(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Jj(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Jj(e)?e:String(e)}function tR(){return tR="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=rR(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},tR.apply(this,arguments)}function eR(t,e){return eR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},eR(t,e)}function rR(t){return rR=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},rR(t)}var nR=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&eR(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=rR(n);if(i){var r=rR(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Jj(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(t=o.call.apply(o,[this].concat(r)))._stateService=void 0,t._map=void 0,t}return e=a,r=[{key:"initState",value:function(t,e){return this._stateService&&this._stateService.dispose(),this._stateService=new Kj(t,e),this}},{key:"zoomChangeShowLabel",value:function(t,e){return this._stateService._zoomChangeShowLabel(t,e),this}},{key:"selected",get:function(){return this._stateService.selected}},{key:"setSelected",value:function(t,e){return this._stateService.setSelected(t,e),this}},{key:"setStyle",value:function(t,e,r){return this._stateService.setStyle(t,e,r),this}},{key:"getStyle",value:function(t,e,r){return this._stateService.getStyle(t,e,r)}},{key:"addHover",value:function(t,e){var r=this;return this._stateService.on({id:e,type:"hover",change:function(e,n,i){if(i instanceof Opl.interaction.Select.SelectEvent){var o,a=i.selected.length>0,s=a?i.selected[0]:i.deselected[0];s.set("_hover",a),t&&t({zoom:Math.ceil(r._map.getView().getZoom()),item:s.get("item"),hover:a,position:Opl.proj.toLonLat(null===(o=i.mapBrowserEvent)||void 0===o?void 0:o.coordinate),featurePosition:Opl.proj.toLonLat(s.getGeometry().getCoordinates()),feature:s,e:i})}}}),this}},{key:"removeHover",value:function(t){return this._stateService.off(t),this}},{key:"addClick",value:function(t,e,r){var n=this;return this._stateService.on({id:e,type:"click",change:function(e,i,o){e?t&&t({zoom:Math.ceil(n._map.getView().getZoom()),item:e.get("item"),position:Opl.proj.toLonLat(o.coordinate),featurePosition:Vj(e.getGeometry()),feature:e}):i&&r&&r.cancelCallback&&r.cancelCallback({zoom:Math.ceil(n._map.getView().getZoom()),item:i.get("item"),position:Opl.proj.toLonLat(o.coordinate),featurePosition:Vj(i.getGeometry()),feature:i})}}),this}},{key:"removeClick",value:function(t){return this._stateService.off(t),this}},{key:"dispose",value:function(){tR(rR(a.prototype),"dispose",this).call(this),this._stateService.dispose()}}],r&&$j(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(rr);function iR(t){return iR="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},iR(t)}function oR(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function aR(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,sR(n.key),n)}}function sR(t){var e=function(t,e){if("object"!=iR(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=iR(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==iR(e)?e:String(e)}function uR(){return uR="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=fR(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},uR.apply(this,arguments)}function lR(t,e){return lR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},lR(t,e)}function cR(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function fR(t){return fR=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},fR(t)}var pR=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&lR(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=fR(n);if(i){var r=fR(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===iR(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return cR(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this))._options=void 0,r._features=[],r._source=new Opl.source.Vector({wrapX:!1}),r._layer=new Opl.layer.Vector({zIndex:1,source:r._source}),r._map=t,r._options=e,r.initState(cR(r),e),r}return e=a,r=[{key:"map",get:function(){return this._map}},{key:"layer",get:function(){return this._layer}},{key:"features",get:function(){return this._features}},{key:"options",get:function(){return this._options}},{key:"show",get:function(){return this._layer.getVisible()},set:function(t){this._layer.setVisible(t)}},{key:"addFeature",value:function(t){var e,r=this;if(Array.isArray(t)){var n,i=t.filter((function(t){return!r._source.hasFeature(t)}));this._source.addFeatures(i),(n=this._features).push.apply(n,function(t){if(Array.isArray(t))return oR(t)}(e=i)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||function(t,e){if(t){if("string"==typeof t)return oR(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?oR(t,e):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}else this._source.hasFeature(t)||(this._source.addFeature(t),this._features.push(t));return this}},{key:"hasFeature",value:function(t){return this._features.includes(t)}},{key:"getFeatures",value:function(t,e){var r=[];if("string"==typeof t)this._features.forEach((function(n){n.get(t)===e&&r.push(n)}));else{var n=Object.keys(t);this._features.forEach((function(e){n.some((function(r){return e.get(r)===t[r]}))&&r.push(e)}))}return r}},{key:"filter",value:function(t){for(var e=[],r=0,n=this._features.length;r<n;r++)!0===t(this._features[r],r)&&e.push(this._features[r]);return e}},{key:"find",value:function(t){for(var e=0,r=this._features.length;e<r;e++)if(!0===t(this._features[e],e))return this._features[e]}},{key:"findLast",value:function(t){for(var e=this._features.length-1;e>=0;e--)if(!0===t(this._features[e],e))return this._features[e]}},{key:"findLastIndex",value:function(t){for(var e=this._features.length-1;e>=0;e--)if(!0===t(this._features[e],e))return e;return-1}},{key:"findIndex",value:function(t){for(var e=0,r=this._features.length;e<r;e++)if(!0===t(this._features[e],e))return e;return-1}},{key:"forEach",value:function(t){for(var e=0,r=this._features.length;e<r;e++)t(this._features[e],e);return this}},{key:"filterVisible",value:function(t){for(var e=[],r=0,n=this._features.length;r<n;r++){var i=this._features[r];!0===t(i.get("item"),i)&&e.push(i)}return e.length!==this._features.length&&(this._source.clear(),this._source.addFeatures(e)),this}},{key:"filterRemove",value:function(t){for(var e=[],r=0;r<this._features.length;r++){var n=this._features[r];!0===t(n.get("item"),n)?(this._features.splice(r,1),r--):e.push(n)}return e.length!==this._features.length&&(this._source.clear(),this._source.addFeatures(e)),this}},{key:"removeFeature",value:function(t){var e=this;if(Array.isArray(t))t.forEach((function(t){e.removeFeature(t)}));else{var r=this._features.findIndex((function(e){return e===t}));r>=0&&(this._features.splice(r,1),this._source.removeFeature(this._features[r]))}return this}},{key:"clearFeatures",value:function(){return this._source.clear(),this}},{key:"dispose",value:function(){uR(fR(a.prototype),"dispose",this).call(this),this.clearFeatures(),this._source.dispose(),this.layer.dispose()}}],r&&aR(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(nR);const hR=pR;function yR(t){return yR="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yR(t)}function dR(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,gR(n.key),n)}}function gR(t){var e=function(t,e){if("object"!=yR(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=yR(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==yR(e)?e:String(e)}function mR(t,e){return mR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},mR(t,e)}function vR(t){return vR=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},vR(t)}var _R=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&mR(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=vR(n);if(i){var r=vR(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===yR(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,e))._zIndex=0,r._layer.set("name",e.name||"iconPoint"),r._layer.setZIndex(e.zIndex||1),r._layer.setStyle((function(t){return r._stateService.getStyle(t,"default",{text:t.get("label")})})),r}return e=a,r=[{key:"create",value:function(t,e){var r=this;if(Array.isArray(t)){var n=t.map((function(t){var n=new Opl.Feature({item:t,label:t.label,geometry:new Opl.geom.Point(Opl.proj.fromLonLat(t.point))});return e&&(e.text=t.label,n.setStyle((function(t){return r._stateService.getStyle(t,"default",e)}))),n.set("styleZIndex",r._zIndex++,!0),n}));this.addFeature(n)}else{var i=new Opl.Feature({item:t,label:t.label,geometry:new Opl.geom.Point(Opl.proj.fromLonLat(t.point))});e&&(e.text=t.label,i.setStyle((function(t){return r._stateService.getStyle(t,"default",e)}))),i.set("styleZIndex",this._zIndex++,!0),this.addFeature(i)}return this}}],r&&dR(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(hR);function bR(t){return bR="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bR(t)}function wR(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function SR(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,OR(n.key),n)}}function OR(t){var e=function(t,e){if("object"!=bR(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=bR(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==bR(e)?e:String(e)}function xR(){return xR="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ER(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},xR.apply(this,arguments)}function CR(t,e){return CR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},CR(t,e)}function ER(t){return ER=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ER(t)}var PR=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&CR(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ER(n);if(i){var r=ER(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===bR(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,e))._styleCache={},r._cluster=void 0,r._zIndex=0,r._selected=null,r._cluster=new Opl.source.Cluster({distance:e.distance||50,source:r._source}),r._layer.setSource(r._cluster),r._layer.set("name",e.name||"clusterPoint"),r._layer.setZIndex(e.zIndex||1),r._layer.setStyle((function(t){return r._clusterStyle(t)})),r}return e=a,r=[{key:"_clusterStyle",value:function(t){var e=t.get("features").length,r=t.get("styleZIndex"),n=this._styleCache[e];if(n&&n.length>0)return n;var i=this._options;if(e>1&&!1!==i.badge){var o,a,s,u,l;n=[new Opl.style.Style({image:new Opl.style.Icon({src:i.iconUrl,scale:i.scale||1,displacement:i.imgOffset,imgSize:i.imgSize})})];var c=i.offset?i.offset[0]:0,f=i.offset?i.offset[1]:0;if(null!==(o=i.badge)&&void 0!==o&&o.radius){var p,h,y;n.push(new Opl.style.Style({image:new Opl.style.Circle({scale:(null===(p=i.badge)||void 0===p?void 0:p.scale)||i.scale,radius:(null===(h=i.badge)||void 0===h?void 0:h.radius)||15,fill:new Opl.style.Fill({color:null===(y=i.badge)||void 0===y?void 0:y.fill}),displacement:i.offset?[i.offset[0],-i.offset[1]]:void 0}),zIndex:r}))}else{var d,g,m=(null===(d=i.badge)||void 0===d?void 0:d.scale)||1,v=Array.isArray(m)?m.length>0?m[0]:1:m,_=Array.isArray(m)?m.length<=1?v:m[1]:m,b=this._createBadge(e.toString(),i);c+=b.width/2,f+=b.height,n.push(new Opl.style.Style({image:new Opl.style.Icon({img:b,size:[b.width,b.height],imgSize:[b.width,b.height],scale:(null===(g=i.badge)||void 0===g?void 0:g.scale)||i.scale,displacement:[c,f]}),zIndex:r})),c*=v,f=(2-f)*_}return n.push(new Opl.style.Style({text:new Opl.style.Text({scale:(null===(a=i.badge)||void 0===a?void 0:a.scale)||i.scale,font:i.fontStyle||"12px Microsoft YaHei",backgroundFill:null!==(s=i.background)&&void 0!==s&&s.fill?new Opl.style.Fill({color:i.background.fill}):void 0,backgroundStroke:null!==(u=i.background)&&void 0!==u&&u.strokeColor?new Opl.style.Stroke({color:i.background.strokeColor,width:null===(l=i.background)||void 0===l?void 0:l.strokeWidth}):void 0,text:e.toString(),fill:new Opl.style.Fill({color:i.fontColor||"rgba(255, 255, 255, 1)"}),offsetX:c,offsetY:f,padding:i.padding}),zIndex:r})),this._styleCache[e]=n,n}return this._stateService.getStyle(t.get("features")[0],"default",{text:t.get("label")})}},{key:"create",value:function(t,e){var r=this;if(Array.isArray(t)){var n=t.map((function(t){var n=new Opl.Feature({item:t,id:t.id,label:t.label,geometry:new Opl.geom.Point(Opl.proj.fromLonLat(t.point))});return e&&n.setStyle((function(t){return r._stateService.getStyle(t,"default",e)})),n.set("styleZIndex",r._zIndex++,!0),n}));this.addFeature(n)}else{var i=new Opl.Feature({item:t,id:t.id,label:t.label,geometry:new Opl.geom.Point(Opl.proj.fromLonLat(t.point))});i.set("styleZIndex",this._zIndex++,!0),e&&i.setStyle((function(t){return r._stateService.getStyle(t,"default",e)})),this.addFeature(i)}return this}},{key:"addClick",value:function(t,e,r){var n=this;return this._stateService.on({id:e,type:"click",change:function(e,i,o){if(e){var a=e.get("features")||[],s=Opl.extent.createEmpty();a.length>1&&(a.forEach((function(t){var e=t.getGeometry().getExtent();Opl.extent.extend(s,e)})),!0!==(null==r?void 0:r.disableZoom)&&n._map.getView().fit(s,function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?wR(Object(r),!0).forEach((function(e){var n,i,o;n=t,i=e,o=r[e],(i=OR(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):wR(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({duration:1e3},r||{}))),t&&t({zoom:Math.ceil(n._map.getView().getZoom()),item:a.length>1?a.map((function(t){return t.get("item")})):a[0].get("item"),position:Opl.proj.toLonLat(o.coordinate),featurePosition:Opl.proj.toLonLat(e.getGeometry().getCoordinates()),limited:1===a.length||n._map.getView().getZoom()>=n._map.getView().getMaxZoom(),features:a,isCluster:a.length>1,e:o})}else if(i&&r&&r.cancelCallback){var u=i.get("features")||[];r.cancelCallback({zoom:Math.ceil(n._map.getView().getZoom()),item:u.length>1?u.map((function(t){return t.get("item")})):u[0].get("item"),position:Opl.proj.toLonLat(o.coordinate),featurePosition:Opl.proj.toLonLat(i.getGeometry().getCoordinates()),limited:1===u.length||n._map.getView().getZoom()>=n._map.getView().getMaxZoom(),features:u,isCluster:u.length>1,e:o})}}}),this}},{key:"addHover",value:function(t,e){var r=this;return this._stateService.on({id:e,type:"hover",change:function(e,n,i){if(i instanceof Opl.interaction.Select.SelectEvent){if(0===i.selected.length&&0===i.deselected.length)return;var o,a,s=i.selected.length>0,u=s?i.selected[0]:i.deselected[0],l=u.get("features");l.length>1?t&&t({zoom:Math.ceil(r._map.getView().getZoom()),position:Opl.proj.toLonLat(null===(o=i.mapBrowserEvent)||void 0===o?void 0:o.coordinate),featurePosition:Opl.proj.toLonLat(u.getGeometry().getCoordinates()),item:l.map((function(t){return t.get("item")})),hover:s,isCluster:!0,features:l,e:i}):t&&t({zoom:Math.ceil(r._map.getView().getZoom()),position:Opl.proj.toLonLat(null===(a=i.mapBrowserEvent)||void 0===a?void 0:a.coordinate),featurePosition:Opl.proj.toLonLat(u.getGeometry().getCoordinates()),item:l[0].get("item"),hover:s,isCluster:!1,features:l,e:i})}}}),this}},{key:"_createBadge",value:function(t,e){var r,n,i,o,a,s,u=(null==e||null===(r=e.badge)||void 0===r?void 0:r.rectRadius)||10,l=document.createElement("canvas"),c=l.getContext("2d");if(!c)return l;var f=(null==e||null===(n=e.fontStyle)||void 0===n?void 0:n.match(/^(\d+)px/)[1])||12;c.font=(null==e?void 0:e.fontStyle)||"".concat(f,"px Microsoft YaHei");var p=c.measureText(t),h=((null==e||null===(i=e.badge)||void 0===i?void 0:i.rectWidth)||p.width)+10;l.width=h<p.width?p.width:h<38?38:h;var y=(null==e||null===(o=e.badge)||void 0===o?void 0:o.rectHeight)||26;l.height=y<26?26:y;var d=l.width,g=l.height,m=g/2;u&&u>0&&u<m&&(m=u),c.beginPath(),c.fillStyle=(null==e||null===(a=e.badge)||void 0===a?void 0:a.strokeColor)||"#fff",c.moveTo(0+m,0),c.arcTo(0+d,0,0+d,0+g,m),c.arcTo(0+d,0+g,0,0+g,m),c.arcTo(0,0+g,0,0,m),c.arcTo(0,0,0+d,0,m),c.closePath(),c.fill(),c.beginPath();var v=(null==e||null===(s=e.badge)||void 0===s?void 0:s.fill)||["#0e4e8e","#1786f4"];if(Array.isArray(v))if(0===v.length)v="#0e4e8e";else{for(var _=c.createLinearGradient(0+m+1.5,2.5,0+m+1.5,2.5+g),b=1/(v.length-1),w=0,S=v.length;w<S;w++)_.addColorStop(w===S-1?1:w*b,v[w]);v=_}return c.fillStyle=v,c.moveTo(0+m+1.5,2.5),c.arcTo(0+d-1.5,2.5,0+d-1.5,0+g-.5,m),c.arcTo(0+d-1.5,0+g-.5,1.5,0+g-.5,m),c.arcTo(1.5,0+g-.5,1.5,2.5,m),c.arcTo(1.5,2.5,0+d-1.5,2.5,m),c.closePath(),c.fill(),l}},{key:"dispose",value:function(){xR(ER(a.prototype),"dispose",this).call(this),this._styleCache={},this._zIndex=0,this._selected=null}}],r&&SR(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(hR);const kR=PR;function TR(t){return TR="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},TR(t)}function jR(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,RR(n.key),n)}}function RR(t){var e=function(t,e){if("object"!=TR(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=TR(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==TR(e)?e:String(e)}function LR(t,e){return LR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},LR(t,e)}function IR(t){return IR=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},IR(t)}var MR=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&LR(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=IR(n);if(i){var r=IR(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===TR(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,e))._layer.set("name",e.name||"fontLayer"),r._layer.setZIndex(e.zIndex||1),r._layer.setStyle((function(t){return r._stateService.getStyle(t,"default",{text:t.get("label")})})),r}return e=a,r=[{key:"create",value:function(t){if(Array.isArray(t)){var e=t.map((function(t){return new Opl.Feature({item:t,name:t.name,label:t.label,geometry:new Opl.geom.Point(Opl.proj.fromLonLat(t.point))})}));this.addFeature(e)}else{var r=new Opl.Feature({item:t,name:t.name,label:t.label,geometry:new Opl.geom.Point(Opl.proj.fromLonLat(t.point))});this.addFeature(r)}return this}},{key:"addSelect",value:function(t,e){return this.addHover(e,t),this}}],r&&jR(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(hR);function AR(t){return AR="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},AR(t)}function DR(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,NR(n.key),n)}}function NR(t){var e=function(t,e){if("object"!=AR(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=AR(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==AR(e)?e:String(e)}function FR(t,e){return FR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},FR(t,e)}function zR(t){return zR=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},zR(t)}var GR=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&FR(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=zR(n);if(i){var r=zR(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===AR(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,e))._layer.set("name",e.name||"lineString"),r._layer.setZIndex(e.zIndex||1),r._layer.setStyle((function(t){return r._stateService.getStyle(t,"default")})),r}return e=a,r=[{key:"create",value:function(t,e){var r=this,n=new Opl.Feature({item:t,label:t.label,geometry:new Opl.geom.LineString((t.points||t.coords).map((function(t){return Opl.proj.fromLonLat(t)})))});return e&&n.setStyle((function(t){return r._stateService.getStyle(t,"default",e)})),this.addFeature(n),this}}],r&&DR(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(hR);function BR(t){return BR="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},BR(t)}function VR(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function UR(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,qR(n.key),n)}}function qR(t){var e=function(t,e){if("object"!=BR(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=BR(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==BR(e)?e:String(e)}function WR(){return WR="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ZR(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},WR.apply(this,arguments)}function XR(t,e){return XR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},XR(t,e)}function ZR(t){return ZR=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ZR(t)}var HR=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&XR(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ZR(n);if(i){var r=ZR(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===BR(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=o.call(this))._overlays=[],e._map=void 0,e._map=t,e}return e=a,r=[{key:"map",get:function(){return this._map}},{key:"overlays",get:function(){return this._overlays}},{key:"addOverlay",value:function(t){var e=this;return Array.isArray(t)?t.forEach((function(t){e.addOverlay(t)})):this._overlays.includes(t)||(this._overlays.push(t),this._map.addOverlay(t)),this}},{key:"searchOverlays",value:function(t){var e=this,r=[];return Array.isArray(t)?t.forEach((function(t){var n,i=e.searchOverlays(t);r.push.apply(r,function(t){if(Array.isArray(t))return VR(t)}(n=i)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||function(t,e){if(t){if("string"==typeof t)return VR(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?VR(t,e):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())})):this._overlays.forEach((function(e){e.get("name")===t&&r.push(e)})),r}},{key:"getOverlays",value:function(t,e){var r=[];if("string"==typeof t)this._overlays.forEach((function(n){n.get(t)===e&&r.push(n)}));else{var n=Object.keys(t);this._overlays.forEach((function(e){n.some((function(r){return e.get(r)===t[r]}))&&r.push(e)}))}return r}},{key:"filter",value:function(t){for(var e=[],r=0,n=this._overlays.length;r<n;r++)!0===t(this._overlays[r],r)&&e.push(this._overlays[r]);return e}},{key:"find",value:function(t){for(var e=0,r=this._overlays.length;e<r;e++)if(!0===t(this._overlays[e],e))return this._overlays[e]}},{key:"findIndex",value:function(t){for(var e=0,r=this._overlays.length;e<r;e++)if(!0===t(this._overlays[e],e))return e;return-1}},{key:"forEach",value:function(t){for(var e=0,r=this._overlays.length;e<r;e++)t(this._overlays[e],e);return this}},{key:"filterVisible",value:function(t){throw new Error("Method not implemented.")}},{key:"filterRemove",value:function(t){throw new Error("Method not implemented.")}},{key:"removeOverlay",value:function(t){var e=this;if(!t)return this._overlays.forEach((function(t){return e._map.removeOverlay(t)})),void(this._overlays.length=0);if(Array.isArray(t))t.forEach((function(t){e.removeOverlay(t)}));else{var r=this.findIndex((function(e){return e.getId()===t||e===t}));if(r<0)return;this._map.removeOverlay(this._overlays[r]),this._overlays.splice(r,1)}}},{key:"clearOverlays",value:function(){return this.removeOverlay(),this}},{key:"dispose",value:function(){WR(ZR(a.prototype),"dispose",this).call(this),this.clearOverlays()}}],r&&UR(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t);function YR(t){return YR="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},YR(t)}var KR=["element","position","point"];function JR(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,$R(n.key),n)}}function $R(t){var e=function(t,e){if("object"!=YR(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=YR(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==YR(e)?e:String(e)}function QR(t,e){return QR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},QR(t,e)}function tL(t){return tL=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tL(t)}var eL=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&QR(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=tL(n);if(i){var r=tL(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===YR(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t))._options=void 0,r._options=e,r}return e=a,r=[{key:"_createMarkElement",value:function(t){var e=document.createElement("div");return e.innerHTML=t,e.setAttribute("style","width: 100px;height:100px;background-color:#ffffff;"),e.setAttribute("target","marker"),document.body.appendChild(e),e}},{key:"_getOverlayElement",value:function(t){var e=t.element instanceof Element?t.element:this._createMarkElement(t.element);return t.useTitle&&(e.title=t.label),delete t.innerHTML,e}},{key:"_createOneOverlay",value:function(t){var e=this._options?Object.assign({},this._options,t):t,r=this._getOverlayElement(e),n=new Opl.Overlay({id:e.id,element:r,position:Opl.proj.fromLonLat(e.position||e.point),positioning:e.positioning||"bottom-center",offset:e.offset?e.offset:[0,0],className:"ol-overlay-container ol-selectable  ".concat(e.className||""),stopEvent:e.stopEvent||!1});return n.set("autoElement",!(e.element instanceof Element),!0),n.set("name",e.name||"overlay",!0),n.set("item",e,!0),n}},{key:"_addClickCallback",value:function(t,e,r){r.stopPropagation(),t&&t({zoom:Math.ceil(this._map.getView().getZoom()),item:e.get("item"),position:e.getPosition(),featurePosition:e.getPosition(),overlay:e})}},{key:"addClick",value:function(t){var e=this;return this.overlays.forEach((function(r){var n=r.getElement();Reflect.has(n,"_overlay_click_")&&n.removeEventListener("click",Reflect.get(n,"_overlay_click_"));var i=e._addClickCallback.bind(e,t,r);Object.defineProperty(n,"_overlay_click_",{value:i}),n.addEventListener("click",i)})),this}},{key:"create",value:function(t){var e=this;if(Array.isArray(t)){var r=t.map((function(t){return e._createOneOverlay(t)}));this.addOverlay(r)}else{var n=this._createOneOverlay(t);this.addOverlay(n)}return this}},{key:"update",value:function(t,e){var r=e.element,n=e.position,i=e.point,o=function(t,e){if(null==t)return{};var r,n,i=function(t,e){if(null==t)return{};var r,n,i={},o=Object.keys(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||(i[r]=t[r]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}(e,KR);return r&&t.setElement(this._getOverlayElement(e)),(n||i)&&t.setPosition(Opl.proj.fromLonLat(n||i)),t.setProperties(o),this}}],r&&JR(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(HR),rL={ibo:"ibo",cta:"cta",ter:"ter",cia:"cia",img:"img",cva:"cva",vec:"vec"},nL={"EPSG:4490":"EPSG:4490","EPSG:4326":"EPSG:4326","EPSG:3857":"EPSG:3857",WEB:"EPSG:900913"},iL={"EPSG:4490":"c","EPSG:4326":"c","EPSG:3857":"c",WEB:"w"};function oL(t){return oL="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},oL(t)}function aL(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function sL(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,uL(n.key),n)}}function uL(t){var e=function(t,e){if("object"!=oL(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=oL(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==oL(e)?e:String(e)}function lL(){return lL="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=fL(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},lL.apply(this,arguments)}function cL(t,e){return cL=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},cL(t,e)}function fL(t){return fL=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},fL(t)}function pL(t,e){var r,n,i,o,a;return t?(!t.strokeColor&&null!==(r=t.stroke)&&void 0!==r&&r.color&&(t.strokeColor=null===(i=t.stroke)||void 0===i?void 0:i.color),!t.strokeWidth&&null!==(n=t.stroke)&&void 0!==n&&n.width&&(t.strokeWidth=null===(o=t.stroke)||void 0===o?void 0:o.width),t.fill&&"string"!=typeof t.fill&&(t.fill=null===(a=t.fill)||void 0===a?void 0:a.color),e&&(t.strokeColor||(t.strokeColor="rgba(14,78,142,.6)"),et(t.strokeWidth)&&(t.strokeWidth=1),t.fill||(t.fill="rgba(0,0,0,0.2)")),t):t}var hL=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&cL(t,e)}(s,t);var e,r,n,i,o,a=(i=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=fL(i);if(o){var r=fL(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===oL(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(r=a.call(this,t,pL(e)))._mapLayerUN=null,r._layer.set("name",e.name||"areaMapStyle"),r._layer.setZIndex(e.zIndex||1),r}return e=s,r=[{key:"setOptions",value:function(t){for(var e in t)this._options[e]=t[e]}},{key:"register",value:function(t){this.addFeature(t),this.setAreaStyle(this._options)}},{key:"initAreaMapStyle",value:function(t,e){var r=this;return t?("string"==typeof t?fetch(t||"四川.json").then((function(t){return t.json()})):Promise.resolve(t)).then((function(t){var n=r._map.getView().getProjection(),i=new Opl.format.GeoJSON({featureProjection:n}).readFeatures(t,e);return r.register(i),!0})).catch((function(){return Promise.resolve(!1)})):Promise.resolve(!1)}},{key:"setAreaStyle",value:function(t){var e=pL(t,!0);this._layer.setStyle(new Opl.style.Style({fill:new Opl.style.Fill({color:e.fill}),stroke:new Opl.style.Stroke({color:e.strokeColor,width:e.strokeWidth})}))}},{key:"setChildAreaStyle",value:function(t,e){var r=this;Array.isArray(t)?t.forEach((function(t){return r.setChildAreaStyle(t,e)})):t.setStyle(e?function(t){return r._stateService.getStyle(t,void 0,e)}:this._layer.getStyle())}},{key:"dispose",value:function(){lL(fL(s.prototype),"dispose",this).call(this),this._mapLayerUN&&this._mapLayerUN()}}],n=[{key:"clip",value:function(t,e,r,n){var i=e.canvas.width,o=e.canvas.height,a=document.createElement("canvas");a.width=i,a.height=o;var s=a.getContext("2d");if(s){s.clearRect(0,0,i,o),s.beginPath();for(var u=0,l=t.length;u<l;u++)for(var c=0,f=t[u].length;c<f;c++){var p=r.getPixelFromCoordinate(t[u][c]),h=p[0],y=p[1];0===c?s.moveTo(h,y):s.lineTo(h,y)}s.closePath(),s.filter=null!=n?n:"invert(1)",s.clip(),s.fill();var d=s.createPattern(e.canvas,"no-repeat");d&&(s.fillStyle=d),s.fillRect(0,0,i,o),e.fillStyle="rgba(0,0,0,.3)",e.fillRect(0,0,i,o);var g=e.createPattern(a,"no-repeat");g&&(e.fillStyle=g),e.fillRect(0,0,i,o)}}},{key:"convertPoints",value:function(t){var e=[];return t.forEach((function(t){var r=t.getGeometry();r.getCoordinates&&r.getCoordinates().forEach((function(t){var r;e.push.apply(e,function(t){if(Array.isArray(t))return aL(t)}(r=t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(r)||function(t,e){if(t){if("string"==typeof t)return aL(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?aL(t,e):void 0}}(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}))})),e}}],r&&sL(e.prototype,r),n&&sL(e,n),Object.defineProperty(e,"prototype",{writable:!1}),s}(hR);function yL(t){return yL="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yL(t)}function dL(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function gL(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function mL(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,vL(n.key),n)}}function vL(t){var e=function(t,e){if("object"!=yL(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=yL(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==yL(e)?e:String(e)}function _L(){return _L="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=wL(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},_L.apply(this,arguments)}function bL(t,e){return bL=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},bL(t,e)}function wL(t){return wL=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},wL(t)}var SL=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&bL(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=wL(n);if(i){var r=wL(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===yL(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(t=o.call.apply(o,[this].concat(r)))._layers=[],t._map=void 0,t}return e=a,r=[{key:"layers",get:function(){return this._layers}},{key:"addLayer",value:function(t){var e=this;return Array.isArray(t)?t.forEach((function(t){e.addLayer(t)})):this.hasLayer(t)||t.disposed||(this._layers.push(t),this._map.addLayer(t)),this}},{key:"hasLayer",value:function(t){return this._layers.includes(t)}},{key:"hasMapLayer",value:function(t){return this._map.getLayers().getArray().includes(t)}},{key:"searchLayers",value:function(t){var e=this,r=[];return Array.isArray(t)?t.forEach((function(t){var n,i=e.searchLayers(t);r.push.apply(r,function(t){if(Array.isArray(t))return gL(t)}(n=i)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||function(t,e){if(t){if("string"==typeof t)return gL(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?gL(t,e):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())})):this._layers.forEach((function(e){e.get("name")===t&&r.push(e)})),r}},{key:"getLayers",value:function(t,e){var r=[];if("string"==typeof t)this._layers.forEach((function(n){n.get(t)===e&&r.push(n)}));else{var n=Object.keys(t);this._layers.forEach((function(e){n.some((function(r){return e.get(r)===t[r]}))&&r.push(e)}))}return r}},{key:"filterLayer",value:function(t){for(var e=[],r=0,n=this._layers.length;r<n;r++)!0===t(this._layers[r],r)&&e.push(this._layers[r]);return e}},{key:"findLayer",value:function(t){for(var e=0,r=this._layers.length;e<r;e++)if(!0===t(this._layers[e],e))return this._layers[e]}},{key:"findIndexLayer",value:function(t){for(var e=0,r=this._layers.length;e<r;e++)if(!0===t(this._layers[e],e))return e;return-1}},{key:"forEachLayer",value:function(t){for(var e=0,r=this._layers.length;e<r;e++)t(this._layers[e],e);return this}},{key:"filterVisibleLayer",value:function(t,e){var r=!1!==e;return this._layers.forEach((function(e){!0===t(e.get("item"),e)&&!1!==e.get("visible")!==r&&e.set("visible",r)})),this}},{key:"filterRemoveLayer",value:function(t){var e=this._layers.filter((function(e){return!0===t(e.get("item"),e)}));return this.removeLayer(e),this}},{key:"visibleLayers",value:function(t,e){var r=this;if(Array.isArray(t))t.forEach((function(t){r.visibleLayers(t,e)}));else{var n=this.searchLayers(t);n.length>0&&n.forEach((function(t){t.set("visible",e)}))}return this}},{key:"zoomByLayers",value:function(t,e){var r=this.searchLayers(Array.isArray(t)?t:[t]),n=Opl.extent.createEmpty();return r.forEach((function(t){Opl.extent.extend(n,t.getSource().getExtent())})),this._map.getView().fit(n,function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?dL(Object(r),!0).forEach((function(e){var n,i,o;n=t,i=e,o=r[e],(i=vL(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):dL(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({duration:1e3},e||{})),this}},{key:"removeLayer",value:function(t){var e=this;if(!t)return this._layers.forEach((function(t){return e._map.removeLayer(t)})),void(this._layers.length=0);if(Array.isArray(t))t.forEach((function(t){e.removeLayer(t)}));else{var r=this.findIndexLayer((function(e){return e===t}));if(r<0)return;this._layers.splice(r,1),this._map.removeLayer(t)}}},{key:"clearLayers",value:function(){return this.removeLayer(),this}},{key:"dispose",value:function(){_L(wL(a.prototype),"dispose",this).call(this),this.clearLayers()}}],r&&mL(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t);const OL=SL;function xL(t){return xL="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xL(t)}function CL(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function EL(t){return function(t){if(Array.isArray(t))return PL(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return PL(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?PL(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function PL(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function kL(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,TL(n.key),n)}}function TL(t){var e=function(t,e){if("object"!=xL(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=xL(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==xL(e)?e:String(e)}function jL(){return jL="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=LL(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},jL.apply(this,arguments)}function RL(t,e){return RL=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},RL(t,e)}function LL(t){return LL=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},LL(t)}var IL=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&RL(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=LL(n);if(i){var r=LL(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===xL(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this))._options=void 0,r._layerGroup=new Map,r._map=void 0,r._map=t,r._options=e,null!=e&&e.group&&e.group.forEach((function(t){r.addLayerGroup(t.name,t.layers)})),r}return e=a,r=[{key:"map",get:function(){return this._map}},{key:"addLayerGroup",value:function(t,e){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!1===(!(arguments.length>2&&void 0!==arguments[2])||arguments[2])&&this.removeLayerGroup(t),this._layerGroup.has(t)){var n=this._layerGroup.get(t);n&&(Array.isArray(e)?n.push.apply(n,EL(e)):n.push(e))}else this._layerGroup.set(t,Array.isArray(e)?EL(e):[e]);return!0===r&&this.toMap(t),this}},{key:"addLayerGroups",value:function(t){var e=this;t.forEach((function(t){e.addLayerGroup(t.groupName,t.layer,t.isAppend,t.isToMap)}))}},{key:"removeLayerGroup",value:function(t){var e=this;return Array.isArray(t)?t.forEach((function(t){e.removeLayerGroup(t)})):this._layerGroup.has(t)&&this._layerGroup.delete(t),this}},{key:"visibleLayerGroup",value:function(t,e){var r=Array.isArray(t)?t:[t],n=this._layerGroup,i=[],o=[];return r.forEach((function(t){if(n.has(t)){var r=n.get(t);if(r)for(var a=0;a<r.length;a++){var s=r[a];if(s.disposed)r.splice(a,1),a--;else if(s.get("visible")!==e){s.set("visible",e);var u=s.getSource();e&&o.push(s),i.includes(u)||i.push(u)}}}})),i.forEach((function(t){t.changed()})),this}},{key:"getLayerExtent",value:function(t){if(Array.isArray(t)){var e=Opl.extent.createEmpty();return t.forEach((function(t){Opl.extent.extend(e,t.getSource().getExtent())})),e}return t.getSource().getExtent()}},{key:"toMap",value:function(t){var e=this,r=Array.isArray(t)?t:[t],n=this._layerGroup,i=[];return r.forEach((function(t){if(n.has(t)){var e=n.get(t);e&&i.push.apply(i,EL(e))}})),i.length>0&&i.forEach((function(t){var r;t.values_.map||null===(r=e.map)||void 0===r||r.addLayer(t)})),this}},{key:"zoomToCenter",value:function(t,e,r){var n=this.map;if(n){var i=this.getLayerExtent(t),o=n.getView();o&&(e&&e>=o.getMinZoom()&&e<=o.getMaxZoom()?(o.setZoom(e),o.setCenter(Opl.extent.getCenter(i))):o.fit(i,function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?CL(Object(r),!0).forEach((function(e){var n,i,o;n=t,i=e,o=r[e],(i=TL(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):CL(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({nearest:!0,duration:1e3,maxZoom:o.getZoom()},r||{})))}}},{key:"groupToZoomToCenter",value:function(t,e,r){if(this._layerGroup.has(t)){var n=this._layerGroup.get(t);n&&this.zoomToCenter(n,e,r)}}},{key:"dispose",value:function(){jL(LL(a.prototype),"dispose",this).call(this),this._layerGroup.clear()}}],r&&kL(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t);const ML=IL;function AL(t){return AL="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},AL(t)}function DL(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function NL(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?DL(Object(r),!0).forEach((function(e){var n,i,o;n=t,i=e,o=r[e],(i=zL(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):DL(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function FL(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,zL(n.key),n)}}function zL(t){var e=function(t,e){if("object"!=AL(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=AL(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==AL(e)?e:String(e)}function GL(){return GL="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=VL(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},GL.apply(this,arguments)}function BL(t,e){return BL=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},BL(t,e)}function VL(t){return VL=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},VL(t)}var UL=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&BL(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=VL(n);if(i){var r=VL(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===AL(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,e))._interactionService=void 0,r._style=void 0,r._defaultStyleOptions={geometry:function(t){return t.getGeometry()},radius:6,strokeColor:"rgba(255, 0, 255, 0.5)",strokeWidth:6,background:{strokeColor:"rgba(255, 255, 255, 1)",strokeWidth:2},fill:"rgba(255, 255, 255, 0.5)"},r._drawLayer=void 0,nt(r._defaultStyleOptions,e),r._layer.set("name",e.name||"drawLine"),r._layer.setZIndex(e.zIndex||1e3),r._layer.setStyle((function(t){return r._returnStyle(t)})),r._interactionService=new Gj(t),r._style=r._stateService._getOptionsToStyle("_style",r._stateService.getMergeStyleOptions(null,r._defaultStyleOptions)),r._createDraw(),r}return e=a,r=[{key:"drawType",get:function(){return this.options.type||"LineString"}},{key:"_createDraw",value:function(){var t=this,e=null,r=new Opl.interaction.Draw({source:this._source,type:this.drawType,style:function(r,n){return r!==e&&r.getGeometry()instanceof Opl.geom.LineString&&(e=r).setStyle((function(e){return t._returnStyle(e)})),t._style}});r.set("name","draw");var n=!1,i=[];r.addEventListener("drawstart",(function(e){i.length=0,t.fire("drawstart"),n=!0})),r.addEventListener("drawend",(function(r){n=!1,e=null,t.fire("drawend"),i.length=0})),r.addEventListener("drawabort",(function(t){n=!1,e=null,i.length=0})),this._drawLayer=r;var o=new Opl.interaction.Pointer({handleDownEvent:function(e){var r=e.originalEvent,o=e.coordinate;return 2===r.button?t._drawLayer.removeLastPoint():0===r.button&&n&&(t.fire("drawchange",i.map((function(t){return Opl.proj.toLonLat(t)})),Opl.proj.toLonLat(o)),i.push(o)),2===r.button}});o.set("name","rightClick"),this._interactionService.addInteraction([r,o],{uncontrolled:!0})}},{key:"_returnStyle",value:function(t){var e=this._stateService._getStyleOptions(this._stateService.getMergeStyleOptions(t,this._defaultStyleOptions)),r=null;return(r=t.getGeometry()instanceof Opl.geom.LineString||t.getGeometry()instanceof Opl.geom.Point?t.getGeometry().getCoordinates():t.getGeometry().getCoordinates()[0])?r.map((function(t){return new Opl.style.Style(NL(NL({},e),{},{geometry:new Opl.geom.Point(t)}))})).concat(this._style):[]}},{key:"draw",value:function(t){var e=this;Lj._appHandler.setOptions({disabled:!0});var r=new Opl.interaction.Select({condition:Opl.events.condition.doubleClick,style:this._style});return r.set("name","stopDraw"),r.on("select",(function(r){e._drawLayer.finishDrawing(),t&&t(e.getValue()),e._source.clear()})),this._interactionService.addInteraction(r,{uncontrolled:!0}),this}},{key:"getValue",value:function(){var t=this._source.getFeatures();return t.length>0?t[0].getGeometry().getCoordinates().map((function(t){return Opl.proj.toLonLat(t)})):[]}},{key:"rmLastPoint",value:function(){var t;return null===(t=this._drawLayer)||void 0===t||t.removeLastPoint(),this}},{key:"dispose",value:function(){GL(VL(a.prototype),"dispose",this).call(this),Lj._appHandler.setOptions({disabled:!1}),this._interactionService.dispose()}}],r&&FL(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(hR);function qL(t){return qL="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qL(t)}function WL(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,XL(n.key),n)}}function XL(t){var e=function(t,e){if("object"!=qL(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=qL(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==qL(e)?e:String(e)}function ZL(t,e){return ZL=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ZL(t,e)}function HL(t){return HL=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},HL(t)}var YL=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ZL(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=HL(n);if(i){var r=HL(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===qL(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,nt({strokeColor:"rgba(0, 0, 255, 0.8)",strokeWidth:0},e)))._useRight=!0,r._interactionService=void 0,r._layer.set("name",e.name||"gridPolygon"),r._layer.setZIndex(e.zIndex||1),r._layer.setStyle((function(t){return r._returnStyle(t)})),r._interactionService=new Gj(t),r._stateService.addExcludeCacheEventName(["_clickStyle","_hoverStyle"]),r}return e=a,r=[{key:"_returnStyle",value:function(t){return this._map.getView().getZoom()<(this._options.minZoomShow||0)?(this._stateService.currentDefaultEventName="_defaultFeatureStyle",this._stateService.getStyle(t,"_defaultFeatureStyle")):(this._stateService.currentDefaultEventName="default",this._stateService.getStyle(t,"default",{text:t.get("label")}))}},{key:"create",value:function(t){if(Array.isArray(t)){var e=t.map((function(t){return new Opl.Feature({item:t,name:t.name,label:t.label,geometry:new Opl.geom.Polygon([t.points.map((function(t){return Opl.proj.fromLonLat(t)}))])})}));this.addFeature(e)}else{var r=new Opl.Feature({item:t,name:t.name,label:t.label,geometry:new Opl.geom.Polygon([t.points.map((function(t){return Opl.proj.fromLonLat(t)}))])});this.addFeature(r)}return this}},{key:"addSelect",value:function(t,e){return this.addClick(t,e),this}},{key:"addRightClick",value:function(t,e){var r=this,n=new Opl.interaction.Select({condition:function(t){var e=t.originalEvent;return 2===e.button&&e.pointerType},layers:[this._layer],style:function(t){return r._returnStyle(t)}});return n.set("name",e||"rightClickSelect"),n.on("select",(function(e){if(0!==e.selected.length){var n=e.selected[e.selected.length-1];t&&t({zoom:Math.ceil(r._map.getView().getZoom()),item:n.get("item"),position:Opl.proj.toLonLat(e.mapBrowserEvent.coordinate),featurePosition:Vj(n.getGeometry()),feature:n})}})),this._interactionService.addInteraction(n),this}},{key:"getCenterCoordinates",value:function(t){return Vj(t.getGeometry())}}],r&&WL(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(hR);function KL(t){return KL="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},KL(t)}function JL(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,$L(n.key),n)}}function $L(t){var e=function(t,e){if("object"!=KL(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=KL(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==KL(e)?e:String(e)}function QL(t,e){return QL=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},QL(t,e)}function tI(t){return tI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tI(t)}var eI=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&QL(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=tI(n);if(i){var r=tI(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===KL(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,e))._layer=new Opl.layer.Heatmap({source:r._source,blur:e.blur||20,radius:e.radius||20,weight:function(t){return t.get("weight")||e.weight||1},zIndex:e.zIndex||2}),r._layer.set("name",e.name||"heatMap"),r}return e=a,r=[{key:"create",value:function(t){if(Array.isArray(t)){var e=t.map((function(t){return new Opl.Feature({item:t,name:t.name,weight:t.weight,geometry:new Opl.geom.Point(Opl.proj.fromLonLat(t.point))})}));this.addFeature(e)}else{var r=new Opl.Feature({item:t,name:t.name,weight:t.weight,geometry:new Opl.geom.Point(Opl.proj.fromLonLat(t.point))});this.addFeature(r)}return this}}],r&&JL(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(hR);function rI(t){return rI="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rI(t)}function nI(t){return function(t){if(Array.isArray(t))return iI(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return iI(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?iI(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function iI(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function oI(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,aI(n.key),n)}}function aI(t){var e=function(t,e){if("object"!=rI(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=rI(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==rI(e)?e:String(e)}function sI(){return sI="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=lI(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},sI.apply(this,arguments)}function uI(t,e){return uI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},uI(t,e)}function lI(t){return lI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},lI(t)}var cI=1.5707963267948966,fI=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&uI(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=lI(n);if(i){var r=lI(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===rI(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,e))._animating=!1,r._startTime=null,r._speed=void 0,r._listenKey=null,r._distance=null,r._index=0,r._routeLine=void 0,r._newRoute=[],r._style=void 0,r._geoMarkerGeometry=null,r._speed=e.speed||.1,r._style=r._createStyle(e),r._layer.set("name",e.name||"trajectory"),r._layer.setZIndex(e.zIndex||1),r._layer.setStyle((function(t){return r._returnStyle(t)})),r}return e=a,r=[{key:"_createStyle",value:function(t){var e=t.obsoletesStyle;return{route:this._stateService._getOptionsToStyle("route",{strokeWidth:t.strokeWidth||5,strokeColor:t.strokeColor||"rgba(255, 255, 255, 1)"}),mark:this._stateService._getOptionsToStyle("mark",{radius:t&&t.strokeWidth-1||4,fill:t.fill||"rgba(0, 0, 0, 1)",strokeWidth:1,strokeColor:"#fff"}),geoMarker:this._stateService._getOptionsToStyle("geoMarker",{iconUrl:t.iconUrl,scale:t&&t.scale?t.scale:1}),lineDash:this._stateService._getOptionsToStyle("lineDash",{strokeWidth:e&&e.strokeWidth+1||6,strokeColor:e&&e.strokeColor||"rgba(0, 0, 0 ,1)",lineDash:e&&e.lineDash||[10,10]}),startMarker:null,endMarker:null}}},{key:"_returnStyle",value:function(t){return this._animating&&"geoMarker"===t.get("type")?null:this._style[t.get("type")]}},{key:"_createRoute",value:function(t){var e=new Opl.Feature({type:"route",name:t||"trajectory",geometry:this._routeLine}),r=function(t,e){var r=[],n=t.shift(),i=t.pop(),o=Math.ceil(Math.ceil(t.length/e)/e);o<=0&&(o=2);for(var a=0,s=0;s<t.length;s++)s===a+o&&(r.push(t[s]),a=s);return r.unshift(n),r.push(i),r}(this._routeLine.getCoordinates().map((function(e){return new Opl.Feature({type:"mark",name:t||"trajectory",geometry:new Opl.geom.Point(e)})})),this._options.pointAmount),n=new Opl.Feature({type:"geoMarker",name:t||"trajectory",geometry:new Opl.geom.Point(this._routeLine.getCoordinateAt(0))}),i=new Opl.Feature({type:"startMarker",name:t||"trajectory",geometry:new Opl.geom.Point(this._routeLine.getCoordinateAt(0))}),o=new Opl.Feature({type:"endMarker",name:t||"trajectory",geometry:new Opl.geom.Point(this._routeLine.getCoordinateAt(1))});return this.addFeature([e,n,i,o].concat(nI(r))),[e,n,i,o].concat(nI(r))}},{key:"_animation",value:function(t){var e=Opl.render.getVectorContext(t),r=t.frameState;if(this._animating){var n=r.time-this._startTime,i=this._distance=this._speed*n/1e3;if(i>=1)return void this._stopAnimation(!0,this._options.repeat);for(var o,a=this._routeLine.getCoordinateAt(i),s=this._routeLine.getCoordinates(),u=0;u<s.length;u++)if(u+1!==s.length){var l=[s[u],s[u+1]];new Opl.geom.LineString(l).intersectsCoordinate(a)&&(this._index=u)}o=this._index===s.length?this._index:this._index+1;var c=-Math.atan2(a[1]-s[o][1],a[0]-s[o][0])-cI;this._style.geoMarker.getImage().setRotation(c);var f=new Opl.geom.Point(a);this._newRoute.push(a);var p=new Opl.geom.LineString(this._newRoute),h=new Opl.Feature(f),y=new Opl.Feature(p);e.drawFeature(y,this._style.lineDash),e.drawFeature(h,this._style.geoMarker)}this._map.render()}},{key:"_stopAnimation",value:function(t,e){var r=this.find((function(t){return"geoMarker"===t.get("type")}));r.setGeometry(this._geoMarkerGeometry),this._animating=!1;var n=t?1:this._distance,i=this._routeLine.getCoordinateAt(n);r.getGeometry().setCoordinates(i),this._newRoute=[],Opl.Observable.unByKey(this._listenKey),e&&this.start()}},{key:"create",value:function(t){var e=t.route,r=(t.points||e||[]).map((function(t){return Opl.proj.fromLonLat(t)}));if(r.length>1){this._routeLine=new Opl.geom.LineString(r);var n=-Math.atan2(r[0][1]-r[1][1],r[0][0]-r[1][0])-cI;this._style.geoMarker.getImage().setRotation(n),this._createRoute(t.name)}return this}},{key:"start",value:function(){var t=this;setTimeout((function(){if(t._animating)t._stopAnimation(!0,!1);else{t._animating=!0,t._startTime=(new Date).getTime(),t._listenKey=t._layer.on("postrender",t._animation.bind(t)),t._map.render();var e=t.find((function(t){return"geoMarker"===t.get("type")}));t._geoMarkerGeometry=e.getGeometry(),e.setGeometry(null)}}))}},{key:"stop",value:function(){this._stopAnimation(!1,!1)}},{key:"getCenterCoordinates",value:function(t){var e=Opl.extent.boundingExtent(t);return Opl.extent.getCenter(e)}},{key:"dispose",value:function(){sI(lI(a.prototype),"dispose",this).call(this),this._listenKey&&Opl.Observable.unByKey(this._listenKey),this.stop()}}],r&&oI(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(hR);function pI(t){return pI="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pI(t)}function hI(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,yI(n.key),n)}}function yI(t){var e=function(t,e){if("object"!=pI(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=pI(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==pI(e)?e:String(e)}function dI(t,e){return dI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},dI(t,e)}function gI(t){return gI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},gI(t)}var mI=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&dI(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=gI(n);if(i){var r=gI(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===pI(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,e))._layer.set("name",e.name||"loadGeojson"),r._layer.setZIndex(e.zIndex||1),r._layer.setStyle((function(t){return r._stateService.getStyle(t,"default",{text:t.get("label")})})),r}return e=a,r=[{key:"loadUrl",value:function(t){var e=this;return new Promise((function(r,n){fetch(t).then((function(t){return t.json()})).then((function(t){e.load(t,r)})).catch((function(){r(!1)}))}))}},{key:"load",value:function(t,e){var r=this._map.getView().getProjection(),n=new Opl.format.GeoJSON({featureProjection:r}).readFeatures(t);return this.addFeature(n),e&&e(!0),this}}],r&&hI(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(hR);function vI(t){return vI="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vI(t)}function _I(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,bI(n.key),n)}}function bI(t){var e=function(t,e){if("object"!=vI(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=vI(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==vI(e)?e:String(e)}function wI(t,e){return wI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},wI(t,e)}function SI(t){return SI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},SI(t)}var OI=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&wI(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=SI(n);if(i){var r=SI(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===vI(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,e))._layer.set("name",e.name||"kml"),r._layer.setZIndex(e.zIndex||1),r._layer.setStyle((function(t){return r._stateService.getStyle(t,"default")})),r}return e=a,r=[{key:"load",value:function(t,e){var r=new Opl.source.Vector({url:t,format:new Opl.format.KML});return this.layer.setSource(r),null!=e&&e.flyTo&&this._map.getView().animate({center:Opl.extent.getCenter(r.getExtent()),duration:1e3}),this}}],r&&_I(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(hR);function xI(t){return xI="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xI(t)}function CI(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function EI(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?CI(Object(r),!0).forEach((function(e){var n,i,o,a;n=t,i=e,o=r[e],a=function(t,e){if("object"!=xI(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=xI(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(i),(i="symbol"==xI(a)?a:String(a))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):CI(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function PI(t){return PI="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},PI(t)}var kI=["name","flyTo","bounds","zoom","opacity"];function TI(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function jI(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?TI(Object(r),!0).forEach((function(e){var n,i,o;n=t,i=e,o=r[e],(i=LI(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):TI(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function RI(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,LI(n.key),n)}}function LI(t){var e=function(t,e){if("object"!=PI(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=PI(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==PI(e)?e:String(e)}function II(){return II="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=AI(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},II.apply(this,arguments)}function MI(t,e){return MI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},MI(t,e)}function AI(t){return AI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},AI(t)}var DI=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&MI(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=AI(n);if(i){var r=AI(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===PI(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this))._layer=new Opl.layer.Group({layers:[]}),r._layers=[],r.map=void 0,r.map=t,r._layer.set("name",e.name||"tileLayerAdmin"),r._layer.setZIndex(e.zIndex||1),r.map.addLayer(r._layer),r}return e=a,r=[{key:"layers",get:function(){return this._layer.getLayers()}},{key:"_addLayer",value:function(t){this._layers.includes(t)||(this._layers.push(t),this.layers.push(t),this._layer.changed())}},{key:"load",value:function(t,e){var r=e||{},n=r.name,i=(r.flyTo,r.bounds),o=(r.zoom,r.opacity),a=function(t,e){if(null==t)return{};var r,n,i=function(t,e){if(null==t)return{};var r,n,i={},o=Object.keys(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||(i[r]=t[r]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}(r,kI),s=this.map.getView().getProjection(),u=i?Opl.extent.applyTransform(i.flat(),Opl.proj.getTransform("EPSG:4326",s)):void 0,l=this.map.getView(),c=new Opl.layer.Tile(jI(jI({opacity:o||.9,extent:u,minZoom:l.getZoom(),maxZoom:l.getMaxZoom()},a),{},{source:new Opl.source.XYZ({url:t})}));return n&&c.set("name",n,!0),this._addLayer(c),u&&l.fit(u,{duration:1e3}),this}},{key:"find",value:function(t){return this._layers.find((function(e){return e.get("name")===t}))}},{key:"remove",value:function(t){if(t){var e=this._layers.findIndex((function(e){return e.get("name")===t}));e>=0&&(this.layers.remove(this._layers[e]),this._layers.slice(e,1))}else this._layers.length=0,this.layers.clear();return this}},{key:"setVisible",value:function(t,e){var r=this.find(t);return r&&r.setVisible(e),this}},{key:"dispose",value:function(){II(AI(a.prototype),"dispose",this).call(this),this._layers.length=0,this.map.removeLayer(this._layer)}}],r&&RI(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t);function NI(t){return NI="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},NI(t)}function FI(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function zI(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?FI(Object(r),!0).forEach((function(e){var n,i,o;n=t,i=e,o=r[e],(i=BI(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):FI(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function GI(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,BI(n.key),n)}}function BI(t){var e=function(t,e){if("object"!=NI(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=NI(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==NI(e)?e:String(e)}function VI(){return VI="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=qI(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},VI.apply(this,arguments)}function UI(t,e){return UI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},UI(t,e)}function qI(t){return qI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},qI(t)}var WI=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&UI(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=qI(n);if(i){var r=qI(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===NI(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this)).map=void 0,r._options=void 0,r._drawInstance=null,r._layer=new Opl.layer.Vector({}),r._source=new Opl.source.Vector({wrapX:!1}),r.map=t,r._options=e,r._layer.setSource(r._source),r._layer.set("name",e.name||"measure"),r._layer.setZIndex(e.zIndex||1),t.addLayer(r._layer),r}return e=a,r=[{key:"_setStyle",value:function(t,e,r){var n=t._style;"function"==typeof n&&(n=n(e));var i=Array.isArray(n)?n:[n];i.push(new Opl.style.Style({text:new Opl.style.Text({font:"16px Microsoft YaHei",text:r,backgroundFill:new Opl.style.Fill({color:"rgba(255,255,255,1)"}),backgroundStroke:new Opl.style.Stroke({width:1,color:"rgba(0,0,0,0.2)"}),fill:new Opl.style.Fill({color:"#333"}),padding:[5,5,5,5],overflow:!0})})),e.setStyle(i),this._source.addFeature(e)}},{key:"distance",value:function(t,e){var r=this;this._drawInstance&&this.clear(!0);var n=new UL(this.map,zI(zI({name:"distance",strokeColor:"rgba(81, 255,0,1)",radius:6,strokeWidth:2,fill:"rgba(225, 229,0,0.2)",background:{strokeColor:"rgba(225, 229,0,1)",strokeWidth:2}},e),{},{type:"LineString"}));this.map.addLayer(n.layer);var i=[];this._drawInstance={draw:n,features:i},n.addEventListener("drawstart",(function(t){if(!0===r._options.drawClear)for(;i.length>0;)r._source.removeFeature(i.pop())})),n.draw((function(e){var o=n._source.getFeatures()[0].getGeometry(),a=Opl.sphere.getLength(o)/1e3;t(a);var s=new Opl.Feature({geometry:new Opl.geom.LineString(o.getCoordinates())});r._setStyle(n,s,"".concat(a.toFixed(3)," km")),i.push(s)}))}},{key:"area",value:function(t,e){var r=this;this._drawInstance&&this.clear(!0);var n=new UL(this.map,zI(zI({name:"area",strokeColor:"rgba(81, 255,0,1)",radius:6,strokeWidth:2,fill:"rgba(225, 229,0,0.2)",background:{strokeColor:"rgba(225, 229,0,1)",strokeWidth:2}},e),{},{type:"Polygon"}));this.map.addLayer(n.layer);var i=[];this._drawInstance={draw:n,features:i},n.addEventListener("drawstart",(function(){if(!0===r._options.drawClear)for(;i.length>0;)r._source.removeFeature(i.pop())})),n.draw((function(e){var o=n._source.getFeatures()[0].getGeometry(),a=ft(Opl.sphere.getArea(o));t(a);var s=new Opl.Feature({geometry:new Opl.geom.Polygon(o.getCoordinates())});r._setStyle(n,s,"".concat(a.toFixed(3)," km²")),i.push(s)}))}},{key:"clear",value:function(t){var e=this;this._drawInstance&&(this._drawInstance.features.forEach((function(t,r){e._source.removeFeature(t)})),this._drawInstance.features.length=0,t&&(this._drawInstance.draw.dispose(),this.map.removeLayer(this._drawInstance.draw.layer),this._drawInstance=null))}},{key:"dispose",value:function(){VI(qI(a.prototype),"dispose",this).call(this),this.clear(!0),this._layer.dispose(),this.map.removeLayer(this._layer)}}],r&&GI(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t);function XI(t){return XI="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},XI(t)}function ZI(t){return function(t){if(Array.isArray(t))return HI(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return HI(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?HI(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function HI(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function YI(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function KI(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?YI(Object(r),!0).forEach((function(e){var n,i,o;n=t,i=e,o=r[e],(i=$I(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):YI(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function JI(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,$I(n.key),n)}}function $I(t){var e=function(t,e){if("object"!=XI(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=XI(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==XI(e)?e:String(e)}function QI(t,e){return QI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},QI(t,e)}function tM(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function eM(t){return eM=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},eM(t)}var rM=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&QI(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=eM(n);if(i){var r=eM(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===XI(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tM(t)}(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=o.call(this))._mapLayers=[],e._view=null,e._instance=new Lr(tM(e)),e._options=void 0,e._domMarker=void 0,e._options=t,e}return e=a,r=[{key:"ol",get:function(){return window.ol}},{key:"map",get:function(){if(this._dispose)throw Error("BimMap(ol)资源已被释放，请重新实例化后使用！");return this._map}},{key:"instances",get:function(){return this._instance.instances}},{key:"instancesToName",get:function(){return this._instance.instancesToName}},{key:"interactions",get:function(){return[]}},{key:"overlays",get:function(){return this._domMarker.overlays}},{key:"options",get:function(){return this._options}},{key:"_init",value:function(t){var e=t.doubleClickZoom,r=void 0!==e&&e,n=t.useControl,i={zoom:n&&!0===n.zoom,rotate:n&&!0===n.rotate,attribution:n&&!0===n.attribution},o=Opl.interaction.defaults({doubleClickZoom:r}),a=new Opl.Map({target:t.target,controls:Opl.control.defaults(i),interactions:o});return this._map=a,Lj.setMap(a),a._appHandler=Lj,this._domMarker=new eL(a),Lj.on("pointermove",(function(t){a.getViewport().style.cursor=a.hasFeatureAtPixel(a.getEventPixel(t.originalEvent))?"pointer":""})),a}},{key:"addView",value:function(t){var e=this._init(this._options),r=t.maxZoom,n=void 0===r?18:r,i=t.proj,o=void 0===i?"EPSG:3857":i,a=t.minZoom,s=void 0===a?0:a,u=Opl.proj.get(o)||void 0,l=u?u.getExtent():null,c=l?Opl.extent.getWidth(l):Opl.extent.getWidth(Opl.extent.applyTransform([-180,-90,180,90],(function(t,e,r){return Opl.proj.transform(t,o,"EPSG:3857"===o?"EPSG:4326":"EPSG:3857")}))),f=[];if("EPSG:4326"===o){for(var p=s;p<20;p++)f.push(360/(256*Math.pow(2,p)));!function(t){var e=Opl.proj.fromLonLat;Opl.proj.fromLonLat=function(r,n){return e(r,n||t)};var r=Opl.proj.toLonLat;Opl.proj.toLonLat=function(e,n){return r(e,n||t)}}(u)}else for(var h=1;h<n+1;h++)f[h]=Math.round(c/(256*Math.pow(2,h)));return this._view=new Opl.View(KI(KI({},t),{},{projection:u,center:Opl.proj.fromLonLat(t.center||[0,0]),zoom:t.zoom||0,minZoom:s||0,maxZoom:n,resolutions:f})),e.setView(this._view),e}},{key:"useTianDiTu",value:function(t){var e,r=this,n=((null==t?void 0:t.type)||["img","cia"]).map((function(e){return function(t){for(var e=Opl.proj.get(nL[t.proj]),r=e.getExtent(),n=r?Opl.extent.getTopLeft(r):[-180,90],i=Opl.proj.getTransform("EPSG:4326",e),o=r?Opl.extent.getWidth(r):Opl.extent.getWidth(Opl.extent.applyTransform([-180,-90,180,90],i)),a=[],s=[],u=t.maxZoom,l=void 0===u?18:u,c=1;c<l+1;c++)a[c]=o/(256*Math.pow(2,c)),s[c]=c;var f=new Opl.tilegrid.WMTS({origin:n,resolutions:a,matrixIds:s}),p=new Opl.source.WMTS({url:t.url+rL[t.type]+"_"+iL[t.proj]+"/wmts?tk="+t.key,layer:rL[t.type],version:"1.0.0",matrixSet:iL[t.proj],format:"tiles",projection:e,requestEncoding:"KVP",style:"default",tileGrid:f}),h=new Opl.layer.Tile({source:p});return h.set("zIndex",1),h}({type:e,proj:(null==t?void 0:t.proj)||"EPSG:4326",key:(null==t?void 0:t.key)||"a3f0bbf7db728e8db4ebbe860679d4bb",url:(null==t?void 0:t.url)||"http://t{0-7}.tianditu.gov.cn/"})}));(e=this._mapLayers).push.apply(e,ZI(n)),n.forEach((function(t){t.set("name","tianditu",!0),r.map.addLayer(t)}))}},{key:"useMapboxVT",value:function(t){var e=this;(function(t){var e=[];return function(t,e,r){var n;if(void 0===r&&(r={}),("string"==typeof t||t instanceof HTMLElement)&&(t=new gS({target:t})),"string"==typeof e){var i=e.startsWith("data:")?location.href:oT(e,r.accessToken);r=XT(i,r),n=new Promise((function(n,o){hT(e,r).then((function(e){ej(e,t,i,r).then((function(){n(t)})).catch(o)})).catch((function(t){o(new Error("Could not load "+e+": "+t.message))}))}))}else n=new Promise((function(n,i){ej(e,t,!r.styleUrl||r.styleUrl.startsWith("data:")?location.href:oT(r.styleUrl,r.accessToken),r).then((function(){n(t)})).catch(i)}));return n}(t.map,t.url).then((function(t){return t.getLayers().forEach((function(t){t.get("mapbox-layers")&&e.push(t)})),e})).catch((function(){return[]}))})({map:this.map,url:t.url}).then((function(t){var r;(r=e._mapLayers).push.apply(r,ZI(t)),t.forEach((function(t){t.set("name","mapboxvt",!0)}))}))}},{key:"useXYZ",value:function(t){var e=this;(function(t){return(null!=t&&t.url?[null==t?void 0:t.url]:!0===(null==t?void 0:t.dark)?["https://webst02.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}","https://webst02.is.autonavi.com/appmaptile?style=8&x={x}&y={y}&z={z}"]:["https://webrd01.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}"]).map((function(t){var e=new Opl.layer.Tile({source:new Opl.source.XYZ({url:t,crossOrigin:"anonymous"})});return e.set("zIndex",0),e}))})(t).forEach((function(t){t.set("name","xyz",!0),e._mapLayers.push(t),e.map.addLayer(t)}))}},{key:"useWMTS",value:function(t){var e=function(t){for(var e=Opl.proj.get(t.proj),r=e.getExtent(),n=r?Opl.extent.getTopLeft(r):[-180,90],i=Opl.proj.getTransform("EPSG:4326",e),o=r?Opl.extent.getWidth(r):Opl.extent.getWidth(Opl.extent.applyTransform([-180,-90,180,90],i)),a=[],s=[],u=t.maxZoom,l=void 0===u?18:u,c=1;c<l+1;c++)a[c]=o/(256*Math.pow(2,c)),s[c]=c;var f=new Opl.tilegrid.WMTS({origin:n,resolutions:a,matrixIds:s}),p=new Opl.source.WMTS({url:t.url+t.key,layer:t.type,version:"1.0.0",matrixSet:t.matrixSet,format:t.format,projection:e,requestEncoding:"KVP",style:"default",tileGrid:f,tileLoadFunction:t.token&&function(e,r){var n=new XMLHttpRequest;return n.responseType="blob",n.open("GET",r),n.setRequestHeader("Authorization","Bearer ".concat(t.token)),n.onload=function(){200===n.status&&(e.getImage().src=URL.createObjectURL(n.response))},n.onerror=function(){e.setState(Opl.TileState.ERROR)},n.send(),!1}});return new Opl.layer.Tile({source:p})}({type:t.type,proj:t.proj||"EPSG:3857",matrixSet:t.proj||"EPSG:3857",format:t.format,key:t.key||"",url:t.url,maxZoom:t.maxZoom||this._view.getMaxZoom(),token:t.token,size:this.map.getSize()});e.set("name","wmts",!0);var r=this._mapLayers.push(e);this.map.addLayer(e);var n=this;return{setVisible:function(t){e.setVisible(t)},remove:function(){n._mapLayers.splice(r,1),n.map.removeLayer(e)}}}},{key:"useWMS",value:function(t){var e=function(t,e){var r,n,i=ct(e.url),o=t.getView().getProjection(),a=(i.BBOX||i.bbox||(null===(r=e.params)||void 0===r?void 0:r.BBOX)||(null===(n=e.params)||void 0===n?void 0:n.bbox)||"-180, -90, 180, 90").split(",").map((function(t){return Number(t)})),s=Opl.extent.applyTransform(a,Opl.proj.getTransform("EPSG:4326",o)),u=new Opl.source.ImageWMS({url:e.url.split("?")[0],ratio:1,params:EI(EI({service:"WMS",format:"image/png",transparent:"true",styles:"",version:"1.3.0",access_token:e.token},i),e.params)}),l=new Opl.layer.Image({source:u,extent:s,zIndex:e.zIndex||1});return l.set("name",e.name||"wms",!0),l}(this.map,t),r=this._mapLayers.push(e);this.map.addLayer(e);var n=this;return{setVisible:function(t){e.setVisible(t)},remove:function(){n._mapLayers.splice(r,1),n.map.removeLayer(e)}}}},{key:"removeMapLayer",value:function(){var t=this;return this._mapLayers.forEach((function(e){return t.map.removeLayer(e)})),this._mapLayers.length=0,this}},{key:"GridPolygon",value:function(t){return this._instance.add(new YL(this.map,t),!0)}},{key:"LayerGroupAdmin",value:function(t){return this._instance.add(new ML(this.map,t))}},{key:"AreaMapStyle",value:function(t){return this._instance.add(new hL(this.map,t),!0)}},{key:"ClusterPoint",value:function(t){return this._instance.add(new kR(this.map,t),!0)}},{key:"IconMarker",value:function(t){return this._instance.add(new _R(this.map,t),!0)}},{key:"DomMarker",value:function(t){return this._instance.add(new eL(this.map,t))}},{key:"Text",value:function(t){return this._instance.add(new MR(this.map,t),!0)}},{key:"Line",value:function(t){return this._instance.add(new GR(this.map,t),!0)}},{key:"Trajectory",value:function(t){return this._instance.add(new fI(this.map,t),!0)}},{key:"DrawLine",value:function(t){return this._instance.add(new UL(this.map,t),!0)}},{key:"HeatMap",value:function(t){return this._instance.add(new eI(this.map,t),!0)}},{key:"Kml",value:function(t){return this._instance.add(new OI(this.map,t),!0)}},{key:"TileLayerAdmin",value:function(t){return this._instance.add(new DI(this.map,t),!0)}},{key:"LoadGeojson",value:function(t){return this._instance.add(new mI(this.map,t),!0)}},{key:"Measure",value:function(t){return this._instance.add(new WI(this.map,t),!0)}},{key:"addOverlay",value:function(t){var e,r,n=t.id?this._domMarker.find((function(e){return e.getId()===t.id})):null;return n?null===(e=this._domMarker)||void 0===e||e.update(n,t):null===(r=this._domMarker)||void 0===r||r.create(t),this}},{key:"removeOverlay",value:function(t){return t?this._domMarker.removeOverlay(t):this._domMarker.clearOverlays(),this}},{key:"removeInstance",value:function(t){return this._instance.remove(t),this}},{key:"getLonLat",value:function(t){if(t instanceof MouseEvent){var e=Opl.proj.toLonLat(this.map.getEventCoordinate(t));return[e[0],e[1]]}var r=Opl.proj.toLonLat(this.map.getCoordinateFromPixel([t.x,t.y]));return[r[0],r[1]]}},{key:"setCenter",value:function(t,e){return this._view.cancelAnimations(),this._view.animate({center:Opl.proj.fromLonLat(t),duration:e||1e3}),this}},{key:"setZoom",value:function(t,e){return this._view.cancelAnimations(),this._view.animate({zoom:t,duration:e||1e3}),this}},{key:"zoomTo",value:function(t){return!t.zoom||t.zoom<this._view.getMinZoom()||t.zoom>this._view.getMaxZoom()?this.setCenter(t.point,t.duration):(this._view.cancelAnimations(),this._view.animate({zoom:t.zoom,center:Opl.proj.fromLonLat(t.point),duration:t.duration||1e3})),this}},{key:"getZoom",value:function(){return Math.round(this._view.getZoom())}},{key:"flyTo",value:function(t,e){return this._view.cancelAnimations(),this._view.animate({zoom:null==e?void 0:e.zoom,center:Bj(Array.isArray(t)?t.map((function(t){return t.getGeometry()})):t.getGeometry()),duration:(null==e?void 0:e.duration)||1e3}),this}},{key:"getEntityCenterCoordinate",value:function(t){return Vj(Array.isArray(t)?t.map((function(t){return t.getGeometry()})):t.getGeometry())}},{key:"getCoordinatesCenter",value:function(t){return function(t){var e=t;if(t.length>0&&Array.isArray(t[0])){var r=Opl.extent.createEmpty();t.forEach((function(t){return Opl.extent.extendCoordinate(r,t)})),t=Opl.extent.getCenter(r)}return e}(t)}},{key:"getCoordinateFromFeature",value:function(t){if(Array.isArray(t)){var e=[];return t.forEach((function(t){e.push(Vj(t.getGeometry()))})),e}return Vj(t.getGeometry())}},{key:"hasFeatureInView",value:function(t,e){var r=this.map.getView().calculateExtent(this.map.getSize());if(!e&&!Array.isArray(t))return Opl.extent.containsExtent(r,t.getGeometry().getExtent());e&&(Array.isArray(t)?t:[t]).forEach((function(t){e(t,Opl.extent.containsExtent(r,t.getGeometry().getExtent()))}))}},{key:"clear",value:function(){return this.clearLayers(),this}},{key:"resize",value:function(){return this.map.updateSize(),this}},{key:"render",value:function(){return this.map.render(),this}},{key:"on",value:function(t,e){return Lj.on(t,e),this}},{key:"off",value:function(t,e){return Lj.off(e,t),this}},{key:"zoomChange",value:function(t){return Lj.onZoom(t),this}},{key:"removeZoomChange",value:function(t){return Lj.offZoom(t),this}},{key:"dispose",value:function(){var t;this._dispose||(this._instance.dispose(),this.clear(),null===(t=this._domMarker)||void 0===t||t.dispose(),Lj.clear(),this._view.dispose(),this._view=null,this._map.dispose(),this._map=null)}},{key:"removeMap",value:function(){this.removeMapLayer(),console.warn("函数 => removeMap : 将在下一版本移除，请使用removeMapLayer！")}},{key:"unon",value:function(t,e){e&&this.off(t,e),console.warn("函数 => unon : 将在下一版本移除，请使用off！")}},{key:"removeInteraction",value:function(t){console.warn("函数 => removeInteraction : 将在下一版本移除！")}},{key:"addInteraction",value:function(t){console.warn("函数 => addInteraction : 将在下一版本移除！")}},{key:"searchInteractions",value:function(t){console.warn("函数 => searchInteractions : 将在下一版本移除！")}},{key:"searchInteraction",value:function(t){console.warn("函数 => searchInteraction : 将在下一版本移除！")}},{key:"clearSelection",value:function(){console.warn("函数 => clearSelection : 将在下一版本移除！")}}],r&&JI(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(OL),nM=r(7823),iM={};function oM(t){return oM="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},oM(t)}function aM(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function sM(t){return sM="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sM(t)}iM.styleTagTransform=_(),iM.setAttributes=d(),iM.insert=h().bind(null,"head"),iM.domAPI=f(),iM.insertStyleElement=m(),l()(nM.Z,iM),nM.Z&&nM.Z.locals&&nM.Z.locals;var uM=["maxZoom","padding","duration"];function lM(t){return function(t){if(Array.isArray(t))return cM(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return cM(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?cM(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function cM(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function fM(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,pM(n.key),n)}}function pM(t){var e=function(t,e){if("object"!=sM(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=sM(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==sM(e)?e:String(e)}function hM(){return hM="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=dM(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},hM.apply(this,arguments)}function yM(t,e){return yM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},yM(t,e)}function dM(t){return dM=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},dM(t)}var gM=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&yM(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=dM(n);if(i){var r=dM(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===sM(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this))._options=void 0,r._layerGroup=new Map,r._map=void 0,r._map=t,r._options=e,null!=e&&e.group&&e.group.forEach((function(t){r.addLayerGroup(t.name,t.layers)})),r}return e=a,r=[{key:"map",get:function(){return this._map}},{key:"addLayerGroup",value:function(t,e){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!1===(!(arguments.length>2&&void 0!==arguments[2])||arguments[2])&&this.removeLayerGroup(t),this._layerGroup.has(t)){var n=this._layerGroup.get(t);n&&(Array.isArray(e)?n.push.apply(n,lM(e)):n.push(e))}else this._layerGroup.set(t,Array.isArray(e)?lM(e):[e]);return!0===r&&this.toMap(t),this}},{key:"addLayerGroups",value:function(t){var e=this;t.forEach((function(t){e.addLayerGroup(t.groupName,t.layer,t.isAppend,t.isToMap)}))}},{key:"removeLayerGroup",value:function(t){var e=this;return Array.isArray(t)?t.forEach((function(t){e.removeLayerGroup(t)})):this._layerGroup.has(t)&&this._layerGroup.delete(t),this}},{key:"visibleLayerGroup",value:function(t,e){var r=Array.isArray(t)?t:[t],n=this._layerGroup,i=[],o=this.map;return r.forEach((function(t){if(n.has(t)){var r=n.get(t);if(r)for(var a=0;a<r.length;a++){var s=r[a];e?(o.dataSources.contains(s)||o.dataSources.add(s),i.push(s)):o.dataSources.contains(s)&&o.dataSources.remove(s)}}})),this}},{key:"getLayerExtent",value:function(t){var e=new Cesium.BoundingSphere;return Array.isArray(t)?t.forEach((function(t){t.entities.values.forEach((function(t){e=D(t,e)}))})):t.entities.values.forEach((function(t){D(t,e)})),e}},{key:"toMap",value:function(t){var e=this,r=Array.isArray(t)?t:[t],n=this._layerGroup,i=[];return r.forEach((function(t){if(n.has(t)){var e=n.get(t);e&&i.push.apply(i,lM(e))}})),i.length>0&&i.forEach((function(t){var r;e.map.dataSources.contains(t)||null===(r=e.map)||void 0===r||r.dataSources.add(t)})),this}},{key:"zoomToCenter",value:function(t,e,r){if(this.map){var n=Array.isArray(t)?new Cesium.CustomDataSource:t;Array.isArray(t)&&t.forEach((function(t){t.entities.values.forEach((function(t){return n.entities.add(t)}))}));var i=r||{},o=(i.maxZoom,i.padding,i.duration);(function(t,e){if(null==t)return{};var r,n,i=function(t,e){if(null==t)return{};var r,n,i={},o=Object.keys(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||(i[r]=t[r]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}})(i,uM),this._map.flyTo(n,{duration:lt(o,!0,1),maximumHeight:E(e)})}}},{key:"groupToZoomToCenter",value:function(t,e,r){if(this._layerGroup.has(t)){var n=this._layerGroup.get(t);n&&this.zoomToCenter(n,e,r)}}},{key:"dispose",value:function(){hM(dM(a.prototype),"dispose",this).call(this),this._layerGroup.clear()}}],r&&fM(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t);const mM=gM;function vM(t){return vM="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vM(t)}var _M=["_rules"];function bM(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function wM(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?bM(Object(r),!0).forEach((function(e){SM(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):bM(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function SM(t,e,r){return(e=EM(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function OM(t){return function(t){if(Array.isArray(t))return xM(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return xM(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?xM(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xM(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function CM(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,EM(n.key),n)}}function EM(t){var e=function(t,e){if("object"!=vM(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=vM(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==vM(e)?e:String(e)}function PM(){return PM="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=TM(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},PM.apply(this,arguments)}function kM(t,e){return kM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},kM(t,e)}function TM(t){return TM=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},TM(t)}var jM=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&kM(t,e)}(s,t);var r,n,i,o,a=(i=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=TM(i);if(o){var r=TM(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===vM(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(e=a.call(this))._cacheStyle=new Map,e._cacheRuleStyle=new Map,e._excludeCacheEventNames=[],e._defaultOptions=null,e._cacheDefaultStyleOptions=null,e._options={},e.currentDefaultEventName="default",t&&nt(e._options,t),e}return r=s,n=[{key:"options",get:function(){return this._options}},{key:"_getTextCanvas",value:function(t,e,r){var n,i,o=document.createElement("canvas"),a=o.getContext("2d");if(!a)return o;a.font=(null==r?void 0:r.fontStyle)||"12px Microsoft YaHei";var s=a.measureText(t),u=((null==r||null===(n=r.badge)||void 0===n?void 0:n.rectWidth)||s.width)+10;o.width=(u<s.width?s.width:u<38?38:u)*e[0];var l=(null==r||null===(i=r.badge)||void 0===i?void 0:i.rectHeight)||26;o.height=(l<26?26:l)*e[1];var c=o.width,f=o.height;return a.beginPath(),a.fillStyle=null==r?void 0:r.fillColor,a.fillRect(0,0,c,f),a.fill(),a.translate(c/2,f/2+2),a.textAlign="center",a.textBaseline="middle",a.fillStyle=r.fontColor||"#ffffff",a.fillText(t,0,0),o}},{key:"_getConvertStyles",value:function(t){var r,n,i={};if((t.fill||t.strokeColor||t.strokeWidth)&&(i.polygon={fill:!!t.fill,material:Cesium.Color.fromCssColorString(t.fill||"rgba(0,0,0,0.2)"),outline:!et(t.strokeWidth),outlineWidth:0,outlineColor:Cesium.Color.fromCssColorString(t.strokeColor||"rgba(14,78,142,0.6)"),heightReference:e.clampToGround?Cesium.HeightReference.CLAMP_TO_GROUND:Cesium.HeightReference.NONE,show:!0,zIndex:t._zIndex},i.polyline={show:!0,width:et(t.strokeWidth)?1:t.strokeWidth,material:"dash"===t.lineType?new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.fromCssColorString(t.strokeColor||"rgba(255,0,255,1)"),dashLength:t.lineDash&&t.lineDash.length>0?t.lineDash[0]:16,gapColor:null!==(r=t.background)&&void 0!==r&&r.fill?Cesium.Color.fromCssColorString(null===(n=t.background)||void 0===n?void 0:n.fill):Cesium.Color.WHITE.withAlpha(0)}):Cesium.Color.fromCssColorString(t.strokeColor||"rgba(255,0,255,1)"),clampToGround:e.clampToGround,zIndex:t._zIndex}),t.radius&&(i.point={show:!0,pixelSize:t.radius||5,heightReference:e.clampToGround?Cesium.HeightReference.CLAMP_TO_GROUND:Cesium.HeightReference.NONE,color:Cesium.Color.fromCssColorString(t.fill||"rgba(0,0,0,0.2)"),outlineColor:Cesium.Color.fromCssColorString(t.strokeColor||"rgba(14,78,142,0.6)"),outlineWidth:t.strokeWidth||1}),t.iconUrl||t.img||t.html){var o=st(t.scale),a=t.imgSize?[t.imgSize[0]*o[0],t.imgSize[1]*o[1]]:[void 0,void 0],s=t.imgOffset||[0,0],u=t.iconUrl||(t.img instanceof HTMLImageElement?t.img.src:t.img?t.img.toDataURL():void 0);if(t.html){var l=at(t.text,t.html);we.loadCanvas(l),u=new Cesium.CallbackProperty((function(){return we.get(l)}),!0)}else u&&/\.gif$/i.test(u)&&(Object.defineProperty(i,"_gif",{value:u,configurable:!1}),u=ye.load(u));i.billboard={show:!0,image:u,scaleByDistance:new Cesium.NearFarScalar(0,.95,8e4,.7),verticalOrigin:Cesium.VerticalOrigin.CENTER,horizontalOrigin:Cesium.HorizontalOrigin.CENTER,heightReference:e.clampToGround?Cesium.HeightReference.CLAMP_TO_GROUND:Cesium.HeightReference.NONE,distanceDisplayCondition:new Cesium.DistanceDisplayCondition(0,Number.POSITIVE_INFINITY),scale:Math.max.apply(Math,OM(o)),width:a[0],height:a[1],pixelOffset:new Cesium.Cartesian2(s[0]*o[0],s[1]*o[1]),color:t.opacity?Cesium.Color.WHITE.withAlpha(t.opacity):void 0}}if(!t.html&&t.text){var c,f,p,h,y,d,g,m=st(t.scale);null!==(c=t.background)&&void 0!==c&&c.url&&!i.billboard&&(i.billboard={show:!0,image:null===(g=t.background)||void 0===g?void 0:g.url,verticalOrigin:Cesium.VerticalOrigin.CENTER,horizontalOrigin:Cesium.HorizontalOrigin.CENTER,heightReference:e.clampToGround?Cesium.HeightReference.CLAMP_TO_GROUND:Cesium.HeightReference.NONE,distanceDisplayCondition:new Cesium.DistanceDisplayCondition(0,Number.POSITIVE_INFINITY),scale:Math.min.apply(Math,OM(m)),eyeOffset:new Cesium.Cartesian3(0,0,-10)});var v=t.offset||[0,0];i.label={show:!0,text:Array.isArray(t.text)?t.text.join("\n"):t.text,font:t.fontStyle||"normal 12px MicroSoft YaHei",style:Cesium.LabelStyle.FILL_AND_OUTLINE,showBackground:!(null===(f=t.background)||void 0===f||!f.fill),backgroundColor:null!==(p=t.background)&&void 0!==p&&p.fill?Cesium.Color.fromCssColorString(null===(h=t.background)||void 0===h?void 0:h.fill):void 0,scale:Math.min.apply(Math,OM(m)),backgroundPadding:new Cesium.Cartesian2(8,7),pixelOffset:new Cesium.Cartesian2(v[0]*m[0],v[1]*m[1]),eyeOffset:new Cesium.Cartesian3(0,-10,-10),horizontalOrigin:Cesium.HorizontalOrigin.CENTER,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,heightReference:e.clampToGround?Cesium.HeightReference.CLAMP_TO_GROUND:Cesium.HeightReference.NONE,fillColor:Cesium.Color.fromCssColorString(t.fontColor||"#333333"),outlineColor:Cesium.Color.fromCssColorString((null===(y=t.background)||void 0===y?void 0:y.strokeColor)||"#ffffff"),outlineWidth:(null===(d=t.background)||void 0===d?void 0:d.strokeWidth)||0,distanceDisplayCondition:new Cesium.DistanceDisplayCondition(0,Number.POSITIVE_INFINITY)}}if(t._zIndex&&(i.zIndex=t._zIndex),t._cesium&&G(i,t._cesium),t._bounce&&Object.defineProperty(i,"_bounce",{value:t._bounce,configurable:!1}),t._opacity&&(t.opacity&&!t._opacity.max&&(t._opacity.max=t.opacity),Object.defineProperty(i,"_opacity",{value:t._opacity,configurable:!1})),t._diffuse)if(Cesium.CircleWaveMaterialProperty){var _=ye.getDefaultDiffuse(t._diffuse),b={duration:1e3*_.duration,gradient:_.gradient,color:Cesium.Color.fromCssColorString(_.color),count:_.count};i.ellipse={heightReference:e.clampToGround?Cesium.HeightReference.CLAMP_TO_GROUND:Cesium.HeightReference.NONE,height:_.height,semiMinorAxis:_.radius,semiMajorAxis:_.radius,classificationType:Cesium.ClassificationType.BOTH,show:!0,distanceDisplayCondition:new Cesium.DistanceDisplayCondition(0,Number.POSITIVE_INFINITY),material:new Cesium.CircleWaveMaterialProperty(wM(wM({},b),{},{color:Cesium.Color.clone(b.color)})),zIndex:t._zIndex||1},_.fixedRadius||Object.defineProperty(i,"_diffuse",{value:_,configurable:!1})}else rt('使用动态GIF图，请引入CircleWaveMaterialProperty插件，MapInit初始化时设置：plugin: ["diffuse"]');return i}},{key:"_getOptionsToStyle",value:function(t,e){var r=this._getConvertStyles(e);return Object.defineProperty(r,"_options",{value:e,configurable:!1}),Object.defineProperty(r,"_eventName",{value:t,configurable:!1}),r}},{key:"_styleIntercept",value:function(t,e){t instanceof Cesium.CustomEntity&&(e&&Reflect.has(e,"_bounce")?t.get("_bounce",!0)||(ye.loadBounce(t,e,Reflect.get(e,"_bounce")),t.set("_bounce",!0,!0)):t.get("_bounce",!0)&&(t.unset("_bounce",!0),ye.removeBounce(t)),e&&Reflect.has(e,"_opacity")?t.get("_opacity",!0)||(ye.loadFlicker(t,e,Reflect.get(e,"_opacity")),t.set("_opacity",!0,!0)):t.get("_opacity",!0)&&(t.unset("_opacity",!0),ye.removeFlicker(t)),e&&Reflect.has(e,"_diffuse")?t.get("_diffuse",!0)||(ye.loadDiffuse(t,Reflect.get(e,"_diffuse")),t.set("_diffuse",!0,!0)):t.get("_diffuse",!0)&&(t.unset("_diffuse",!0),ye.removeDiffuse(t)))}},{key:"_convertStyles",value:function(t){var e=this;if(!t)return{};var r=ot(t),n=(r._rules,function(t,e){if(null==t)return{};var r,n,i=function(t,e){if(null==t)return{};var r,n,i={},o=Object.keys(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||(i[r]=t[r]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}(r,_M)),i={};return i[this.currentDefaultEventName]=this._getOptionsToStyle(this.currentDefaultEventName,n),Object.keys(n).forEach((function(t){t.startsWith("_")&&t.endsWith("Style")&&(i[t]=e._getOptionsToStyle(t,it(n[t],n)))})),i}},{key:"_getFeatureDefaultStyle",value:function(t){if(this._cacheStyle.has(t)){var e=this._cacheStyle.get(t)[this.currentDefaultEventName];if(e&&Reflect.has(e,"_options"))return Reflect.get(e,"_options")}}},{key:"_getFeatureStyle",value:function(t,e,r){var n;if(this._cacheStyle.has(t)?n=this._cacheStyle.get(t)[e]:this._cacheStyle.set(t,{}),n){if(r&&!1!==(null==r?void 0:r.isMergeStyle))if(e===this.currentDefaultEventName)n=this._getOptionsToStyle(e,this.getMergeStyleOptions(t,r));else{var i=this._getFeatureDefaultStyle(t),o=i?this.getMergeStyleOptions(t,r,i):this.getMergeStyleOptions(t,r);n=this._getOptionsToStyle(e,o[e]?this.getMergeStyleOptions(t,o[e],o):o)}}else{if(e===this.currentDefaultEventName)n=this._getOptionsToStyle(e,this.getMergeStyleOptions(t,r));else{var a=this._getFeatureDefaultStyle(t),s=a?this.getMergeStyleOptions(t,r,a):this.getMergeStyleOptions(t,r);n=this._getOptionsToStyle(e,s[e]?this.getMergeStyleOptions(t,s[e],s):s)}e!==this.currentDefaultEventName&&this._excludeCacheEventNames.includes(e)||(this._cacheStyle.get(t)[e]=n)}return n}},{key:"getMergeStyleOptions",value:function(t,e,r){var n=ot(r||this._defaultOptions);if(n._rules){var i=xe(t,n._rules);i&&(n=nt(n,i,["_cesium"]),i._cesium&&(n._cesium?nt(n._cesium,i._cesium):n._cesium=i._cesium))}return e?nt(n,e):n}},{key:"addExcludeCacheEventName",value:function(t){var e;(e=this._excludeCacheEventNames).push.apply(e,OM(Array.isArray(t)?t:[t]))}},{key:"removeExcludeCacheEventName",value:function(t){var e=Array.isArray(t)?t:[t];this._excludeCacheEventNames=this._excludeCacheEventNames.filter((function(t){return!e.includes(t)}))}},{key:"setOptions",value:function(t){t&&nt(this._options,t)}},{key:"setDefaultOptions",value:function(t){return this._defaultOptions=t,this._cacheDefaultStyleOptions=this._convertStyles(t),this}},{key:"removeStyle",value:function(t){this._cacheStyle.has(t)&&this._cacheStyle.delete(t)}},{key:"removeFeatureStyle",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";if(this._cacheStyle.has(t)){var r=this._cacheStyle.get(t);r[e]||Reflect.deleteProperty(r,e)}}},{key:"addStyle",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",r=arguments.length>2?arguments[2]:void 0;return this._getFeatureStyle(t,e,r)}},{key:"getStyle",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",r=arguments.length>2?arguments[2]:void 0;if(!r&&("_hoverStyle"===e||"_clickStyle"===e)){var n=t.getStyle();n&&Reflect.get(n,"_eventName")!==this.currentDefaultEventName&&Reflect.has(n,"_options")&&(r=SM({},e,Reflect.get(n,"_options")[e]))}var i=this._getFeatureStyle(t,e,r);if(i||this._cacheDefaultStyleOptions){var o=i||this._cacheDefaultStyleOptions[e];return this._styleIntercept(t,o),o}}},{key:"dispose",value:function(){PM(TM(s.prototype),"dispose",this).call(this),this._cacheStyle.clear(),this._defaultOptions=null,this._cacheDefaultStyleOptions=null}}],n&&CM(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),s}(_t);function RM(t){return RM="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},RM(t)}function LM(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,IM(n.key),n)}}function IM(t){var e=function(t,e){if("object"!=RM(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=RM(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==RM(e)?e:String(e)}function MM(){return MM="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=NM(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},MM.apply(this,arguments)}function AM(t,e){return AM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},AM(t,e)}function DM(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function NM(t){return NM=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},NM(t)}var FM=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&AM(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=NM(n);if(i){var r=NM(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===RM(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return DM(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,e))._state_key=void 0,r._zoomChangeHandler=void 0,r.parent=void 0,r._selected=null,r._hoverSelected=null,r._events=[],r._layerClick=r.layerClick.bind(DM(r)),r._layerMove=r.layerMove.bind(DM(r)),r._initEvent={click:!1,hover:!1},r.parent=t,r._state_key=Symbol("stateService"),r.setDefaultOptions(e),r._initStyleEvent(e),r}return e=a,r=[{key:"map",get:function(){return this.parent.map}},{key:"selected",get:function(){return this._selected}},{key:"hoverSelected",get:function(){return this._hoverSelected}},{key:"hoverEvent",get:function(){return this._events.filter((function(t){return"hover"===t.type}))}},{key:"clickEvent",get:function(){return this._events.filter((function(t){return"click"===t.type}))}},{key:"_initStyleEvent",value:function(t){var e=this;null!=t&&t._clickStyle&&(this._onDefaultEvent("click"),this.on({type:"click",change:function(t,r,n){r&&r!==t&&(r.setStyle(r.get("__oldStyle",!0)),r.unset("__oldStyle",!0)),t&&r!==t&&(t.has("__oldStyle",!0)||t.set("__oldStyle",t.getStyle(),!0),t.setStyle(e.getStyle(t,"_clickStyle")))}})),null!=t&&t._hoverStyle&&(this._onDefaultEvent("hover"),this.on({type:"hover",change:function(t,r,n){r&&r!==t&&(e.parent.options._clickStyle&&e._selected===r||(r.setStyle(r.get("__oldStyle",!0)),r.unset("__oldStyle",!0))),t&&r!==t&&e._selected!==t&&(t.has("__oldStyle",!0)||t.set("__oldStyle",t.getStyle(),!0),t.setStyle(e.getStyle(t,"_hoverStyle")))}}))}},{key:"_onDefaultEvent",value:function(t){"click"!==t||this._initEvent.click?"hover"!==t||this._initEvent.hover||(this._initEvent.hover=!0,this.map._cameraService.on(Cesium.ScreenSpaceEventType.MOUSE_MOVE,this._layerMove,this._state_key)):(this._initEvent.click=!0,this.map._cameraService.on(Cesium.ScreenSpaceEventType.LEFT_CLICK,this._layerClick,this._state_key))}},{key:"__zoomChange",value:function(t,e){if(Array.isArray(t)?e>=t[0]&&e<=t[1]:e>=t){var r=Cesium.JulianDate.now(),n=this.map.camera.computeViewRectangle();this.parent.forEach((function(t){Cesium.Rectangle.contains(n,Cesium.Cartographic.fromCartesian(t.position.getValue(r)))?t.label&&(t.label.show=!0):t.label&&(t.label.show=!1)}))}else this.parent.forEach((function(t){t.label&&(t.label.show=!1)}))}},{key:"_zoomChangeShowLabel",value:function(t,e){this._zoomChangeHandler&&(this.map._cameraService.offZoom(this._zoomChangeHandler),this._zoomChangeHandler=null),t&&(this._zoomChangeHandler=this.__zoomChange.bind(this,t),this.map._cameraService.onZoom(this._zoomChangeHandler),!0===e&&this._zoomChangeHandler(t,this.map.getZoom()))}},{key:"_hasGetEntity",value:function(t){var e=(Array.isArray(t)?this.parent.filter((function(e){return t.includes(e)})):this.parent.find((function(e){return e===t})))||null;return Array.isArray(e)&&0===e.length&&(e=null),e}},{key:"layerClick",value:function(t,e){var r=this,n=null;Cesium.defined(t)&&(n=this._hasGetEntity(t.id),e.target=t);var i=this.parent,o=n;this.clickEvent.forEach((function(t){return t.change.call(i.layer,o,r._selected,e)})),this._selected=o}},{key:"layerMove",value:function(t,e){var r=this,n=null;Cesium.defined(t)&&(n=this._hasGetEntity(t.id),e.target=t),n===this._hoverSelected||Array.isArray(n)&&Array.isArray(this._hoverSelected)&&this._hoverSelected.every((function(t){return n.some((function(e){return e===t}))}))||(this.hoverEvent.forEach((function(t){return t.change.call(r.parent.layer,n,r._hoverSelected,e)})),this._hoverSelected=n)}},{key:"setSelected",value:function(t,e){return t?this._hasGetEntity(t)&&(this._selected&&this.setSelected(),e&&this.map._cameraService.mapFlyTo(t,e),this._selected!==t&&(t.has("__oldStyle",!0)||t.set("__oldStyle",t.getStyle(),!0),t.setStyle(this.getStyle(t,"_clickStyle")),this._selected=t)):this._selected&&(this._selected.has("__oldStyle",!0)?(this._selected.setStyle(this._selected.get("__oldStyle",!0)),this._selected.unset("__oldStyle",!0)):this._selected.setStyle(this.getStyle(this._selected)),this._selected=null),this}},{key:"setStyle",value:function(t,e,r){var n=this,i=e?r||"_temp":void 0;return Array.isArray(t)?t.forEach((function(t){return t.setStyle(n.getStyle(t,i,e))})):t.setStyle(this.getStyle(t,i,e)),this}},{key:"resetState",value:function(){return this._selected&&(this._selected.setStyle(this.getStyle(this._selected)),this._selected=null),this._hoverSelected&&(this._hoverSelected.setStyle(this.getStyle(this._hoverSelected)),this._hoverSelected=null),this}},{key:"on",value:function(t){return"click"!==t.type||this._initEvent.click?"hover"!==t.type||this._initEvent.hover||this._onDefaultEvent("hover"):this._onDefaultEvent("click"),this._events.push(t),this}},{key:"off",value:function(t){for(var e=0;e<this._events.length;e++)this._events[e].id!==t&&this._events[e].change!==t||(this._events.splice(e,1),e--);return this}},{key:"dispose",value:function(){MM(NM(a.prototype),"dispose",this).call(this),this._zoomChangeShowLabel(),this.map._cameraService.off(this._state_key),this._selected=null,this._hoverSelected=null,this._events.length=0}}],r&&LM(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(jM);function zM(t){return zM="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zM(t)}function GM(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,BM(n.key),n)}}function BM(t){var e=function(t,e){if("object"!=zM(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=zM(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==zM(e)?e:String(e)}function VM(){return VM="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=qM(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},VM.apply(this,arguments)}function UM(t,e){return UM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},UM(t,e)}function qM(t){return qM=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},qM(t)}var WM=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&UM(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=qM(n);if(i){var r=qM(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===zM(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(t=o.call.apply(o,[this].concat(r)))._stateService=void 0,t._map=void 0,t}return e=a,r=[{key:"initState",value:function(t,e){return this._stateService&&this._stateService.dispose(),this._stateService=new FM(t,e),this}},{key:"zoomChangeShowLabel",value:function(t,e){return this._stateService._zoomChangeShowLabel(t,e),this}},{key:"selected",get:function(){return this._stateService.selected}},{key:"setSelected",value:function(t,e){return this._stateService.setSelected(t,e),this}},{key:"setStyle",value:function(t,e,r){return this._stateService.setStyle(t,e,r),this}},{key:"getStyle",value:function(t,e,r){return this._stateService.getStyle(t,e,r)}},{key:"addHover",value:function(t,e){var r=this;return this._stateService.on({id:e,type:"hover",change:function(e,n,i){var o=!!e,a=o?e:n;a.set("_hover",o,!0),t&&t({zoom:r._map.getZoom(),item:a.get("item"),hover:o,position:k(r._map,i.endPosition),featurePosition:A(a),feature:a,e:i})}}),this}},{key:"removeHover",value:function(t){return this._stateService.off(t),this}},{key:"addClick",value:function(t,e,r){var n=this;return this._stateService.on({id:e,type:"click",change:function(e,i,o){e?t&&t({zoom:n._map.getZoom(),item:e.get("item"),position:k(n._map,o.position),featurePosition:A(e),feature:e}):i&&r&&r.cancelCallback&&r.cancelCallback({zoom:P(n._map.camera.positionCartographic.height),item:i.get("item"),position:k(n._map,o.position),featurePosition:A(i),feature:i})}}),this}},{key:"removeClick",value:function(t){return this._stateService.off(t),this}},{key:"dispose",value:function(){VM(qM(a.prototype),"dispose",this).call(this),this._stateService.dispose()}}],r&&GM(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(rr);function XM(t){return XM="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},XM(t)}function ZM(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,HM(n.key),n)}}function HM(t){var e=function(t,e){if("object"!=XM(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=XM(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==XM(e)?e:String(e)}function YM(t,e){return YM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},YM(t,e)}function KM(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function JM(t){return JM=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},JM(t)}var $M=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&YM(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=JM(n);if(i){var r=JM(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===XM(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return KM(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this))._options=void 0,r._features=[],r._layer=new Cesium.BimMapDataSource,r._map=t,r._options=e,r.initState(KM(r),e),r}return e=a,(r=[{key:"map",get:function(){return this._map}},{key:"features",get:function(){return this._layer.entities.values}},{key:"layer",get:function(){return this._layer}},{key:"show",get:function(){return this._layer.show},set:function(t){this._layer.show=t}},{key:"addFeature",value:function(t){var e=this,r=this._layer.getStyle(),n="function"==typeof r;return Array.isArray(t)?t.filter((function(t){return!e.hasFeature(t)})).forEach((function(t){e._features.push(t),e._layer.entities.add(t),r&&!t.getStyle()&&t.setStyle(n?r(t):r)})):this.hasFeature(t)||(this._features.push(t),this._layer.entities.add(t),r&&!t.getStyle()&&t.setStyle(n?r(t):r)),this}},{key:"hasFeature",value:function(t){return this._features.includes(t)}},{key:"removeFeature",value:function(t){var e=this;if(Array.isArray(t))t.forEach((function(t){e.removeFeature(t)}));else{var r=this._features.findIndex((function(e){return e===t}));r>=0&&(this._layer.entities.remove(this._features[r]),this._features.splice(r,1))}return this}},{key:"clearFeatures",value:function(){return this._layer.entities.removeAll(),this._features.length=0,this}},{key:"getFeatures",value:function(t,e){var r=[];if("string"==typeof t)this._features.forEach((function(n){var i;(null===(i=n.options)||void 0===i?void 0:i[t])===e&&r.push(n)}));else{var n=Object.keys(t);this._features.forEach((function(e){n.some((function(r){var n;return(null===(n=e.options)||void 0===n?void 0:n[r])===t[r]}))&&r.push(e)}))}return r}},{key:"filter",value:function(t){for(var e=[],r=0,n=this._features.length;r<n;r++)!0===t(this._features[r],r)&&e.push(this._features[r]);return e}},{key:"find",value:function(t){for(var e=0,r=this._features.length;e<r;e++)if(!0===t(this._features[e],e))return this._features[e]}},{key:"findLast",value:function(t){for(var e=this._features.length-1;e>=0;e--)if(!0===t(this._features[e],e))return this._features[e]}},{key:"findIndex",value:function(t){for(var e=0,r=this._features.length;e<r;e++)if(!0===t(this._features[e],e))return e;return-1}},{key:"findLastIndex",value:function(t){for(var e=this._features.length-1;e>=0;e--)if(!0===t(this._features[e],e))return e;return-1}},{key:"forEach",value:function(t){for(var e=0,r=this._features.length;e<r;e++)t(this._features[e],e);return this}},{key:"filterVisible",value:function(t){for(var e=0,r=this._features.length;e<r;e++){var n=this._features[e];!0===t(n.get("item"),n)?n.show=!0:n.show=!1}return this}},{key:"filterRemove",value:function(t){for(var e=this,r=[],n=0;n<this._features.length;n++){var i=this._features[n];!0===t(i.get("item"),i)?(this._features.splice(n,1),n--):r.push(i)}return r.length!==this._features.length&&(this._layer.entities.removeAll(),r.forEach((function(t){return e._layer.entities.add(t)}))),this}},{key:"options",get:function(){return this._options}},{key:"dispose",value:function(){this.clearFeatures()}}])&&ZM(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(WM);const QM=$M;function tA(t){return tA="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tA(t)}function eA(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,rA(n.key),n)}}function rA(t){var e=function(t,e){if("object"!=tA(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=tA(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==tA(e)?e:String(e)}function nA(){return nA="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=oA(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},nA.apply(this,arguments)}function iA(t,e){return iA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},iA(t,e)}function oA(t){return oA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},oA(t)}function aA(t,e){var r,n,i,o,a;return t?(!t.strokeColor&&null!==(r=t.stroke)&&void 0!==r&&r.color&&(t.strokeColor=null===(i=t.stroke)||void 0===i?void 0:i.color),!t.strokeWidth&&null!==(n=t.stroke)&&void 0!==n&&n.width&&(t.strokeWidth=null===(o=t.stroke)||void 0===o?void 0:o.width),t.fill&&"string"!=typeof t.fill&&(t.fill=null===(a=t.fill)||void 0===a?void 0:a.color),e&&(t.strokeColor||(t.strokeColor="rgba(14,78,142,.6)"),et(t.strokeWidth)&&(t.strokeWidth=1),t.fill||(t.fill="rgba(0,0,0,0.2)")),t):t}var sA=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&iA(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=oA(n);if(i){var r=oA(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===tA(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,aA(e)))._mapLayerUN=null,r._layer.set("name",e.name||"areaMapStyle"),r}return e=a,r=[{key:"setOptions",value:function(t){for(var e in t)this._options[e]=t[e]}},{key:"register",value:function(t){this.addFeature(t),this.setAreaStyle(this._options)}},{key:"initAreaMapStyle",value:function(t,e){var r=this;return t?("string"==typeof t?fetch(t||"四川.json").then((function(t){return t.json()})):Promise.resolve(t)).then((function(t){return(new Cesium.GeoJsonDataSource).load(t,e).then((function(t){r.register(t.entities.values)})).catch((function(t){console.error("🚀 ~ 加载geojson异常:",t)})),!0})).catch((function(){return Promise.resolve(!1)})):Promise.resolve(!1)}},{key:"setAreaStyle",value:function(t){this._layer.setStyle(this._stateService.getStyle(this._layer,void 0,aA(t,!0)))}},{key:"setChildAreaStyle",value:function(t,e){var r=this;Array.isArray(t)?t.forEach((function(t){return r.setChildAreaStyle(t,e)})):t.setStyle(e?this._stateService.getStyle(t,void 0,e):this._stateService.getStyle(this._layer)),this._map.scene.requestRender()}},{key:"dispose",value:function(){nA(oA(a.prototype),"dispose",this).call(this),this._mapLayerUN&&this._mapLayerUN()}}],r&&eA(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(QM);function uA(t){return uA="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},uA(t)}var lA=["padding","duration"];function cA(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function fA(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?cA(Object(r),!0).forEach((function(e){var n,i,o;n=t,i=e,o=r[e],(i=hA(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):cA(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function pA(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,hA(n.key),n)}}function hA(t){var e=function(t,e){if("object"!=uA(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=uA(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==uA(e)?e:String(e)}function yA(){return yA="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=mA(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},yA.apply(this,arguments)}function dA(t,e){return dA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},dA(t,e)}function gA(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function mA(t){return mA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},mA(t)}var vA=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&dA(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=mA(n);if(i){var r=mA(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===uA(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return gA(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),e.badge&&(e._badgeStyle=e.badge),(r=o.call(this,t,e))._styleCache={},r._cluster=void 0,r._zIndex=0,r._selected=null,r._cacheBadgeImages=new Map,r.__clusterEvent=r._clusterEvent.bind(gA(r)),r._setClusterOptions(e),r._layer.set("name",e.name||"clusterPoint"),r._layer.setStyle((function(t){return r._stateService.getStyle(t,"default",{text:t.get("label")})})),r}return e=a,r=[{key:"_setClusterOptions",value:function(t){this._layer.clustering.enabled=!0,this._layer.clustering.pixelRange=t.distance||50,this._layer.clustering.minimumClusterSize=2,this._layer.clustering.clusterBillboards=!0,this._layer.clustering.clusterLabels=!0,this._layer.clustering.clusterPoints=!0,this._layer.clustering.show=!0,this._layer.clustering.clusterEvent.addEventListener(this.__clusterEvent)}},{key:"_clusterEvent",value:function(t,e){t.length>1&&(e.billboard.id=e.label.id,e.point.id=e.label.id,this._clusterStyle(t,e))}},{key:"_clusterStyle",value:function(t,e){var r,n=t.length,i=this._cacheBadgeImages.has(n+"")?this._cacheBadgeImages.get(n+""):{},o=st(this._options.badge?this._options.badge.scale:1),a=i.canvas||this._createBadge(n,this._options,o),s=i.style||this._stateService.getStyle(e.billboard,"default_".concat(n),{text:n+"",background:{fill:"#ffffff"}});this._cacheBadgeImages.set(n+"",{style:s,canvas:a}),null!==(r=s.billboard)&&void 0!==r&&r.image?(e.label.show=!1,ut(e.billboard,s.billboard,["image"]),e.billboard.setImage(n+"",this._createImageCallback.bind(this)),e.billboard.show=!0):s.billboard?ut(e.billboard,s.billboard):(e.label.text=n+"",e.point.show=!0,e.point.pixelSize=10)}},{key:"create",value:function(t,e){if(Array.isArray(t)){var r=t.map((function(t){var e=new Cesium.CustomEntity({position:Cesium.fromLonLat(t.point),label:t.label&&{text:t.label}});return e.set({item:t,label:t.label}),e}));this.addFeature(r)}else{var n=new Cesium.CustomEntity({position:Cesium.fromLonLat(t.point),label:t.label&&{text:t.label}});n.set({item:t,label:t.label}),e&&n.setStyle(this._stateService.getStyle(n,"default",fA(fA({},e),{},{text:t.label}))),this.addFeature(n)}return this}},{key:"addClick",value:function(t,e,r){var n=this;return this._stateService.on({id:e,type:"click",change:function(e,i,o){if(Array.isArray(e)||Array.isArray(i)){var a,s=Array.isArray(e)?e:Array.isArray(i)?i:[];if(!0!==(null==r?void 0:r.disableZoom)){var u=r||{},l=(u.padding,u.duration);(function(t,e){if(null==t)return{};var r,n,i=function(t,e){if(null==t)return{};var r,n,i={},o=Object.keys(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||(i[r]=t[r]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}})(u,lA),n._map.flyTo(e||i,{duration:lt(l,!0,1)})}var c=null==o||null===(a=o.target)||void 0===a||null===(a=a.primitive)||void 0===a?void 0:a.position,f=Cesium.toLonLat(T(n._map,o.position));t&&t({zoom:n._map.getZoom(),item:s.map((function(t){return t.get("item")})),position:f,featurePosition:c?Cesium.toLonLat(c):f,limited:1===s.length||n._map.getZoom()>=n._map.getMaxZoom(),features:s,isCluster:!0,e:o})}else e?t&&t({zoom:n._map.getZoom(),item:e.get("item"),position:Cesium.toLonLat(T(n._map,o.position)),featurePosition:A(e),limited:!0,features:[e],isCluster:!1,e:o}):i&&r&&r.cancelCallback&&r.cancelCallback({zoom:n._map.getZoom(),item:i.get("item"),position:Cesium.toLonLat(T(n._map,o.position)),featurePosition:A(i),limited:!0,features:[i],isCluster:!1,e:o})}}),this}},{key:"addHover",value:function(t,e){var r=this;return this._stateService.on({id:e,type:"hover",change:function(e,n,i){if(Array.isArray(e)||Array.isArray(n)){var o,a=Array.isArray(e)?e:Array.isArray(n)?n:[],s=null==i||null===(o=i.target)||void 0===o||null===(o=o.primitive)||void 0===o?void 0:o.position,u=Cesium.toLonLat(T(r._map,i.endPosition));t&&t({zoom:r._map.getZoom(),position:u,featurePosition:s?Cesium.toLonLat(s):u,item:a.map((function(t){return t.get("item")})),hover:!!e,isCluster:!0,features:a,e:i})}else if(e||n){var l=e||n;t&&t({zoom:r._map.getZoom(),position:Cesium.toLonLat(T(r._map,i.endPosition)),featurePosition:A(l),item:l.get("item"),hover:!!e,isCluster:!1,features:[l],e:i})}}}),this}},{key:"_createImageCallback",value:function(t){var e=this;return new Promise((function(r,n){var i,o=new Image,a=e._cacheBadgeImages.has(t)?e._cacheBadgeImages.get(t):{},s=a.style,u=a.canvas;null!==(i=s.billboard)&&void 0!==i&&i.image?(o.onload=function(){r(u?e._mergeCanvas(o,u,s):o)},o.onerror=function(){n()},o.src=s.billboard.image):r(o)}))}},{key:"_mergeCanvas",value:function(t,e,r){var n=document.createElement("canvas"),i=n.getContext("2d");if(i){var o,a=st(r._options.scale),s={w:t.width*a[0],h:t.height*a[1]},u=(null===(o=r._options)||void 0===o||null===(o=o.badge)||void 0===o?void 0:o.offset)||[0,0],l={w:e.width/1.6+u[0],h:e.height/1.8+u[1]};return n.width=s.w+l.w,n.height=s.h+l.h,i.drawImage(t,0,l.h,s.w,s.h),i.drawImage(e,n.width-e.width,0),n}return t}},{key:"_createBadge",value:function(t,e,r){var n,i,o,a,s,u=(null==e||null===(n=e.badge)||void 0===n?void 0:n.rectRadius)||10,l=document.createElement("canvas"),c=l.getContext("2d");if(!c)return l;c.font=(null==e?void 0:e.fontStyle)||"12px Microsoft YaHei";var f=c.measureText(t),p=((null==e||null===(i=e.badge)||void 0===i?void 0:i.rectWidth)||f.width)+10;l.width=(p<f.width?f.width:p<38?38:p)*r[0];var h=(null==e||null===(o=e.badge)||void 0===o?void 0:o.rectHeight)||26;l.height=(h<26?26:h)*r[1];var y=l.width,d=l.height,g=d/2;u&&u>0&&u<g&&(g=u),c.beginPath(),c.fillStyle=(null==e||null===(a=e.badge)||void 0===a?void 0:a.strokeColor)||"#fff",c.moveTo(0+g,0),c.arcTo(0+y,0,0+y,0+d,g),c.arcTo(0+y,0+d,0,0+d,g),c.arcTo(0,0+d,0,0,g),c.arcTo(0,0,0+y,0,g),c.closePath(),c.fill(),c.beginPath();var m=(null==e||null===(s=e.badge)||void 0===s?void 0:s.fill)||["#0e4e8e","#1786f4"];if(Array.isArray(m))if(0===m.length)m="#0e4e8e";else{for(var v=c.createLinearGradient(0+g+1.5,2.5,0+g+1.5,2.5+d),_=1/(m.length-1),b=0,w=m.length;b<w;b++)v.addColorStop(b===w-1?1:b*_,m[b]);m=v}return c.fillStyle=m,c.moveTo(0+g+1.5,2.5),c.arcTo(0+y-1.5,2.5,0+y-1.5,0+d-.5,g),c.arcTo(0+y-1.5,0+d-.5,1.5,0+d-.5,g),c.arcTo(1.5,0+d-.5,1.5,2.5,g),c.arcTo(1.5,2.5,0+y-1.5,2.5,g),c.closePath(),c.fill(),c.translate(y/2,d/2+2),c.textAlign="center",c.textBaseline="middle",c.fillStyle=e.fontColor||"#ffffff",c.fillText(t,0,0),l}},{key:"dispose",value:function(){yA(mA(a.prototype),"dispose",this).call(this),this._layer.clustering.clusterEvent.removeEventListener(this.__clusterEvent),this._cacheBadgeImages.clear()}}],r&&pA(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(QM);const _A=vA;function bA(t){return bA="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bA(t)}function wA(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function SA(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?wA(Object(r),!0).forEach((function(e){var n,i,o;n=t,i=e,o=r[e],(i=xA(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):wA(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function OA(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,xA(n.key),n)}}function xA(t){var e=function(t,e){if("object"!=bA(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=bA(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==bA(e)?e:String(e)}function CA(t,e){return CA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},CA(t,e)}function EA(t){return EA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},EA(t)}var PA=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&CA(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=EA(n);if(i){var r=EA(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===bA(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,e))._zIndex=0,r._layer.set("name",e.name||"iconPoint"),r._layer.setStyle((function(t){return r._stateService.getStyle(t,"default",{text:t.get("label")})})),r}return e=a,r=[{key:"create",value:function(t,e){var r=this;if(Array.isArray(t)){var n=t.map((function(t){var n=new Cesium.CustomEntity({position:Cesium.fromLonLat(t.point),label:t.label&&{text:t.label}});return n.set({item:t,label:t.label}),e&&n.setStyle(r._stateService.getStyle(n,"default",SA(SA({},e),{},{text:t.label}))),n}));this.addFeature(n)}else{var i=new Cesium.CustomEntity({position:Cesium.fromLonLat(t.point),label:t.label&&{text:t.label}});i.set({item:t,label:t.label}),e&&i.setStyle(this._stateService.getStyle(i,"default",SA(SA({},e),{},{text:t.label}))),this.addFeature(i)}return this}}],r&&OA(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(QM);function kA(t){return kA="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kA(t)}function TA(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function jA(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,RA(n.key),n)}}function RA(t){var e=function(t,e){if("object"!=kA(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=kA(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==kA(e)?e:String(e)}function LA(){return LA="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=MA(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},LA.apply(this,arguments)}function IA(t,e){return IA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},IA(t,e)}function MA(t){return MA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},MA(t)}var AA=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&IA(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=MA(n);if(i){var r=MA(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===kA(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=o.call(this))._overlays=[],e._map=void 0,e._map=t,e}return e=a,r=[{key:"map",get:function(){return this._map}},{key:"overlays",get:function(){return this._overlays}},{key:"addOverlay",value:function(t){var e=this;return Array.isArray(t)?t.forEach((function(t){e.addOverlay(t)})):this._overlays.includes(t)||(this._overlays.push(t),this._map.addDivOverlay(t)),this}},{key:"searchOverlays",value:function(t){var e=this,r=[];return Array.isArray(t)?t.forEach((function(t){var n,i=e.searchOverlays(t);r.push.apply(r,function(t){if(Array.isArray(t))return TA(t)}(n=i)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||function(t,e){if(t){if("string"==typeof t)return TA(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?TA(t,e):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())})):this._overlays.forEach((function(e){e.get("name")===t&&r.push(e)})),r}},{key:"getOverlays",value:function(t,e){var r=[];if("string"==typeof t)this._overlays.forEach((function(n){n.get(t)===e&&r.push(n)}));else{var n=Object.keys(t);this._overlays.forEach((function(e){n.some((function(r){return e.get(r)===t[r]}))&&r.push(e)}))}return r}},{key:"filter",value:function(t){for(var e=[],r=0,n=this._overlays.length;r<n;r++)!0===t(this._overlays[r],r)&&e.push(this._overlays[r]);return e}},{key:"find",value:function(t){for(var e=0,r=this._overlays.length;e<r;e++)if(!0===t(this._overlays[e],e))return this._overlays[e]}},{key:"findIndex",value:function(t){for(var e=0,r=this._overlays.length;e<r;e++)if(!0===t(this._overlays[e],e))return e;return-1}},{key:"forEach",value:function(t){for(var e=0,r=this._overlays.length;e<r;e++)t(this._overlays[e],e);return this}},{key:"filterVisible",value:function(t){throw new Error("Method not implemented.")}},{key:"filterRemove",value:function(t){throw new Error("Method not implemented.")}},{key:"removeOverlay",value:function(t){var e=this;if(!t)return this._overlays.forEach((function(t){return e._map.removeDivOverlay(t)})),void(this._overlays.length=0);if(Array.isArray(t))t.forEach((function(t){e.removeOverlay(t)}));else{var r=this.findIndex((function(e){return e.get("id")===t||e===t}));if(r<0)return;this._map.removeDivOverlay(this._overlays[r]),this._overlays.splice(r,1)}}},{key:"clearOverlays",value:function(){return this.removeOverlay(),this}},{key:"dispose",value:function(){LA(MA(a.prototype),"dispose",this).call(this),this.clearOverlays()}}],r&&jA(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t);function DA(t){return DA="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},DA(t)}var NA=["element","position","point"];function FA(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,zA(n.key),n)}}function zA(t){var e=function(t,e){if("object"!=DA(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=DA(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==DA(e)?e:String(e)}function GA(t,e){return GA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},GA(t,e)}function BA(t){return BA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},BA(t)}var VA=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&GA(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=BA(n);if(i){var r=BA(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===DA(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t))._options=void 0,r._container=void 0,r._options=e,r._container=document.createElement("div"),r._container.classList.add("bimmap-smap-popups"),r}return e=a,r=[{key:"container",get:function(){return this._container}},{key:"_createMarkElement",value:function(t){var e=document.createElement("div");return e.classList.add("bimmap-smap-popup_text"),t instanceof HTMLElement?e.insertAdjacentElement("afterbegin",t):e.innerHTML=t,e.setAttribute("target","popup"),e}},{key:"_getOverlayElement",value:function(t){var e=this._createMarkElement(t.element);return t.useTitle&&(e.title=t.label),e}},{key:"_createOneOverlay",value:function(t){var e=this._options?Object.assign({},this._options,t):t,r=this._getOverlayElement(e);delete e.innerHTML;var n=e.offset||[0,0],i=Cesium.popup({id:e.id,name:e.name||"overlay",item:e,autoElement:!(e.element instanceof Element),className:"bimmap-smap-popup bimmap-smap-popup_".concat(e.positioning||"bottom-center"," ").concat(e.className||""),autoClose:!1,closeButton:!1,closeOnEscapeKey:!1,closeOnClick:!1,offset:n,bubblingMouseEvents:!1,clampToGround:e.clampToGround});return i.setLatLng(e.position||e.point),i.setContent(r),i}},{key:"_addClickCallback",value:function(t,e,r){r.stopPropagation(),t&&t({zoom:this._map.getZoom(),item:e.get("item"),position:e.getLatLng(),featurePosition:e.getLatLng(),overlay:e})}},{key:"addClick",value:function(t){var e=this;return this.overlays.forEach((function(r){var n=r.getElement();Reflect.has(n,"_overlay_click_")&&n.removeEventListener("click",Reflect.get(n,"_overlay_click_"));var i=e._addClickCallback.bind(e,t,r);Object.defineProperty(n,"_overlay_click_",{value:i}),n.addEventListener("click",i)})),this}},{key:"create",value:function(t){var e=this;if(Array.isArray(t)){var r=t.map((function(t){return e._createOneOverlay(t)}));this.addOverlay(r)}else{var n=this._createOneOverlay(t);this.addOverlay(n)}return this}},{key:"update",value:function(t,e){var r=e.element,n=e.position,i=e.point,o=function(t,e){if(null==t)return{};var r,n,i=function(t,e){if(null==t)return{};var r,n,i={},o=Object.keys(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||(i[r]=t[r]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}(e,NA);return r&&t.setContent(this._getOverlayElement(e)),(n||i)&&t.setLatLng(n||i),t.setProperties(o),this}}],r&&FA(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(AA);function UA(t){return UA="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},UA(t)}function qA(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,WA(n.key),n)}}function WA(t){var e=function(t,e){if("object"!=UA(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=UA(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==UA(e)?e:String(e)}function XA(t,e){return XA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},XA(t,e)}function ZA(t){return ZA=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ZA(t)}var HA=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&XA(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ZA(n);if(i){var r=ZA(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===UA(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,e))._layer.set("name",e.name||"fontLayer"),r._layer.setStyle((function(t){return r._stateService.getStyle(t,"default",{text:t.get("label")})})),r}return e=a,r=[{key:"create",value:function(t){var e=this;if(Array.isArray(t))t.forEach((function(t){var r=new Cesium.CustomEntity({position:Cesium.fromLonLat(t.point),label:{text:t.label}});r.set({item:t,label:t.label}),e.addFeature(r)}));else{var r=new Cesium.CustomEntity({position:Cesium.fromLonLat(t.point),label:{text:t.label}});r.set({item:t,label:t.label}),this.addFeature(r)}return this}},{key:"addSelect",value:function(t,e){return this.addHover(e,t),this}}],r&&qA(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(QM);function YA(t){return YA="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},YA(t)}function KA(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function JA(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,$A(n.key),n)}}function $A(t){var e=function(t,e){if("object"!=YA(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=YA(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==YA(e)?e:String(e)}function QA(t,e){return QA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},QA(t,e)}function tD(t){return tD=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tD(t)}var eD=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&QA(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=tD(n);if(i){var r=tD(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===YA(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,e))._layer.set("name",e.name||"lineString"),r._layer.setStyle((function(t){return r._stateService.getStyle(t,"default")})),r}return e=a,r=[{key:"_checkHeight",value:function(t){return(t||[]).map((function(t){return t.length>2?t:[].concat(function(t){if(Array.isArray(t))return KA(t)}(e=t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||function(t,e){if(t){if("string"==typeof t)return KA(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?KA(t,e):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[0]);var e}))}},{key:"create",value:function(t,e){var r=new Cesium.CustomEntity({polyline:{positions:Cesium.Cartesian3.fromDegreesArrayHeights(this._checkHeight(t.points||t.coords).flat())}});return r.set({item:t,label:t.label}),e&&r.setStyle(this._stateService.getStyle(r,"default",e)),this.addFeature(r),this}}],r&&JA(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(QM);function rD(t){return rD="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rD(t)}function nD(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,iD(n.key),n)}}function iD(t){var e=function(t,e){if("object"!=rD(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=rD(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==rD(e)?e:String(e)}function oD(){return oD="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=uD(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},oD.apply(this,arguments)}function aD(t,e){return aD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},aD(t,e)}function sD(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function uD(t){return uD=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},uD(t)}var lD=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&aD(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=uD(n);if(i){var r=uD(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===rD(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return sD(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,nt({strokeColor:"rgba(0, 0, 255, 0.8)",strokeWidth:0},e)))._key=void 0,r._useRight=!0,r.__zoomEvent=r._bindEvent.bind(sD(r)),r._timer=void 0,r._layer.set("name",e.name||"gridPolygon"),r._key=Symbol(e.name||"drawLine"),r._layer.setStyle((function(t){return r._returnStyle(t)})),r._stateService.addExcludeCacheEventName(["_clickStyle","_hoverStyle"]),r._map._cameraService.on(Cesium.ScreenSpaceEventType.WHEEL,r.__zoomEvent,r._key),r}return e=a,r=[{key:"_bindEvent",value:function(t,e){var r=this;this._timer&&(clearTimeout(this._timer),this._timer=null),this._timer=setTimeout((function(){var t=r._layer.getStyle(),e="function"==typeof t;r.features.forEach((function(r){r.setStyle(e?t(r):t)})),r._timer=null}),400)}},{key:"_createPolygonHierarchy",value:function(t){var e=Cesium.Cartesian3.fromDegreesArrayHeights(t.map((function(t){return t.length>2?t:t.concat(0)})).flat(1)),r=new Cesium.PolygonHierarchy(e),n=window.Cesium.PolygonPipeline;if(n){for(var i=n.triangulate(e),o=[],a=0;a<i.length;a+=3)o.push.apply(o,[e[i[a]],e[i[a+1]],e[i[a+2]]]);var s=new Cesium.PolygonHierarchy(o);return{hierarchy:s,center:Cesium.BoundingSphere.fromPoints(s.positions).center}}return{hierarchy:r,center:Cesium.BoundingSphere.fromPoints(e).center}}},{key:"create",value:function(t){if(Array.isArray(t)){var e=t.map((function(t){var e=new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArrayHeights(t.points.map((function(t){return t.length>2?t:t.concat(0)})).flat(1))),r=new Cesium.CustomEntity({position:Cesium.BoundingSphere.fromPoints(e.positions).center,polygon:{hierarchy:e}});return r.set({item:t,name:t.name,label:t.label}),r}));this.addFeature(e)}else{var r=new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArrayHeights(t.points.map((function(t){return t.length>2?t:t.concat(0)})).flat(1))),n=new Cesium.CustomEntity({position:Cesium.BoundingSphere.fromPoints(r.positions).center,polygon:{hierarchy:r}});n.set({item:t,name:t.name,label:t.label}),this.addFeature(n)}return this}},{key:"addRightClick",value:function(t,e){return this}},{key:"getCenterCoordinates",value:function(t){return A(t)}},{key:"addSelect",value:function(t,e){return this.addClick(t,e),this}},{key:"_returnStyle",value:function(t){return P(this._map.camera.positionCartographic.height)<(this._options.minZoomShow||0)?(this._stateService.currentDefaultEventName="_defaultFeatureStyle",this._stateService.getStyle(t,"_defaultFeatureStyle")):(this._stateService.currentDefaultEventName="default",this._stateService.getStyle(t,"default",{text:t.get("label")}))}},{key:"dispose",value:function(){oD(uD(a.prototype),"dispose",this).call(this),this._map._cameraService.off(this._key),this._timer&&(clearTimeout(this._timer),this._timer=null)}}],r&&nD(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(QM);function cD(t){return cD="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cD(t)}function fD(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,pD(n.key),n)}}function pD(t){var e=function(t,e){if("object"!=cD(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=cD(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==cD(e)?e:String(e)}function hD(){return hD="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=dD(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},hD.apply(this,arguments)}function yD(t,e){return yD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},yD(t,e)}function dD(t){return dD=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},dD(t)}var gD=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&yD(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=dD(n);if(i){var r=dD(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===cD(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,e))._animating=!1,r._speed=void 0,r._distance=300,r._index=0,r._Latlngs=[],r._linePositions=[],r._positionProperty=void 0,r._animatedMarker=void 0,r._polyline=void 0,r._realTimePolyline=void 0,r._date=[],r._speed=e.speed||.1,r._layer.set("name",e.name||"trajectory"),r._layer.setStyle((function(t){return r._stateService.getStyle(t,"default")})),r}return e=a,r=[{key:"_setDefaultStyle",value:function(){this._speed=this._options.speed||.1,this._polyline.setStyle({polyline:{material:Cesium.Color.fromCssColorString(this._options.strokeColor||"rgba(255,255,255,0.8)"),width:this._options.strokeWidth||5}});var t=this._options.lineDash||[5,5];this._realTimePolyline.setStyle({polyline:{width:this._options.strokeWidth||3,material:new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.fromCssColorString(this._options.fill||"rgba(0,0,0,0.9)"),dashLength:t[0]})}})}},{key:"_getAngle",value:function(t,e){var r=Math.atan2(e[1]-t[1],e[0]-t[0])*(180/Math.PI);return r>0?r=90-r:r<0&&(r=Math.abs(r)+90),r}},{key:"_getCoureAngle",value:function(t,e){var r=Math.atan2(e.y-t.y,e.x-t.x)*(180/Math.PI);return r<0&&(r+=360),Cesium.Math.toRadians(r)+Math.PI/180*90}},{key:"_reset",value:function(){this._dispose||(this._animating=!0,this._linePositions.length=0,this._positionProperty=new Cesium.SampledPositionProperty,this._realTimePolyline.position=this._positionProperty,this._realTimePolyline.orientation=new Cesium.VelocityOrientationProperty(this._positionProperty),this._setDefaultStyle(),requestAnimationFrame(this._animation.bind(this)))}},{key:"_animation",value:function(){if(this._animating){if(!this._Latlngs)return;for(var t=this,e=0,r=0;r<this._Latlngs.length-1;r++)e+=Cesium.Cartesian3.distance(this._Latlngs[r],this._Latlngs[r+1]);for(var n=100*this._speed,i=e/n,o=this._map.clock.currentTime,a=Cesium.JulianDate.addSeconds(o,n,new Cesium.JulianDate),s=0,u=1;u<this._Latlngs.length;u++){1===u&&(t._positionProperty.addSample(o,this._Latlngs[0]),this._date.push(o));var l=Cesium.Cartesian3.distance(this._Latlngs[u],this._Latlngs[u-1]),c=Cesium.JulianDate.addSeconds(o,l/i+s,new Cesium.JulianDate);t._positionProperty.addSample(c,this._Latlngs[u]),this._date.push(c),s+=l/i}this._map.clock.currentTime=o,this._map.clock.multiplier=1,this._map.clock.shouldAnimate=!0,this._map.clock.stopTime=a,this._map.clock.clockRange=Cesium.ClockRange.CLAMPED;var f=this._map.clock.onStop.addEventListener((function(){f&&f(),t._animating=!1}))}}},{key:"create",value:function(t){var e=this,r=(null==t?void 0:t.points)||(null==t?void 0:t.route)||[];if(0!==r.length){if(this._Latlngs=Cesium.Cartesian3.fromDegreesArray(r.flat()),this._polyline?this._polyline.polyline.positions.setValue(this._Latlngs):(this._polyline=new Cesium.CustomEntity({polyline:{clampToGround:!0,positions:this._Latlngs,zIndex:1}}),this.addFeature(this._polyline)),!this._realTimePolyline){var n=this,i=0;this._realTimePolyline=new Cesium.CustomEntity({polyline:{clampToGround:!0,positions:new Cesium.CallbackProperty((function(t,r){var o=n._positionProperty.getValue(t);return o&&(Cesium.JulianDate.compare(t,e._date[i])>0&&i<e._date.length-1&&(n._animatedMarker.billboard.rotation=n._getCoureAngle(n._positionProperty.getValue(e._date[i]),n._positionProperty.getValue(e._date[i+1])),i++),n._linePositions.push(o),n._linePositions.length>2&&n._animatedMarker.position.setValue(n._linePositions[n._linePositions.length-1])),n._linePositions}),!1),zIndex:2}}),this.addFeature(this._realTimePolyline)}return this._animatedMarker||(this._animatedMarker=new Cesium.CustomEntity({position:this._Latlngs[0],billboard:{rotation:this._getCoureAngle(this._Latlngs[0],this._Latlngs[1])}}),this.addFeature(this._animatedMarker)),this}}},{key:"start",value:function(){this._reset()}},{key:"stop",value:function(){this._map.clock.stopTime=Cesium.JulianDate.now()}},{key:"getCenterCoordinates",value:function(t){return N(t)}},{key:"dispose",value:function(){hD(dD(a.prototype),"dispose",this).call(this),this.stop(),this._animating=!1,this._Latlngs.length=0,this._linePositions.length=0}}],r&&fD(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(QM);function mD(t){return mD="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mD(t)}function vD(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,_D(n.key),n)}}function _D(t){var e=function(t,e){if("object"!=mD(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=mD(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==mD(e)?e:String(e)}function bD(){return bD="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=SD(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},bD.apply(this,arguments)}function wD(t,e){return wD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},wD(t,e)}function SD(t){return SD=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},SD(t)}var OD=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&wD(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=SD(n);if(i){var r=SD(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===mD(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,e))._key=void 0,r._defaultStyleOptions={radius:6,strokeColor:"rgba(255, 0, 255, 0.5)",strokeWidth:6,background:{strokeColor:"rgba(255, 255, 255, 1)",strokeWidth:2},fill:"rgba(255, 255, 255, 0.5)",interactive:!1},r._startMarker=new Cesium.CustomEntity({position:Cesium.Cartesian3.fromArray([0,0]),point:{pixelSize:5}}),r._latlngs=[],r._polyline=new Cesium.CustomEntity({polyline:{positions:[]},polygon:{hierarchy:[]}}),r._start=!1,r._completeCallback=void 0,r._polylinePoint=[],r._movePoint=void 0,nt(r._defaultStyleOptions,e),r._layer.set("name",e.name||"drawLine"),r._key=Symbol(e.name||"drawLine"),r._layer.setStyle((function(t){return r._stateService.getStyle(t,"default",r._defaultStyleOptions)})),r._initEvent(),r}return e=a,(r=[{key:"_initEvent",value:function(){this._map._cameraService.on(Cesium.ScreenSpaceEventType.MOUSE_MOVE,this._mapEvent.bind(this,"mousemove"),this._key,{uncontrolled:!0}),this._map._cameraService.on(Cesium.ScreenSpaceEventType.LEFT_CLICK,this._mapEvent.bind(this,"click"),this._key,{uncontrolled:!0}),this._map._cameraService.on(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK,this._mapEvent.bind(this,"dblclick"),this._key,{uncontrolled:!0}),this._map._cameraService.on(Cesium.ScreenSpaceEventType.RIGHT_CLICK,this._mapEvent.bind(this,"contextmenu"),this._key,{uncontrolled:!0})}},{key:"_createPolylinePoint",value:function(t){0===this._latlngs.length?this.fire("drawstart"):this.fire("drawchange",this._latlngs.map((function(t){return Cesium.toLonLat(t)})),Cesium.toLonLat(t)),this._latlngs.push(t);var e=new Cesium.CustomEntity({position:t,point:{pixelSize:this._defaultStyleOptions.radius}});this._polylinePoint.push(e),this.addFeature(e)}},{key:"_mapEvent",value:function(t,e,r){if("contextmenu"!==t){var n=r.position||r.endPosition;if("mousemove"===t)this._movePoint=r.endPosition,this._startMarker.position=T(this._map,n);else{if(!this._start)return;this._createPolylinePoint(T(this._map,n)),"dblclick"===t&&(this._start=!1,this.fire("drawend"),this._completeCallback&&(this._completeCallback(this.getValue()),this._reset()))}}else this.rmLastPoint()}},{key:"_reset",value:function(){var t=this;if(this.removeFeature(this._polylinePoint),this._startMarker.point.pixelSize=new Cesium.ConstantProperty(this._defaultStyleOptions.radius),this._latlngs.length=0,this._polyline.polyline.positions=new Cesium.CallbackProperty((function(e){return t._start&&t._latlngs.length>0&&t._movePoint?t._latlngs.map((function(t){return t.clone()})).concat(T(t._map,t._movePoint)):t._latlngs.map((function(t){return t.clone()}))}),!1),"Polygon"===this._options.type){var e=new Cesium.PolygonHierarchy([],[]);this._polyline.polygon.hierarchy=new Cesium.CallbackProperty((function(r){if(t._start&&t._latlngs.length>0&&t._movePoint){var n=T(t._map,t._movePoint);n&&(e.positions=t._latlngs.map((function(t){return t.clone()})).concat(n))}else e.positions=t._latlngs.map((function(t){return t.clone()}));return e}),!1)}this._start=!0}},{key:"draw",value:function(t){return this.map.canvas.style.cursor="crosshair",this._map._appHandler.setOptions({disabled:!0}),this._completeCallback=t,this.addFeature(this._startMarker),this.addFeature(this._polyline),this._reset(),this}},{key:"getValue",value:function(){return Cesium.toLonLat(this._latlngs)}},{key:"rmLastPoint",value:function(){return this._polylinePoint.length>0&&(this.removeFeature(this._polylinePoint.pop()),this._latlngs.pop()),this}},{key:"dispose",value:function(){bD(SD(a.prototype),"dispose",this).call(this),this.map.canvas.style.cursor="",this._map._appHandler.setOptions({disabled:!1}),this._map._cameraService.off(this._key),this._reset(),this._start=!1}}])&&vD(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(QM);function xD(t){return xD="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xD(t)}function CD(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ED(n.key),n)}}function ED(t){var e=function(t,e){if("object"!=xD(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=xD(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==xD(e)?e:String(e)}function PD(){return PD="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=TD(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},PD.apply(this,arguments)}function kD(t,e){return kD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},kD(t,e)}function TD(t){return TD=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},TD(t)}var jD=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&kD(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=TD(n);if(i){var r=TD(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===xD(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,e))._heatmap=void 0,r._layer.set("name",e.name||"heatMap"),r}return e=a,r=[{key:"_getBounds",value:function(t,e){t.east=Math.max(t.east,e[0]),t.west=Math.min(t.west,e[0]),t.north=Math.max(t.north,e[1]),t.south=Math.min(t.south,e[1])}},{key:"_initHeatmap",value:function(t){this._heatmap=Cesium.Heatmap(this._map,t,{blur:(100-(this.options.blur||20))/100,radius:this.options.radius||25,minOpacity:.1,gradient:{0:"rgba(0, 0, 255, 0)",.3:"cyan",.4:"lime",.7:"#ffff00",.8:"orange",1:"#ff0000"}}),this._heatmap||rt("使用热力图必须引用插件[CesiumHeatmap.js]！")}},{key:"create",value:function(t){var e=this;this._heatmap&&(this._heatmap.deleteLayer(),this._heatmap=null);var r={west:106.243911,east:106.270811,south:29.244545,north:29.289995};if(Array.isArray(t)){var n=t.map((function(t){return e._getBounds(r,t.point),{x:t.point[0],y:t.point[1],value:t.weight||1}}));this._initHeatmap(r),this._heatmap&&this._heatmap.setWGS84Data(0,1,n)}else this._getBounds(r,t.point),this._initHeatmap(r),this._heatmap&&this._heatmap.setWGS84Data(0,1,[{x:t.point[0],y:t.point[1],value:t.weight||1}]);return this}},{key:"dispose",value:function(){PD(TD(a.prototype),"dispose",this).call(this),this._heatmap&&this._heatmap.deleteLayer()}}],r&&CD(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(QM);function RD(t){return RD="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},RD(t)}function LD(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ID(n.key),n)}}function ID(t){var e=function(t,e){if("object"!=RD(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=RD(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==RD(e)?e:String(e)}function MD(t,e){return MD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},MD(t,e)}function AD(t){return AD=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},AD(t)}var DD=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&MD(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=AD(n);if(i){var r=AD(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===RD(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,e))._layer.set("name",e.name||"loadGeojson"),r._layer.setStyle((function(t){return r._stateService.getStyle(t,"default",{text:t.get("name")})})),r}return e=a,r=[{key:"loadUrl",value:function(t){var e=this;return fetch(t).then((function(t){return t.json()})).then((function(t){return e.load(t),!0})).catch((function(){return!1}))}},{key:"load",value:function(t){var e=this;return Cesium.GeoJsonDataSource.load(t,{clampToGround:!0}).then((function(t){e.addFeature(t.entities.values.map((function(t){return t})))})).catch((function(t){rt("加载geojson异常 ","error",t)})),this}}],r&&LD(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(QM);function ND(t){return ND="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ND(t)}function FD(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,zD(n.key),n)}}function zD(t){var e=function(t,e){if("object"!=ND(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=ND(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ND(e)?e:String(e)}function GD(){return GD="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=VD(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},GD.apply(this,arguments)}function BD(t,e){return BD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},BD(t,e)}function VD(t){return VD=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},VD(t)}var UD=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&BD(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=VD(n);if(i){var r=VD(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===ND(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this))._name=void 0,r._map=void 0,r._imageLayers=new Map,r._options=void 0,r._map=t,r._options=e,r._name=(null==e?void 0:e.name)||"obliquePhotography",r}return e=a,r=[{key:"name",get:function(){return this._name}},{key:"options",get:function(){return this._options}},{key:"_setLayerStyle",value:function(t,e,r){var n,i;t.show=!1!==r.visible;var o=e.backColor||(null==r?void 0:r.backColor)||(null===(n=this._options)||void 0===n?void 0:n.backColor);t.transparentBackColor=o?Cesium.Color.fromCssColorString(o):Cesium.ImageryLayer.DEFAULT_TRANSPERANTBACKCOLOR||Cesium.ImageryLayer.DEFAULT_TRANSPARENTBACKCOLOR,t.transparentBackColorTolerance=e.tolerance||(null==r?void 0:r.tolerance)||(null===(i=this._options)||void 0===i?void 0:i.tolerance)||Cesium.ImageryLayer.DEFAULT_TRANSPERANTBACKCOLORTOLERANCE||Cesium.ImageryLayer.DEFAULT_TRANSPARENTBACKCOLORTOLERANCE}},{key:"load",value:function(t,e){var r=this,n=e.name||"defaultImageryLayer";return this._imageLayers.has(n)?(this._map.zoomTo(this._imageLayers.get(n)[0]),this):(this._imageLayers.set(n,t.map((function(t){var n=t.url.startsWith("http")?t.url:t.baseUrl+t.url;if(/http(s)?\:\/\/([^\/]+)/.test(n)){var i=RegExp.$1?[RegExp.$2]:[],o=r._map.imageryLayers.addImageryProvider(new Cesium.SuperMapImageryProvider({name:t.layerName,url:n,subdomains:i}));return t.layerName&&(o.set("layerName",t.layerName),o.set("item",t)),r._setLayerStyle(o,t,e),o}})).filter((function(t){return!!t}))),this)}},{key:"setVisible",value:function(t,e){return this._imageLayers.has(t)&&this._imageLayers.get(t).forEach((function(t){t.show})),this}},{key:"remove",value:function(t){var e=this;return t?this._imageLayers.has(t)&&(this._imageLayers.forEach((function(t){t.forEach((function(t){return e._map.imageryLayers.remove(t,!0)}))})),this._imageLayers.delete(t)):this._map.imageryLayers.removeAll(!0),this}},{key:"dispose",value:function(){GD(VD(a.prototype),"dispose",this).call(this),this.remove(),this._imageLayers.clear()}}],r&&FD(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t),qD=function(t){return t.QX="ObliquePhotogrammetry",t.BIM="s3m",t.PILE="pile",t}({}),WD=function(t){return t.gltf="gltf",t.point="point",t.tiles3d="3dtiles",t}({});function XD(t){return XD="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},XD(t)}function ZD(){ZD=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var o=e&&e.prototype instanceof m?e:m,a=Object.create(o.prototype),s=new j(n||[]);return i(a,"_invoke",{value:E(t,r,s)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var p="suspendedStart",h="suspendedYield",y="executing",d="completed",g={};function m(){}function v(){}function _(){}var b={};l(b,a,(function(){return this}));var w=Object.getPrototypeOf,S=w&&w(w(R([])));S&&S!==r&&n.call(S,a)&&(b=S);var O=_.prototype=m.prototype=Object.create(b);function x(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function C(t,e){function r(i,o,a,s){var u=f(t[i],t,o);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==XD(c)&&n.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(c).then((function(t){l.value=t,a(l)}),(function(t){return r("throw",t,a,s)}))}s(u.arg)}var o;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return o=o?o.then(i,i):i()}})}function E(e,r,n){var i=p;return function(o,a){if(i===y)throw new Error("Generator is already running");if(i===d){if("throw"===o)throw a;return{value:t,done:!0}}for(n.method=o,n.arg=a;;){var s=n.delegate;if(s){var u=P(s,n);if(u){if(u===g)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===p)throw i=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=y;var l=f(e,r,n);if("normal"===l.type){if(i=n.done?d:h,l.arg===g)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=d,n.method="throw",n.arg=l.arg)}}}function P(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var o=f(i,e.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,g;var a=o.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function k(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function j(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(k,this),this.reset(!0)}function R(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return o.next=o}}throw new TypeError(XD(e)+" is not iterable")}return v.prototype=_,i(O,"constructor",{value:_,configurable:!0}),i(_,"constructor",{value:v,configurable:!0}),v.displayName=l(_,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,_):(t.__proto__=_,l(t,u,"GeneratorFunction")),t.prototype=Object.create(O),t},e.awrap=function(t){return{__await:t}},x(C.prototype),l(C.prototype,s,(function(){return this})),e.AsyncIterator=C,e.async=function(t,r,n,i,o){void 0===o&&(o=Promise);var a=new C(c(t,r,n,i),o);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},x(O),l(O,u,"Generator"),l(O,a,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=R,j.prototype={constructor:j,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return s.type="throw",s.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),l=n.call(a,"finallyLoc");if(u&&l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),T(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;T(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:R(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}function HD(t,e,r,n,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,i)}function YD(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var o=t.apply(e,r);function a(t){HD(o,n,i,a,s,"next",t)}function s(t){HD(o,n,i,a,s,"throw",t)}a(void 0)}))}}function KD(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,JD(n.key),n)}}function JD(t){var e=function(t,e){if("object"!=XD(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=XD(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==XD(e)?e:String(e)}function $D(){return $D="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=tN(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},$D.apply(this,arguments)}function QD(t,e){return QD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},QD(t,e)}function tN(t){return tN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tN(t)}var eN=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&QD(t,e)}(s,t);var e,r,n,i,o,a=(i=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=tN(i);if(o){var r=tN(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===XD(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(r=a.call(this))._key=void 0,r._name=void 0,r._options=void 0,r._map=void 0,r._models=new Map,r._events=[],r._state={s3mOpacity:new Map,s3mFilterOpacity:.1,selected:null,selectedOpacity:.5},r._options=e,r._name=(null==e?void 0:e.name)||"s3MTiles",r._key=Symbol(r._name),r._map=t,r._initEvent(),r}return e=s,r=[{key:"name",get:function(){return this._name}},{key:"options",get:function(){return this._options}},{key:"layers",get:function(){return this._map.scene.layers}},{key:"clicks",get:function(){return this._events.filter((function(t){return"click"===t.type}))}},{key:"hovers",get:function(){return this._events.filter((function(t){return"hover"===t.type}))}},{key:"selected",get:function(){return this._state.selected}},{key:"_initEvent",value:function(){var t=this;this._map._cameraService.on(Cesium.ScreenSpaceEventType.LEFT_CLICK,(function(e,r){t._setSelected(null==e?void 0:e.primitive,null==e?void 0:e.id)}),this._key)}},{key:"_setSelected",value:function(t,e,r){var n,i=this;if(!t||t instanceof Cesium.Cesium3DTile||(t=null),!1!==(null===(n=this._options)||void 0===n?void 0:n.clickFlyTo)&&t&&t.getAttributesById(e).then((function(t,e,r){i._map.camera.flyTo({destination:Cesium.Rectangle.fromDegrees(t.SmSdriW,t.SmSdriS,t.SmSdriE,t.SmSdriN),duration:0})})),this._state.selected!==t){if(this._state.selected){var o=this._state.selected.get("_bimsdk_s3m_selected_alpha_",!0);o&&(this._state.selected.style3D.fillForeColor.alpha=o,this._state.selected.unset("_bimsdk_s3m_selected_alpha_",!0))}t&&(t.set("_bimsdk_s3m_selected_alpha_",t.style3D.fillForeColor.alpha,!0),t.style3D.fillForeColor.alpha=this._state.selectedOpacity),this._state.selected=t,!1!==r&&this.clicks.forEach((function(r){var n;r.event(null===(n=t)||void 0===n||null===(n=n.options)||void 0===n?void 0:n.item,t,e)}))}}},{key:"_setTileLayer",value:function(t,e,r){if(e.dataType&&(t._dataType="osgb"===e.dataType?qD.QX:e.dataType),t.selectEnabled=!0===(null==r?void 0:r.selectEnabled),t.visible=!1!==(null==r?void 0:r.visible),t.residentRootTile=!0,t.indexedDBSetting.isGeoTilesSave=!0,t.indexedDBSetting.isAttributesSave=!0,t.indexedDBSetting.isGeoTilesRootNodeSave=!0,t._dataType===qD.QX)t._clipping=!0,t.LoadingPriority=Cesium.LoadingPriorityMode.Child_Priority_NonLinear,t.visibleDistanceMax=2e4,t.maxVisibleAltitude=2e4;else if(t._dataType===qD.BIM){t.RGBTOBGR="YK-QL-XKTDQ"!==t.name&&!e.url.includes("yknew2304"),t._clipping=!0,t.selectColorType=1,t.brightness=(null==r?void 0:r.brightness)||3;var n=Cesium.Color.fromCssColorString((null==r?void 0:r.selectedColor)||"rgba(0,0,255, 1)");t.selectedColor=n,t.selectedLineColor=null!=r&&r.selectedLineColor?Cesium.Color.fromCssColorString(null==r?void 0:r.selectedLineColor):n,t.visibleDistanceMax=2e4,t.maxVisibleAltitude=2e4,e.dataUrl&&(e.isMerge?t.setQueryParameter({url:!e.dataUrl||e.dataUrl.includes("http")?e.dataUrl||"":e.baseUrl.split(";")[0]+e.dataUrl,dataSourceName:e.sourceName,isMerge:e.isMerge}):t.setQueryParameter({url:!e.dataUrl||e.dataUrl.includes("http")?e.dataUrl||"":e.baseUrl.split(";")[0]+e.dataUrl,dataSourceName:e.sourceName,dataSetName:e.setName,keyWord:"SmID"})),function(t,e){t.style3D.fillStyle=Cesium.FillStyle.Fill_And_WireFrame,t.wireFrameMode=Cesium.WireFrameType.Sketch,t.style3D.lineWidth=.5,t.style3D.lineColor=Cesium.Color.LIGHTGREY.withAlpha(.4)}(t),t.selectionFiltrateByTransparency=this._state.s3mFilterOpacity}e.url.includes("SanQuSanXian")&&(t.style3D.fillForeColor.alpha=.25)}},{key:"_zoomToPosition",value:function(t){var e=k(this._map,t);this._map.camera.flyToBoundingSphere(Cesium.BoundingSphere.fromBoundingSpheres([new Cesium.BoundingSphere(Cesium.Cartesian3.fromDegrees(e[0],e[1],this._map.getMinHeight()+10),10)]),{duration:0})}},{key:"load",value:(n=YD(ZD().mark((function t(e,r){var n,i,o,a=this;return ZD().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this,i=r.name||"defaultModel",!this._models.has(i)){t.next=6;break}return(o=this._models.get(i))&&o.length>0&&n._map.zoomTo(o[0],new Cesium.HeadingPitchRange(0,Cesium.Math.toRadians(-90),0)),t.abrupt("return");case 6:return n._models.set(i,[]),t.abrupt("return",new Promise(function(){var t=YD(ZD().mark((function t(o,s){var u,l;return ZD().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return u=[],e.forEach((function(t){var e=a._map.scene.addS3MTilesLayerByScp("".concat(t.url.startsWith("http")?t.url:(t.baseUrl||"")+t.url),{name:t.layerName,cullEnabled:!1});u.push(e),Cesium.when(e,(function(e){Reflect.has(e,"options")||(e.options={}),e.options.item=t,n._setTileLayer(e,t,r)}))})),t.next=4,Promise.all(u);case 4:l=t.sent,n._models.set(i,l),!0===(null==r?void 0:r.zoomTo)&&(n._map.camera.cancelFlight(),n._map.zoomTo(l[0],new Cesium.HeadingPitchRange(0,Cesium.Math.toRadians(-90),0))),o(l);case 8:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()));case 8:case"end":return t.stop()}}),t,this)}))),function(t,e){return n.apply(this,arguments)})},{key:"on",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"click";return this._events.push({type:e,event:t}),this}},{key:"off",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"click",r=this._events.findIndex((function(r){return r.type===e&&r.event===t}));return r>=0&&this._events.splice(r,1),this}},{key:"find",value:function(t,e){var r=e||"defaultModel";if(this._models.has(r)){var n=this._models.get(r);if(n&&n.length>0)return this.layers.find(t)||n.find((function(e){return e.name===t||e.options.item.id===t}))}return null}},{key:"filter",value:function(t,e){var r=e||"defaultModel";if(this._models.has(r)){var n=this._models.get(r);if(n&&n.length>0)return n.filter((function(e){return t(e.options.item,e)}))}return null}},{key:"setSelected",value:function(t,e){if(t){var r=this.find(t,e);r&&(this.layers.setSelectedLayer(r),this._setSelected(r))}else this.layers.releaseSelection(),this.layers.setSelectedLayer(null),this._setSelected(null);return this}},{key:"setLayerStyle",value:function(t){var e=this;if(Array.isArray(t))t.forEach((function(t){return e.setLayerStyle(t)}));else{var r=this.layers.find(t.name);r&&r.setObjsColor(t.smIds,t.color)}return this}},{key:"setSelection",value:function(t,e){var r="string"==typeof t?this.find(t):t;return r&&(e?(r.setSelection(e),this._setSelected(r,void 0,!1)):r.releaseSelection()),this}},{key:"setOpacity",value:function(t,e){var r=this,n=e&&e<=0&&e<=1?e:-1;return-1!==n&&(this._state.s3mFilterOpacity=n),t.forEach((function(t){var e=r.layers.find(t.name);e&&(e.style3D.fillForeColor.alpha=t.opacity,r._state.s3mOpacity.set(e,t.opacity),-1!==n&&(e.selectionFiltrateByTransparency=n))})),this}},{key:"setVisibleByName",value:function(t,e){return this._models.has(t)&&this._models.get(t).forEach((function(t){t.visible=e})),this}},{key:"setVisible",value:function(t,e,r){if(t&&0!==t.length)return this.layers.layerQueue.forEach((function(n){t.includes(n.name)?n.visible=e:!0===r&&(n.visible=!e)})),this}},{key:"setS3mStyle",value:function(t,e,r){var n="string"==typeof t?this.find(t):t;if(n&&e)if(r)n.has("_bimsdk_oldStyle_",!0)||n.set("_bimsdk_oldStyle_",e.map((function(t){return e={},r=t,i=n.getObjsColor(t),(r=JD(r))in e?Object.defineProperty(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e;var e,r,i})),!0),n.setObjsColor(e,Cesium.Color.fromCssColorString(r));else if(n.has("_bimsdk_oldStyle_",!0)){var i=n.get("_bimsdk_oldStyle_",!0);i?Object.keys(i).forEach((function(t){n.setObjsColor([t],i[t])})):n.setObjsColor(e,void 0),n.unset("_bimsdk_oldStyle_",!0)}return this}},{key:"setS3mVisible",value:function(t,e,r,n){var i="string"==typeof t?this.find(t):t;return i&&(!0===n?i.updateObjsVisible(e,r):i.setOnlyObjsVisible(e,r)),this}},{key:"layerToTop",value:function(t){var e="string"==typeof t?this.find(t):t;return e&&this.layers.raiseToTop(e),this}},{key:"layerToBottom",value:function(t){var e="string"==typeof t?this.find(t):t;return e&&this.layers.lowerToBottom(e),this}},{key:"zoomTo",value:function(t){return this._map.camera.cancelFlight(),this._map.zoomTo(t,new Cesium.HeadingPitchRange(0,Cesium.Math.toRadians(-90),0)),this}},{key:"remove",value:function(t){var e=this;return t?this._models.has(t)&&(this._models.get(t).forEach((function(t){e.layers.remove(t.name)})),this._models.delete(t)):(this.layers.removeAll(),this._models.clear()),this}},{key:"dispose",value:function(){$D(tN(s.prototype),"dispose",this).call(this),this._map._cameraService.off(this._key),this._events.length=0,this.remove()}}],r&&KD(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),s}(_t);function rN(t){return rN="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rN(t)}function nN(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function iN(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?nN(Object(r),!0).forEach((function(e){var n,i,o;n=t,i=e,o=r[e],(i=aN(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):nN(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function oN(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,aN(n.key),n)}}function aN(t){var e=function(t,e){if("object"!=rN(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=rN(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==rN(e)?e:String(e)}function sN(){return sN="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=lN(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},sN.apply(this,arguments)}function uN(t,e){return uN=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},uN(t,e)}function lN(t){return lN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},lN(t)}var cN=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&uN(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=lN(n);if(i){var r=lN(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===rN(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this))._name=void 0,r._options=void 0,r._map=void 0,r._terrainsUrl=void 0,r._map=t,r._options=e,r._name=(null==e?void 0:e.name)||"terrain",r}return e=a,(r=[{key:"name",get:function(){return this._name}},{key:"options",get:function(){return this._options}},{key:"_createDefaultTerrain",value:function(){return new Cesium.EllipsoidTerrainProvider({ellipsoid:Cesium.Ellipsoid.WGS84})}},{key:"load",value:function(t,e){if(!t)return this._terrainsUrl=null,void(this._map.terrainProvider=this._createDefaultTerrain());var r=Array.isArray(t)?t.length>1?t:t[0]:t;if(this._terrainsUrl=r,Array.isArray(r))this._map.terrainProvider=new Cesium.SCTTerrainProvider(iN({urls:r.map((function(t){return t+(t.endsWith("/")?"":"/")})),isSct:!0,subdomains:[]},e));else if(t.includes("tianditu")){Cesium.GeoTerrainProvider;for(var n=["0","1","2","3","4","5","6","7"],i=new Array,o=0;o<n.length;o++)i.push("https://t{s}.tianditu.gov.cn/".replace("{s}",n[o])+"DataServer?T=elv_c&tk=99bc0b8df065eb27b289330adfe75fd8");this._map.terrainProvider=new Cesium.GeoTerrainProvider({urls:i})}else if(/http(s)?\:\/\/([^\/]+)/.test(r)){var a=RegExp.$1?[RegExp.$2]:[];this._map.terrainProvider=new Cesium.CesiumTerrainProvider(iN({url:r+(r.endsWith("/")?"":"/"),invisibility:!0,isSct:!0,subdomains:a},e))}return this}},{key:"setVisible",value:function(t){var e,r;return t?this._terrainsUrl&&null!==(e=this._map.terrainProvider)&&void 0!==e&&null!==(e=e._baseUrl)&&void 0!==e&&e.includes(this._terrainsUrl)?this._map.terrainProvider.visible=!0:this._map.terrainProvider||(this._map.terrainProvider=this._createDefaultTerrain()):this._terrainsUrl&&null!==(r=this._map)&&void 0!==r&&null!==(r=r.terrainProvider)&&void 0!==r&&null!==(r=r._baseUrl)&&void 0!==r&&r.includes(this._terrainsUrl)?this._map.terrainProvider.visible=!1:this._map.terrainLayers.removeAll(),this}},{key:"remove",value:function(){return this._map.terrainLayers.removeAll(),this}},{key:"dispose",value:function(){sN(lN(a.prototype),"dispose",this).call(this),this.remove()}}])&&oN(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t);function fN(t){return fN="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fN(t)}var pN=["name","data","scale"],hN=["name","data","scale"],yN=["point","scale","minimumPixelSize"],dN=["name","data"],gN=["name","data"],mN=["name","data"];function vN(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function _N(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?vN(Object(r),!0).forEach((function(e){var n,i,o;n=t,i=e,o=r[e],(i=SN(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):vN(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function bN(t,e){if(null==t)return{};var r,n,i=function(t,e){if(null==t)return{};var r,n,i={},o=Object.keys(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||(i[r]=t[r]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function wN(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,SN(n.key),n)}}function SN(t){var e=function(t,e){if("object"!=fN(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=fN(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==fN(e)?e:String(e)}function ON(){return ON="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=CN(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},ON.apply(this,arguments)}function xN(t,e){return xN=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},xN(t,e)}function CN(t){return CN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},CN(t)}var EN=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&xN(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=CN(n);if(i){var r=CN(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===fN(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this))._key=void 0,r._name=void 0,r._options=void 0,r._map=void 0,r._gltfPrimitives=new Cesium.PrimitiveCollection,r._pointPrimitives=new Cesium.PointPrimitiveCollection,r._3dTilesPrimitives=new Cesium.PrimitiveCollection,r._events=[],r._state={selected:null,hoverSelected:null},r._map=t,r._options=e,r._name=(null==e?void 0:e.name)||"primitive",r._key=Symbol(r._name),r._map.scene.primitives.add(r._gltfPrimitives),r._map.scene.primitives.add(r._pointPrimitives),r._map.scene.primitives.add(r._3dTilesPrimitives),r._initEvent(),r}return e=a,r=[{key:"name",get:function(){return this._name}},{key:"options",get:function(){return this._options}},{key:"clicks",get:function(){var t=this;return function(e){return t._events.filter((function(t){return"click"===t.type&&t.pType===e}))}}},{key:"hovers",get:function(){var t=this;return function(e){return t._events.filter((function(t){return"hover"===t.type&&t.pType===e}))}}},{key:"_containTo",value:function(t){return this._gltfPrimitives.contains(t)||this._pointPrimitives.contains(t)||this._3dTilesPrimitives.contains(t)}},{key:"_convertStyleColor",value:function(t){if(/^rgba\((.*)\.(.*)\.(.*)\.(.*)\)$/.test(t)){var e=Number(RegExp.$1),r=Number(RegExp.$2),n=Number(RegExp.$3),i=Number(RegExp.$4);return"vec4(".concat(e/255,",").concat(r/255,",").concat(n/255,",").concat(i,")")}return"color('".concat(t,"')")}},{key:"_zoomToPosition",value:function(t){var e;e=t instanceof Cesium.PointPrimitive?j(this._map,t.position):t instanceof Cesium.Cesium3DTileset?j(this._map,t.boundingSphere.center):j(this._map,Cesium.Matrix4.multiplyByPoint(t.modelMatrix,t.boundingSphere.center,new Cesium.Cartesian3)),this._map.camera.flyTo({destination:e,orientation:{heading:Cesium.Math.toRadians(0),pitch:Cesium.Math.toRadians(-90),roll:0},duration:1})}},{key:"_setSelected",value:function(t,e,r){var n;t&&!this._containTo(t)&&(t=null);var i=!1!==(null===(n=this._options)||void 0===n?void 0:n.clickFlyTo),o=this._state.selected;if(o!==t&&(o||t)){this._state.selected=t;var a=(t||o).get("__primitive_type",!0);!1!==r&&(t&&o&&t.get("__primitive_type",!0)!==o.get("__primitive_type",!0)&&this.clicks(o.get("__primitive_type",!0)).forEach((function(t){t.event(null,null,null,o)})),this.clicks(a).forEach((function(r){var n;r.event(null===(n=t)||void 0===n?void 0:n.get("data"),t,e,o)})))}i&&t&&this._zoomToPosition(t)}},{key:"_setHoverSelected",value:function(t,e,r){t&&!this._containTo(t)&&(t=null);var n=this._state.hoverSelected;if(n!==t&&(n||t)){this._state.hoverSelected=t;var i=(t||n).get("__primitive_type",!0);!1!==r&&(t&&n&&t.get("__primitive_type",!0)!==n.get("__primitive_type",!0)&&this.hovers(n.get("__primitive_type",!0)).forEach((function(t){t.event(null,null,null,n)})),this.hovers(i).forEach((function(r){var i;r.event(null===(i=t)||void 0===i?void 0:i.get("data"),t,e,n)})))}}},{key:"_initEvent",value:function(){var t,e,r=this;!0===(null===(t=this._options)||void 0===t?void 0:t.listenClickEvent)&&this._map._cameraService.on(Cesium.ScreenSpaceEventType.LEFT_CLICK,(function(t){r._setSelected(null==t?void 0:t.primitive,null==t?void 0:t.id)}),this._key),!0===(null===(e=this._options)||void 0===e?void 0:e.listenHoverEvent)&&this._map._cameraService.on(Cesium.ScreenSpaceEventType.MOUSE_MOVE,(function(t){r._setHoverSelected(null==t?void 0:t.primitive,null==t?void 0:t.id)}),this._key)}},{key:"loadGltf",value:function(t,e){var r=this;return new Promise((function(n,i){if(Array.isArray(t)){var o=t.map((function(t){var e=t.name,n=t.data,i=t.scale,o=void 0===i?1:i,a=bN(t,pN),s=Cesium.Matrix4.fromTranslation(Cesium.fromLonLat(a.point));Cesium.Matrix4.setScale(s,new Cesium.Cartesian3(o,o,o),s);var u=r._gltfPrimitives.add(Cesium.Model.fromGltf(_N(_N({},a),{},{name:"ceshi",modelMatrix:s,minimumPixelSize:a.minimumPixelSize||60,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND})));return u.set("name",e||"model"),u.set("data",n),u.set("__primitive_type",WD.gltf,!0),u}));!0===(null==e?void 0:e.flyTo)&&(r._map.camera.cancelFlight(),r._map.camera.setView({destination:j(r._map,Cesium.BoundingSphere.fromPoints(t.map((function(t){return Cesium.fromLonLat(t.point)}))).center)})),n(o)}else{var a=t.name,s=t.data,u=t.scale,l=void 0===u?1:u,c=bN(t,hN),f=Cesium.Matrix4.fromTranslation(Cesium.fromLonLat(c.point));Cesium.Matrix4.setScale(f,new Cesium.Cartesian3(l,l,l),f);var p=r._gltfPrimitives.add(Cesium.Model.fromGltf(_N(_N({},c),{},{modelMatrix:f,minimumPixelSize:c.minimumPixelSize||60,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND})));p.set("name",a||"model"),p.set("data",s),p.set("__primitive_type",WD.gltf,!0),!0===(null==e?void 0:e.flyTo)&&(r._map.camera.cancelFlight(),r._map.camera.setView({destination:Cesium.fromLonLat(c.point,r._map.getHeight())})),n(p)}}))}},{key:"setGltfVisible",value:function(t,e,r){if("function"==typeof t)for(var n=0;n<this._gltfPrimitives.length;n++){var i=this._gltfPrimitives.get(n);!0===r?i.show=t(i.get("name"),i.get("data"),i):!0===t(i.get("name"),i.get("data"),i)&&(i.show=e)}else if(0===t.length)this._gltfPrimitives.show=e;else for(var o=0;o<this._gltfPrimitives.length;o++){var a=this._gltfPrimitives.get(o);t.includes(a.get("name"))?a.show=e:!0===r&&(a.show=!e)}return this}},{key:"removeGltf",value:function(t){if(t&&0!==t.length)for(var e=0;e<this._gltfPrimitives.length;e++){var r=this._gltfPrimitives.get(e);t.includes(r.get("name"))&&this._gltfPrimitives.remove(r)&&e--}else this._gltfPrimitives.removeAll();return this}},{key:"updateGltfOptions",value:function(t,e){if(e){var r=e.point,n=e.scale,i=e.minimumPixelSize,o=bN(e,yN),a="string"==typeof t?this.find(t,"gltf"):t;a&&(a.modelMatrix&&(r&&Cesium.Matrix4.setTranslation(a.modelMatrix,Cesium.fromLonLat(r),a.modelMatrix),n&&Cesium.Matrix4.setScale(a.modelMatrix,new Cesium.Cartesian3(n,n,n),a.modelMatrix)),i&&(a.minimumPixelSize=i),o&&Object.keys(o).forEach((function(t){Reflect.has(a,t)&&Reflect.set(a,t,o[t])})))}return this}},{key:"loadPoint",value:function(t,e){var r=this;if(Array.isArray(t))t.forEach((function(t){var e=t.name,n=t.data,i=bN(t,dN),o=r._pointPrimitives.add(_N(_N({},i),{},{position:Cesium.fromLonLat(i.point),color:Cesium.Color.fromCssColorString(i.color||"rgba(0,0,255, 0.9)"),pixelSize:i.pixelSize||10,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND}));o.set("name",e||"point"),o.set("data",n),o.set("__primitive_type",WD.point,!0)})),!0===(null==e?void 0:e.flyTo)&&(this._map.camera.cancelFlight(),this._map.camera.setView({destination:j(this._map,Cesium.BoundingSphere.fromPoints(t.map((function(t){return Cesium.fromLonLat(t.point)}))).center)}));else{var n=t.name,i=t.data,o=bN(t,gN),a=this._pointPrimitives.add(_N(_N({},o),{},{position:Cesium.fromLonLat(o.point),color:Cesium.Color.fromCssColorString(o.color||"rgba(0,0,255, 0.9)"),pixelSize:o.pixelSize||10,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND}));a.set("name",n||"point"),a.set("data",i),a.set("__primitive_type",WD.point,!0),!0===(null==e?void 0:e.flyTo)&&(this._map.camera.cancelFlight(),this._map.camera.setView({destination:Cesium.fromLonLat(o.point,this._map.getHeight())}))}return this}},{key:"setPointVisible",value:function(t,e,r){if("function"==typeof t)for(var n=0;n<this._pointPrimitives.length;n++){var i=this._pointPrimitives.get(n);!0===r?i.show=t(i.get("name"),i.get("data"),i):!0===t(i.get("name"),i.get("data"),i)&&(i.show=e)}else if(0===t.length)this._pointPrimitives.show=e;else for(var o=0;o<this._pointPrimitives.length;o++){var a=this._pointPrimitives.get(o);t.includes(a.get("name"))?a.show=e:!0===r&&(a.show=!e)}return this}},{key:"removePoint",value:function(t){if(t&&0!==t.length)for(var e=0;e<this._pointPrimitives.length;e++){var r=this._pointPrimitives.get(e);t.includes(r.get("name"))&&this._pointPrimitives.remove(r)&&e--}else this._pointPrimitives.removeAll();return this}},{key:"updatePointOptions",value:function(t,e){var r="string"==typeof t?this.find(t,"point"):t;return r&&(e.color&&(r.color=Cesium.Color.fromCssColorString(e.color)),e.pixelSize&&(r.pixelSize=e.pixelSize)),this}},{key:"load3Dtiles",value:function(t,e){var r=this;return new Promise((function(n,i){if(Array.isArray(t)){var o=t.map((function(t){var e=r._map.scene.primitives.add(new Cesium.Cesium3DTileset({url:t.url}));return e.colorBlendMode=Cesium.Cesium3DTileColorBlendMode.REPLACE,e.readyPromise}));Promise.all(o).then((function(i){if(i.forEach((function(e,n){e.set("name",t[n].name||"3dtiles"),e.set("data",t[n].data),e.set("__primitive_type",WD.tiles3d,!0),e.colorBlendMode=Cesium.Cesium3DTileColorBlendMode.REPLACE,r._3dTilesPrimitives.add(e)})),!1!==(null==e?void 0:e.flyTo)){var o=r._map.getMinHeight();r._map.camera.cancelFlight(),r._map.camera.setView({destination:j(r._map,i[0].boundingSphere.center,1e4<o?o:1e4),orientation:{heading:6.283185307179586,pitch:-1.5707936357425476,roll:0}})}n(i)})).catch((function(t){i(t)}))}else{var a=t.name,s=t.data,u=bN(t,mN);r._map.scene.primitives.add(new Cesium.Cesium3DTileset({url:u.url})).readyPromise.then((function(t){if(t.set("name",a||"3dtiles"),t.set("data",s),t.set("__primitive_type",WD.tiles3d,!0),t.colorBlendMode=Cesium.Cesium3DTileColorBlendMode.REPLACE,!1!==(null==e?void 0:e.flyTo)){var i=r._map.getMinHeight();r._map.camera.cancelFlight(),r._map.camera.setView({destination:j(r._map,t.boundingSphere.center,1e4<i?i:1e4),orientation:{heading:6.283185307179586,pitch:-1.5707936357425476,roll:0}})}n(t)})).otherwise((function(t){i(t)}))}}))}},{key:"set3DTilesVisible",value:function(t,e,r){if("function"==typeof t)for(var n=0;n<this._3dTilesPrimitives.length;n++){var i=this._3dTilesPrimitives.get(n);!0===r?i.show=t(i.get("name"),i.get("data"),i):!0===t(i.get("name"),i.get("data"),i)&&(i.show=e)}else if(0===t.length)this._3dTilesPrimitives.show=e;else for(var o=0;o<this._3dTilesPrimitives.length;o++){var a=this._3dTilesPrimitives.get(o);t.includes(a.get("name"))?a.show=e:!0===r&&(a.show=!e)}return this}},{key:"remove3DTiles",value:function(t){if(t&&0!==t.length)for(var e=0;e<this._3dTilesPrimitives.length;e++){var r=this._3dTilesPrimitives.get(e);t.includes(r.get("name"))&&this._3dTilesPrimitives.remove(r)&&e--}else this._3dTilesPrimitives.removeAll();return this}},{key:"update3DTilesOptions",value:function(t,e){var r="string"==typeof t?this.find(t,"3dtiles"):t;return r&&(r.style||(r.style=new Cesium.Cesium3DTileStyle),e.color&&(r.style.color=new Cesium.Expression(this._convertStyleColor(e.color))),e.backgroundColor&&(r.style.backgroundColor=new Cesium.Expression(this._convertStyleColor(e.backgroundColor))),r.makeStyleDirty()),this}},{key:"find",value:function(t,e){for(var r="point"===e?this._pointPrimitives:"3dtiles"===e?this._3dTilesPrimitives:this._gltfPrimitives,n=0;n<r.length;n++){var i=r.get(n);if(i.get("name")===t)return i}return null}},{key:"on",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"click",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:WD.gltf;return this._events.push({type:e,event:t,pType:r}),this}},{key:"off",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"click",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:WD.gltf,n=this._events.findIndex((function(n){return n.type===e&&n.pType===r&&n.event===t}));return n>=0&&this._events.splice(n,1),this}},{key:"dispose",value:function(){ON(CN(a.prototype),"dispose",this).call(this),this._map._cameraService.off(this._key),this._events.length=0,this._state.selected=null,this._state.hoverSelected=null,this._gltfPrimitives.destroy(),this._map.scene.primitives.remove(this._gltfPrimitives),this._pointPrimitives.destroy(),this._map.scene.primitives.remove(this._pointPrimitives),this._3dTilesPrimitives.destroy(),this._map.scene.primitives.remove(this._3dTilesPrimitives)}}],r&&wN(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t);function PN(t){return PN="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},PN(t)}function kN(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function TN(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,jN(n.key),n)}}function jN(t){var e=function(t,e){if("object"!=PN(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=PN(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==PN(e)?e:String(e)}function RN(){return RN="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=MN(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},RN.apply(this,arguments)}function LN(t,e){return LN=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},LN(t,e)}function IN(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function MN(t){return MN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},MN(t)}var AN=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&LN(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=MN(n);if(i){var r=MN(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===PN(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return IN(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this))._name=void 0,r._options={model:"first",cameraDistance:1.5,cameraHeight:1.8},r._map=void 0,r._start=void 0,r._stop=void 0,r._customRoamingEntity=void 0,r.__customRoamingEvent=r._customRoamingEvent.bind(IN(r)),r._map=t,r.setOptions(e),r._name=(null==e?void 0:e.name)||"dataRoam",r}return e=a,r=[{key:"name",get:function(){return this._name}},{key:"options",get:function(){return this._options}},{key:"clampToGround",get:function(){var t;return!0===(null===(t=this._options)||void 0===t?void 0:t.clampToGround)}},{key:"model",set:function(t){this._options.model=t,this._changeModel()}},{key:"setOptions",value:function(t){t&&Object.assign(this._options,t)}},{key:"_adjustCamera",value:function(t,e){var r=Cesium.Matrix4.fromRotationTranslation(Cesium.Matrix3.fromQuaternion(e),t);this._map.scene.camera.lookAtTransform(r),this._map.scene.camera.position=new Cesium.Cartesian3(-this._options.cameraDistance||1.5,0,this._options.cameraHeight||1.8),this._map.scene.camera.direction=new Cesium.Cartesian3(-t.x,0,0),this._map.scene.camera.right=new Cesium.Cartesian3(0,t.y,0),this._map.scene.camera.up=new Cesium.Cartesian3(0,0,t.z),this._map.scene.camera.lookDown(Cesium.Math.PI/60)}},{key:"_changeModel",value:function(){var t=this._options.model;switch(this._map.trackedEntity=void 0,t){case"follow":this._map.trackedEntity=this._customRoamingEntity;break;case"first":var e=this._customRoamingEntity.position.getValue(this._start),r=this._customRoamingEntity.orientation.getValue(this._start);this._adjustCamera(e,r),this._map.scene.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);break;case"god":this._map.zoomTo(this._customRoamingEntity,new Cesium.HeadingPitchRange(0,Cesium.Math.toRadians(-90),1e3))}}},{key:"_computeDistance",value:function(t){if(0===t.length)return 0;var e=t.length;if(e<2)return 0;for(var r=0,n=0;n<e-1;n++)r+=Cesium.Cartesian3.distance(t[n],t[n+1]);return+Math.abs(r).toFixed(2)}},{key:"_computeSamplePosition",value:function(t,e,r,n){for(var i=0,o=t.length;i<o;i++){var a=this._computeDistance(t.slice(0,i+1)),s=Cesium.JulianDate.addSeconds(this._start,a*e,Cesium.JulianDate.now());n.addSample(s,a),r.addSample(s,t[i])}}},{key:"_customRoamingEvent",value:function(){if(this._customRoamingEntity)if("first"===this._options.model){var t=this._customRoamingEntity.orientation.getValue(this._map.clock.currentTime),e=this._customRoamingEntity.position.getValue(this._map.clock.currentTime);Cesium.defined(t)&&this._adjustCamera(e,t)}else"god"===this._options.model&&this._map.zoomTo(this._customRoamingEntity,new Cesium.HeadingPitchRange(0,Cesium.Math.toRadians(-90),1e3));Cesium.JulianDate.greaterThanOrEquals(this._map.clock.currentTime,this._stop)&&(this._map.trackedEntity=void 0,this._map.scene.camera.lookAtTransform(Cesium.Matrix4.IDENTITY),this._map.clock.onTick.removeEventListener(this.__customRoamingEvent),this._map.clock.multiplier=0,this._map.clock.currentTime=this._start.clone())}},{key:"_customRoaming",value:function(t,e){var r,n=Cesium.Cartesian3.fromDegreesArrayHeights(t);this._map.clock.onTick.removeEventListener(this.__customRoamingEvent),this._start=Cesium.JulianDate.now(),this._stop=Cesium.JulianDate.addSeconds(this._start,e,Cesium.JulianDate.now());var i=this._computeDistance(n),o=new Cesium.SampledPositionProperty,a=new Cesium.SampledProperty(Number);this._map.clock.currentTime=this._start.clone(),this._map.clock.startTime=this._start.clone(),this._map.clock.stopTime=this._stop.clone(),this._map.clock.clockRange=Cesium.ClockRange.CLAMPED,this._map.clock.multiplier=1,this.remove(),this._computeSamplePosition(n,e/i,o,a),this._customRoamingEntity=this._map.entities.add({availability:new Cesium.TimeIntervalCollection([new Cesium.TimeInterval({start:this._start,stop:this._stop})]),position:o,orientation:new Cesium.VelocityOrientationProperty(o),model:{uri:(null===(r=this._options)||void 0===r?void 0:r.gltfSrc)||"static/gltf/PureMilkTruck1.gltf",minimumPixelSize:64,heightReference:this.clampToGround?Cesium.HeightReference.CLAMP_TO_GROUND:Cesium.HeightReference.NONE},path:{resolution:1,material:new Cesium.PolylineGlowMaterialProperty({glowPower:.1,color:Cesium.Color.AQUA}),width:10},properties:new Cesium.PropertyBag({roaming:a})}),this._customRoamingEntity.position.setInterpolationOptions({interpolationDegree:6,interpolationAlgorithm:Cesium.LinearApproximation}),this._changeModel(),Cesium.JulianDate.equals(this._map.clock.currentTime,this._start)&&this._map.clock.onTick.addEventListener(this.__customRoamingEvent)}},{key:"create",value:function(t){var e=t.positions,r=t.duration;this.stop();var n,i=this.clampToGround?e.map((function(t){return[t[0],t[1],0]})):e;return this._customRoaming(function(t){if(Array.isArray(t))return kN(t)}(n=i.flat())||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||function(t,e){if(t){if("string"==typeof t)return kN(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?kN(t,e):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),r||6),this}},{key:"stop",value:function(){return this._map.clock.multiplier=0,this._map.trackedEntity=void 0,this._map.scene.camera.lookAtTransform(Cesium.Matrix4.IDENTITY),this}},{key:"pause",value:function(){this._map.clock.multiplier=0,this._map.trackedEntity=void 0,this._map.scene.camera.lookAtTransform(Cesium.Matrix4.IDENTITY)}},{key:"remove",value:function(){return this._customRoamingEntity&&(this._map.entities.remove(this._customRoamingEntity),this._customRoamingEntity=null),this}},{key:"dispose",value:function(){RN(MN(a.prototype),"dispose",this).call(this),this.stop(),this.remove()}}],r&&TN(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t);function DN(t){return DN="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},DN(t)}function NN(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,FN(n.key),n)}}function FN(t){var e=function(t,e){if("object"!=DN(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=DN(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==DN(e)?e:String(e)}function zN(){return zN="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=BN(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},zN.apply(this,arguments)}function GN(t,e){return GN=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},GN(t,e)}function BN(t){return BN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},BN(t)}var VN=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&GN(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=BN(n);if(i){var r=BN(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===DN(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this))._name=void 0,r._map=void 0,r._options=void 0,r._serverUrl="http:"===location.protocol?"http://support.supermap.com.cn:8090/iserver/services/plot-jingyong/rest/plot":location.origin+"/iserver/services/plot-jingyong/rest/plot",r._visible=!0,r._container=void 0,r._currentPlotLayerName="plottingLayer",r._plotInstance=void 0,r._plotLayer=new Map,r._selectedIcon=null,r._map=t,r._options=e||{},r._name=(null==e?void 0:e.name)||"dynamicPlotting",r}return e=a,r=[{key:"name",get:function(){return this._name}},{key:"options",get:function(){return this._options}},{key:"visible",get:function(){return this._visible},set:function(t){if(this._visible=t,this._plotInstance){var e,r,n,i,o=this.plotLayer(this._currentPlotLayerName);this.setVisible(t,this._currentPlotLayerName),t?!1!==this._options.enablePanel&&(this._map._appHandler.setOptions({disabled:t}),this._createContainer(),this._container.style.display="block",null===(e=o.plotDraw)||void 0===e||e.activate(),null===(r=o.plotEdit)||void 0===r||r.activate()):(null===(n=o.plotDraw)||void 0===n||n.deactivate(),null===(i=o.plotEdit)||void 0===i||i.deactivate(),this._container&&(this._container.style.display="none"))}}},{key:"enablePanel",get:function(){return!!this._options.enablePanel},set:function(t){if(this._options.enablePanel=t,this._plotInstance&&this._visible){this._map._appHandler.setOptions({disabled:t});var e,r,n,i,o=this.plotLayer(this._currentPlotLayerName);t?(this._createContainer(),this._container.style.display="block",null===(e=o.plotDraw)||void 0===e||e.activate(),null===(r=o.plotEdit)||void 0===r||r.activate()):(null===(n=o.plotDraw)||void 0===n||n.deactivate(),null===(i=o.plotEdit)||void 0===i||i.deactivate(),this._container&&(this._container.style.display="none"))}}},{key:"plotLayer",get:function(){var t=this;return function(e){if(!t._plotLayer.has(e)){var r=new Cesium.PlottingLayer(t._map.scene,e);t._map.scene.plotLayers.add(r),t._plotLayer.set(e,{layer:r})}return t._plotLayer.get(e)}}},{key:"_changeIcon",value:function(t){this._container&&(this._selectedIcon&&this._container.contains(this._selectedIcon)&&this._selectedIcon.classList.remove("selected"),this._selectedIcon=t,t&&!t.classList.contains("selected")&&t.classList.add("selected"))}},{key:"_createContainer",value:function(){var t,e=this;if(!this._container&&this._plotInstance){this._map._appHandler.setOptions({disabled:!0});var r=document.createElement("div");null!==(t=this._options)&&void 0!==t&&t.className&&this._options.className.split(" ").forEach((function(t){return r.classList.add(t)})),r.setAttribute("id","bimmap-smap-plotting"),document.body.appendChild(r),r.onclick=function(t){if(t.target instanceof HTMLDivElement){var r=t.target.getAttribute("id");/^\d+$/.test(r)&&e._changeIcon(t.target)}},window.$("#bimmap-smap-plotting").panel({cls:"bimmap-smap-plotting",content:'<div class="easyui-tabs">\n      <div id="plotPanel" title="标绘面板"></div>\n      <div id="stylePanel" title="属性面板"></div>\n    </div>'}),this._container=r;var n=this.plotLayer(this._currentPlotLayerName);window.initPlotPanel("plotPanel",this._serverUrl,n.plotDraw,n.plotEdit,this._plotInstance),new window.StylePanel("stylePanel",n.plotEdit,this._plotInstance)}}},{key:"initPlotting",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"plottingLayer";if(!Cesium.Plotting)throw Error("使用超图动态标绘，请配置加载插件：MapInit实例化配置第三参数中加入属性plugin:['plotting']。");this._currentPlotLayerName=e,this._plotInstance=Cesium.Plotting.getInstance(this._serverUrl,this._map.scene);var r=this.plotLayer(e);r.plotEdit=new Cesium.PlotEditControl(this._map.scene,r.layer),r.plotEdit.SelectedEvent.addEventListener((function(e){t.fire("selected",t.convertGraphicObjectsToJson(e))})),r.plotEdit.UnSelectedEvent.addEventListener((function(e){t.fire("unselected")})),r.plotDraw=new Cesium.PlotDrawControl(this._map.scene,r.layer),r.plotDrawCB=r.plotDraw.drawControlEndEvent.addEventListener((function(e){r.plotEdit.activate(),t._changeIcon(),t.fire("drawEnd",t.getPlottingData(),r.plotEdit)})),window.StylePanel.editFeatureCallback=function(e){t.fire("change",t.convertGraphicObjectsToJson(e))},!1!==this._options.enablePanel&&this._visible&&(this._createContainer(),this._container.style.display="block")}},{key:"loadData",value:function(t,e){if(t.length>0){var r,n=this.plotLayer("plottingLayer");!0!==(null==e?void 0:e.append)&&n.layer.removeAll(),t.forEach((function(t){n.layer.geoJsonToGeoGraphicObject(JSON.parse(t))})),null===(r=n.plotEdit)||void 0===r||r.activate()}}},{key:"getPlottingData",value:function(){var t=this.plotLayer("plottingLayer").layer;if(0===t.geoGraphicObjects.length)return[];var e=[];return t.geoGraphicObjects.map((function(t){e.push(Cesium.GeoGraphicObject.toGeoJson(t))})),e}},{key:"convertGraphicObjectsToJson",value:function(t){return Array.isArray(t)?t.map((function(t){return Cesium.GeoGraphicObject.toGeoJson(t)})):Cesium.GeoGraphicObject.toGeoJson(t)}},{key:"removeGraphic",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"plottingLayer",n=this.plotLayer(r).layer;Array.isArray(t)?t.forEach((function(t){return e.removeGraphic(t,r)})):"string"==typeof t?n.removeFeatureByUuId(t):n.removeGeoGraphicObject(t)}},{key:"setVisible",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"plottingLayer";if(this._plotLayer.has(e)){var r=this._plotLayer.get(e);r&&(r.layer.visibility=t)}return this}},{key:"clear",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"plottingLayer";if(this._plotLayer.has(t)){var e=this._plotLayer.get(t).layer;e&&e.removeAll()}}},{key:"clearAll",value:function(){this._plotLayer.forEach((function(t,e){t.layer.removeAll()}))}},{key:"remove",value:function(t){if(t){if(this._plotLayer.has(t)){var e=this._plotLayer.get(t);e&&this._map.scene.plotLayers.remove(e,!0),this._plotLayer.delete(t)}}else this._map.scene.plotLayers.removeAll(!0),this._plotLayer.clear();return this}},{key:"dispose",value:function(){zN(BN(a.prototype),"dispose",this).call(this),this.remove(),this._changeIcon(),this._plotLayer.forEach((function(t,e){var r,n;t.plotDrawCB&&t.plotDrawCB(),null===(r=t.plotEdit)||void 0===r||r.deactivate(),null===(n=t.plotDraw)||void 0===n||n.deactivate()})),this._plotLayer.clear(),this._plotInstance&&this._plotInstance.destroy(),this._container&&(document.body.removeChild(this._container),this._container=null),this._map._appHandler.setOptions({disabled:!1})}}],r&&NN(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(rr);function UN(t){return UN="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},UN(t)}function qN(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function WN(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function XN(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?WN(Object(r),!0).forEach((function(e){var n,i,o;n=t,i=e,o=r[e],(i=HN(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):WN(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function ZN(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,HN(n.key),n)}}function HN(t){var e=function(t,e){if("object"!=UN(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=UN(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==UN(e)?e:String(e)}function YN(){return YN="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=JN(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},YN.apply(this,arguments)}function KN(t,e){return KN=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},KN(t,e)}function JN(t){return JN=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},JN(t)}var $N=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&KN(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=JN(n);if(i){var r=JN(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===UN(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this)).map=void 0,r._options=void 0,r._drawInstance=null,r._layer=new Cesium.BimMapDataSource,r.map=t,r._options=e,r._layer.set("name",(null==e?void 0:e.name)||"terrainExcavation"),t.dataSources.add(r._layer),r}return e=a,r=[{key:"start",value:function(t,e){var r=this;this._drawInstance&&this.clear(!0);var n=new OD(this.map,XN(XN({name:"area",strokeColor:"rgba(81, 255,0,1)",radius:6,strokeWidth:2,fill:"rgba(225, 229,0,0.2)",background:{strokeColor:"rgba(225, 229,0,1)",strokeWidth:2}},e),{},{type:"Polygon"}));this.map.dataSources.add(n.layer),this._drawInstance=n,n.addEventListener("drawstart",(function(){r.map.scene.globe.removeAllExcavationRegion()})),n.draw((function(e){var n,i=e.filter((function(t){return t[0]&&t[1]&&t[2]}));i.length>2&&r.map.scene.globe.addExcavationRegion({name:"ExcavationRegion",position:(n=i.flat(),function(t){if(Array.isArray(t))return qN(t)}(n)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||function(t,e){if(t){if("string"==typeof t)return qN(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?qN(t,e):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),height:t,transparent:!1})}))}},{key:"clear",value:function(t){var e=this;this._drawInstance&&(this._drawInstance.features.forEach((function(t,r){e._layer.entities.remove(t)})),this._drawInstance.features.length=0,t&&(this._drawInstance.dispose(),this.map.dataSources.remove(this._drawInstance.layer,!0),this._drawInstance=null)),this.map.scene.globe.removeAllExcavationRegion()}},{key:"dispose",value:function(){YN(JN(a.prototype),"dispose",this).call(this),this.clear(!0),this._layer.entities.removeAll(),this.map.dataSources.remove(this._layer,!0)}}],r&&ZN(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t);function QN(t){return QN="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},QN(t)}function tF(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,eF(n.key),n)}}function eF(t){var e=function(t,e){if("object"!=QN(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=QN(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==QN(e)?e:String(e)}function rF(){return rF="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=iF(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},rF.apply(this,arguments)}function nF(t,e){return nF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},nF(t,e)}function iF(t){return iF=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},iF(t)}var oF=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&nF(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=iF(n);if(i){var r=iF(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===QN(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=o.call(this)).map=void 0,e._instances=[],e.map=t,e}return e=a,r=[{key:"instances",get:function(){return this._instances}},{key:"viewToExtents",value:function(t,e,r,n){return this.map._cameraService.viewToExtents(t,e,r,n),this}},{key:"setDepthTestAgainstTerrain",value:function(t){return this.map._cameraService.setDepthTestAgainstTerrain(t),this}},{key:"getCameraVisualAngle",value:function(){return this.map._cameraService.getCameraVisualAngle()}},{key:"setCameraVisualAngle",value:function(t,e){return this.map._cameraService.setCameraVisualAngle(t,e),this}},{key:"setView",value:function(t,e){return this.map._cameraService.setView({destination:Cesium.fromLonLat(t),orientation:e||{heading:6.283185307179586,pitch:-1.5707936357425476,roll:0}}),this}},{key:"S3MTiles",value:function(t){var e=new eN(this.map,t);return this._instances.push(e),e}},{key:"obliquePhotography",value:function(t){var e=new UD(this.map,t);return this._instances.push(e),e}},{key:"Terrain",value:function(t){var e=new cN(this.map,t);return this._instances.push(e),e}},{key:"Primitive",value:function(t){var e=new EN(this.map,t);return this._instances.push(e),e}},{key:"DataRoam",value:function(t){var e=new AN(this.map,t);return this._instances.push(e),e}},{key:"DynamicPlotting",value:function(t){var e=new VN(this.map,t);return this._instances.push(e),e}},{key:"TerrainExcavation",value:function(t){var e=new $N(this.map,t);return this._instances.push(e),e}},{key:"findInstance",value:function(t){return this._instances.find((function(e){return e.name===t}))}},{key:"filterInstance",value:function(t){return this._instances.filter((function(e){return e.name===t}))}},{key:"removeInstance",value:function(t){var e=this;if(!t)return this._instances.forEach((function(t){return t.dispose()})),void(this._instances.length=0);if(Array.isArray(t))t.forEach((function(t){return e.removeInstance(t)}));else{var r=this._instances.findIndex((function(e){return e===t}));r>=0&&(this._instances[r].dispose(),this._instances.splice(r,1))}return this}},{key:"dispose",value:function(){rF(iF(a.prototype),"dispose",this).call(this),this.removeInstance()}}],r&&tF(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t);function aF(t){return aF="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},aF(t)}function sF(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function uF(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,lF(n.key),n)}}function lF(t){var e=function(t,e){if("object"!=aF(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=aF(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==aF(e)?e:String(e)}function cF(){return cF="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=pF(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},cF.apply(this,arguments)}function fF(t,e){return fF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},fF(t,e)}function pF(t){return pF=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},pF(t)}var hF=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&fF(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=pF(n);if(i){var r=pF(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===aF(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(t=o.call.apply(o,[this].concat(r)))._layers=[],t._map=void 0,t}return e=a,r=[{key:"layers",get:function(){return this._layers}},{key:"addLayer",value:function(t){var e=this;return Array.isArray(t)?t.forEach((function(t){e.addLayer(t)})):this._layers.includes(t)||(this._layers.push(t),this._map.dataSources.add(t)),this}},{key:"hasLayer",value:function(t){return this._layers.includes(t)}},{key:"removeLayer",value:function(t){var e=this;if(!t)return this._map.dataSources.removeAll(),void(this._layers.length=0);if(Array.isArray(t))t.forEach((function(t){e.removeLayer(t)}));else{var r=this.findIndexLayer((function(e){return e===t}));if(r<0)return;this._layers.splice(r,1),this._map.dataSources.remove(t,!0)}}},{key:"clearLayers",value:function(){var t=this;return this._layers.forEach((function(e){return t._map.dataSources.remove(e,!0)})),this._layers.length=0,this}},{key:"getLayers",value:function(t,e){var r=[];if("string"==typeof t)this._layers.forEach((function(n){var i;(null===(i=n.options)||void 0===i?void 0:i[t])===e&&r.push(n)}));else{var n=Object.keys(t);this._layers.forEach((function(e){n.some((function(r){var n;return(null===(n=e.options)||void 0===n?void 0:n[r])===t[r]}))&&r.push(e)}))}return r}},{key:"searchLayers",value:function(t){var e=this,r=[];return Array.isArray(t)?t.forEach((function(t){var n,i=e.searchLayers(t);r.push.apply(r,function(t){if(Array.isArray(t))return sF(t)}(n=i)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||function(t,e){if(t){if("string"==typeof t)return sF(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?sF(t,e):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())})):this._layers.forEach((function(e){var n;(null===(n=e.options)||void 0===n?void 0:n.name)===t&&r.push(e)})),r}},{key:"filterLayer",value:function(t){for(var e=[],r=0,n=this._layers.length;r<n;r++)!0===t(this._layers[r],r)&&e.push(this._layers[r]);return e}},{key:"findLayer",value:function(t){for(var e=0,r=this._layers.length;e<r;e++)if(!0===t(this._layers[e],e))return this._layers[e]}},{key:"findIndexLayer",value:function(t){for(var e=0,r=this._layers.length;e<r;e++)if(!0===t(this._layers[e],e))return e;return-1}},{key:"forEachLayer",value:function(t){for(var e=0,r=this._layers.length;e<r;e++)t(this._layers[e],e);return this}},{key:"filterVisibleLayer",value:function(t,e){var r=!1!==e;return this._layers.forEach((function(e){!0===t(e.get("item"),e)&&e.show!==r&&(e.show=r)})),this}},{key:"filterRemoveLayer",value:function(t){for(var e=0,r=this._layers.length;e<r;e++)t(this._layers[e].get("item"),this._layers[e])&&(this._layers.splice(e,1),this._map.dataSources.remove(this._layers[e],!0),e--);return this}},{key:"visibleLayers",value:function(t,e){if(Array.isArray(t))this._layers.filter((function(e){return t.includes(e.get("name"))})).forEach((function(t){t.show=e}));else{var r=this.findLayer((function(e){return e.get("name")===t}));r&&(r.show=e)}return this}},{key:"zoomByLayers",value:function(t,e){if(Array.isArray(t)){var r=this._layers.filter((function(e){return t.includes(e.get("name"))}));r.length>0&&this._map._cameraService.zoomTo(r[r.length-1])}else{var n=this.findLayer((function(e){return e.get("name")===t}));n&&this._map._cameraService.zoomTo(n)}return this}},{key:"dispose",value:function(){cF(pF(a.prototype),"dispose",this).call(this),this.clearLayers()}}],r&&uF(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t);const yF=hF;function dF(t){return dF="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dF(t)}function gF(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,mF(n.key),n)}}function mF(t){var e=function(t,e){if("object"!=dF(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=dF(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==dF(e)?e:String(e)}function vF(){return vF="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=bF(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},vF.apply(this,arguments)}function _F(t,e){return _F=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},_F(t,e)}function bF(t){return bF=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},bF(t)}var wF=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_F(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=bF(n);if(i){var r=bF(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===dF(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this,t,e))._datasources=[],r._layer.set("name",e.name||"kml"),r._layer.setStyle((function(t){return r._stateService.getStyle(t,"default")})),r}return e=a,r=[{key:"load",value:function(t,e){var r=this;return Cesium.KmlDataSource.load(t).then((function(t){r._datasources.push(t),r._map.dataSources.add(t),null!=e&&e.flyTo&&(r._map.camera.cancelFlight(),r._map.zoomTo(t))})).catch((function(e){console.error("加载 kml 失败：",t,e)})),this}},{key:"dispose",value:function(){var t=this;vF(bF(a.prototype),"dispose",this).call(this),this._datasources.forEach((function(e){return t._map.dataSources.remove(e)})),this._datasources.length=0}}],r&&gF(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(QM);function SF(t){return SF="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},SF(t)}var OF=["name","flyTo","bounds","zoom","opacity"];function xF(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function CF(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function EF(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,PF(n.key),n)}}function PF(t){var e=function(t,e){if("object"!=SF(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=SF(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==SF(e)?e:String(e)}function kF(){return kF="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=jF(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},kF.apply(this,arguments)}function TF(t,e){return TF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},TF(t,e)}function jF(t){return jF=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},jF(t)}var RF=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&TF(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=jF(n);if(i){var r=jF(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===SF(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this))._layers=[],r.map=void 0,r.map=t,r}return e=a,r=[{key:"load",value:function(t,e){var r,n,i=e||{},o=i.name,a=(i.flyTo,i.bounds),s=(i.zoom,i.opacity,function(t,e){if(null==t)return{};var r,n,i=function(t,e){if(null==t)return{};var r,n,i={},o=Object.keys(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||(i[r]=t[r]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}(i,OF)),u=a?new Cesium.GeographicTilingScheme({rectangle:(r=Cesium.Rectangle).fromDegrees.apply(r,(n=a.flat(),function(t){if(Array.isArray(t))return CF(t)}(n)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||function(t,e){if(t){if("string"==typeof t)return CF(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?CF(t,e):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()))}):void 0,l=this.map.imageryLayers.addImageryProvider(new Cesium.UrlTemplateImageryProvider(function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?xF(Object(r),!0).forEach((function(e){var n,i,o;n=t,i=e,o=r[e],(i=PF(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):xF(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({url:t,minimumLevel:e.minZoom||this.map.getMaxZoom(),maximumLevel:e.maxZoom||this.map.getMinZoom(),tilingScheme:u},s)));return o&&Object.defineProperty(l,"name",{value:o,configurable:!1}),this._layers.push(l),a&&this.map._cameraService.flyTo({destination:Cesium.BoundingSphere.fromPoints(Cesium.Cartesian3.fromDegreesArray(a.flat(1))).center}),this}},{key:"find",value:function(t){return this._layers.find((function(e){return Reflect.get(e,"name")===t}))}},{key:"remove",value:function(t){var e=this;if(t){var r=this._layers.findIndex((function(e){return Reflect.get(e,"name")===t}));r>=0&&(this.map.imageryLayers.remove(this._layers[r],!0),this._layers.slice(r,1))}else this._layers.forEach((function(t){return e.map.imageryLayers.remove(t,!0)})),this._layers.length=0;return this}},{key:"setVisible",value:function(t,e){var r=this.find(t);return r&&(r.show=e),this}},{key:"dispose",value:function(){kF(jF(a.prototype),"dispose",this).call(this),this.remove()}}],r&&EF(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t);function LF(t){return LF="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},LF(t)}function IF(t){return function(t){if(Array.isArray(t))return MF(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return MF(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?MF(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function MF(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function AF(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function DF(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?AF(Object(r),!0).forEach((function(e){var n,i,o;n=t,i=e,o=r[e],(i=FF(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):AF(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function NF(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,FF(n.key),n)}}function FF(t){var e=function(t,e){if("object"!=LF(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=LF(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==LF(e)?e:String(e)}function zF(){return zF="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=BF(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},zF.apply(this,arguments)}function GF(t,e){return GF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},GF(t,e)}function BF(t){return BF=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},BF(t)}var VF=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&GF(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=BF(n);if(i){var r=BF(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===LF(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this)).map=void 0,r._options=void 0,r._clampMode="1",r._drawInstance=null,r._elevationRamp=[0,.045,.1,.15,.37,.54,1],r._slopeRamp=[0,.29,.5,Math.sqrt(2)/2,.87,.91,1],r._layer=new Cesium.BimMapDataSource,r._contourOptions={showContour:!1,spacing:50,width:2,contourType:"none"},r.map=t,r._options=e,r._layer.set("name",e.name||"measure"),t.dataSources.add(r._layer),r}return e=a,r=[{key:"clampMode",get:function(){return this._clampMode||"1"},set:function(t){this._clampMode=t||"1"}},{key:"_getColorRamp",value:function(t){var e=document.createElement("canvas");e.width=100,e.height=1;var r,n=e.getContext("2d");if("elevation"===t?r=this._elevationRamp:"slope"===t&&(r=this._slopeRamp),n&&r){var i=n.createLinearGradient(0,0,100,0);i.addColorStop(r[0],"#000000"),i.addColorStop(r[1],"#2747E0"),i.addColorStop(r[2],"#D33B7D"),i.addColorStop(r[3],"#D33038"),i.addColorStop(r[4],"#FF9742"),i.addColorStop(r[5],"#ffd700"),i.addColorStop(r[6],"#ffffff"),n.fillStyle=i,n.fillRect(0,0,100,1)}return e}},{key:"_getSlopeContourMaterial",value:function(){return new Cesium.Material({fabric:{type:"SlopeColorContour",materials:{contourMaterial:{type:"ElevationContour"},slopeRampMaterial:{type:"SlopeRamp"}},components:{diffuse:"contourMaterial.alpha == 0.0 ? slopeRampMaterial.diffuse : contourMaterial.diffuse",alpha:"max(contourMaterial.alpha, slopeRampMaterial.alpha)"}},translucent:!1})}},{key:"_getElevationContourMaterial",value:function(){return new Cesium.Material({fabric:{type:"ElevationColorContour",materials:{contourMaterial:{type:"ElevationContour"},elevationRampMaterial:{type:"ElevationRamp"}},components:{diffuse:"contourMaterial.alpha == 0.0 ? elevationRampMaterial.diffuse : contourMaterial.diffuse",alpha:"max(contourMaterial.alpha, elevationRampMaterial.alpha)"}},translucent:!1})}},{key:"_updateMaterial",value:function(t){var e,r={},n={};t.enableContour?("elevation"===t.contourType?(r=(e=this._getElevationContourMaterial()).materials.elevationRampMaterial.uniforms,n=e.materials.contourMaterial.uniforms):"slope"===t.contourType?(this.map.terrainProvider._requestVertexNormals=!0,r=(e=this._getSlopeContourMaterial()).materials.slopeRampMaterial.uniforms,n=e.materials.contourMaterial.uniforms):n=(e=Cesium.Material.fromType("ElevationContour")).uniforms,n.width=t.contourWidth,n.spacing=t.contourSpacing,n.color=t.contourColor):"elevation"===t.contourType?r=(e=Cesium.Material.fromType("ElevationRamp")).uniforms:"slope"===t.contourType&&(this.map.terrainProvider._requestVertexNormals=!1,r=(e=Cesium.Material.fromType("SlopeRamp")).uniforms),"none"!==t.contourType&&(r.image=this._getColorRamp(t.contourType)),this.map.scene.globe.material=e,this.map.scene.requestRender()}},{key:"_getLabel",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Cesium.LabelGraphics({text:t,style:Cesium.LabelStyle.FILL_AND_OUTLINE,showBackground:!0,backgroundColor:Cesium.Color.fromCssColorString("rgba(255,255,255,0.5)"),backgroundPadding:new Cesium.Cartesian2(5,5),font:"16px Microsoft YaHei",show:!0,distanceDisplayCondition:new Cesium.DistanceDisplayCondition(0,Number.POSITIVE_INFINITY),fillColor:Cesium.Color.fromCssColorString("#000000"),eyeOffset:new Cesium.Cartesian3(0,-10,-10),horizontalOrigin:Cesium.HorizontalOrigin.CENTER,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,heightReference:e?Cesium.HeightReference.CLAMP_TO_GROUND:Cesium.HeightReference.NONE})}},{key:"_setStyle",value:function(t,e,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];e.setStyle(t.layer.getStyle()),e.label=this._getLabel(r,n),e.point.show=!1,e.polyline.clampToGround=n,this._layer.entities.add(e)}},{key:"_createPoint",value:function(t,e,r,n){var i=this;r.forEach((function(r){var o=new Cesium.CustomEntity({position:Cesium.fromLonLat(r),point:{pixelSize:5}});o.setStyle(t.layer.getStyle()),n&&(o.point.heightReference=Cesium.HeightReference.NONE),i._layer.entities.add(o),e.push(o)}))}},{key:"distance",value:function(t,e){var r=this;this._drawInstance&&this.clear(!0);var n=new OD(this.map,DF(DF({name:"distance",strokeColor:"rgba(81, 255,0,1)",radius:6,strokeWidth:2,fill:"rgba(225, 229,0,0.2)",background:{strokeColor:"rgba(225, 229,0,1)",strokeWidth:2}},e),{},{type:"LineString"}));this.map.dataSources.add(n.layer);var i=[];this._drawInstance={draw:n,features:i},n.addEventListener("drawstart",(function(t){if(!0===r._options.drawClear)for(;i.length>0;)r._layer.entities.remove(i.pop())})),n.draw((function(e){var o=0;if(e.length>1)for(var a="1"===r.clampMode,s=1;s<e.length;s++)o+=a?Cesium.Cartesian3.distance(Cesium.fromLonLat([e[s-1][0],e[s-1][1],0]),Cesium.fromLonLat([e[s][0],e[s][1],0]))/1e3:Cesium.Cartesian3.distance(Cesium.fromLonLat(e[s-1]),Cesium.fromLonLat(e[s]))/1e3;var u=new Cesium.CustomEntity({position:e.length>1?Cesium.fromLonLat(e[Math.floor(e.length/2)],0):void 0,polyline:{positions:Cesium.Cartesian3.fromDegreesArrayHeights(e.flat())}});r._setStyle(n,u,pt(o),!0),i.push(u),r._createPoint(n,i,e),t(o)}))}},{key:"area",value:function(t,e){var r=this;this._drawInstance&&this.clear(!0);var n=new OD(this.map,DF(DF({name:"area",strokeColor:"rgba(81, 255,0,1)",radius:6,strokeWidth:2,fill:"rgba(225, 229,0,0.2)",background:{strokeColor:"rgba(225, 229,0,1)",strokeWidth:2}},e),{},{type:"Polygon"}));this.map.dataSources.add(n.layer);var i=[];this._drawInstance={draw:n,features:i},n.addEventListener("drawstart",(function(){if(!0===r._options.drawClear)for(;i.length>0;)r._layer.entities.remove(i.pop())})),n.draw((function(e){var o=e.length>1&&e[0][0]!==e[e.length-1][0]&&e[0][1]!==e[e.length-1][1]?e.concat([e[0]]):e,a=0;if("2"===r.clampMode)a=F(Cesium.Cartesian3.fromDegreesArrayHeights(o.flat()));else{var s=IF(n._latlngs);a=F(s.concat(s[0]))}var u=new Cesium.CustomEntity({position:R(e.map((function(t){return[t[0],t[1],0]}))),polyline:{positions:Cesium.Cartesian3.fromDegreesArrayHeights(o.flat())},polygon:{hierarchy:Cesium.Cartesian3.fromDegreesArrayHeights(e.flat())}});r._setStyle(n,u,ht(a)),i.push(u),r._createPoint(n,i,e),t(a)}))}},{key:"height",value:function(t,e){var r=this;this._drawInstance&&this.clear(!0);var n=new OD(this.map,DF(DF({name:"height",strokeColor:"rgba(81, 255,0,1)",radius:6,strokeWidth:2,fill:"rgba(225, 229,0,0.2)",background:{strokeColor:"rgba(225, 229,0,1)",strokeWidth:2}},e),{},{type:"LineString"}));this.map.dataSources.add(n.layer);var i=[];this._drawInstance={draw:n,features:i},n.addEventListener("drawstart",(function(t){if(!0===r._options.drawClear)for(;i.length>0;)r._layer.entities.remove(i.pop())})),n.addEventListener("drawchange",(function(t){t.length>=2&&n.rmLastPoint()})),n.draw((function(e){var o=IF(n._latlngs);if(o.length>1){var a=o.map((function(t){return Cesium.toLonLat(t)})),s=Cesium.Cartesian3.distance(Cesium.fromLonLat(Cesium.toLonLat(o[0],0)),Cesium.fromLonLat(Cesium.toLonLat(o[o.length-1],0)))/1e3,u=Cesium.Cartesian3.distance(o[0],o[o.length-1])/1e3,l=Math.abs(o[0].z-o[o.length-1].z)/1e3,c=IF(a[a.length-1]);c[2]=a[0][2];var f=new Cesium.CustomEntity({position:e.length>1?R([a[a.length-1],c]):void 0,polyline:{positions:Cesium.Cartesian3.fromDegreesArrayHeights(a.concat(c,a[0]).flat()),clampToGround:!1}});r._setStyle(n,f,"垂直距离："+pt(l),!1),i.push(f);var p=new Cesium.CustomEntity({position:Cesium.fromLonLat(a[0]),label:r._getLabel("空间距离：".concat(pt(u)),!1)});i.push(p),r._layer.entities.add(p);var h=new Cesium.CustomEntity({position:e.length>1?R([a[0],c]):void 0,label:r._getLabel("水平距离：".concat(pt(s)),!1)});i.push(h),r._layer.entities.add(h),r._createPoint(n,i,a.concat([c]),!0),t(l,u,s)}}))}},{key:"updateContour",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1?arguments[1]:void 0;return e&&Object.assign(this._contourOptions,e),this._updateMaterial({enableContour:t&&this._contourOptions.showContour,contourSpacing:this._contourOptions.spacing,contourWidth:this._contourOptions.width,contourType:t?this._contourOptions.contourType:"none",minHeight:-414,maxHeight:8777,contourColor:Cesium.Color.RED.withAlpha(.4)}),this}},{key:"clear",value:function(t){var e=this;this._drawInstance&&(this._drawInstance.features.forEach((function(t,r){e._layer.entities.remove(t)})),this._drawInstance.features.length=0,t&&(this._drawInstance.draw.dispose(),this.map.dataSources.remove(this._drawInstance.draw.layer,!0),this._drawInstance=null))}},{key:"dispose",value:function(){zF(BF(a.prototype),"dispose",this).call(this),this.clear(!0),this._layer.entities.removeAll(),this.map.dataSources.remove(this._layer,!0)}}],r&&NF(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t);function UF(t){return UF="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},UF(t)}function qF(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,WF(n.key),n)}}function WF(t){var e=function(t,e){if("object"!=UF(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=UF(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==UF(e)?e:String(e)}var XF=function(){function t(e){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.mapboxRenderer=void 0,this.ready=!1,this.readyPromise=void 0,this.tilingScheme=void 0,this.rectangle=void 0,this.tileSize=void 0,this.tileWidth=void 0,this.tileHeight=void 0,this.maximumLevel=void 0,this.minimumLevel=void 0,this.tileDiscardPolicy=void 0,this.errorEvent=void 0,this.credit=void 0,this.proxy=void 0,this.hasAlphaChannel=void 0,this.sourceFilter=void 0,this.enablePickFeatures=void 0,this.mapboxRenderer=new window.mapbox.BasicRenderer({style:e.style,requestTransformFn:e.requestTransformFn}),this.ready=!1,this.readyPromise=this.mapboxRenderer._style.loadedPromise.then((function(){return r.ready=!0})),this.tilingScheme=new Cesium.WebMercatorTilingScheme({ellipsoid:Cesium.Ellipsoid.WGS84}),this.rectangle=this.tilingScheme.rectangle,this.tileSize=this.tileWidth=this.tileHeight=e.tileSize||512,this.maximumLevel=e.maximumLevel||Number.MAX_SAFE_INTEGER,this.minimumLevel=e.minimumLevel||0,this.tileDiscardPolicy=void 0,this.errorEvent=new Cesium.Event,this.credit=new Cesium.Credit(e.credit||"",!1),this.proxy=new Cesium.DefaultProxy(""),this.hasAlphaChannel=void 0===e.hasAlphaChannel||e.hasAlphaChannel,this.sourceFilter=e.sourceFilter,e.mapboxAccessToken&&(window.mapbox.accessToken=e.mapboxAccessToken),this.enablePickFeatures=!("enablePickFeatures"in e)||!!e.enablePickFeatures}var e,r;return e=t,r=[{key:"getTileCredits",value:function(t,e,r){return[]}},{key:"createTile",value:function(){var t=document.createElement("canvas");return t.width=this.tileSize,t.height=this.tileSize,t.style.imageRendering="pixelated",t.getContext("2d").globalCompositeOperation="copy",t}},{key:"_getTilesSpec",value:function(t,e){for(var r=t.x,n=t.y,i=t.zoom,o=this.tileSize,a=[],s=(1<<i)-1,u=-1;u<=1;u++){var l=r+u;l<0&&(l=s),l>s&&(l=0);for(var c=-1;c<=1;c++){var f=n+c;f<0||f>s||a.push({source:e,z:i,x:l,y:f,left:0+u*o,top:0+c*o,size:o})}}return a}},{key:"requestImage",value:function(t,e,r){var n=this,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(r>this.maximumLevel||r<this.minimumLevel)return Promise.reject(void 0);this.mapboxRenderer.filterForZoom(r);var o=this.mapboxRenderer.getVisibleSources().reduce((function(i,o){return i.concat(n._getTilesSpec({x:t,y:e,zoom:r},o))}),[]);return new Promise((function(t,e){var r=n.createTile(),a=r.getContext("2d"),s=n.mapboxRenderer.renderTiles(a,{srcLeft:0,srcTop:0,width:n.tileSize,height:n.tileSize,destLeft:0,destTop:0},o,(function(o){"string"!=typeof o||o.endsWith("tiles not available")?i?(s.consumer.ctx=void 0,t(r),n.mapboxRenderer.releaseRender(s)):t(s):e(void 0)}))}))}},{key:"pickFeatures",value:function(t,e,r,n,i){var o=this;if(this.ready&&this.enablePickFeatures)return this.requestImage(t,e,r,!1).then((function(t){var e=o.mapboxRenderer.getVisibleSources();e=o.sourceFilter?o.sourceFilter(e):e;var a=[];return n=Cesium.Math.toDegrees(n),i=Cesium.Math.toDegrees(i),e.forEach((function(t){a.push({data:o.mapboxRenderer.queryRenderedFeatures({source:t,renderedZoom:r,lng:n,lat:i,tileZ:r})})})),t.consumer.ctx=void 0,o.mapboxRenderer.releaseRender(t),a}))}},{key:"destroy",value:function(){this.mapboxRenderer._cancelAllPendingRenders(),Object.values(this.mapboxRenderer._style.sourceCaches).forEach((function(t){return t._tileCache.reset()})),this.mapboxRenderer._gl.getExtension("WEBGL_lose_context").loseContext()}}],r&&qF(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();const ZF=XF;function HF(t){return HF="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},HF(t)}var YF=["url","type","proj","key","maxZoom"],KF=["url","maxZoom"],JF=["url","type","format","maxZoom","minZoom"];function $F(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function QF(t,e){if(null==t)return{};var r,n,i=function(t,e){if(null==t)return{};var r,n,i={},o=Object.keys(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||(i[r]=t[r]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function tz(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function ez(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?tz(Object(r),!0).forEach((function(e){var n,i,o;n=t,i=e,o=r[e],(i=nz(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):tz(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function rz(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,nz(n.key),n)}}function nz(t){var e=function(t,e){if("object"!=HF(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=HF(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==HF(e)?e:String(e)}function iz(t,e){return iz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},iz(t,e)}function oz(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function az(t){return az=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},az(t)}var sz=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&iz(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=az(n);if(i){var r=az(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===HF(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return oz(t)}(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=o.call(this))._instance=new Lr(oz(e)),e._mapLayers=[],e._options=void 0,e._domMarker=void 0,e._stopRenderInterval=!0,e.tdService=void 0,e._options=t,e}return e=a,r=[{key:"Cesium",get:function(){return window.Cesium}},{key:"map",get:function(){if(this._dispose)throw Error("BimMap(supermap)资源已被释放，请重新实例化后使用！");return this._map}},{key:"instances",get:function(){return this._instance.instances}},{key:"instancesToName",get:function(){return this._instance.instancesToName}},{key:"interactions",get:function(){return[]}},{key:"overlays",get:function(){return this._domMarker.overlays}},{key:"options",get:function(){return this._options}},{key:"_init",value:function(t){return this._map=new Cesium.CustomViewer(t.target,ez({animation:!1,timeline:!1,fullscreenButton:!1,geocoder:!1,homeButton:!1,navigationHelpButton:!1,baseLayerPicker:!1,sceneModePicker:!1,infoBox:!1,selectionIndicator:!1,navigationInstructionsInitiallyVisible:!1,creditContainer:document.createElement("DIV"),terrainProvider:new Cesium.EllipsoidTerrainProvider({ellipsoid:Cesium.Ellipsoid.WGS84}),requestRenderMode:!1,maximumRenderTimeChange:.2,scene3DOnly:!0,contextOptions:{webgl:{preserveDrawingBuffer:!0},requestWebgl1:!0}},t)),this._map._appHandler=new nr,this._map._cameraService=new Ro(this._map),this.tdService=new oF(this._map),this.tdService.viewToExtents(98.70117187500001,28.497660832963472,109.24804687500001,32.667124733120325),this.tdService.setDepthTestAgainstTerrain(!1),this._domMarker=new VA(this._map),this._map}},{key:"_useInnerLoop",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:33;if(t){var r=this;this.map.useDefaultRenderLoop=!1;var n=this.map,i=Date.now();this._stopRenderInterval=!1,function t(){Date.now()-i>=e&&(n.render(),n.scene.requestRender(),i=Date.now()),r._stopRenderInterval||requestAnimationFrame(t)}()}else this._stopRenderInterval=!0,this.map.useDefaultRenderLoop=!0}},{key:"addView",value:function(t){var e=t.maxZoom,r=void 0===e?18:e,n=(t.proj,t.center),i=t.zoom,o=t.minZoom,a=void 0===o?7:o,s=this._options;a&&(s.minZoom=a),r&&(s.maxZoom=r),i&&(s.zoom=i),this._init(this._options);var u=n&&n.length>1?n:[103.11767578125001,30.72294882477251];return this.map._cameraService.flyTo({destination:Cesium.fromLonLat([u[0],u[1],u.length>2?u[2]:E(i||a)]),duration:.2}),a<=r&&(this.map.scene.screenSpaceCameraController.minimumZoomDistance=E(r),this.map.scene.screenSpaceCameraController.maximumZoomDistance=E(a)),this.map}},{key:"removeMapLayer",value:function(){var t=this;return this._mapLayers.forEach((function(e){return t.map.imageryLayers.remove(e)})),this._mapLayers.length=0,this}},{key:"useTianDiTu",value:function(t){var e=this,r=t||{},n=r.url,i=r.type,o=void 0===i?["img","cia"]:i,a=r.proj,u=void 0===a?"WEB":a,l=r.key,c=void 0===l?"99bc0b8df065eb27b289330adfe75fd8":l,f=r.maxZoom,p=QF(r,YF),h=n?[n]:o.map((function(t){var e=s(t,u),r=e.split("_");return"https://{s}.tianditu.gov.cn/".concat(e,"/wmts?service=wmts&request=gettile&version=1.0.0&layer=").concat(r[0],"&style=default&tilematrixset=").concat(r[1],"&tilematrix={z}&tilerow={y}&tilecol={x}&format=tiles&tk=").concat(c)}));h.forEach((function(t){var r=new Cesium.UrlTemplateImageryProvider(ez({url:t,subdomains:["t0","t1","t2","t3","t4","t5","t6","t7"],maximumLevel:f||e._options.maxZoom||18},p));e._mapLayers.push(e.map.imageryLayers.addImageryProvider(r))}))}},{key:"useMapboxVT",value:function(t){var e=this;t.url,!1===t.cesiumToTianDiTu?fetch(t.url).then((function(t){return t.json()})).then((function(t){var r=new ZF({style:t});r.readyPromise.then((function(){e._mapLayers.push(e.map.imageryLayers.addImageryProvider(r))}))})):(t.url=void 0,this.useTianDiTu(t))}},{key:"useXYZ",value:function(t){var e=this,r=t||{},n=r.url,i=(r.maxZoom,QF(r,KF));(n?[null==t?void 0:t.url]:!0===(null==t?void 0:t.dark)?["https://webst02.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}","https://webst02.is.autonavi.com/appmaptile?style=8&x={x}&y={y}&z={z}"]:["https://webrd01.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}"]).forEach((function(r){var n,o=new Cesium.UrlTemplateImageryProvider(ez({url:r,maximumLevel:(null==t?void 0:t.maxZoom)||(null===(n=e._options)||void 0===n?void 0:n.maxZoom)||13},i));e._mapLayers.push(e.map.imageryLayers.addImageryProvider(o))}))}},{key:"useWMTS",value:function(t){var e=t.url,r=(t.type,t.format,t.maxZoom),n=(t.minZoom,QF(t,JF)),i=new Cesium.WebMapTileServiceImageryProvider(ez({url:e||window.location.origin+"/services/newtianditudomdlg/wmts",tileMatrixSetID:"GetTileMatrix",layer:"defaultLayer",style:"default",format:"image/png",tileMatrixLabels:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18],tilingScheme:new Cesium.GeographicTilingScheme,maximumLevel:r||this._options.maxZoom||18},n)),o=this._mapLayers.push(this.map.imageryLayers.addImageryProvider(i)),a=this;return{setVisible:function(t){a._mapLayers[o].show=t},remove:function(){a.map.imageryLayers.remove(a._mapLayers[o]),a._mapLayers.splice(o,1)}}}},{key:"useWMS",value:function(t){var e,r=t.url,n=t.params,i=t.token,o=n.BBOX.split(",").map((function(t){return Number(t)}));Reflect.deleteProperty(n,"BBOX");var a,s=new Cesium.WebMapServiceImageryProvider({url:r,layers:n.layers,tilingScheme:new Cesium.GeographicTilingScheme({rectangle:(e=Cesium.Rectangle).fromDegrees.apply(e,(a=o,function(t){if(Array.isArray(t))return $F(t)}(a)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(a)||function(t,e){if(t){if("string"==typeof t)return $F(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?$F(t,e):void 0}}(a)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()))}),parameters:ez({service:"WMS",layers:"0,1",format:"image/png",transparent:!0,styles:"",version:"1.3.0",access_token:i},n)}),u=this._mapLayers.push(this.map.imageryLayers.addImageryProvider(s)),l=this;return{setVisible:function(t){l._mapLayers[u].show=t},remove:function(){l.map.imageryLayers.remove(l._mapLayers[u]),l._mapLayers.splice(u,1)}}}},{key:"GridPolygon",value:function(t){return this._instance.add(new lD(this.map,t),!0)}},{key:"LayerGroupAdmin",value:function(t){return this._instance.add(new mM(this.map,t))}},{key:"AreaMapStyle",value:function(t){return this._instance.add(new sA(this.map,t),!0)}},{key:"ClusterPoint",value:function(t){return this._instance.add(new _A(this.map,t),!0)}},{key:"IconMarker",value:function(t){return this._instance.add(new PA(this.map,t),!0)}},{key:"DomMarker",value:function(t){return this._instance.add(new VA(this.map,t))}},{key:"Text",value:function(t){return this._instance.add(new HA(this.map,t),!0)}},{key:"Line",value:function(t){return this._instance.add(new eD(this.map,t),!0)}},{key:"Trajectory",value:function(t){return this._instance.add(new gD(this.map,t),!0)}},{key:"DrawLine",value:function(t){return this._instance.add(new OD(this.map,t),!0)}},{key:"HeatMap",value:function(t){return this._instance.add(new jD(this.map,t),!0)}},{key:"Kml",value:function(t){return this._instance.add(new wF(this.map,t),!0)}},{key:"TileLayerAdmin",value:function(t){return this._instance.add(new RF(this.map,t),!0)}},{key:"LoadGeojson",value:function(t){return this._instance.add(new DD(this.map,t),!0)}},{key:"Measure",value:function(t){return this._instance.add(new VF(this.map,t),!0)}},{key:"addOverlay",value:function(t){var e,r,n=t.id?this._domMarker.find((function(e){return e.get("id")===t.id})):null;return n?null===(e=this._domMarker)||void 0===e||e.update(n,t):null===(r=this._domMarker)||void 0===r||r.create(t),this}},{key:"removeOverlay",value:function(t){return t?this._domMarker.removeOverlay(t):this._domMarker.clearOverlays(),this}},{key:"removeInstance",value:function(t){return this._instance.remove(t),this}},{key:"getLonLat",value:function(t){var e=t instanceof MouseEvent?{x:t.pageX,y:t.pageY}:t,r=Cesium.Cartographic.fromCartesian(this.map.camera.pickEllipsoid(new Cesium.Cartesian2(e.x,e.y)));return[Cesium.Math.toDegrees(r.longitude),Cesium.Math.toDegrees(r.latitude),this.map.getHeight()]}},{key:"setCenter",value:function(t,e){return this.map.camera.cancelFlight(),this.map._cameraService.flyTo({destination:Cesium.Cartesian3.fromDegrees(t[0],t[1],t.length>2?t[2]:this.map.getHeight()),duration:lt(e)}),this}},{key:"setZoom",value:function(t,e){this.map.camera.cancelFlight();var r=Cesium.Cartographic.fromCartesian(this.map.camera.pickEllipsoid(new Cesium.Cartesian2(this.map.canvas.clientWidth/2,this.map.canvas.clientHeight/2)));return this.map._cameraService.flyTo({destination:Cesium.Cartesian3.fromDegrees(Cesium.Math.toDegrees(r.longitude),Cesium.Math.toDegrees(r.latitude),E(t)),duration:lt(e)}),this}},{key:"zoomTo",value:function(t){return!t.zoom||t.zoom<this.map.getMinZoom()||t.zoom>this.map.getMaxZoom()?this.setCenter(t.point,t.duration):this.map._cameraService.flyTo({destination:Cesium.Cartesian3.fromDegrees(t.point[0],t.point[1],E(t.zoom)),duration:lt(t.duration)}),this}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"flyTo",value:function(t,e){return this.map._cameraService.mapFlyTo(t,e),this}},{key:"getEntityCenterCoordinate",value:function(t){return A(Array.isArray(t)?t.map((function(t){return t.getGeometry()})):t.getGeometry())}},{key:"getCoordinatesCenter",value:function(t){return I(t)}},{key:"getCoordinateFromFeature",value:function(t){if(Array.isArray(t)){var e=[];return t.forEach((function(t){e.push(A(t))})),e}return A(t)}},{key:"hasFeatureInView",value:function(t,e){var r=Cesium.JulianDate.now(),n=this.map.camera.computeViewRectangle();if(!e&&!Array.isArray(t))return Cesium.Rectangle.contains(n,Cesium.Cartographic.fromCartesian(t.position.getValue(r)));e&&(Array.isArray(t)?t:[t]).forEach((function(t){e(t,Cesium.Rectangle.contains(n,Cesium.Cartographic.fromCartesian(t.position.getValue(r))))}))}},{key:"clear",value:function(){return this.clearLayers(),this}},{key:"resize",value:function(){return this.map.scene.camera.setView({destination:this.map.scene.camera.positionWC,orientation:{heading:this.map.scene.camera.heading,pitch:this.map.scene.camera.pitch}}),this.map.scene.requestRender(),this}},{key:"render",value:function(){return this.map.scene.requestRender(),this}},{key:"on",value:function(t,e){return this.map._cameraService.on(li(t),e),this}},{key:"off",value:function(t,e){return this.map._cameraService.off(e,li(t)),this}},{key:"zoomChange",value:function(t){return this.map._cameraService.onZoom(t),this}},{key:"removeZoomChange",value:function(t){return this.map._cameraService.offZoom(t),this}},{key:"dispose",value:function(){var t;this._dispose||(this._map._cameraService.dispose(),this._instance.dispose(),this.clear(),null===(t=this._domMarker)||void 0===t||t.dispose(),this._map.destroy(),this._map=null)}},{key:"removeMap",value:function(){this.removeMapLayer(),console.warn("函数 => removeMap : 将在下一版本移除，请使用removeMapLayer！")}},{key:"unon",value:function(t){console.warn("函数 => unon : 将在下一版本移除，请使用off！")}},{key:"removeInteraction",value:function(t){}},{key:"addInteraction",value:function(t){}},{key:"searchInteractions",value:function(t){}},{key:"searchInteraction",value:function(t){}},{key:"clearSelection",value:function(){}}],r&&rz(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(yF);function uz(t){return uz="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},uz(t)}function lz(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,cz(n.key),n)}}function cz(t){var e=function(t,e){if("object"!=uz(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=uz(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==uz(e)?e:String(e)}function fz(){return fz="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=hz(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},fz.apply(this,arguments)}function pz(t,e){return pz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},pz(t,e)}function hz(t){return hz=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},hz(t)}function yz(t){return function(t){if(Array.isArray(t))return dz(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return dz(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?dz(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function dz(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function gz(t){for(var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=e?document.body.getElementsByClassName(t):document.head.getElementsByClassName(t),n=0;n<r.length;n++)e?document.body.removeChild(r[n]):document.head.removeChild(r[n]),n--}function mz(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ol";switch(!1!==(arguments.length>2?arguments[2]:void 0)&&vz(e),e){case"leaflet":return new Jp(t);case"cesium":return new ma(t);case"supermap":return new sz(t);default:return new rM(t)}}function vz(t){switch(t){case"ol":"ol"===t&&(window.Opl=window.ol);break;case"leaflet":!function(){if(window.L){if(L.fromLonLat=function(t){return Array.isArray(t)&&t.length>0&&Array.isArray(t[0])?t.map((function(t){return L.latLng(t[1],t[0])})):L.latLng(t[1],t[0])},L.toLonLat=function(t,e,r){if("number"==typeof t)return[e,t,r];if(Q(t))return[t.lng,t.lat];if(Array.isArray(t)){var n=t[0];t[0]=t[1],t[1]=n}return t},L.TileLayer.WMS){var t=L.TileLayer.WMS.prototype.getTileUrl;L.TileLayer.WMS.prototype.getTileUrl=function(e){var r=t.call(this,e),n=ct(r);return n.ACCESSTOKEN&&(n.access_token=n.ACCESSTOKEN),function(t,e){return(e?"".concat(e.indexOf("?")>=0?e.split("?")[0]:e,"?"):"")+new URLSearchParams(t).toString()}(n,r)}}L.Icon.prototype.get=L.Layer.prototype.get=function(t,e){return e?Reflect.get(this,t):this.feature&&this.feature.properties&&!et(this.feature.properties[t])?this.feature.properties[t]:Reflect.get(this.options,t)},L.Icon.prototype.has=L.Layer.prototype.has=function(t,e){return e?Reflect.has(this,t):Reflect.has(this.options,t)},L.Icon.prototype.set=L.Layer.prototype.set=function(t,e,r){return r?Reflect.set(this,t,e):Reflect.set(this.options,t,e)},L.Icon.prototype.unset=L.Layer.prototype.unset=function(t,e){return e?Reflect.deleteProperty(this,t):Reflect.deleteProperty(this.options,t)},L.Icon.prototype.setProperties=L.Layer.prototype.setProperties=function(t){var e=this;Q(t)&&Object.keys(t).forEach((function(r){Reflect.set(e.options,r,t[r])}))},L.Icon.prototype.getProperties=L.Layer.prototype.getProperties=function(){var t=this,e={};return this.feature&&this.feature.properties&&Object.keys(this.feature.properties).forEach((function(r){r.startsWith("__")||(e[r]=t.feature.properties[r])})),Object.keys(this.options).forEach((function(r){r.startsWith("__")||(e[r]=t.options[r])})),e};var e=L.Marker.prototype._setPos;L.Marker.include({_setPos:function(t){e.call(this,t),this._applyRotation()},_applyRotation:function(){this.options.rotationAngle&&(this._icon.style[L.DomUtil.TRANSFORM+"Origin"]=this.options.rotationOrigin||"center center",this._icon.style[L.DomUtil.TRANSFORM]+=" rotate("+this.options.rotationAngle+"deg)")},setRotationAngle:function(t){return this.options.rotationAngle=t,this.update(),this},setRotationOrigin:function(t){return this.options.rotationOrigin=t,this.update(),this}}),L.Layer.prototype.getStyle=function(){return this.get("__style",!0)},L.Layer.prototype.setStyle=function(t){return this.set("__style",t,!0),this instanceof L.LayerGroup?this.eachLayer((function(e){return o(e,t)})):o(this,t),this};var r=L.Path.prototype.setStyle;L.Path.prototype.setStyle=function(t){if(t){if(this.set("__style",t,!0),"function"==typeof t)o(this,t);else if("leaflet"===t.kind)r.call(this,t);else{var e=t.path,n=ja(t,ka);e?r.call(this,e):this instanceof L.Path&&r.call(this,n),o(this,n)}return this}};var n=L.FeatureGroup.prototype.setStyle;L.FeatureGroup.prototype.setStyle=function(t){if(t){if(this.set("__style",t,!0),"function"==typeof t)o(this,t);else if("leaflet"===t.kind)n.call(this,t);else{var e=t.path,r=ja(t,Ta);e&&n.call(this,e),o(this,r)}return this}}}function i(t){return!1!==t.get("_visibleText",!0)}function o(t,e){if(t instanceof L.Marker){var n="function"==typeof e?e(t):e;if(n){var o,a=!1;if(t.getIcon()instanceof L.DivIcon&&n.css){var s=t.getIcon();!s||n.icon||n.tip?(s.get("className")||"").indexOf(ba)>=0&&s.has("html")&&("string"==typeof s.get("html")?t.setIcon(Ea(n,void 0,i(t))):s.get("html").style.cssText=n.css.cssText,a=!0):t.setIcon(null)}else(n.icon||t.getIcon())&&(t.setIcon(Ea(n,void 0,i(t))),a=!0);a||(n.tip&&i(t)?t.getTooltip()?null!==(o=n.tip)&&void 0!==o&&o.content&&t.setTooltipContent(n.tip.content):t.bindTooltip(L.tooltip(n.tip)):t.getTooltip()&&t.unbindTooltip()),n.zIndex&&t.setZIndexOffset(n.zIndex)}}else if(t instanceof L.Polygon){var u,l,c="function"==typeof e?e(t):e;if(c)if(c.tip&&i(t))if(t.getPopup()){if(null!==(u=c.tip)&&void 0!==u&&u.content){var f;t.setPopupContent("<span style='".concat(Pa(null===(f=c.css)||void 0===f?void 0:f.cssText,["color"],!0),"'>").concat(c.tip.content,"<span>"))}}else t.bindPopup(L.popup({content:"<span style='".concat(Pa(null===(l=c.css)||void 0===l?void 0:l.cssText,["color"],!0),"'>").concat(c.tip.content,"<span>"),interactive:!1,className:"bimmap-popup bimmap-popup_nbg",autoClose:!1,closeButton:!1,closeOnEscapeKey:!1,closeOnClick:!1,bubblingMouseEvents:!1})),t.openPopup(t.getBounds().getCenter());else c.path?r.call(t,c.path):t.getPopup()&&t.closePopup().unbindPopup()}else if(t instanceof L.Polyline){var p="function"==typeof e?e(t):e;p&&p.path&&(p.path.fill=!1,r.call(t,p.path))}else if(t instanceof L.CircleMarker){var h,y="function"==typeof e?e(t):e;y&&(t.get("_canvasMarker",!0)?function(t,e){var r;if(e.icon&&e.icon.iconUrl){var n=Reflect.get(t.getStyle(),"_options");t.set("img",{url:e.icon.iconUrl,size:null!=n&&n.imgSize?e.icon.iconSize:void 0})}else t.unset("img");null===(r=t._updatePath)||void 0===r||r.call(t)}(t,y):null!==(h=y.path)&&void 0!==h&&h.radius&&t.setRadius(y.path.radius))}else if(t instanceof L.Popup){var d="function"==typeof e?e(t):e;d&&d.tip&&i(t)?t.setContent(d.tip.content):t.getPopup()&&t.unbindPopup()}}}();break;case"cesium":!function(){function t(t,e){Object.keys(e).forEach((function(r){Q(t[r])?t[r].getValue&&t[r].getValue()!==e[r]&&(t[r]=e[r]):t[r]!==e[r]&&(t[r]=e[r])}))}window.Cesium&&(Cesium.fromLonLat=function(t,e){return Cesium.Cartesian3.fromDegrees(t[0],t[1],et(e)?t.length>2?t[2]:e||0:e)},Cesium.toLonLat=function(t,e){if(Array.isArray(t))return t.map((function(t){var r=Cesium.Cartographic.fromCartesian(t);return[Cesium.Math.toDegrees(r.longitude),Cesium.Math.toDegrees(r.latitude),et(e)?r.height:e]}));var r=Cesium.Cartographic.fromCartesian(t);return[Cesium.Math.toDegrees(r.longitude),Cesium.Math.toDegrees(r.latitude),et(e)?r.height:e]},Cesium.Heatmap=function(t,e,r){return window.CesiumHeatmap?window.CesiumHeatmap.create(t,e,function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?dt(Object(r),!0).forEach((function(e){var n,i,o,a;n=t,i=e,o=r[e],a=function(t,e){if("object"!=yt(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=yt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(i),(i="symbol"==yt(a)?a:String(a))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):dt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({blur:.8,radius:20,minOpacity:.6,maxOpacity:1},r)):(rt("使用热力图必须引用插件[CesiumHeatmap.js]！"),null)},Cesium.CustomViewer=Cesium.Viewer,Cesium.CustomViewer.prototype.getMinZoom=function(){var t=P(this.scene.screenSpaceCameraController.maximumZoomDistance);return t<0?0:t},Cesium.CustomViewer.prototype.getMaxZoom=function(){return P(this.scene.screenSpaceCameraController.minimumZoomDistance)},Cesium.CustomViewer.prototype.getZoom=function(){return P(this.getHeight())},Cesium.CustomViewer.prototype.getHeight=function(){return this.camera.positionCartographic.height},Cesium.CustomViewer.prototype.getMinHeight=function(){return this.scene.screenSpaceCameraController.minimumZoomDistance},Cesium.CustomViewer.prototype.getMaxHeight=function(){return this.scene.screenSpaceCameraController.maximumZoomDistance},Cesium.CustomViewer.prototype.getCameraProperty=function(){var t=this.camera;return{heading:t.heading,pitch:t.pitch,roll:t.roll}},Y(window.Cesium),Cesium.CustomEntity=Cesium.Entity,Cesium.BimMapDataSource=Cesium.CustomDataSource,function(t){function e(t,e){if(e)return Reflect.get(this,t);if(this.properties&&this.properties instanceof Cesium.PropertyBag){var r=this.properties.getValue(Cesium.JulianDate.now());if(Reflect.has(r,t))return Reflect.get(r,t)}return Reflect.get(this.options||{},t)}function r(t,e){return e?Reflect.has(this,t):Reflect.has(this.options||{},t)}function n(t,e,r){var n=this;return"name"===t&&Reflect.has(this,"name")&&(this.name=e),r?Q(t)?(Object.keys(t).forEach((function(e){Reflect.set(n,e,t[e])})),!0):Reflect.set(this,t,e):(this.options||(this.options={}),Q(t)?(Object.keys(t).forEach((function(e){Reflect.set(n.options,e,t[e])})),!0):Reflect.set(this.options,t,e))}function i(t,e){return e?Reflect.deleteProperty(this,t):Reflect.deleteProperty(this.options,t)}function o(t){var e=this;Q(t)&&Object.keys(t).forEach((function(r){Reflect.set(e.options,r,t[r])}))}function a(){var t=this,e={};if(this.options&&Object.keys(this.options).forEach((function(r){r.startsWith("__")||(e[r]=t.options[r])})),this.properties&&this.properties instanceof Cesium.PropertyBag){var r=this.properties.getValue(Cesium.JulianDate.now());r&&Q(r)&&Object.keys(r).forEach((function(t){t.startsWith("__")||(e[t]=r[t])}))}return e}[Cesium.Entity.prototype,Cesium.CustomDataSource.prototype,Cesium.GeoJsonDataSource.prototype,Cesium.DivOverlay.prototype,Cesium.ImageryLayer.prototype,Cesium.Model.prototype,Cesium.PointPrimitive.prototype,Cesium.Cesium3DTileset.prototype,Cesium.Cesium3DTile.prototype,Cesium.Cesium3DTileContent.prototype,Cesium.Cesium3DTileFeature.prototype].forEach((function(t){t.get=e,t.set=n,t.unset=i,t.has=r,t.setProperties=o,t.getProperties=a}))}(),function(t){function e(){return this.get("__style",!0)}function r(t){this.set("__style",t,!0),this.entities.values.forEach((function(e){e.setStyle&&e.setStyle(t)})),this.update(Cesium.JulianDate.now())}[Cesium.DataSource.prototype,Cesium.KmlDataSource.prototype,Cesium.CzmlDataSource.prototype,Cesium.CustomDataSource.prototype,Cesium.GeoJsonDataSource.prototype].forEach((function(t){t.getStyle=e,t.setStyle=r}))}(),Cesium.CustomEntity.prototype.getStyle=function(){return this.get("__style",!0)},Cesium.CustomEntity.prototype.setStyle=function(e){var r="function"==typeof e?e(this):e;if(r){this.set("__style",e,!0),r.billboard?this.billboard?t(this.billboard,r.billboard):this.billboard=new Cesium.BillboardGraphics(r.billboard):this.billboard&&(this.billboard=void 0),r.label?this.label?t(this.label,r.label):this.label=new Cesium.LabelGraphics(r.label):this.label&&(this.label=void 0);var n,i,o,a=null;r.polygon?null!==(n=this.polygon)&&void 0!==n&&n.hierarchy&&(this.polygon?t(this.polygon,r.polygon):this.polygon=new Cesium.PolygonGraphics(r.polygon),!r.polygon.outline||!r.polyline||null!==(i=this.polyline)&&void 0!==i&&i.positions||(a=this.polygon.hierarchy.getValue(Cesium.JulianDate.now()).positions)):this.polygon&&(this.polygon=void 0),r.polyline?(null!==(o=this.polyline)&&void 0!==o&&o.positions||a)&&(this.polyline?t(this.polyline,r.polyline):this.polyline=new Cesium.PolylineGraphics(r.polyline),a&&(this.polyline.positions=a)):this.polyline,r.point?this.point?t(this.point,r.point):this.point=new Cesium.PointGraphics(r.point):this.point&&(this.point=void 0),r.ellipse?this.ellipse?t(this.ellipse,r.ellipse):this.ellipse=new Cesium.EllipseGraphics(r.ellipse):this.ellipse&&(this.ellipse=void 0)}})}();break;case"supermap":!function(){if(window.Cesium){if(Cesium.fromLonLat=function(t,e){return Cesium.Cartesian3.fromDegrees(t[0],t[1],et(e)?t.length>2?t[2]:e||0:e)},Cesium.toLonLat=function(t,e){if(Array.isArray(t))return t.map((function(t){var r=Cesium.Cartographic.fromCartesian(t);return[Cesium.Math.toDegrees(r.longitude),Cesium.Math.toDegrees(r.latitude),et(e)?r.height:e]}));var r=Cesium.Cartographic.fromCartesian(t);return[Cesium.Math.toDegrees(r.longitude),Cesium.Math.toDegrees(r.latitude),et(e)?r.height:e]},Cesium.Heatmap=function(t,e,r){return window.CesiumHeatmap?window.CesiumHeatmap.create(t,e,function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?aM(Object(r),!0).forEach((function(e){var n,i,o,a;n=t,i=e,o=r[e],a=function(t,e){if("object"!=oM(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=oM(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(i),(i="symbol"==oM(a)?a:String(a))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):aM(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({blur:.8,radius:20,minOpacity:.6,maxOpacity:1},r)):(rt("使用热力图必须引用插件[CesiumHeatmap.js]！"),null)},Cesium.CustomViewer=Cesium.Viewer,Cesium.CustomViewer.prototype.getMinZoom=function(){var t=P(this.scene.screenSpaceCameraController.maximumZoomDistance);return t<0?0:t},Cesium.CustomViewer.prototype.getMaxZoom=function(){return P(this.scene.screenSpaceCameraController.minimumZoomDistance)},Cesium.CustomViewer.prototype.getZoom=function(){return P(this.getHeight())},Cesium.CustomViewer.prototype.getHeight=function(){return this.camera.positionCartographic.height},Cesium.CustomViewer.prototype.getMinHeight=function(){return this.scene.screenSpaceCameraController.minimumZoomDistance},Cesium.CustomViewer.prototype.getMaxHeight=function(){return this.scene.screenSpaceCameraController.maximumZoomDistance},Cesium.CustomViewer.prototype.getCameraProperty=function(){var t=this.camera;return{heading:t.heading,pitch:t.pitch,roll:t.roll}},Y(window.Cesium),window.StylePanel){var t=window.StylePanel.prototype.updateSelectFeature;window.StylePanel.prototype.updateSelectFeature=function(e,r){t.call(this,e,r),null!=e&&r&&window.StylePanel.editFeatureCallback&&window.StylePanel.editFeatureCallback(r)}}Cesium.CustomEntity=Cesium.Entity,Cesium.BimMapDataSource=Cesium.CustomDataSource,Cesium.CustomImageryLayer=Cesium.ImageryLayer,function(t){function e(t,e){if(e)return Reflect.get(this,t);if(this.properties&&this.properties instanceof Cesium.PropertyBag){var r=this.properties.getValue(Cesium.JulianDate.now());if(Reflect.has(r,t))return Reflect.get(r,t)}return Reflect.get(this.options||{},t)}function r(t,e){return e?Reflect.has(this,t):Reflect.has(this.options||{},t)}function n(t,e,r){var n=this;return"name"===t&&Reflect.has(this,"name")&&(this.name=e),r?Q(t)?(Object.keys(t).forEach((function(e){Reflect.set(n,e,t[e])})),!0):Reflect.set(this,t,e):(this.options||(this.options={}),Q(t)?(Object.keys(t).forEach((function(e){Reflect.set(n.options,e,t[e])})),!0):Reflect.set(this.options,t,e))}function i(t,e){return e?Reflect.deleteProperty(this,t):Reflect.deleteProperty(this.options,t)}function o(t){var e=this;Q(t)&&Object.keys(t).forEach((function(r){Reflect.set(e.options,r,t[r])}))}function a(){var t=this,e={};if(this.options&&Object.keys(this.options).forEach((function(r){r.startsWith("__")||(e[r]=t.options[r])})),this.properties&&this.properties instanceof Cesium.PropertyBag){var r=this.properties.getValue(Cesium.JulianDate.now());r&&Q(r)&&Object.keys(r).forEach((function(t){t.startsWith("__")||(e[t]=r[t])}))}return e}[Cesium.Entity.prototype,Cesium.CustomDataSource.prototype,Cesium.GeoJsonDataSource.prototype,Cesium.DivOverlay.prototype,Cesium.ImageryLayer.prototype,Cesium.S3MTilesLayer.prototype,Cesium.Model.prototype,Cesium.PointPrimitive.prototype,Cesium.Cesium3DTileset.prototype].forEach((function(t){t.get=e,t.set=n,t.unset=i,t.has=r,t.setProperties=o,t.getProperties=a}))}(),function(t){function e(){return this.get("__style",!0)}function r(t){this.set("__style",t,!0),this.entities.values.forEach((function(e){e.setStyle&&e.setStyle(t)}))}[Cesium.DataSource.prototype,Cesium.KmlDataSource.prototype,Cesium.CzmlDataSource.prototype,Cesium.CustomDataSource.prototype,Cesium.GeoJsonDataSource.prototype].forEach((function(t){t.getStyle=e,t.setStyle=r}))}(),Cesium.CustomEntity.prototype.getStyle=function(){return this.get("__style",!0)},Cesium.CustomEntity.prototype.setStyle=function(t){var r="function"==typeof t?t(this):t;if(r){this.set("__style",t,!0),r.billboard?this.billboard?e(this.billboard,r.billboard):this.billboard=new Cesium.BillboardGraphics(r.billboard):this.billboard&&(this.billboard=void 0),r.label?this.label?e(this.label,r.label):this.label=new Cesium.LabelGraphics(r.label):this.label&&(this.label=void 0);var n,i,o,a=null;r.polygon?null!==(n=this.polygon)&&void 0!==n&&n.hierarchy&&(this.polygon?e(this.polygon,r.polygon):this.polygon=new Cesium.PolygonGraphics(r.polygon),!r.polygon.outline||!r.polyline||null!==(i=this.polyline)&&void 0!==i&&i.positions||(a=this.polygon.hierarchy.getValue(Cesium.JulianDate.now()).positions)):this.polygon&&(this.polygon=void 0),r.polyline?(null!==(o=this.polyline)&&void 0!==o&&o.positions||a)&&(this.polyline?e(this.polyline,r.polyline):this.polyline=new Cesium.PolylineGraphics(r.polyline),a&&(this.polyline.positions=a)):this.polyline,r.point?this.point?e(this.point,r.point):this.point=new Cesium.PointGraphics(r.point):this.point&&(this.point=void 0),r.ellipse?this.ellipse?e(this.ellipse,r.ellipse):this.ellipse=new Cesium.EllipseGraphics(r.ellipse):this.ellipse&&(this.ellipse=void 0)}}}function e(t,e){Object.keys(e).forEach((function(r){Q(t[r])?t[r].getValue&&t[r].getValue()!==e[r]&&(t[r]=e[r]):t[r]!==e[r]&&(t[r]=e[r])}))}}()}}var _z=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&pz(t,e)}(a,t);var e,r,n,i,o=(n=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=hz(n);if(i){var r=hz(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===uz(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ol",n=arguments.length>2?arguments[2]:void 0;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=o.call(this))._service=void 0,e._queue=[],e._type=void 0,e._type=r,function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ol",e=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,n=(null==r?void 0:r.baseUrl)||"".concat("https://bim.schdri.com:8800","/bimgis-sdk/v").concat((null==r?void 0:r.version)||"1.1.2","/");window.BIMMAP_SDK_SOURCE_URL=n;var i=(null==r?void 0:r.plugin)||[],o=[],a=[];switch(t){case"ol":a.push("ol/ol.css"),o.push("ol/ol.js"),i.includes("gif")&&o.push("plugins/gifler.js"),i.includes("html2canvas")&&o.push("plugins/html2canvas.min.js");break;case"leaflet":a.push("leaflet/leaflet.css","leaflet/plugin/leaflet.markercluster/MarkerCluster.css","leaflet/plugin/leaflet.markercluster/MarkerCluster.Default.css"),o.push("leaflet/leaflet.js","leaflet/leaflet.marker.js","leaflet/plugin/leaflet.markercluster/leaflet.markercluster.js","leaflet/plugin/leaflet-canvas-markers.js"),i.includes("mapbox")&&(a.push("leaflet/mapbox-gl.css"),o.push("leaflet/mapbox-gl.js"),o.push("leaflet/leaflet-mapbox-gl.js")),i.includes("heatMap")&&o.push("leaflet/plugin/leaflet-heat.js"),i.includes("animated")&&o.push("leaflet/plugin/leaflet.animatedmarker/leaflet.animatedmarker.js"),i.includes("kml")&&o.push("leaflet/plugin/leaflet-kml.js"),i.includes("wms")&&o.push("leaflet/plugin/leaflet.wms.js"),i.includes("measure")&&(a.push("leaflet/plugin/leaflet-measure/leaflet-measure.css"),o.push("leaflet/plugin/leaflet-measure/leaflet-measure.cn.js"));break;case"cesium":a.push("cesium/Widgets/widgets.css"),o.push("cesium/Cesium.js"),i.includes("heatMap")&&o.push("cesium/CesiumHeatmap.js"),i.includes("mapbox")&&o.push("cesium/mapbox-gl.js"),i.includes("gif")&&o.push("plugins/gifler.js"),i.includes("diffuse")&&o.push("cesium/CircleWaveMaterialProperty.js"),i.includes("html2canvas")&&o.push("plugins/html2canvas.min.js");break;case"supermap":a.push("supermap/Widgets/widgets.css"),o.push("supermap/Cesium.js"),i.includes("heatMap")&&o.push("supermap/CesiumHeatmap.js"),i.includes("tdt")&&o.push("supermap/cesiumTdt.js"),i.includes("mapbox")&&o.push("supermap/mapbox-gl.js"),i.includes("gif")&&o.push("plugins/gifler.js"),i.includes("diffuse")&&o.push("supermap/CircleWaveMaterialProperty.js"),i.includes("plotting")&&(a.push("supermap/plotPanelControl/colorpicker/css/colorpicker.css"),a.push("supermap/plotPanelControl/colorpicker/css/layout.css"),a.push("supermap/plotPanelControl/jquery-easyui-1.4.4/css/easyui.css"),a.push("supermap/plotPanelControl/zTree/css/zTreeStyle.css"),o.push("supermap/ThirdParty/Workers/PlotAlgo/PlotAlgoInclude.js"),o.push("supermap/plotPanelControl/jquery-easyui-1.4.4/jquery.min.js"),o.push("supermap/plotPanelControl/jquery-easyui-1.4.4/jquery-ui.js"),o.push("supermap/plotPanelControl/jquery-easyui-1.4.4/jquery.easyui.min.js"),o.push("supermap/plotPanelControl/colorpicker/js/colorpicker.js"),o.push("supermap/plotPanelControl/colorpicker/js/colorpickerEditor.js"),o.push("supermap/plotPanelControl/colorpicker/js/eye.js"),o.push("supermap/plotPanelControl/colorpicker/js/utils.js"),o.push("supermap/plotPanelControl/colorpicker/js/layout.js"),o.push("supermap/plotPanelControl/zTree/jquery.ztree.core.js"),o.push("supermap/plotPanelControl/PlotPanel.js"),o.push("supermap/plotPanelControl/StylePanel.js"),window.CESIUM_BASE_URL=n+"supermap"),i.includes("html2canvas")&&o.push("plugins/html2canvas.min.js")}null!=r&&r.extraStyleUrl&&a.push.apply(a,yz(null==r?void 0:r.extraStyleUrl)),function(t,e){gz("bimgis_sdk_style",!1);for(var r=0;r<e.length;r++){var n=document.createElement("link");n.href=/^http(s)?\:\/\//.test(e[r])?e[r]:"".concat(t).concat(e[r]),n.rel="stylesheet",n.classList.add("bimgis_sdk_style"),document.head.appendChild(n)}}(n,a),null!=r&&r.extraScriptUrl&&o.push.apply(o,yz(null==r?void 0:r.extraScriptUrl)),function(t,e,r){gz("bimgis_sdk_js"),function n(i){var o=document.createElement("script");o.src=/^http(s)?\:\/\//.test(e[i])?e[i]:"".concat(t).concat(e[i]),o.setAttribute("async","false"),o.classList.add("bimgis_sdk_js"),i===e.length-1?r&&(o.onload=r,o.onerror=r):(o.onload=function(){n(i+1)},o.onerror=function(){n(i+1)}),document.body.appendChild(o)}(0)}(n,o,e)}(r,(function(){var i;e._dispose||(vz(r),e._service=mz(t,r,!1),e._ready(),"cesium"!==r&&"supermap"!==r||null==n||null===(i=n.plugin)||void 0===i||!i.includes("diffuse")||(e._service.map.camera.changed.addEventListener(e._monitorDiffuse.bind(e._service.map)),e._monitorDiffuse.call(e._service.map)))}),n),e}return e=a,(r=[{key:"service",get:function(){return this._service}},{key:"_monitorDiffuse",value:function(){if(ye.diffuseMap.size>0){var t=this.camera.positionCartographic.height;ye.diffuseMap.forEach((function(e,r){r.ellipse.semiMinorAxis=t/e.radius,r.ellipse.semiMajorAxis=t/e.radius}))}}},{key:"_ready",value:function(){if(this._service)for(;this._queue.length>0;)this._queue.shift()(this._service)}},{key:"clearHtmlCanvasCache",value:function(){we.clear()}},{key:"ready",value:function(t){this._service?(this._ready(),t(this._service)):this._queue.push(t)}},{key:"dispose",value:function(){fz(hz(a.prototype),"dispose",this).call(this),gz("bimgis_sdk_style",!1),gz("bimgis_sdk_js"),this._queue.length=0,this._service&&this._service.dispose()}}])&&lz(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(_t);_z.version="1.1.2"})();var i=n.VT,o=n.VD,a=n.WB;export{i as MapInit,o as getMapService,a as setDefaultStyle};